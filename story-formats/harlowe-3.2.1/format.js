window.storyFormat({"name":"Harlowe","version":"3.2.1","author":"Leon Arnott","description":"The default story format for Twine 2. Now with an editor toolbar! Consult its <a href='https://twine2.neocities.org/' target='_blank' rel='noopener noreferrer'>documentation</a>.","image":"icon.svg","url":"http://twinery.org/","license":"Zlib","proofing":false,"source":"<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n<title>{{STORY_NAME}}</title>\n<style title=\"Twine CSS\">@keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes rumble{25%{top:-0.1em}75%{top:0.1em}0%,to{top:0px}}@keyframes shudder{25%{left:0.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes buoy{25%{top:0.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes sway{25%{left:0.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes shudder-in{0%, to{transform:translateX(0em)}5%, 25%, 45%{transform:translateX(-1em)}15%, 35%, 55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes rumble-in{0%, to{transform:translateY(0em)}5%, 25%, 45%{transform:translateY(-1em)}15%, 35%, 55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes fidget{0%, 8.1%, 82.1%, 31.1%, 38.1%, 44.1%, 40.1%, 47.1%, 74.1%, 16.1%, 27.1%, 72.1%, 24.1%, 95.1%, 6.1%, 36.1%, 20.1%, 4.1%, 91.1%, 14.1%, 87.1%, to{left:0px;top:0px}8%, 82%, 31%, 38%, 44%{left:-1px}40%, 47%, 74%, 16%, 27%{left:1px}72%, 24%, 95%, 6%, 36%{top:-1px}20%, 4%, 91%, 14%, 87%{top:1px}}@keyframes slide-right{0%{transform:translateX(-100vw)}}@keyframes slide-left{0%{transform:translateX(100vw)}}@keyframes slide-up{0%{transform:translateY(100vh)}}@keyframes slide-down{0%{transform:translateY(-100vh)}}@keyframes fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:0.2}64%{opacity:0.4}78%{opacity:0.6}87%{opacity:0.8}92%, to{opacity:1}}@keyframes blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}.dom-debug-mode tw-story,.dom-debug-mode tw-passage,.dom-debug-mode tw-sidebar,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{outline:1px solid #f5a3da;min-height:32px;display:block !important}.dom-debug-mode tw-story::before,.dom-debug-mode tw-passage::before,.dom-debug-mode tw-sidebar::before,.dom-debug-mode tw-include::before,.dom-debug-mode tw-hook::before,.dom-debug-mode tw-expression::before,.dom-debug-mode tw-link::before,.dom-debug-mode tw-dialog::before,.dom-debug-mode tw-columns::before,.dom-debug-mode tw-column::before,.dom-debug-mode tw-align::before{position:absolute;top:0;left:0;height:16px;background-color:#f5a3da;color:black;font-size:16px;font-weight:normal;font-style:normal;font-family:monospace;display:inline-block;line-height:100%;white-space:pre;z-index:999997}.dom-debug-mode tw-story:hover,.dom-debug-mode tw-passage:hover,.dom-debug-mode tw-sidebar:hover,.dom-debug-mode tw-include:hover,.dom-debug-mode tw-hook:hover,.dom-debug-mode tw-expression:hover,.dom-debug-mode tw-link:hover,.dom-debug-mode tw-dialog:hover,.dom-debug-mode tw-columns:hover,.dom-debug-mode tw-column:hover,.dom-debug-mode tw-align:hover{outline:1px solid #fc9}.dom-debug-mode tw-story:hover::before,.dom-debug-mode tw-passage:hover::before,.dom-debug-mode tw-sidebar:hover::before,.dom-debug-mode tw-include:hover::before,.dom-debug-mode tw-hook:hover::before,.dom-debug-mode tw-expression:hover::before,.dom-debug-mode tw-link:hover::before,.dom-debug-mode tw-dialog:hover::before,.dom-debug-mode tw-columns:hover::before,.dom-debug-mode tw-column:hover::before,.dom-debug-mode tw-align:hover::before{background-color:#fc9;transition:background-color 1s}.dom-debug-mode tw-passage,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{padding:1em;margin:0}.dom-debug-mode tw-story::before{content:'<tw-story tags=\"' attr(tags) '\">'}.dom-debug-mode tw-passage::before{top:-16px;content:'<tw-passage tags=\"' attr(tags) '\">'}.dom-debug-mode tw-sidebar::before{top:-16px;content:\"<tw-sidebar>\"}.dom-debug-mode tw-hook::before{content:'<tw-hook name=\"' attr(name) '\">'}.dom-debug-mode tw-expression::before{content:'<tw-expression name=\"' attr(name) '\">'}.dom-debug-mode tw-link::before{content:'<tw-link name=\"' attr(name) '\">'}.dom-debug-mode tw-dialog::before{content:\"<tw-dialog>\"}.dom-debug-mode tw-columns::before{content:\"<tw-columns>\"}.dom-debug-mode tw-column::before{content:\"<tw-column>\"}.dom-debug-mode tw-align::before{content:\"<tw-align>\"}.dom-debug-mode tw-include::before{content:'<tw-include type=\"' attr(type) '\" title=\"' attr(title) '\">'}.debug-mode tw-expression{display:inline-block !important}.debug-mode tw-expression[type=variable]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:\"$\" attr(name)}.debug-mode tw-expression[type=tempVariable]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:\"_\" attr(name)}.debug-mode tw-expression[return=boolean]{background-color:rgba(179,179,179,0.2)}.debug-mode tw-expression[return=array]{background-color:rgba(255,102,102,0.2)}.debug-mode tw-expression[return=dataset]{background-color:rgba(255,128,0,0.2)}.debug-mode tw-expression[return=number]{background-color:rgba(255,179,102,0.2)}.debug-mode tw-expression[return=datamap]{background-color:rgba(255,255,102,0.2)}.debug-mode tw-expression[return=changer]{background-color:rgba(179,255,102,0.2)}.debug-mode tw-expression[return=lambda]{background-color:rgba(102,255,102,0.2)}.debug-mode tw-expression[return=hookname]{background-color:rgba(102,255,204,0.2)}.debug-mode tw-expression[return=string]{background-color:rgba(102,255,255,0.2)}.debug-mode tw-expression[return=datatype]{background-color:rgba(102,153,255,0.2)}.debug-mode tw-expression[return=gradient],.debug-mode tw-expression[return=colour]{background-color:rgba(204,102,255,0.2)}.debug-mode tw-expression[return=instant],.debug-mode tw-expression[return=macro]{background-color:rgba(240,117,199,0.2)}.debug-mode tw-expression[return=command]{background-color:rgba(153,153,255,0.2)}.debug-mode tw-expression.false{background-color:rgba(255,0,0,0.2) !important}.debug-mode tw-expression[type=macro]::before{content:\"(\" attr(name) \":)\";padding:0 0.5rem;font-size:1rem;vertical-align:middle;line-height:normal;background-color:inherit;border:1px solid rgba(255,255,255,0.5)}.debug-mode tw-hook{background-color:rgba(0,85,255,0.1) !important}.debug-mode tw-hook::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:\"[\"}.debug-mode tw-hook::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:\"]\"}.debug-mode tw-hook[name]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:\"]<\" attr(name) \"|\"}.debug-mode tw-pseudo-hook{background-color:rgba(255,170,0,0.1) !important}.debug-mode tw-collapsed::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:\"{\"}.debug-mode tw-collapsed::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:\"}\"}.debug-mode tw-verbatim::before,.debug-mode tw-verbatim::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:\"`\"}.debug-mode tw-align[style*=\"text-align: center\"]{background:linear-gradient(to right, rgba(255,204,189,0) 0%, rgba(255,204,189,0.25) 50%, rgba(255,204,189,0) 100%)}.debug-mode tw-align[style*=\"text-align: left\"]{background:linear-gradient(to right, rgba(255,204,189,0.25) 0%, rgba(255,204,189,0) 100%)}.debug-mode tw-align[style*=\"text-align: right\"]{background:linear-gradient(to right, rgba(255,204,189,0) 0%, rgba(255,204,189,0.25) 100%)}.debug-mode tw-column{background-color:rgba(189,228,255,0.2)}.debug-mode tw-enchantment{animation:enchantment 0.5s infinite;border:1px solid}.debug-mode tw-link::after,.debug-mode tw-broken-link::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:attr(passage-name)}.debug-mode tw-include{background-color:rgba(204,128,51,0.1)}.debug-mode tw-include::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:attr(type) ' \"' attr(title) '\"'}@keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}tw-debugger{position:fixed;box-sizing:border-box;bottom:0;right:0;z-index:999999;min-width:10em;min-height:1em;padding:0em 0.5em 0.5em 1em;font-size:1.25em;font-family:sans-serif;color:#000;border-left:solid #000 2px;border-top:solid #000 2px;border-top-left-radius:.5em;background:#fff;opacity:1}tw-debugger select{margin-right:1em;width:12em}tw-debugger button{border-radius:3px;border:solid #999 1px;margin:auto 4px;background-color:#fff;font-size:inherit;color:#000}tw-debugger button.enabled{background-color:#eee;box-shadow:inset #ddd 3px 5px 0.5em}tw-debugger .panel{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;position:absolute;bottom:100%;left:-2px;right:0;padding:1em;max-height:40vh;overflow-y:scroll;overflow-x:hidden;z-index:999998;background:#fff;border:inherit;border-bottom:solid #999 2px;border-top-left-radius:.5em;border-bottom-left-radius:.5em;font-size:0.8em}tw-debugger .panel:empty,tw-debugger .panel[hidden]{display:none}tw-debugger .panel-source,tw-debugger .panel-row-source{font-family:monospace;overflow-x:scroll;white-space:pre;-ms-flex-preferred-size:100%;flex-basis:100%}tw-debugger .panel-row-source{margin:5px 0}tw-debugger .panel-rows{width:100%;overflow-x:scroll}tw-debugger .panel-rows>*{display:table-row}tw-debugger .panel-rows>div:nth-of-type(2n){background:#EEE}tw-debugger .panel-row-buttons{text-align:right}tw-debugger .panel-variables .panel-rows:empty::before{content:\"~ No variables ~\";font-style:italic;color:#888;text-align:center}tw-debugger .panel-enchantments .panel-rows:empty::before{content:\"~ No enchantments ~\";font-style:italic;color:#888;text-align:center}tw-debugger .panel-errors .panel-rows:empty::before{content:\"~ No errors... for now. ~\";font-style:italic;color:#888;text-align:center}tw-debugger .panel-rows:empty+.panel-variables-bottom{display:none}tw-debugger .panel-storylets:not(.panel-exclusive) .storylet-exclusive,tw-debugger .panel-storylets:not(.panel-urgent) .storylet-urgent{display:none}tw-debugger .panel-variables-bottom{padding-top:5px}tw-debugger .enchantment-row{min-height:1.5em}tw-debugger .variable-path{opacity:0.4}tw-debugger .temporary-variable-scope,tw-debugger .enchantment-local{font-family:sans-serif;font-weight:normal;opacity:0.8;font-size:0.75em}tw-debugger .temporary-variable-scope:not(:empty)::before,tw-debugger .enchantment-local:not(:empty)::before{content:\" in \"}tw-debugger .variable-name,tw-debugger .enchantment-name{font-family:monospace;font-weight:bold}tw-debugger .variable-type{color:#444;font-weight:normal;text-overflow:ellipsis;overflow:hidden;max-width:10em}tw-debugger .error-row{display:table-row;background-color:rgba(230,101,204,0.3)}tw-debugger .error-row:nth-of-type(2n){background-color:rgba(237,145,219,0.3)}tw-debugger .error-row>*{display:table-cell;padding:0.25em 0.5em}tw-debugger .error-row .error-message{cursor:help}tw-debugger .error-row .error-passage{color:#444}tw-debugger .storylet-row{background-color:rgba(201,233,222,0.3)}tw-debugger .storylet-row:nth-child(2n){background-color:rgba(128,203,178,0.3)}tw-debugger .storylet-row.storylet-closed{font-style:italic;opacity:0.4;background-color:rgba(217,217,217,0.3)}tw-debugger .storylet-row.storylet-closed:nth-child(2n){background-color:rgba(166,166,166,0.3)}.storylet-error tw-debugger .storylet-row{background-color:rgba(230,101,204,0.3)}.storylet-error tw-debugger .storylet-row:nth-child(2n){background-color:rgba(237,145,219,0.3)}tw-debugger .storylet-row .storylet-name,tw-debugger .storylet-row .storylet-value{display:inline-block;width:50%}tw-debugger .tabs{padding-bottom:0.5em}tw-debugger .tab{border-radius:0px 0px 0.5em 0.5em;border-top:none}tw-debugger .resizer{position:absolute;height:3em;border-left:2px solid #ccc;border-right:2px solid #ccc;top:10px;left:4px;width:8px;cursor:ew-resize}tw-dialog{z-index:999997;border:#fff solid 2px;padding:2em;color:#fff;background-color:#000;display:block}@media (min-width: 576px){tw-dialog{max-width:50vw}}tw-dialog input[type=text]{font-size:inherit;width:100%}tw-dialog-links{text-align:right;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}tw-backdrop{z-index:999996;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0.8);display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}tw-backdrop ~ tw-backdrop{display:none}tw-link,.link,tw-icon,.enchantment-clickblock{cursor:pointer}tw-link,.enchantment-link{color:#4169E1;font-weight:bold;text-decoration:none;transition:color 0.2s ease-in-out}tw-passage [style^=\"color\"] tw-link:not(:hover),tw-passage [style*=\" color\"] tw-link:not(:hover),tw-passage [style^=\"color\"][hover=\"true\"] tw-link:hover,tw-passage [style*=\" color\"][hover=\"true\"] tw-link:hover,tw-passage [style^=\"color\"] .enchantment-link:not(:hover),tw-passage [style*=\" color\"] .enchantment-link:not(:hover),tw-passage [style^=\"color\"][hover=\"true\"] .enchantment-link:hover,tw-passage [style*=\" color\"][hover=\"true\"] .enchantment-link:hover{color:inherit}tw-link:hover,.enchantment-link:hover{color:#00bfff}tw-link:active,.enchantment-link:active{color:#DD4B39}.visited{color:#6941e1}tw-passage [style^=\"color\"] .visited:not(:hover),tw-passage [style*=\" color\"] .visited:not(:hover),tw-passage [style^=\"color\"][hover=\"true\"] .visited:hover,tw-passage [style*=\" color\"][hover=\"true\"] .visited:hover{color:inherit}.visited:hover{color:#E3E}tw-broken-link{color:#993333;border-bottom:2px solid #993333;cursor:not-allowed}tw-passage [style^=\"color\"] tw-broken-link:not(:hover),tw-passage [style*=\" color\"] tw-broken-link:not(:hover),tw-passage [style^=\"color\"][hover=\"true\"] tw-broken-link:hover,tw-passage [style*=\" color\"][hover=\"true\"] tw-broken-link:hover{color:inherit}.enchantment-mouseover{border-bottom:2px dashed #999}.enchantment-mouseout{border:rgba(64,149,191,0.6) 1px solid}.enchantment-mouseout:hover{background-color:rgba(175,197,207,0.75);border:transparent 1px solid;border-radius:0.2em}.enchantment-clickblock{width:100%;height:100%;display:block}.enchantment-clickblock>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;color:rgba(65,105,225,0.5);transition:color 0.2s ease-in-out}.enchantment-clickblock>:not(tw-enchantment):hover::after{color:rgba(0,191,255,0.5)}.enchantment-clickblock>:not(tw-enchantment):active::after{color:rgba(222,78,59,0.5)}.enchantment-clickblock>:not(tw-enchantment)::after{box-shadow:inset 0 0 0 0.5vmax}.enchantment-clickblock>tw-passage::after,.enchantment-clickblock>tw-sidebar::after{box-shadow:0 0 0 0.5vmax}.enchantment-mouseoverblock>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:2px dashed #999}.enchantment-mouseoutblock>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:rgba(64,149,191,0.6) 2px solid}.enchantment-mouseoutblock:hover>:not(tw-enchantment)::after{content:\"\";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;background-color:rgba(175,197,207,0.75);border:transparent 2px solid;border-radius:0.2em}tw-link.enchantment-button,.enchantment-link.enchantment-button,.enchantment-button:not(.enchantment-link) tw-link,.enchantment-button:not(.enchantment-link) .enchantment-link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}tw-dialog-links{padding-top:1.5em}tw-dialog-links tw-link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block;display:inline-block}html{margin:0;height:100%;overflow-x:hidden}*,:before,:after{position:relative;box-sizing:inherit}body{margin:0;height:100%}tw-storydata{display:none}tw-story{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;font:100% Georgia, serif;box-sizing:border-box;width:100%;min-height:100%;font-size:1.5em;line-height:1.5em;padding:5% 5%;overflow:hidden;background-color:#000;color:#fff}tw-story [style*=content-box] *{box-sizing:border-box}@media (min-width: 576px){tw-story{padding:5% 20%}}tw-story tw-consecutive-br{display:block;height:1.6ex;visibility:hidden}tw-story select{background-color:transparent;font:inherit;border-style:solid;padding:2px}tw-story select:not([disabled]){color:inherit}tw-story textarea{resize:none;background-color:transparent;font:inherit;color:inherit;border-style:none;padding:2px}tw-story input[type=checkbox]{transform:scale(1.5);margin:0 0.5em}tw-story tw-noscript{animation:appear 0.8s}tw-passage{display:block}tw-sidebar{text-align:center;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}@media (min-width: 576px){tw-sidebar{left:-5em;width:3em;position:absolute;-ms-flex-direction:column;flex-direction:column}}tw-icon{display:inline-block;margin:0.5em 0;font-size:66px;font-family:\"Verdana\",sans-serif}tw-icon[alt]{opacity:0.2}tw-icon[alt]:hover{opacity:0.4}tw-icon[data-label]::after{font-weight:bold;content:attr(data-label);font-size:20px;bottom:-20px;left:-50%;white-space:nowrap}tw-meter{display:block}tw-hook:empty,tw-expression:empty{display:none}tw-error{display:inline-block;border-radius:0.2em;padding:0.2em;font-size:1rem;cursor:help;white-space:pre-wrap}tw-error.error{background-color:rgba(223,58,190,0.6);color:#fff}tw-error.warning{background-color:rgba(223,140,58,0.6);color:#fff;display:none}.debug-mode tw-error.warning{display:inline}tw-error-explanation{display:block;font-size:0.8rem;line-height:1rem}tw-open-button,tw-folddown{cursor:pointer;line-height:0em;border-radius:1px;border:1px solid black;font-size:0.8rem;margin:0 0.4rem;padding:2px;white-space:pre}tw-folddown::after{content:\"\\25b6\"}tw-folddown.open::after{content:\"\\25bc\"}tw-open-button::after{content:\"Open\"}tw-notifier{border-radius:0.2em;padding:0.2em;font-size:1rem;background-color:rgba(223,182,58,0.4);display:none}.debug-mode tw-notifier{display:inline}tw-notifier::before{content:attr(message)}tw-colour{border:1px solid black;display:inline-block;width:1em;height:1em}h1{font-size:3em}h2{font-size:2.25em}h3{font-size:1.75em}h1,h2,h3,h4,h5,h6{line-height:1em;margin:0.3em 0 0.6em 0}pre{font-size:1rem;line-height:initial}small{font-size:70%}big{font-size:120%}mark{color:rgba(0,0,0,0.6);background-color:#ff9}ins{color:rgba(0,0,0,0.6);background-color:rgba(255,242,204,0.5);border-radius:0.5em;box-shadow:0em 0em 0.2em #ffe699;text-decoration:none}center{text-align:center;margin:0 auto;width:60%}blink{text-decoration:none;animation:fade-in-out 1s steps(1, end) infinite alternate}tw-align{display:block}tw-columns{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:justify;justify-content:space-between}.transition-in{animation:appear 0ms step-start}.transition-out{animation:appear 0ms step-end}[data-t8n^=dissolve].transition-in,[data-t8n=fade].transition-in{animation:appear .8s}[data-t8n^=dissolve].transition-out,[data-t8n=fade].transition-out{animation:appear .8s reverse}[data-t8n^=shudder].transition-in{display:inline-block !important;animation:shudder-in .8s}[data-t8n^=shudder].transition-out{display:inline-block !important;animation:shudder-in .8s reverse}[data-t8n^=rumble].transition-in{display:inline-block !important;animation:rumble-in .8s}[data-t8n^=rumble].transition-out{display:inline-block !important;animation:rumble-in .8s reverse}[data-t8n^=pulse].transition-in{animation:pulse .8s;display:inline-block !important}[data-t8n^=pulse].transition-out{animation:pulse .8s reverse;display:inline-block !important}[data-t8n^=zoom].transition-in{animation:zoom-in .8s;display:inline-block !important}[data-t8n^=zoom].transition-out{animation:zoom-in .8s reverse;display:inline-block !important}[data-t8n^=blur].transition-in{animation:blur .8s;display:inline-block !important}[data-t8n^=blur].transition-out{animation:blur .8s reverse;display:inline-block !important}[data-t8n^=slideleft].transition-in{animation:slide-left .8s;display:inline-block !important}[data-t8n^=slideleft].transition-out{animation:slide-right .8s reverse;display:inline-block !important}[data-t8n^=slideright].transition-in{animation:slide-right .8s;display:inline-block !important}[data-t8n^=slideright].transition-out{animation:slide-left .8s reverse;display:inline-block !important}[data-t8n^=slideup].transition-in{animation:slide-up .8s;display:inline-block !important}[data-t8n^=slideup].transition-out{animation:slide-down .8s reverse;display:inline-block !important}[data-t8n^=slidedown].transition-in{animation:slide-down .8s;display:inline-block !important}[data-t8n^=slidedown].transition-out{animation:slide-up .8s reverse;display:inline-block !important}[data-t8n^=fadeleft].transition-in{animation:fade-left .8s;display:inline-block !important}[data-t8n^=fadeleft].transition-out{animation:fade-right .8s reverse;display:inline-block !important}[data-t8n^=faderight].transition-in{animation:fade-right .8s;display:inline-block !important}[data-t8n^=faderight].transition-out{animation:fade-left .8s reverse;display:inline-block !important}[data-t8n^=fadeup].transition-in{animation:fade-up .8s;display:inline-block !important}[data-t8n^=fadeup].transition-out{animation:fade-down .8s reverse;display:inline-block !important}[data-t8n^=fadedown].transition-in{animation:fade-down .8s;display:inline-block !important}[data-t8n^=fadedown].transition-out{animation:fade-up .8s reverse;display:inline-block !important}[data-t8n^=flicker].transition-in{animation:flicker .8s}[data-t8n^=flicker].transition-out{animation:flicker .8s reverse}\r\n</style>\n</head>\n<body>\n<tw-story><noscript><tw-noscript>JavaScript needs to be enabled to play {{STORY_NAME}}.</tw-noscript></noscript></tw-story>\n{{STORY_DATA}}\n<script title=\"Twine engine code\" data-main=\"harlowe\">\"use strict\";var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),_typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e};function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}!function(){\n/**\n * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.\n * Released under MIT license, http://github.com/requirejs/almond/LICENSE\n */var requirejs,require,define,root,factory;!function(e){var t,n,r,i,a={},o={},s={},c={},u=Object.prototype.hasOwnProperty,l=[].slice,p=/\\.js$/;function f(e,t){return u.call(e,t)}function d(e,t){var n,r,i,a,o,c,u,l,f,d,h,y=t&&t.split(\"/\"),m=s.map,g=m&&m[\"*\"]||{};if(e){for(o=(e=e.split(\"/\")).length-1,s.nodeIdCompat&&p.test(e[o])&&(e[o]=e[o].replace(p,\"\")),\".\"===e[0].charAt(0)&&y&&(e=y.slice(0,y.length-1).concat(e)),f=0;f<e.length;f++)if(\".\"===(h=e[f]))e.splice(f,1),f-=1;else if(\"..\"===h){if(0===f||1===f&&\"..\"===e[2]||\"..\"===e[f-1])continue;f>0&&(e.splice(f-1,2),f-=2)}e=e.join(\"/\")}if((y||g)&&m){for(f=(n=e.split(\"/\")).length;f>0;f-=1){if(r=n.slice(0,f).join(\"/\"),y)for(d=y.length;d>0;d-=1)if((i=m[y.slice(0,d).join(\"/\")])&&(i=i[r])){a=i,c=f;break}if(a)break;!u&&g&&g[r]&&(u=g[r],l=f)}!a&&u&&(a=u,c=l),a&&(n.splice(0,c,a),e=n.join(\"/\"))}return e}function h(t,r){return function(){var i=l.call(arguments,0);return\"string\"!=typeof i[0]&&1===i.length&&i.push(null),n.apply(e,i.concat([t,r]))}}function y(e){return function(t){a[e]=t}}function m(n){if(f(o,n)){var r=o[n];delete o[n],c[n]=!0,t.apply(e,r)}if(!f(a,n)&&!f(c,n))throw new Error(\"No \"+n);return a[n]}function g(e){var t,n=e?e.indexOf(\"!\"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function v(e){return e?g(e):[]}r=function(e,t){var n,r,i=g(e),a=i[0],o=t[1];return e=i[1],a&&(n=m(a=d(a,o))),a?e=n&&n.normalize?n.normalize(e,(r=o,function(e){return d(e,r)})):d(e,o):(a=(i=g(e=d(e,o)))[0],e=i[1],a&&(n=m(a))),{f:a?a+\"!\"+e:e,n:e,pr:a,p:n}},i={require:function(e){return h(e)},exports:function(e){var t=a[e];return void 0!==t?t:a[e]={}},module:function(e){return{id:e,uri:\"\",exports:a[e],config:function(e){return function(){return s&&s.config&&s.config[e]||{}}}(e)}}},t=function(t,n,s,u){var l,p,d,g,b,w,T,S=[],x=void 0===s?\"undefined\":_typeof(s);if(w=v(u=u||t),\"undefined\"===x||\"function\"===x){for(n=!n.length&&s.length?[\"require\",\"exports\",\"module\"]:n,b=0;b<n.length;b+=1)if(\"require\"===(p=(g=r(n[b],w)).f))S[b]=i.require(t);else if(\"exports\"===p)S[b]=i.exports(t),T=!0;else if(\"module\"===p)l=S[b]=i.module(t);else if(f(a,p)||f(o,p)||f(c,p))S[b]=m(p);else{if(!g.p)throw new Error(t+\" missing \"+p);g.p.load(g.n,h(u,!0),y(p),{}),S[b]=a[p]}d=s?s.apply(a[t],S):void 0,t&&(l&&l.exports!==e&&l.exports!==a[t]?a[t]=l.exports:d===e&&T||(a[t]=d))}else t&&(a[t]=s)},requirejs=require=n=function(a,o,c,u,l){if(\"string\"==typeof a)return i[a]?i[a](o):m(r(a,v(o)).f);if(!a.splice){if((s=a).deps&&n(s.deps,s.callback),!o)return;o.splice?(a=o,o=c,c=null):a=e}return o=o||function(){},\"function\"==typeof c&&(c=u,u=l),u?t(e,a,o,c):setTimeout(function(){t(e,a,o,c)},4),n},n.config=function(e){return n(e)},requirejs._defined=a,(define=function(e,t,n){if(\"string\"!=typeof e)throw new Error(\"See almond README: incorrect module build, no module name\");t.splice||(n=t,t=[]),f(a,e)||f(o,e)||(o[e]=[e,t,n])}).amd={jQuery:!0}}(),define(\"almond\",function(){}),\n/*!\n * https://github.com/paulmillr/es6-shim\n * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)\n *   and contributors,  MIT License\n * es6-shim: v0.35.4\n * see https://github.com/paulmillr/es6-shim/blob/0.35.3/LICENSE\n * Details and documentation:\n * https://github.com/paulmillr/es6-shim/\n */\nroot=this,factory=function(){var e,t,n=Function.call.bind(Function.apply),r=Function.call.bind(Function.call),i=Array.isArray,a=Object.keys,o=function(e){try{return e(),!1}catch(e){return!0}},s=function(e){try{return e()}catch(e){return!1}},c=(e=o,function(){return!n(e,this,arguments)}),u=!!Object.defineProperty&&!o(function(){return Object.defineProperty({},\"x\",{get:function(){}})}),l=\"foo\"===function(){}.name,p=Function.call.bind(Array.prototype.forEach),f=Function.call.bind(Array.prototype.reduce),d=Function.call.bind(Array.prototype.filter),h=Function.call.bind(Array.prototype.some),y=function(e,t,n,r){!r&&t in e||(u?Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n}):e[t]=n)},m=function(e,t,n){p(a(t),function(r){var i=t[r];y(e,r,i,!!n)})},g=Function.call.bind(Object.prototype.toString),v=\"function\"==typeof/abc/?function(e){return\"function\"==typeof e&&\"[object Function]\"===g(e)}:function(e){return\"function\"==typeof e},b=function(e,t,n){if(!u)throw new TypeError(\"getters require true ES5 support\");Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:n})},w=function(e,t,n){if(!u)throw new TypeError(\"getters require true ES5 support\");var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,{configurable:r.configurable,enumerable:r.enumerable,get:function(){return e[t]},set:function(n){e[t]=n}})},T=function(e,t,n){if(u){var r=Object.getOwnPropertyDescriptor(e,t);r.value=n,Object.defineProperty(e,t,r)}else e[t]=n},S=function(e,t,n){u?Object.defineProperty(e,t,n):\"value\"in n&&(e[t]=n.value)},x=function(e,t){t&&v(t.toString)&&y(e,\"toString\",t.toString.bind(t),!0)},k=Object.create||function(e,t){var n=function(){};n.prototype=e;var r=new n;return void 0!==t&&a(t).forEach(function(e){S(r,e,t[e])}),r},O=function(e,t){return!!Object.setPrototypeOf&&s(function(){var n=function t(n){var r=new e(n);return Object.setPrototypeOf(r,t.prototype),r};return Object.setPrototypeOf(n,e),n.prototype=k(e.prototype,{constructor:{value:n}}),t(n)})},j=function(){if(\"undefined\"!=typeof self)return self;if(\"undefined\"!=typeof window)return window;if(\"undefined\"!=typeof global)return global;throw new Error(\"unable to locate global object\")}(),A=j.isFinite,C=Function.call.bind(String.prototype.indexOf),E=Function.apply.bind(Array.prototype.indexOf),_=Function.call.bind(Array.prototype.concat),N=Function.call.bind(String.prototype.slice),P=Function.call.bind(Array.prototype.push),I=Function.apply.bind(Array.prototype.push),M=Function.call.bind(Array.prototype.shift),D=Math.max,R=Math.min,L=Math.floor,q=Math.abs,F=Math.exp,V=Math.log,H=Math.sqrt,z=Function.call.bind(Object.prototype.hasOwnProperty),$=function(){},B=j.Map,W=B&&B.prototype.delete,U=B&&B.prototype.get,G=B&&B.prototype.has,X=B&&B.prototype.set,Y=j.Symbol||{},J=Y.species||\"@@species\",K=Number.isNaN||function(e){return e!=e},Z=Number.isFinite||function(e){return\"number\"==typeof e&&A(e)},Q=v(Math.sign)?Math.sign:function(e){var t=Number(e);return 0===t?t:K(t)?t:t<0?-1:1},ee=function(e){var t=Number(e);return t<-1||K(t)?NaN:0===t||t===1/0?t:-1===t?-1/0:1+t-1==0?t:t*(V(1+t)/(1+t-1))},te=function(e){return\"[object Arguments]\"===g(e)},ne=te(arguments)?te:function(e){return null!==e&&\"object\"===(void 0===e?\"undefined\":_typeof(e))&&\"number\"==typeof e.length&&e.length>=0&&\"[object Array]\"!==g(e)&&\"[object Function]\"===g(e.callee)},re=function(e){return null===e||\"function\"!=typeof e&&\"object\"!==(void 0===e?\"undefined\":_typeof(e))},ie=function(e){return\"[object String]\"===g(e)},ae=function(e){return\"[object RegExp]\"===g(e)},oe=function(e){return\"function\"==typeof j.Symbol&&\"symbol\"===(void 0===e?\"undefined\":_typeof(e))},se=function(e,t,n){var r=e[t];y(e,t,n,!0),x(e[t],r)},ce=\"function\"==typeof Y&&\"function\"==typeof Y.for&&oe(Y()),ue=oe(Y.iterator)?Y.iterator:\"_es6-shim iterator_\";j.Set&&\"function\"==typeof(new j.Set)[\"@@iterator\"]&&(ue=\"@@iterator\"),j.Reflect||y(j,\"Reflect\",{},!0);var le,pe=j.Reflect,fe=String,de=\"undefined\"!=typeof document&&document?document.all:null,he=null==de?function(e){return null==e}:function(e){return null==e&&e!==de},ye={Call:function(e,t){var r=arguments.length>2?arguments[2]:[];if(!ye.IsCallable(e))throw new TypeError(e+\" is not a function\");return n(e,t,r)},RequireObjectCoercible:function(e,t){if(he(e))throw new TypeError(t||\"Cannot call method on \"+e);return e},TypeIsObject:function(e){return null!=e&&!0!==e&&!1!==e&&(\"function\"==typeof e||\"object\"===(void 0===e?\"undefined\":_typeof(e))||e===de)},ToObject:function(e,t){return Object(ye.RequireObjectCoercible(e,t))},IsCallable:v,IsConstructor:function(e){return ye.IsCallable(e)},ToInt32:function(e){return ye.ToNumber(e)>>0},ToUint32:function(e){return ye.ToNumber(e)>>>0},ToNumber:function(e){if(\"[object Symbol]\"===g(e))throw new TypeError(\"Cannot convert a Symbol value to a number\");return+e},ToInteger:function(e){var t=ye.ToNumber(e);return K(t)?0:0!==t&&Z(t)?(t>0?1:-1)*L(q(t)):t},ToLength:function(e){var t=ye.ToInteger(e);return t<=0?0:t>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:t},SameValue:function(e,t){return e===t?0!==e||1/e==1/t:K(e)&&K(t)},SameValueZero:function(e,t){return e===t||K(e)&&K(t)},IsIterable:function(e){return ye.TypeIsObject(e)&&(void 0!==e[ue]||ne(e))},GetIterator:function(e){if(ne(e))return new t(e,\"value\");var n=ye.GetMethod(e,ue);if(!ye.IsCallable(n))throw new TypeError(\"value is not an iterable\");var r=ye.Call(n,e);if(!ye.TypeIsObject(r))throw new TypeError(\"bad iterator\");return r},GetMethod:function(e,t){var n=ye.ToObject(e)[t];if(!he(n)){if(!ye.IsCallable(n))throw new TypeError(\"Method not callable: \"+t);return n}},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var n=ye.GetMethod(e,\"return\");if(void 0!==n){var r,i;try{r=ye.Call(n,e)}catch(e){i=e}if(!t){if(i)throw i;if(!ye.TypeIsObject(r))throw new TypeError(\"Iterator's return method returned a non-object.\")}}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!ye.TypeIsObject(t))throw new TypeError(\"bad iterator\");return t},IteratorStep:function(e){var t=ye.IteratorNext(e);return!ye.IteratorComplete(t)&&t},Construct:function(e,t,n,r){var i=void 0===n?e:n;if(!r&&pe.construct)return pe.construct(e,t,i);var a=i.prototype;ye.TypeIsObject(a)||(a=Object.prototype);var o=k(a),s=ye.Call(e,o,t);return ye.TypeIsObject(s)?s:o},SpeciesConstructor:function(e,t){var n=e.constructor;if(void 0===n)return t;if(!ye.TypeIsObject(n))throw new TypeError(\"Bad constructor\");var r=n[J];if(he(r))return t;if(!ye.IsConstructor(r))throw new TypeError(\"Bad @@species\");return r},CreateHTML:function(e,t,n,r){var i=ye.ToString(e),a=\"<\"+t;\"\"!==n&&(a+=\" \"+n+'=\"'+ye.ToString(r).replace(/\"/g,\"&quot;\")+'\"');return a+\">\"+i+\"</\"+t+\">\"},IsRegExp:function(e){if(!ye.TypeIsObject(e))return!1;var t=e[Y.match];return void 0!==t?!!t:ae(e)},ToString:function(e){return fe(e)}};if(u&&ce){var me=function(e){if(oe(Y[e]))return Y[e];var t=Y.for(\"Symbol.\"+e);return Object.defineProperty(Y,e,{configurable:!1,enumerable:!1,writable:!1,value:t}),t};if(!oe(Y.search)){var ge=me(\"search\"),ve=String.prototype.search;y(RegExp.prototype,ge,function(e){return ye.Call(ve,e,[this])});se(String.prototype,\"search\",function(e){var t=ye.RequireObjectCoercible(this);if(!he(e)){var n=ye.GetMethod(e,ge);if(void 0!==n)return ye.Call(n,e,[t])}return ye.Call(ve,t,[ye.ToString(e)])})}if(!oe(Y.replace)){var be=me(\"replace\"),we=String.prototype.replace;y(RegExp.prototype,be,function(e,t){return ye.Call(we,e,[this,t])});se(String.prototype,\"replace\",function(e,t){var n=ye.RequireObjectCoercible(this);if(!he(e)){var r=ye.GetMethod(e,be);if(void 0!==r)return ye.Call(r,e,[n,t])}return ye.Call(we,n,[ye.ToString(e),t])})}if(!oe(Y.split)){var Te=me(\"split\"),Se=String.prototype.split;y(RegExp.prototype,Te,function(e,t){return ye.Call(Se,e,[this,t])});se(String.prototype,\"split\",function(e,t){var n=ye.RequireObjectCoercible(this);if(!he(e)){var r=ye.GetMethod(e,Te);if(void 0!==r)return ye.Call(r,e,[n,t])}return ye.Call(Se,n,[ye.ToString(e),t])})}var xe=oe(Y.match),ke=xe&&((le={})[Y.match]=function(){return 42},42!==\"a\".match(le));if(!xe||ke){var Oe=me(\"match\"),je=String.prototype.match;y(RegExp.prototype,Oe,function(e){return ye.Call(je,e,[this])});se(String.prototype,\"match\",function(e){var t=ye.RequireObjectCoercible(this);if(!he(e)){var n=ye.GetMethod(e,Oe);if(void 0!==n)return ye.Call(n,e,[t])}return ye.Call(je,t,[ye.ToString(e)])})}}var Ae=function(e,t,n){x(t,e),Object.setPrototypeOf&&Object.setPrototypeOf(e,t),u?p(Object.getOwnPropertyNames(e),function(r){r in $||n[r]||w(e,r,t)}):p(Object.keys(e),function(r){r in $||n[r]||(t[r]=e[r])}),t.prototype=e.prototype,T(e.prototype,\"constructor\",t)},Ce=function(){return this},Ee=function(e){u&&!z(e,J)&&b(e,J,Ce)},_e=function(e,t){var n=t||function(){return this};y(e,ue,n),!e[ue]&&oe(ue)&&(e[ue]=n)},Ne=function(e,t,n){if(function(e,t,n){u?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,writable:!0,value:n}):e[t]=n}(e,t,n),!ye.SameValue(e[t],n))throw new TypeError(\"property is nonconfigurable\")},Pe=function(e,t,n,r){if(!ye.TypeIsObject(e))throw new TypeError(\"Constructor requires `new`: \"+t.name);var i=t.prototype;ye.TypeIsObject(i)||(i=n);var a=k(i);for(var o in r)if(z(r,o)){var s=r[o];y(a,o,s,!0)}return a};if(String.fromCodePoint&&1!==String.fromCodePoint.length){var Ie=String.fromCodePoint;se(String,\"fromCodePoint\",function(e){return ye.Call(Ie,this,arguments)})}var Me={fromCodePoint:function(e){for(var t,n=[],r=0,i=arguments.length;r<i;r++){if(t=Number(arguments[r]),!ye.SameValue(t,ye.ToInteger(t))||t<0||t>1114111)throw new RangeError(\"Invalid code point \"+t);t<65536?P(n,String.fromCharCode(t)):(t-=65536,P(n,String.fromCharCode(55296+(t>>10))),P(n,String.fromCharCode(t%1024+56320)))}return n.join(\"\")},raw:function(e){var t=ye.ToObject(e,\"bad callSite\"),n=ye.ToObject(t.raw,\"bad raw value\"),r=n.length,i=ye.ToLength(r);if(i<=0)return\"\";for(var a,o,s,c,u=[],l=0;l<i&&(a=ye.ToString(l),s=ye.ToString(n[a]),P(u,s),!(l+1>=i));)o=l+1<arguments.length?arguments[l+1]:\"\",c=ye.ToString(o),P(u,c),l+=1;return u.join(\"\")}};String.raw&&\"xy\"!==String.raw({raw:{0:\"x\",1:\"y\",length:2}})&&se(String,\"raw\",Me.raw),m(String,Me);var De={repeat:function(e){var t=ye.ToString(ye.RequireObjectCoercible(this)),n=ye.ToInteger(e);if(n<0||n>=1/0)throw new RangeError(\"repeat count must be less than infinity and not overflow maximum string size\");return function e(t,n){if(n<1)return\"\";if(n%2)return e(t,n-1)+t;var r=e(t,n/2);return r+r}(t,n)},startsWith:function(e){var t=ye.ToString(ye.RequireObjectCoercible(this));if(ye.IsRegExp(e))throw new TypeError('Cannot call method \"startsWith\" with a regex');var n,r=ye.ToString(e);arguments.length>1&&(n=arguments[1]);var i=D(ye.ToInteger(n),0);return N(t,i,i+r.length)===r},endsWith:function(e){var t=ye.ToString(ye.RequireObjectCoercible(this));if(ye.IsRegExp(e))throw new TypeError('Cannot call method \"endsWith\" with a regex');var n,r=ye.ToString(e),i=t.length;arguments.length>1&&(n=arguments[1]);var a=void 0===n?i:ye.ToInteger(n),o=R(D(a,0),i);return N(t,o-r.length,o)===r},includes:function(e){if(ye.IsRegExp(e))throw new TypeError('\"includes\" does not accept a RegExp');var t,n=ye.ToString(e);return arguments.length>1&&(t=arguments[1]),-1!==C(this,n,t)},codePointAt:function(e){var t=ye.ToString(ye.RequireObjectCoercible(this)),n=ye.ToInteger(e),r=t.length;if(n>=0&&n<r){var i=t.charCodeAt(n);if(i<55296||i>56319||n+1===r)return i;var a=t.charCodeAt(n+1);return a<56320||a>57343?i:1024*(i-55296)+(a-56320)+65536}}};if(String.prototype.includes&&!1!==\"a\".includes(\"a\",1/0)&&se(String.prototype,\"includes\",De.includes),String.prototype.startsWith&&String.prototype.endsWith){var Re=o(function(){return\"/a/\".startsWith(/a/)}),Le=s(function(){return!1===\"abc\".startsWith(\"a\",1/0)});Re&&Le||(se(String.prototype,\"startsWith\",De.startsWith),se(String.prototype,\"endsWith\",De.endsWith))}ce&&(s(function(){var e=/a/;return e[Y.match]=!1,\"/a/\".startsWith(e)})||se(String.prototype,\"startsWith\",De.startsWith),s(function(){var e=/a/;return e[Y.match]=!1,\"/a/\".endsWith(e)})||se(String.prototype,\"endsWith\",De.endsWith),s(function(){var e=/a/;return e[Y.match]=!1,\"/a/\".includes(e)})||se(String.prototype,\"includes\",De.includes));m(String.prototype,De);var qe=[\"\\t\\n\\v\\f\\r \\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\",\"\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\",\"\\u2029\\ufeff\"].join(\"\"),Fe=new RegExp(\"(^[\"+qe+\"]+)|([\"+qe+\"]+$)\",\"g\"),Ve=function(){return ye.ToString(ye.RequireObjectCoercible(this)).replace(Fe,\"\")},He=[\"\\x85\",\"\\u200b\",\"\\ufffe\"].join(\"\"),ze=new RegExp(\"[\"+He+\"]\",\"g\"),$e=/^[-+]0x[0-9a-f]+$/i,Be=He.trim().length!==He.length;y(String.prototype,\"trim\",Ve,Be);var We=function(e){return{value:e,done:0===arguments.length}},Ue=function(e){ye.RequireObjectCoercible(e),this._s=ye.ToString(e),this._i=0};Ue.prototype.next=function(){var e=this._s,t=this._i;if(void 0===e||t>=e.length)return this._s=void 0,We();var n,r,i=e.charCodeAt(t);return r=i<55296||i>56319||t+1===e.length?1:(n=e.charCodeAt(t+1))<56320||n>57343?1:2,this._i=t+r,We(e.substr(t,r))},_e(Ue.prototype),_e(String.prototype,function(){return new Ue(this)});var Ge={from:function(e){var t,n,i,a,o,s,c=this;if(arguments.length>1&&(t=arguments[1]),void 0===t)n=!1;else{if(!ye.IsCallable(t))throw new TypeError(\"Array.from: when provided, the second argument must be a function\");arguments.length>2&&(i=arguments[2]),n=!0}if(void 0!==(ne(e)||ye.GetMethod(e,ue))){o=ye.IsConstructor(c)?Object(new c):[];var u,l,p=ye.GetIterator(e);for(s=0;!1!==(u=ye.IteratorStep(p));){l=u.value;try{n&&(l=void 0===i?t(l,s):r(t,i,l,s)),o[s]=l}catch(e){throw ye.IteratorClose(p,!0),e}s+=1}a=s}else{var f,d=ye.ToObject(e);for(a=ye.ToLength(d.length),o=ye.IsConstructor(c)?Object(new c(a)):new Array(a),s=0;s<a;++s)f=d[s],n&&(f=void 0===i?t(f,s):r(t,i,f,s)),Ne(o,s,f)}return o.length=a,o},of:function(){for(var e=arguments.length,t=this,n=i(t)||!ye.IsCallable(t)?new Array(e):ye.Construct(t,[e]),r=0;r<e;++r)Ne(n,r,arguments[r]);return n.length=e,n}};m(Array,Ge),Ee(Array),m((t=function(e,t){this.i=0,this.array=e,this.kind=t}).prototype,{next:function(){var e=this.i,n=this.array;if(!(this instanceof t))throw new TypeError(\"Not an ArrayIterator\");if(void 0!==n)for(var r=ye.ToLength(n.length);e<r;e++){var i,a=this.kind;return\"key\"===a?i=e:\"value\"===a?i=n[e]:\"entry\"===a&&(i=[e,n[e]]),this.i=e+1,We(i)}return this.array=void 0,We()}}),_e(t.prototype),Array.of===Ge.of||function(){var e=function(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&2===t.length}()||se(Array,\"of\",Ge.of);var Xe={copyWithin:function(e,t){var n,r=ye.ToObject(this),i=ye.ToLength(r.length),a=ye.ToInteger(e),o=ye.ToInteger(t),s=a<0?D(i+a,0):R(a,i),c=o<0?D(i+o,0):R(o,i);arguments.length>2&&(n=arguments[2]);var u=void 0===n?i:ye.ToInteger(n),l=u<0?D(i+u,0):R(u,i),p=R(l-c,i-s),f=1;for(c<s&&s<c+p&&(f=-1,c+=p-1,s+=p-1);p>0;)c in r?r[s]=r[c]:delete r[s],c+=f,s+=f,p-=1;return r},fill:function(e){var t,n;arguments.length>1&&(t=arguments[1]),arguments.length>2&&(n=arguments[2]);var r=ye.ToObject(this),i=ye.ToLength(r.length);t=ye.ToInteger(void 0===t?0:t);for(var a=(n=ye.ToInteger(void 0===n?i:n))<0?i+n:n,o=t<0?D(i+t,0):R(t,i);o<i&&o<a;++o)r[o]=e;return r},find:function(e){var t=ye.ToObject(this),n=ye.ToLength(t.length);if(!ye.IsCallable(e))throw new TypeError(\"Array#find: predicate must be a function\");for(var i,a=arguments.length>1?arguments[1]:null,o=0;o<n;o++)if(i=t[o],a){if(r(e,a,i,o,t))return i}else if(e(i,o,t))return i},findIndex:function(e){var t=ye.ToObject(this),n=ye.ToLength(t.length);if(!ye.IsCallable(e))throw new TypeError(\"Array#findIndex: predicate must be a function\");for(var i=arguments.length>1?arguments[1]:null,a=0;a<n;a++)if(i){if(r(e,i,t[a],a,t))return a}else if(e(t[a],a,t))return a;return-1},keys:function(){return new t(this,\"key\")},values:function(){return new t(this,\"value\")},entries:function(){return new t(this,\"entry\")}};if(Array.prototype.keys&&!ye.IsCallable([1].keys().next)&&delete Array.prototype.keys,Array.prototype.entries&&!ye.IsCallable([1].entries().next)&&delete Array.prototype.entries,Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ue]&&(m(Array.prototype,{values:Array.prototype[ue]}),oe(Y.unscopables)&&(Array.prototype[Y.unscopables].values=!0)),l&&Array.prototype.values&&\"values\"!==Array.prototype.values.name){var Ye=Array.prototype.values;se(Array.prototype,\"values\",function(){return ye.Call(Ye,this,arguments)}),y(Array.prototype,ue,Array.prototype.values,!0)}m(Array.prototype,Xe),1/[!0].indexOf(!0,-0)<0&&y(Array.prototype,\"indexOf\",function(e){var t=E(this,arguments);return 0===t&&1/t<0?0:t},!0),_e(Array.prototype,function(){return this.values()}),Object.getPrototypeOf&&_e(Object.getPrototypeOf([].values()));var Je,Ke=s(function(){return 0===Array.from({length:-1}).length}),Ze=1===(Je=Array.from([0].entries())).length&&i(Je[0])&&0===Je[0][0]&&0===Je[0][1];if(Ke&&Ze||se(Array,\"from\",Ge.from),!s(function(){return Array.from([0],void 0)})){var Qe=Array.from;se(Array,\"from\",function(e){return arguments.length>1&&void 0!==arguments[1]?ye.Call(Qe,this,arguments):r(Qe,this,e)})}var et=-(Math.pow(2,32)-1),tt=function(e,t){var n={length:et};return n[t?(n.length>>>0)-1:0]=!0,s(function(){return r(e,n,function(){throw new RangeError(\"should not reach here\")},[]),!0})};if(!tt(Array.prototype.forEach)){var nt=Array.prototype.forEach;se(Array.prototype,\"forEach\",function(e){return ye.Call(nt,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.map)){var rt=Array.prototype.map;se(Array.prototype,\"map\",function(e){return ye.Call(rt,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.filter)){var it=Array.prototype.filter;se(Array.prototype,\"filter\",function(e){return ye.Call(it,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.some)){var at=Array.prototype.some;se(Array.prototype,\"some\",function(e){return ye.Call(at,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.every)){var ot=Array.prototype.every;se(Array.prototype,\"every\",function(e){return ye.Call(ot,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.reduce)){var st=Array.prototype.reduce;se(Array.prototype,\"reduce\",function(e){return ye.Call(st,this.length>=0?this:[],arguments)})}if(!tt(Array.prototype.reduceRight,!0)){var ct=Array.prototype.reduceRight;se(Array.prototype,\"reduceRight\",function(e){return ye.Call(ct,this.length>=0?this:[],arguments)})}var ut=8!==Number(\"0o10\"),lt=2!==Number(\"0b10\"),pt=h(He,function(e){return 0===Number(e+0+e)});if(ut||lt||pt){var ft=Number,dt=/^0b[01]+$/i,ht=/^0o[0-7]+$/i,yt=dt.test.bind(dt),mt=ht.test.bind(ht),gt=ze.test.bind(ze),vt=$e.test.bind($e),bt=function(){var e=function(t){var n;\"string\"==typeof(n=arguments.length>0?re(t)?t:function(e){var t;if(\"function\"==typeof e.valueOf&&(t=e.valueOf(),re(t)))return t;if(\"function\"==typeof e.toString&&(t=e.toString(),re(t)))return t;throw new TypeError(\"No default value\")}(t):0)&&(n=ye.Call(Ve,n),yt(n)?n=parseInt(N(n,2),2):mt(n)?n=parseInt(N(n,2),8):(gt(n)||vt(n))&&(n=NaN));var r=this,i=s(function(){return ft.prototype.valueOf.call(r),!0});return r instanceof e&&!i?new ft(n):ft(n)};return e}();Ae(ft,bt,{}),m(bt,{NaN:ft.NaN,MAX_VALUE:ft.MAX_VALUE,MIN_VALUE:ft.MIN_VALUE,NEGATIVE_INFINITY:ft.NEGATIVE_INFINITY,POSITIVE_INFINITY:ft.POSITIVE_INFINITY}),Number=bt,T(j,\"Number\",bt)}var wt=Math.pow(2,53)-1;m(Number,{MAX_SAFE_INTEGER:wt,MIN_SAFE_INTEGER:-wt,EPSILON:2.220446049250313e-16,parseInt:j.parseInt,parseFloat:j.parseFloat,isFinite:Z,isInteger:function(e){return Z(e)&&ye.ToInteger(e)===e},isSafeInteger:function(e){return Number.isInteger(e)&&q(e)<=Number.MAX_SAFE_INTEGER},isNaN:K}),y(Number,\"parseInt\",j.parseInt,Number.parseInt!==j.parseInt),1===[,1].find(function(){return!0})&&se(Array.prototype,\"find\",Xe.find),0!==[,1].findIndex(function(){return!0})&&se(Array.prototype,\"findIndex\",Xe.findIndex);var Tt,St,xt,kt=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable),Ot=function(e,t){u&&kt(e,t)&&Object.defineProperty(e,t,{enumerable:!1})},jt=function(){for(var e=Number(this),t=arguments.length,n=t-e,r=new Array(n<0?0:n),i=e;i<t;++i)r[i-e]=arguments[i];return r},At=function(e){return function(t,n){return t[n]=e[n],t}},Ct=function(e,t){var n,r=a(Object(t));return ye.IsCallable(Object.getOwnPropertySymbols)&&(n=d(Object.getOwnPropertySymbols(Object(t)),kt(t))),f(_(r,n||[]),At(t),e)},Et={assign:function(e,t){var n=ye.ToObject(e,\"Cannot convert undefined or null to object\");return f(ye.Call(jt,1,arguments),Ct,n)},is:function(e,t){return ye.SameValue(e,t)}};if(Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,\"xy\")}catch(t){return\"y\"===e[1]}}()&&se(Object,\"assign\",Et.assign),m(Object,Et),u){var _t={setPrototypeOf:function(e,t){var n,i=function(e,t){return function(e,t){if(!ye.TypeIsObject(e))throw new TypeError(\"cannot set prototype on a non-object\");if(null!==t&&!ye.TypeIsObject(t))throw new TypeError(\"can only set prototype to an object or null\"+t)}(e,t),r(n,e,t),e};try{n=e.getOwnPropertyDescriptor(e.prototype,\"__proto__\").set,r(n,{},null)}catch(t){if(e.prototype!=={}.__proto__)return;n=function(e){this.__proto__=e},i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object)};m(Object,_t)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&null!==Object.getPrototypeOf(Object.setPrototypeOf({},null))&&null===Object.getPrototypeOf(Object.create(null))&&(Tt=Object.create(null),St=Object.getPrototypeOf,xt=Object.setPrototypeOf,Object.getPrototypeOf=function(e){var t=St(e);return t===Tt?null:t},Object.setPrototypeOf=function(e,t){return xt(e,null===t?Tt:t)},Object.setPrototypeOf.polyfill=!1),!!o(function(){return Object.keys(\"foo\")})){var Nt=Object.keys;se(Object,\"keys\",function(e){return Nt(ye.ToObject(e))}),a=Object.keys}if(o(function(){return Object.keys(/a/g)})){var Pt=Object.keys;se(Object,\"keys\",function(e){if(ae(e)){var t=[];for(var n in e)z(e,n)&&P(t,n);return t}return Pt(e)}),a=Object.keys}if(Object.getOwnPropertyNames&&!!o(function(){return Object.getOwnPropertyNames(\"foo\")})){var It=\"object\"===(\"undefined\"==typeof window?\"undefined\":_typeof(window))?Object.getOwnPropertyNames(window):[],Mt=Object.getOwnPropertyNames;se(Object,\"getOwnPropertyNames\",function(e){var t=ye.ToObject(e);if(\"[object Window]\"===g(t))try{return Mt(t)}catch(e){return _([],It)}return Mt(t)})}if(Object.getOwnPropertyDescriptor&&!!o(function(){return Object.getOwnPropertyDescriptor(\"foo\",\"bar\")})){var Dt=Object.getOwnPropertyDescriptor;se(Object,\"getOwnPropertyDescriptor\",function(e,t){return Dt(ye.ToObject(e),t)})}if(Object.seal&&!!o(function(){return Object.seal(\"foo\")})){var Rt=Object.seal;se(Object,\"seal\",function(e){return ye.TypeIsObject(e)?Rt(e):e})}if(Object.isSealed&&!!o(function(){return Object.isSealed(\"foo\")})){var Lt=Object.isSealed;se(Object,\"isSealed\",function(e){return!ye.TypeIsObject(e)||Lt(e)})}if(Object.freeze&&!!o(function(){return Object.freeze(\"foo\")})){var qt=Object.freeze;se(Object,\"freeze\",function(e){return ye.TypeIsObject(e)?qt(e):e})}if(Object.isFrozen&&!!o(function(){return Object.isFrozen(\"foo\")})){var Ft=Object.isFrozen;se(Object,\"isFrozen\",function(e){return!ye.TypeIsObject(e)||Ft(e)})}if(Object.preventExtensions&&!!o(function(){return Object.preventExtensions(\"foo\")})){var Vt=Object.preventExtensions;se(Object,\"preventExtensions\",function(e){return ye.TypeIsObject(e)?Vt(e):e})}if(Object.isExtensible&&!!o(function(){return Object.isExtensible(\"foo\")})){var Ht=Object.isExtensible;se(Object,\"isExtensible\",function(e){return!!ye.TypeIsObject(e)&&Ht(e)})}if(Object.getPrototypeOf&&!!o(function(){return Object.getPrototypeOf(\"foo\")})){var zt=Object.getPrototypeOf;se(Object,\"getPrototypeOf\",function(e){return zt(ye.ToObject(e))})}var $t,Bt=u&&(($t=Object.getOwnPropertyDescriptor(RegExp.prototype,\"flags\"))&&ye.IsCallable($t.get));if(u&&!Bt){b(RegExp.prototype,\"flags\",function(){if(!ye.TypeIsObject(this))throw new TypeError(\"Method called on incompatible type: must be an object.\");var e=\"\";return this.global&&(e+=\"g\"),this.ignoreCase&&(e+=\"i\"),this.multiline&&(e+=\"m\"),this.unicode&&(e+=\"u\"),this.sticky&&(e+=\"y\"),e})}var Wt,Ut=u&&s(function(){return\"/a/i\"===String(new RegExp(/a/g,\"i\"))}),Gt=ce&&u&&((Wt=/./)[Y.match]=!1,RegExp(Wt)===Wt),Xt=s(function(){return\"/abc/\"===RegExp.prototype.toString.call({source:\"abc\"})}),Yt=Xt&&s(function(){return\"/a/b\"===RegExp.prototype.toString.call({source:\"a\",flags:\"b\"})});if(!Xt||!Yt){var Jt=RegExp.prototype.toString;y(RegExp.prototype,\"toString\",function(){var e=ye.RequireObjectCoercible(this);return ae(e)?r(Jt,e):\"/\"+fe(e.source)+\"/\"+fe(e.flags)},!0),x(RegExp.prototype.toString,Jt)}if(u&&(!Ut||Gt)){var Kt=Object.getOwnPropertyDescriptor(RegExp.prototype,\"flags\").get,Zt=Object.getOwnPropertyDescriptor(RegExp.prototype,\"source\")||{},Qt=ye.IsCallable(Zt.get)?Zt.get:function(){return this.source},en=RegExp,tn=function e(t,n){var r=ye.IsRegExp(t);return this instanceof e||!r||void 0!==n||t.constructor!==e?ae(t)?new e(ye.Call(Qt,t),void 0===n?ye.Call(Kt,t):n):(r&&(t.source,void 0===n&&t.flags),new en(t,n)):t};Ae(en,tn,{$input:!0}),RegExp=tn,T(j,\"RegExp\",tn)}if(u){var nn={input:\"$_\",lastMatch:\"$&\",lastParen:\"$+\",leftContext:\"$`\",rightContext:\"$'\"};p(a(nn),function(e){e in RegExp&&!(nn[e]in RegExp)&&b(RegExp,nn[e],function(){return RegExp[e]})})}Ee(RegExp);var rn=1/Number.EPSILON,an=Math.pow(2,-23),on=Math.pow(2,127)*(2-an),sn=Math.pow(2,-126),cn=Math.E,un=Math.LOG2E,ln=Math.LOG10E,pn=Number.prototype.clz;delete Number.prototype.clz;var fn={acosh:function(e){var t=Number(e);if(K(t)||e<1)return NaN;if(1===t)return 0;if(t===1/0)return t;var n=1/(t*t);if(t<2)return ee(t-1+H(1-n)*t);var r=t/2;return ee(r+H(1-n)*r-1)+1/un},asinh:function(e){var t=Number(e);if(0===t||!A(t))return t;var n=q(t),r=n*n,i=Q(t);return n<1?i*ee(n+r/(H(r+1)+1)):i*(ee(n/2+H(1+1/r)*n/2-1)+1/un)},atanh:function(e){var t=Number(e);if(0===t)return t;if(-1===t)return-1/0;if(1===t)return 1/0;if(K(t)||t<-1||t>1)return NaN;var n=q(t);return Q(t)*ee(2*n/(1-n))/2},cbrt:function(e){var t=Number(e);if(0===t)return t;var n,r=t<0;return r&&(t=-t),n=t===1/0?1/0:(t/((n=F(V(t)/3))*n)+2*n)/3,r?-n:n},clz32:function(e){var t=Number(e),n=ye.ToUint32(t);return 0===n?32:pn?ye.Call(pn,n):31-L(V(n+.5)*un)},cosh:function(e){var t=Number(e);if(0===t)return 1;if(K(t))return NaN;if(!A(t))return 1/0;var n=F(q(t)-1);return(n+1/(n*cn*cn))*(cn/2)},expm1:function(e){var t=Number(e);if(t===-1/0)return-1;if(!A(t)||0===t)return t;if(q(t)>.5)return F(t)-1;for(var n=t,r=0,i=1;r+n!==r;)r+=n,n*=t/(i+=1);return r},hypot:function(e,t){for(var n=0,r=0,i=0;i<arguments.length;++i){var a=q(Number(arguments[i]));r<a?(n*=r/a*(r/a),n+=1,r=a):n+=a>0?a/r*(a/r):a}return r===1/0?1/0:r*H(n)},log2:function(e){return V(e)*un},log10:function(e){return V(e)*ln},log1p:ee,sign:Q,sinh:function(e){var t=Number(e);if(!A(t)||0===t)return t;var n=q(t);if(n<1){var r=Math.expm1(n);return Q(t)*r*(1+1/(r+1))/2}var i=F(n-1);return Q(t)*(i-1/(i*cn*cn))*(cn/2)},tanh:function(e){var t=Number(e);return K(t)||0===t?t:t>=20?1:t<=-20?-1:(Math.expm1(t)-Math.expm1(-t))/(F(t)+F(-t))},trunc:function(e){var t=Number(e);return t<0?-L(-t):L(t)},imul:function(e,t){var n=ye.ToUint32(e),r=ye.ToUint32(t),i=65535&n,a=65535&r;return i*a+((n>>>16&65535)*a+i*(r>>>16&65535)<<16>>>0)|0},fround:function(e){var t=Number(e);if(0===t||t===1/0||t===-1/0||K(t))return t;var n=Q(t),r=q(t);if(r<sn)return n*(r/sn/an+rn-rn)*sn*an;var i=(1+an/Number.EPSILON)*r,a=i-(i-r);return a>on||K(a)?n*(1/0):n*a}},dn=function(e,t,n){return q(1-e/t)/Number.EPSILON<(n||8)};m(Math,fn),y(Math,\"sinh\",fn.sinh,Math.sinh(710)===1/0),y(Math,\"cosh\",fn.cosh,Math.cosh(710)===1/0),y(Math,\"log1p\",fn.log1p,-1e-17!==Math.log1p(-1e-17)),y(Math,\"asinh\",fn.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7)),y(Math,\"asinh\",fn.asinh,Math.asinh(1e300)===1/0),y(Math,\"atanh\",fn.atanh,0===Math.atanh(1e-300)),y(Math,\"tanh\",fn.tanh,-2e-17!==Math.tanh(-2e-17)),y(Math,\"acosh\",fn.acosh,Math.acosh(Number.MAX_VALUE)===1/0),y(Math,\"acosh\",fn.acosh,!dn(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON))),y(Math,\"cbrt\",fn.cbrt,!dn(Math.cbrt(1e-300),1e-100)),y(Math,\"sinh\",fn.sinh,-2e-17!==Math.sinh(-2e-17));var hn=Math.expm1(10);y(Math,\"expm1\",fn.expm1,hn>22025.465794806718||hn<22025.465794806718);var yn=Math.round,mn=0===Math.round(.5-Number.EPSILON/4)&&1===Math.round(Number.EPSILON/3.99-.5),gn=[rn+1,2*rn-1].every(function(e){return Math.round(e)===e});y(Math,\"round\",function(e){var t=L(e);return e-t<.5?t:-1===t?-0:t+1},!mn||!gn),x(Math.round,yn);var vn=Math.imul;-5!==Math.imul(4294967295,5)&&(Math.imul=fn.imul,x(Math.imul,vn)),2!==Math.imul.length&&se(Math,\"imul\",function(e,t){return ye.Call(vn,Math,arguments)});var bn,wn,Tn=function(){var e=j.setTimeout;if(\"function\"==typeof e||\"object\"===(void 0===e?\"undefined\":_typeof(e))){ye.IsPromise=function(e){return!!ye.TypeIsObject(e)&&void 0!==e._promise};var t,n=function(e){if(!ye.IsConstructor(e))throw new TypeError(\"Bad promise constructor\");var t=this;if(t.resolve=void 0,t.reject=void 0,t.promise=new e(function(e,n){if(void 0!==t.resolve||void 0!==t.reject)throw new TypeError(\"Bad Promise implementation!\");t.resolve=e,t.reject=n}),!ye.IsCallable(t.resolve)||!ye.IsCallable(t.reject))throw new TypeError(\"Bad promise constructor\")};\"undefined\"!=typeof window&&ye.IsCallable(window.postMessage)&&(t=function(){var e=[];return window.addEventListener(\"message\",function(t){if(t.source===window&&\"zero-timeout-message\"===t.data){if(t.stopPropagation(),0===e.length)return;M(e)()}},!0),function(t){P(e,t),window.postMessage(\"zero-timeout-message\",\"*\")}});var i,a,o,s,c,u=ye.IsCallable(j.setImmediate)?j.setImmediate:\"object\"===(\"undefined\"==typeof process?\"undefined\":_typeof(process))&&process.nextTick?process.nextTick:(i=j.Promise,(a=i&&i.resolve&&i.resolve())&&function(e){return a.then(e)}||(ye.IsCallable(t)?t():function(t){e(t,0)})),l=function(e){return e},p=function(e){throw e},f={},d=function(e,t,n){u(function(){h(e,t,n)})},h=function(e,t,n){var r,i;if(t===f)return e(n);try{r=e(n),i=t.resolve}catch(e){r=e,i=t.reject}i(r)},y=function(e,t){var n=e._promise,r=n.reactionLength;if(r>0&&(d(n.fulfillReactionHandler0,n.reactionCapability0,t),n.fulfillReactionHandler0=void 0,n.rejectReactions0=void 0,n.reactionCapability0=void 0,r>1))for(var i=1,a=0;i<r;i++,a+=3)d(n[a+0],n[a+2],t),e[a+0]=void 0,e[a+1]=void 0,e[a+2]=void 0;n.result=t,n.state=1,n.reactionLength=0},g=function(e,t){var n=e._promise,r=n.reactionLength;if(r>0&&(d(n.rejectReactionHandler0,n.reactionCapability0,t),n.fulfillReactionHandler0=void 0,n.rejectReactions0=void 0,n.reactionCapability0=void 0,r>1))for(var i=1,a=0;i<r;i++,a+=3)d(n[a+1],n[a+2],t),e[a+0]=void 0,e[a+1]=void 0,e[a+2]=void 0;n.result=t,n.state=2,n.reactionLength=0},v=function(e){var t=!1;return{resolve:function(n){var r;if(!t){if(t=!0,n===e)return g(e,new TypeError(\"Self resolution\"));if(!ye.TypeIsObject(n))return y(e,n);try{r=n.then}catch(t){return g(e,t)}if(!ye.IsCallable(r))return y(e,n);u(function(){w(e,n,r)})}},reject:function(n){if(!t)return t=!0,g(e,n)}}},b=function(e,t,n,i){e===s?r(e,t,n,i,f):r(e,t,n,i)},w=function(e,t,n){var r=v(e),i=r.resolve,a=r.reject;try{b(n,t,i,a)}catch(e){a(e)}},T=c=function(e){if(!(this instanceof c))throw new TypeError('Constructor Promise requires \"new\"');if(this&&this._promise)throw new TypeError(\"Bad construction\");if(!ye.IsCallable(e))throw new TypeError(\"not a valid resolver\");var t=Pe(this,c,o,{_promise:{result:void 0,state:0,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}}),n=v(t),r=n.reject;try{e(n.resolve,r)}catch(e){r(e)}return t};o=T.prototype;var S=function(e,t,n,r){var i=!1;return function(a){i||(i=!0,t[e]=a,0==--r.count&&(0,n.resolve)(t))}};return m(T,{all:function(e){var t=this;if(!ye.TypeIsObject(t))throw new TypeError(\"Promise is not object\");var r,i,a=new n(t);try{return function(e,t,n){for(var r,i,a=e.iterator,o=[],s={count:1},c=0;;){try{if(!1===(r=ye.IteratorStep(a))){e.done=!0;break}i=r.value}catch(t){throw e.done=!0,t}o[c]=void 0;var u=t.resolve(i),l=S(c,o,n,s);s.count+=1,b(u.then,u,l,n.reject),c+=1}0==--s.count&&(0,n.resolve)(o);return n.promise}(i={iterator:r=ye.GetIterator(e),done:!1},t,a)}catch(e){var o=e;if(i&&!i.done)try{ye.IteratorClose(r,!0)}catch(e){o=e}return(0,a.reject)(o),a.promise}},race:function(e){var t=this;if(!ye.TypeIsObject(t))throw new TypeError(\"Promise is not object\");var r,i,a=new n(t);try{return function(e,t,n){for(var r,i,a,o=e.iterator;;){try{if(!1===(r=ye.IteratorStep(o))){e.done=!0;break}i=r.value}catch(t){throw e.done=!0,t}a=t.resolve(i),b(a.then,a,n.resolve,n.reject)}return n.promise}(i={iterator:r=ye.GetIterator(e),done:!1},t,a)}catch(e){var o=e;if(i&&!i.done)try{ye.IteratorClose(r,!0)}catch(e){o=e}return(0,a.reject)(o),a.promise}},reject:function(e){if(!ye.TypeIsObject(this))throw new TypeError(\"Bad promise constructor\");var t=new n(this);return(0,t.reject)(e),t.promise},resolve:function(e){var t=this;if(!ye.TypeIsObject(t))throw new TypeError(\"Bad promise constructor\");if(ye.IsPromise(e)&&e.constructor===t)return e;var r=new n(t);return(0,r.resolve)(e),r.promise}}),m(o,{catch:function(e){return this.then(null,e)},then:function(e,t){if(!ye.IsPromise(this))throw new TypeError(\"not a promise\");var r,i=ye.SpeciesConstructor(this,T);r=arguments.length>2&&arguments[2]===f&&i===T?f:new n(i);var a,o=ye.IsCallable(e)?e:l,s=ye.IsCallable(t)?t:p,c=this._promise;if(0===c.state){if(0===c.reactionLength)c.fulfillReactionHandler0=o,c.rejectReactionHandler0=s,c.reactionCapability0=r;else{var u=3*(c.reactionLength-1);c[u+0]=o,c[u+1]=s,c[u+2]=r}c.reactionLength+=1}else if(1===c.state)a=c.result,d(o,r,a);else{if(2!==c.state)throw new TypeError(\"unexpected Promise state\");a=c.result,d(s,r,a)}return r.promise}}),f=new n(T),s=o.then,T}}();if(j.Promise&&(delete j.Promise.accept,delete j.Promise.defer,delete j.Promise.prototype.chain),\"function\"==typeof Tn){m(j,{Promise:Tn});var Sn=O(j.Promise,function(e){return e.resolve(42).then(function(){})instanceof e}),xn=!o(function(){return j.Promise.reject(42).then(null,5).then(null,$)}),kn=o(function(){return j.Promise.call(3,$)}),On=function(e){var t=e.resolve(5);t.constructor={};var n=e.resolve(t);try{n.then(null,$).then(null,$)}catch(e){return!0}return t===n}(j.Promise),jn=u&&(bn=0,wn=Object.defineProperty({},\"then\",{get:function(){bn+=1}}),Promise.resolve(wn),1===bn),An=function e(t){var n=new Promise(t);t(3,function(){}),this.then=n.then,this.constructor=e};An.prototype=Promise.prototype,An.all=Promise.all;var Cn=s(function(){return!!An.all([1,2])});if(Sn&&xn&&kn&&!On&&jn&&!Cn||(Promise=Tn,se(j,\"Promise\",Tn)),1!==Promise.all.length){var En=Promise.all;se(Promise,\"all\",function(e){return ye.Call(En,this,arguments)})}if(1!==Promise.race.length){var _n=Promise.race;se(Promise,\"race\",function(e){return ye.Call(_n,this,arguments)})}if(1!==Promise.resolve.length){var Nn=Promise.resolve;se(Promise,\"resolve\",function(e){return ye.Call(Nn,this,arguments)})}if(1!==Promise.reject.length){var Pn=Promise.reject;se(Promise,\"reject\",function(e){return ye.Call(Pn,this,arguments)})}Ot(Promise,\"all\"),Ot(Promise,\"race\"),Ot(Promise,\"resolve\"),Ot(Promise,\"reject\"),Ee(Promise)}var In,Mn,Dn=function(e){var t=a(f(e,function(e,t){return e[t]=!0,e},{}));return e.join(\":\")===t.join(\":\")},Rn=Dn([\"z\",\"a\",\"bb\"]),Ln=Dn([\"z\",1,\"a\",\"3\",2]);if(u){var qn=function(e,t){return t||Rn?he(e)?\"^\"+ye.ToString(e):\"string\"==typeof e?\"$\"+e:\"number\"==typeof e?Ln?e:\"n\"+e:\"boolean\"==typeof e?\"b\"+e:null:null},Fn=function(){return Object.create?Object.create(null):{}},Vn=function(e,t,n){if(i(n)||ie(n))p(n,function(e){if(!ye.TypeIsObject(e))throw new TypeError(\"Iterator value \"+e+\" is not an entry object\");t.set(e[0],e[1])});else if(n instanceof e)r(e.prototype.forEach,n,function(e,n){t.set(n,e)});else{var a,o;if(!he(n)){if(o=t.set,!ye.IsCallable(o))throw new TypeError(\"bad map\");a=ye.GetIterator(n)}if(void 0!==a)for(;;){var s=ye.IteratorStep(a);if(!1===s)break;var c=s.value;try{if(!ye.TypeIsObject(c))throw new TypeError(\"Iterator value \"+c+\" is not an entry object\");r(o,t,c[0],c[1])}catch(e){throw ye.IteratorClose(a,!0),e}}}},Hn=function(e,t,n){if(i(n)||ie(n))p(n,function(e){t.add(e)});else if(n instanceof e)r(e.prototype.forEach,n,function(e){t.add(e)});else{var a,o;if(!he(n)){if(o=t.add,!ye.IsCallable(o))throw new TypeError(\"bad set\");a=ye.GetIterator(n)}if(void 0!==a)for(;;){var s=ye.IteratorStep(a);if(!1===s)break;var c=s.value;try{r(o,t,c)}catch(e){throw ye.IteratorClose(a,!0),e}}}},zn={Map:function(){var e={},t=function(e,t){this.key=e,this.value=t,this.next=null,this.prev=null};t.prototype.isRemoved=function(){return this.key===e};var n,i=function(e,t){if(!ye.TypeIsObject(e)||!function(e){return!!e._es6map}(e))throw new TypeError(\"Method Map.prototype.\"+t+\" called on incompatible receiver \"+ye.ToString(e))},a=function(e,t){i(e,\"[[MapIterator]]\"),this.head=e._head,this.i=this.head,this.kind=t};_e(a.prototype={isMapIterator:!0,next:function(){if(!this.isMapIterator)throw new TypeError(\"Not a MapIterator\");var e,t=this.i,n=this.kind,r=this.head;if(void 0===this.i)return We();for(;t.isRemoved()&&t!==r;)t=t.prev;for(;t.next!==r;)if(!(t=t.next).isRemoved())return e=\"key\"===n?t.key:\"value\"===n?t.value:[t.key,t.value],this.i=t,We(e);return this.i=void 0,We()}});var o=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires \"new\"');if(this&&this._es6map)throw new TypeError(\"Bad construction\");var r=Pe(this,e,n,{_es6map:!0,_head:null,_map:B?new B:null,_size:0,_storage:Fn()}),i=new t(null,null);return i.next=i.prev=i,r._head=i,arguments.length>0&&Vn(e,r,arguments[0]),r};return b(n=o.prototype,\"size\",function(){if(void 0===this._size)throw new TypeError(\"size method called on incompatible Map\");return this._size}),m(n,{get:function(e){var t;i(this,\"get\");var n=qn(e,!0);if(null!==n)return(t=this._storage[n])?t.value:void 0;if(this._map)return(t=U.call(this._map,e))?t.value:void 0;for(var r=this._head,a=r;(a=a.next)!==r;)if(ye.SameValueZero(a.key,e))return a.value},has:function(e){i(this,\"has\");var t=qn(e,!0);if(null!==t)return void 0!==this._storage[t];if(this._map)return G.call(this._map,e);for(var n=this._head,r=n;(r=r.next)!==n;)if(ye.SameValueZero(r.key,e))return!0;return!1},set:function(e,n){i(this,\"set\");var r,a=this._head,o=a,s=qn(e,!0);if(null!==s){if(void 0!==this._storage[s])return this._storage[s].value=n,this;r=this._storage[s]=new t(e,n),o=a.prev}else this._map&&(G.call(this._map,e)?U.call(this._map,e).value=n:(r=new t(e,n),X.call(this._map,e,r),o=a.prev));for(;(o=o.next)!==a;)if(ye.SameValueZero(o.key,e))return o.value=n,this;return r=r||new t(e,n),ye.SameValue(-0,e)&&(r.key=0),r.next=this._head,r.prev=this._head.prev,r.prev.next=r,r.next.prev=r,this._size+=1,this},delete:function(t){i(this,\"delete\");var n=this._head,r=n,a=qn(t,!0);if(null!==a){if(void 0===this._storage[a])return!1;r=this._storage[a].prev,delete this._storage[a]}else if(this._map){if(!G.call(this._map,t))return!1;r=U.call(this._map,t).prev,W.call(this._map,t)}for(;(r=r.next)!==n;)if(ye.SameValueZero(r.key,t))return r.key=e,r.value=e,r.prev.next=r.next,r.next.prev=r.prev,this._size-=1,!0;return!1},clear:function(){i(this,\"clear\"),this._map=B?new B:null,this._size=0,this._storage=Fn();for(var t=this._head,n=t,r=n.next;(n=r)!==t;)n.key=e,n.value=e,r=n.next,n.next=n.prev=t;t.next=t.prev=t},keys:function(){return i(this,\"keys\"),new a(this,\"key\")},values:function(){return i(this,\"values\"),new a(this,\"value\")},entries:function(){return i(this,\"entries\"),new a(this,\"key+value\")},forEach:function(e){i(this,\"forEach\");for(var t=arguments.length>1?arguments[1]:null,n=this.entries(),a=n.next();!a.done;a=n.next())t?r(e,t,a.value[1],a.value[0],this):e(a.value[1],a.value[0],this)}}),_e(n,n.entries),o}(),Set:function(){var e,t=function(e,t){if(!ye.TypeIsObject(e)||!function(e){return e._es6set&&void 0!==e._storage}(e))throw new TypeError(\"Set.prototype.\"+t+\" called on incompatible receiver \"+ye.ToString(e))},n=function t(){if(!(this instanceof t))throw new TypeError('Constructor Set requires \"new\"');if(this&&this._es6set)throw new TypeError(\"Bad construction\");var n=Pe(this,t,e,{_es6set:!0,\"[[SetData]]\":null,_storage:Fn()});if(!n._es6set)throw new TypeError(\"bad set\");return arguments.length>0&&Hn(t,n,arguments[0]),n};e=n.prototype;var i=function(e){if(!e[\"[[SetData]]\"]){var t=new zn.Map;e[\"[[SetData]]\"]=t,p(a(e._storage),function(e){var n=function(e){var t=e;if(\"^null\"===t)return null;if(\"^undefined\"!==t){var n=t.charAt(0);return\"$\"===n?N(t,1):\"n\"===n?+N(t,1):\"b\"===n?\"btrue\"===t:+t}}(e);t.set(n,n)}),e[\"[[SetData]]\"]=t}e._storage=null};b(n.prototype,\"size\",function(){return t(this,\"size\"),this._storage?a(this._storage).length:(i(this),this[\"[[SetData]]\"].size)}),m(n.prototype,{has:function(e){var n;return t(this,\"has\"),this._storage&&null!==(n=qn(e))?!!this._storage[n]:(i(this),this[\"[[SetData]]\"].has(e))},add:function(e){var n;return t(this,\"add\"),this._storage&&null!==(n=qn(e))?(this._storage[n]=!0,this):(i(this),this[\"[[SetData]]\"].set(e,e),this)},delete:function(e){var n;if(t(this,\"delete\"),this._storage&&null!==(n=qn(e))){var r=z(this._storage,n);return delete this._storage[n]&&r}return i(this),this[\"[[SetData]]\"].delete(e)},clear:function(){t(this,\"clear\"),this._storage&&(this._storage=Fn()),this[\"[[SetData]]\"]&&this[\"[[SetData]]\"].clear()},values:function(){return t(this,\"values\"),i(this),new o(this[\"[[SetData]]\"].values())},entries:function(){return t(this,\"entries\"),i(this),new o(this[\"[[SetData]]\"].entries())},forEach:function(e){t(this,\"forEach\");var n=arguments.length>1?arguments[1]:null,a=this;i(a),this[\"[[SetData]]\"].forEach(function(t,i){n?r(e,n,i,i,a):e(i,i,a)})}}),y(n.prototype,\"keys\",n.prototype.values,!0),_e(n.prototype,n.prototype.values);var o=function(e){this.it=e};return o.prototype={isSetIterator:!0,next:function(){if(!this.isSetIterator)throw new TypeError(\"Not a SetIterator\");return this.it.next()}},_e(o.prototype),n}()};if(j.Set&&!Set.prototype.delete&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys)&&(j.Set=zn.Set),j.Map||j.Set){s(function(){return 2===new Map([[1,2]]).get(1)})||(j.Map=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires \"new\"');var t=new B;return arguments.length>0&&Vn(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,j.Map.prototype),t},j.Map.prototype=k(B.prototype),y(j.Map.prototype,\"constructor\",j.Map,!0),x(j.Map,B));var $n=new Map,Bn=((Mn=new Map([[1,0],[2,0],[3,0],[4,0]])).set(-0,Mn),Mn.get(0)===Mn&&Mn.get(-0)===Mn&&Mn.has(0)&&Mn.has(-0)),Wn=$n.set(1,2)===$n;Bn&&Wn||se(Map.prototype,\"set\",function(e,t){return r(X,this,0===e?0:e,t),this}),Bn||(m(Map.prototype,{get:function(e){return r(U,this,0===e?0:e)},has:function(e){return r(G,this,0===e?0:e)}},!0),x(Map.prototype.get,U),x(Map.prototype.has,G));var Un=new Set,Gn=Set.prototype.delete&&Set.prototype.add&&Set.prototype.has&&((In=Un).delete(0),In.add(-0),!In.has(0)),Xn=Un.add(1)===Un;if(!Gn||!Xn){var Yn=Set.prototype.add;Set.prototype.add=function(e){return r(Yn,this,0===e?0:e),this},x(Set.prototype.add,Yn)}if(!Gn){var Jn=Set.prototype.has;Set.prototype.has=function(e){return r(Jn,this,0===e?0:e)},x(Set.prototype.has,Jn);var Kn=Set.prototype.delete;Set.prototype.delete=function(e){return r(Kn,this,0===e?0:e)},x(Set.prototype.delete,Kn)}var Zn=O(j.Map,function(e){var t=new e([]);return t.set(42,42),t instanceof e}),Qn=Object.setPrototypeOf&&!Zn,er=function(){try{return!(j.Map()instanceof j.Map)}catch(e){return e instanceof TypeError}}();0===j.Map.length&&!Qn&&er||(j.Map=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires \"new\"');var t=new B;return arguments.length>0&&Vn(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,e.prototype),t},j.Map.prototype=B.prototype,y(j.Map.prototype,\"constructor\",j.Map,!0),x(j.Map,B));var tr=O(j.Set,function(e){var t=new e([]);return t.add(42,42),t instanceof e}),nr=Object.setPrototypeOf&&!tr,rr=function(){try{return!(j.Set()instanceof j.Set)}catch(e){return e instanceof TypeError}}();if(0!==j.Set.length||nr||!rr){var ir=j.Set;j.Set=function e(){if(!(this instanceof e))throw new TypeError('Constructor Set requires \"new\"');var t=new ir;return arguments.length>0&&Hn(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,e.prototype),t},j.Set.prototype=ir.prototype,y(j.Set.prototype,\"constructor\",j.Set,!0),x(j.Set,ir)}var ar=new j.Map,or=!s(function(){return ar.keys().next().done});if((\"function\"!=typeof j.Map.prototype.clear||0!==(new j.Set).size||0!==ar.size||\"function\"!=typeof j.Map.prototype.keys||\"function\"!=typeof j.Set.prototype.keys||\"function\"!=typeof j.Map.prototype.forEach||\"function\"!=typeof j.Set.prototype.forEach||c(j.Map)||c(j.Set)||\"function\"!=typeof ar.keys().next||or||!Zn)&&m(j,{Map:zn.Map,Set:zn.Set},!0),j.Set.prototype.keys!==j.Set.prototype.values&&y(j.Set.prototype,\"keys\",j.Set.prototype.values,!0),_e(Object.getPrototypeOf((new j.Map).keys())),_e(Object.getPrototypeOf((new j.Set).keys())),l&&\"has\"!==j.Set.prototype.has.name){var sr=j.Set.prototype.has;se(j.Set.prototype,\"has\",function(e){return r(sr,this,e)})}}m(j,zn),Ee(j.Map),Ee(j.Set)}var cr=function(e){if(!ye.TypeIsObject(e))throw new TypeError(\"target must be an object\")},ur={apply:function(){return ye.Call(ye.Call,null,arguments)},construct:function(e,t){if(!ye.IsConstructor(e))throw new TypeError(\"First argument must be a constructor.\");var n=arguments.length>2?arguments[2]:e;if(!ye.IsConstructor(n))throw new TypeError(\"new.target must be a constructor.\");return ye.Construct(e,t,n,\"internal\")},deleteProperty:function(e,t){if(cr(e),u){var n=Object.getOwnPropertyDescriptor(e,t);if(n&&!n.configurable)return!1}return delete e[t]},has:function(e,t){return cr(e),t in e}};Object.getOwnPropertyNames&&Object.assign(ur,{ownKeys:function(e){cr(e);var t=Object.getOwnPropertyNames(e);return ye.IsCallable(Object.getOwnPropertySymbols)&&I(t,Object.getOwnPropertySymbols(e)),t}});var lr=function(e){return!o(e)};if(Object.preventExtensions&&Object.assign(ur,{isExtensible:function(e){return cr(e),Object.isExtensible(e)},preventExtensions:function(e){return cr(e),lr(function(){return Object.preventExtensions(e)})}}),u){var pr=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(!r){var i=Object.getPrototypeOf(e);if(null===i)return;return pr(i,t,n)}return\"value\"in r?r.value:r.get?ye.Call(r.get,n):void 0},fr=function(e,t,n,i){var a=Object.getOwnPropertyDescriptor(e,t);if(!a){var o=Object.getPrototypeOf(e);if(null!==o)return fr(o,t,n,i);a={value:void 0,writable:!0,enumerable:!0,configurable:!0}}return\"value\"in a?!!a.writable&&(!!ye.TypeIsObject(i)&&(Object.getOwnPropertyDescriptor(i,t)?pe.defineProperty(i,t,{value:n}):pe.defineProperty(i,t,{value:n,writable:!0,enumerable:!0,configurable:!0}))):!!a.set&&(r(a.set,i,n),!0)};Object.assign(ur,{defineProperty:function(e,t,n){return cr(e),lr(function(){return Object.defineProperty(e,t,n)})},getOwnPropertyDescriptor:function(e,t){return cr(e),Object.getOwnPropertyDescriptor(e,t)},get:function(e,t){cr(e);var n=arguments.length>2?arguments[2]:e;return pr(e,t,n)},set:function(e,t,n){cr(e);var r=arguments.length>3?arguments[3]:e;return fr(e,t,n,r)}})}if(Object.getPrototypeOf){var dr=Object.getPrototypeOf;ur.getPrototypeOf=function(e){return cr(e),dr(e)}}if(Object.setPrototypeOf&&ur.getPrototypeOf){Object.assign(ur,{setPrototypeOf:function(e,t){if(cr(e),null!==t&&!ye.TypeIsObject(t))throw new TypeError(\"proto must be an object or null\");return t===pe.getPrototypeOf(e)||!(pe.isExtensible&&!pe.isExtensible(e))&&(!function(e,t){for(var n=t;n;){if(e===n)return!0;n=ur.getPrototypeOf(n)}return!1}(e,t)&&(Object.setPrototypeOf(e,t),!0))}})}Object.keys(ur).forEach(function(e){!function(e,t){ye.IsCallable(j.Reflect[e])?s(function(){return j.Reflect[e](1),j.Reflect[e](NaN),j.Reflect[e](!0),!0})&&se(j.Reflect,e,t):y(j.Reflect,e,t)}(e,ur[e])});var hr=j.Reflect.getPrototypeOf;if(l&&hr&&\"getPrototypeOf\"!==hr.name&&se(j.Reflect,\"getPrototypeOf\",function(e){return r(hr,j.Reflect,e)}),j.Reflect.setPrototypeOf&&s(function(){return j.Reflect.setPrototypeOf(1,{}),!0})&&se(j.Reflect,\"setPrototypeOf\",ur.setPrototypeOf),j.Reflect.defineProperty&&(s(function(){var e=!j.Reflect.defineProperty(1,\"test\",{value:1}),t=\"function\"!=typeof Object.preventExtensions||!j.Reflect.defineProperty(Object.preventExtensions({}),\"test\",{});return e&&t})||se(j.Reflect,\"defineProperty\",ur.defineProperty)),j.Reflect.construct&&(s(function(){var e=function(){};return j.Reflect.construct(function(){},[],e)instanceof e})||se(j.Reflect,\"construct\",ur.construct)),\"Invalid Date\"!==String(new Date(NaN))){var yr=Date.prototype.toString;se(Date.prototype,\"toString\",function(){var e=+this;return e!=e?\"Invalid Date\":ye.Call(yr,this)})}var mr={anchor:function(e){return ye.CreateHTML(this,\"a\",\"name\",e)},big:function(){return ye.CreateHTML(this,\"big\",\"\",\"\")},blink:function(){return ye.CreateHTML(this,\"blink\",\"\",\"\")},bold:function(){return ye.CreateHTML(this,\"b\",\"\",\"\")},fixed:function(){return ye.CreateHTML(this,\"tt\",\"\",\"\")},fontcolor:function(e){return ye.CreateHTML(this,\"font\",\"color\",e)},fontsize:function(e){return ye.CreateHTML(this,\"font\",\"size\",e)},italics:function(){return ye.CreateHTML(this,\"i\",\"\",\"\")},link:function(e){return ye.CreateHTML(this,\"a\",\"href\",e)},small:function(){return ye.CreateHTML(this,\"small\",\"\",\"\")},strike:function(){return ye.CreateHTML(this,\"strike\",\"\",\"\")},sub:function(){return ye.CreateHTML(this,\"sub\",\"\",\"\")},sup:function(){return ye.CreateHTML(this,\"sup\",\"\",\"\")}};p(Object.keys(mr),function(e){var t=String.prototype[e],n=!1;if(ye.IsCallable(t)){var i=r(t,\"\",' \" '),a=_([],i.match(/\"/g)).length;n=i!==i.toLowerCase()||a>2}else n=!0;n&&se(String.prototype,e,mr[e])});var gr=function(){if(!ce)return!1;var e=\"object\"===(\"undefined\"==typeof JSON?\"undefined\":_typeof(JSON))&&\"function\"==typeof JSON.stringify?JSON.stringify:null;if(!e)return!1;if(void 0!==e(Y()))return!0;if(\"[null]\"!==e([Y()]))return!0;var t={a:Y()};return t[Y()]=!0,\"{}\"!==e(t)}(),vr=s(function(){return!ce||\"{}\"===JSON.stringify(Object(Y()))&&\"[{}]\"===JSON.stringify([Object(Y())])});if(gr||!vr){var br=JSON.stringify;se(JSON,\"stringify\",function(e){if(\"symbol\"!==(void 0===e?\"undefined\":_typeof(e))){var t;arguments.length>1&&(t=arguments[1]);var n=[e];if(i(t))n.push(t);else{var a=ye.IsCallable(t)?t:null;n.push(function(e,t){var n=a?r(a,this,e,t):t;if(\"symbol\"!==(void 0===n?\"undefined\":_typeof(n)))return oe(n)?At({})(n):n})}return arguments.length>2&&n.push(arguments[2]),br.apply(this,n)}})}return j},\"function\"==typeof define&&define.amd?define(\"es6-shim\",factory):\"object\"===(\"undefined\"==typeof exports?\"undefined\":_typeof(exports))?module.exports=factory():root.returnExports=factory(),function(e,t){\"object\"===(\"undefined\"==typeof module?\"undefined\":_typeof(module))&&\"object\"===_typeof(module.exports)?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error(\"jQuery requires a window with a document\");return t(e)}:t(e)}(\"undefined\"!=typeof window?window:this,function(e,t){var n=[],r=Object.getPrototypeOf,i=n.slice,a=n.flat?function(e){return n.flat.call(e)}:function(e){return n.concat.apply([],e)},o=n.push,s=n.indexOf,c={},u=c.toString,l=c.hasOwnProperty,p=l.toString,f=p.call(Object),d={},h=function(e){return\"function\"==typeof e&&\"number\"!=typeof e.nodeType},y=function(e){return null!=e&&e===e.window},m=e.document,g={type:!0,src:!0,nonce:!0,noModule:!0};function v(e,t,n){var r,i,a=(n=n||m).createElement(\"script\");if(a.text=e,t)for(r in g)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&a.setAttribute(r,i);n.head.appendChild(a).parentNode.removeChild(a)}function b(e){return null==e?e+\"\":\"object\"===(void 0===e?\"undefined\":_typeof(e))||\"function\"==typeof e?c[u.call(e)]||\"object\":void 0===e?\"undefined\":_typeof(e)}var w=function e(t,n){return new e.fn.init(t,n)};function T(e){var t=!!e&&\"length\"in e&&e.length,n=b(e);return!h(e)&&!y(e)&&(\"array\"===n||0===t||\"number\"==typeof t&&t>0&&t-1 in e)}w.fn=w.prototype={jquery:\"3.5.1\",constructor:w,length:0,toArray:function(){return i.call(this)},get:function(e){return null==e?i.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return w.each(this,e)},map:function(e){return this.pushStack(w.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(i.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(w.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(w.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:o,sort:n.sort,splice:n.splice},w.extend=w.fn.extend=function(){var e,t,n,r,i,a,o=arguments[0]||{},s=1,c=arguments.length,u=!1;for(\"boolean\"==typeof o&&(u=o,o=arguments[s]||{},s++),\"object\"===(void 0===o?\"undefined\":_typeof(o))||h(o)||(o={}),s===c&&(o=this,s--);s<c;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],\"__proto__\"!==t&&o!==r&&(u&&r&&(w.isPlainObject(r)||(i=Array.isArray(r)))?(n=o[t],a=i&&!Array.isArray(n)?[]:i||w.isPlainObject(n)?n:{},i=!1,o[t]=w.extend(u,a,r)):void 0!==r&&(o[t]=r));return o},w.extend({expando:\"jQuery\"+(\"3.5.1\"+Math.random()).replace(/\\D/g,\"\"),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||\"[object Object]\"!==u.call(e))&&(!(t=r(e))||\"function\"==typeof(n=l.call(t,\"constructor\")&&t.constructor)&&p.call(n)===f)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){v(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(T(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(T(Object(e))?w.merge(n,\"string\"==typeof e?[e]:e):o.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:s.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,a=e.length,o=!n;i<a;i++)!t(e[i],i)!==o&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,s=[];if(T(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&s.push(i);return a(s)},guid:1,support:d}),\"function\"==typeof Symbol&&(w.fn[Symbol.iterator]=n[Symbol.iterator]),w.each(\"Boolean Number String Function Array Date RegExp Object Error Symbol\".split(\" \"),function(e,t){c[\"[object \"+t+\"]\"]=t.toLowerCase()});var S=function(e){var t,n,r,i,a,o,s,c,u,l,p,f,d,h,y,m,g,v,b,w=\"sizzle\"+1*new Date,T=e.document,S=0,x=0,k=ce(),O=ce(),j=ce(),A=ce(),C=function(e,t){return e===t&&(p=!0),0},E={}.hasOwnProperty,_=[],N=_.pop,P=_.push,I=_.push,M=_.slice,D=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R=\"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",L=\"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",q=\"(?:\\\\\\\\[\\\\da-fA-F]{1,6}\"+L+\"?|\\\\\\\\[^\\\\r\\\\n\\\\f]|[\\\\w-]|[^\\0-\\\\x7f])+\",F=\"\\\\[\"+L+\"*(\"+q+\")(?:\"+L+\"*([*^$|!~]?=)\"+L+\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\"+q+\"))|)\"+L+\"*\\\\]\",V=\":(\"+q+\")(?:\\\\((('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\"+F+\")*)|.*)\\\\)|)\",H=new RegExp(L+\"+\",\"g\"),z=new RegExp(\"^\"+L+\"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\"+L+\"+$\",\"g\"),$=new RegExp(\"^\"+L+\"*,\"+L+\"*\"),B=new RegExp(\"^\"+L+\"*([>+~]|\"+L+\")\"+L+\"*\"),W=new RegExp(L+\"|>\"),U=new RegExp(V),G=new RegExp(\"^\"+q+\"$\"),X={ID:new RegExp(\"^#(\"+q+\")\"),CLASS:new RegExp(\"^\\\\.(\"+q+\")\"),TAG:new RegExp(\"^(\"+q+\"|[*])\"),ATTR:new RegExp(\"^\"+F),PSEUDO:new RegExp(\"^\"+V),CHILD:new RegExp(\"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\"+L+\"*(even|odd|(([+-]|)(\\\\d*)n|)\"+L+\"*(?:([+-]|)\"+L+\"*(\\\\d+)|))\"+L+\"*\\\\)|)\",\"i\"),bool:new RegExp(\"^(?:\"+R+\")$\",\"i\"),needsContext:new RegExp(\"^\"+L+\"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\"+L+\"*((?:-\\\\d)?\\\\d*)\"+L+\"*\\\\)|)(?=[^-]|$)\",\"i\")},Y=/HTML$/i,J=/^(?:input|select|textarea|button)$/i,K=/^h\\d$/i,Z=/^[^{]+\\{\\s*\\[native \\w/,Q=/^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,ee=/[+~]/,te=new RegExp(\"\\\\\\\\[\\\\da-fA-F]{1,6}\"+L+\"?|\\\\\\\\([^\\\\r\\\\n\\\\f])\",\"g\"),ne=function(e,t){var n=\"0x\"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\\0-\\x1f\\x7f]|^-?\\d)|^-$|[^\\0-\\x1f\\x7f-\\uFFFF\\w-]/g,ie=function(e,t){return t?\"\\0\"===e?\"\\ufffd\":e.slice(0,-1)+\"\\\\\"+e.charCodeAt(e.length-1).toString(16)+\" \":\"\\\\\"+e},ae=function(){f()},oe=we(function(e){return!0===e.disabled&&\"fieldset\"===e.nodeName.toLowerCase()},{dir:\"parentNode\",next:\"legend\"});try{I.apply(_=M.call(T.childNodes),T.childNodes),_[T.childNodes.length].nodeType}catch(e){I={apply:_.length?function(e,t){P.apply(e,M.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function se(e,t,r,i){var a,s,u,l,p,h,g,v=t&&t.ownerDocument,T=t?t.nodeType:9;if(r=r||[],\"string\"!=typeof e||!e||1!==T&&9!==T&&11!==T)return r;if(!i&&(f(t),t=t||d,y)){if(11!==T&&(p=Q.exec(e)))if(a=p[1]){if(9===T){if(!(u=t.getElementById(a)))return r;if(u.id===a)return r.push(u),r}else if(v&&(u=v.getElementById(a))&&b(t,u)&&u.id===a)return r.push(u),r}else{if(p[2])return I.apply(r,t.getElementsByTagName(e)),r;if((a=p[3])&&n.getElementsByClassName&&t.getElementsByClassName)return I.apply(r,t.getElementsByClassName(a)),r}if(n.qsa&&!A[e+\" \"]&&(!m||!m.test(e))&&(1!==T||\"object\"!==t.nodeName.toLowerCase())){if(g=e,v=t,1===T&&(W.test(e)||B.test(e))){for((v=ee.test(e)&&ge(t.parentNode)||t)===t&&n.scope||((l=t.getAttribute(\"id\"))?l=l.replace(re,ie):t.setAttribute(\"id\",l=w)),s=(h=o(e)).length;s--;)h[s]=(l?\"#\"+l:\":scope\")+\" \"+be(h[s]);g=h.join(\",\")}try{return I.apply(r,v.querySelectorAll(g)),r}catch(t){A(e,!0)}finally{l===w&&t.removeAttribute(\"id\")}}}return c(e.replace(z,\"$1\"),t,r,i)}function ce(){var e=[];return function t(n,i){return e.push(n+\" \")>r.cacheLength&&delete t[e.shift()],t[n+\" \"]=i}}function ue(e){return e[w]=!0,e}function le(e){var t=d.createElement(\"fieldset\");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function pe(e,t){for(var n=e.split(\"|\"),i=n.length;i--;)r.attrHandle[n[i]]=t}function fe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function de(e){return function(t){return\"input\"===t.nodeName.toLowerCase()&&t.type===e}}function he(e){return function(t){var n=t.nodeName.toLowerCase();return(\"input\"===n||\"button\"===n)&&t.type===e}}function ye(e){return function(t){return\"form\"in t?t.parentNode&&!1===t.disabled?\"label\"in t?\"label\"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&oe(t)===e:t.disabled===e:\"label\"in t&&t.disabled===e}}function me(e){return ue(function(t){return t=+t,ue(function(n,r){for(var i,a=e([],n.length,t),o=a.length;o--;)n[i=a[o]]&&(n[i]=!(r[i]=n[i]))})})}function ge(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=se.support={},a=se.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||\"HTML\")},f=se.setDocument=function(e){var t,i,o=e?e.ownerDocument||e:T;return o!=d&&9===o.nodeType&&o.documentElement?(h=(d=o).documentElement,y=!a(d),T!=d&&(i=d.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener(\"unload\",ae,!1):i.attachEvent&&i.attachEvent(\"onunload\",ae)),n.scope=le(function(e){return h.appendChild(e).appendChild(d.createElement(\"div\")),void 0!==e.querySelectorAll&&!e.querySelectorAll(\":scope fieldset div\").length}),n.attributes=le(function(e){return e.className=\"i\",!e.getAttribute(\"className\")}),n.getElementsByTagName=le(function(e){return e.appendChild(d.createComment(\"\")),!e.getElementsByTagName(\"*\").length}),n.getElementsByClassName=Z.test(d.getElementsByClassName),n.getById=le(function(e){return h.appendChild(e).id=w,!d.getElementsByName||!d.getElementsByName(w).length}),n.getById?(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute(\"id\")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode(\"id\");return n&&n.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n,r,i,a=t.getElementById(e);if(a){if((n=a.getAttributeNode(\"id\"))&&n.value===e)return[a];for(i=t.getElementsByName(e),r=0;a=i[r++];)if((n=a.getAttributeNode(\"id\"))&&n.value===e)return[a]}return[]}}),r.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,a=t.getElementsByTagName(e);if(\"*\"===e){for(;n=a[i++];)1===n.nodeType&&r.push(n);return r}return a},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&y)return t.getElementsByClassName(e)},g=[],m=[],(n.qsa=Z.test(d.querySelectorAll))&&(le(function(e){var t;h.appendChild(e).innerHTML=\"<a id='\"+w+\"'></a><select id='\"+w+\"-\\r\\\\' msallowcapture=''><option selected=''></option></select>\",e.querySelectorAll(\"[msallowcapture^='']\").length&&m.push(\"[*^$]=\"+L+\"*(?:''|\\\"\\\")\"),e.querySelectorAll(\"[selected]\").length||m.push(\"\\\\[\"+L+\"*(?:value|\"+R+\")\"),e.querySelectorAll(\"[id~=\"+w+\"-]\").length||m.push(\"~=\"),(t=d.createElement(\"input\")).setAttribute(\"name\",\"\"),e.appendChild(t),e.querySelectorAll(\"[name='']\").length||m.push(\"\\\\[\"+L+\"*name\"+L+\"*=\"+L+\"*(?:''|\\\"\\\")\"),e.querySelectorAll(\":checked\").length||m.push(\":checked\"),e.querySelectorAll(\"a#\"+w+\"+*\").length||m.push(\".#.+[+~]\"),e.querySelectorAll(\"\\\\\\f\"),m.push(\"[\\\\r\\\\n\\\\f]\")}),le(function(e){e.innerHTML=\"<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>\";var t=d.createElement(\"input\");t.setAttribute(\"type\",\"hidden\"),e.appendChild(t).setAttribute(\"name\",\"D\"),e.querySelectorAll(\"[name=d]\").length&&m.push(\"name\"+L+\"*[*^$|!~]?=\"),2!==e.querySelectorAll(\":enabled\").length&&m.push(\":enabled\",\":disabled\"),h.appendChild(e).disabled=!0,2!==e.querySelectorAll(\":disabled\").length&&m.push(\":enabled\",\":disabled\"),e.querySelectorAll(\"*,:x\"),m.push(\",.*:\")})),(n.matchesSelector=Z.test(v=h.matches||h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&le(function(e){n.disconnectedMatch=v.call(e,\"*\"),v.call(e,\"[s!='']:x\"),g.push(\"!=\",V)}),m=m.length&&new RegExp(m.join(\"|\")),g=g.length&&new RegExp(g.join(\"|\")),t=Z.test(h.compareDocumentPosition),b=t||Z.test(h.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},C=t?function(e,t){if(e===t)return p=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e==d||e.ownerDocument==T&&b(T,e)?-1:t==d||t.ownerDocument==T&&b(T,t)?1:l?D(l,e)-D(l,t):0:4&r?-1:1)}:function(e,t){if(e===t)return p=!0,0;var n,r=0,i=e.parentNode,a=t.parentNode,o=[e],s=[t];if(!i||!a)return e==d?-1:t==d?1:i?-1:a?1:l?D(l,e)-D(l,t):0;if(i===a)return fe(e,t);for(n=e;n=n.parentNode;)o.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;o[r]===s[r];)r++;return r?fe(o[r],s[r]):o[r]==T?-1:s[r]==T?1:0},d):d},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(f(e),n.matchesSelector&&y&&!A[t+\" \"]&&(!g||!g.test(t))&&(!m||!m.test(t)))try{var r=v.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){A(t,!0)}return se(t,d,null,[e]).length>0},se.contains=function(e,t){return(e.ownerDocument||e)!=d&&f(e),b(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=d&&f(e);var i=r.attrHandle[t.toLowerCase()],a=i&&E.call(r.attrHandle,t.toLowerCase())?i(e,t,!y):void 0;return void 0!==a?a:n.attributes||!y?e.getAttribute(t):(a=e.getAttributeNode(t))&&a.specified?a.value:null},se.escape=function(e){return(e+\"\").replace(re,ie)},se.error=function(e){throw new Error(\"Syntax error, unrecognized expression: \"+e)},se.uniqueSort=function(e){var t,r=[],i=0,a=0;if(p=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(C),p){for(;t=e[a++];)t===e[a]&&(i=r.push(a));for(;i--;)e.splice(r[i],1)}return l=null,e},i=se.getText=function(e){var t,n=\"\",r=0,a=e.nodeType;if(a){if(1===a||9===a||11===a){if(\"string\"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===a||4===a)return e.nodeValue}else for(;t=e[r++];)n+=i(t);return n},(r=se.selectors={cacheLength:50,createPseudo:ue,match:X,attrHandle:{},find:{},relative:{\">\":{dir:\"parentNode\",first:!0},\" \":{dir:\"parentNode\"},\"+\":{dir:\"previousSibling\",first:!0},\"~\":{dir:\"previousSibling\"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||\"\").replace(te,ne),\"~=\"===e[2]&&(e[3]=\" \"+e[3]+\" \"),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),\"nth\"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(\"even\"===e[3]||\"odd\"===e[3])),e[5]=+(e[7]+e[8]||\"odd\"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return X.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||\"\":n&&U.test(n)&&(t=o(n,!0))&&(t=n.indexOf(\")\",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return\"*\"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=k[e+\" \"];return t||(t=new RegExp(\"(^|\"+L+\")\"+e+\"(\"+L+\"|$)\"))&&k(e,function(e){return t.test(\"string\"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute(\"class\")||\"\")})},ATTR:function(e,t,n){return function(r){var i=se.attr(r,e);return null==i?\"!=\"===t:!t||(i+=\"\",\"=\"===t?i===n:\"!=\"===t?i!==n:\"^=\"===t?n&&0===i.indexOf(n):\"*=\"===t?n&&i.indexOf(n)>-1:\"$=\"===t?n&&i.slice(-n.length)===n:\"~=\"===t?(\" \"+i.replace(H,\" \")+\" \").indexOf(n)>-1:\"|=\"===t&&(i===n||i.slice(0,n.length+1)===n+\"-\"))}},CHILD:function(e,t,n,r,i){var a=\"nth\"!==e.slice(0,3),o=\"last\"!==e.slice(-4),s=\"of-type\"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,c){var u,l,p,f,d,h,y=a!==o?\"nextSibling\":\"previousSibling\",m=t.parentNode,g=s&&t.nodeName.toLowerCase(),v=!c&&!s,b=!1;if(m){if(a){for(;y;){for(f=t;f=f[y];)if(s?f.nodeName.toLowerCase()===g:1===f.nodeType)return!1;h=y=\"only\"===e&&!h&&\"nextSibling\"}return!0}if(h=[o?m.firstChild:m.lastChild],o&&v){for(b=(d=(u=(l=(p=(f=m)[w]||(f[w]={}))[f.uniqueID]||(p[f.uniqueID]={}))[e]||[])[0]===S&&u[1])&&u[2],f=d&&m.childNodes[d];f=++d&&f&&f[y]||(b=d=0)||h.pop();)if(1===f.nodeType&&++b&&f===t){l[e]=[S,d,b];break}}else if(v&&(b=d=(u=(l=(p=(f=t)[w]||(f[w]={}))[f.uniqueID]||(p[f.uniqueID]={}))[e]||[])[0]===S&&u[1]),!1===b)for(;(f=++d&&f&&f[y]||(b=d=0)||h.pop())&&((s?f.nodeName.toLowerCase()!==g:1!==f.nodeType)||!++b||(v&&((l=(p=f[w]||(f[w]={}))[f.uniqueID]||(p[f.uniqueID]={}))[e]=[S,b]),f!==t)););return(b-=i)===r||b%r==0&&b/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||se.error(\"unsupported pseudo: \"+e);return i[w]?i(t):i.length>1?(n=[e,e,\"\",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ue(function(e,n){for(var r,a=i(e,t),o=a.length;o--;)e[r=D(e,a[o])]=!(n[r]=a[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:ue(function(e){var t=[],n=[],r=s(e.replace(z,\"$1\"));return r[w]?ue(function(e,t,n,i){for(var a,o=r(e,null,i,[]),s=e.length;s--;)(a=o[s])&&(e[s]=!(t[s]=a))}):function(e,i,a){return t[0]=e,r(t,null,a,n),t[0]=null,!n.pop()}}),has:ue(function(e){return function(t){return se(e,t).length>0}}),contains:ue(function(e){return e=e.replace(te,ne),function(t){return(t.textContent||i(t)).indexOf(e)>-1}}),lang:ue(function(e){return G.test(e||\"\")||se.error(\"unsupported lang: \"+e),e=e.replace(te,ne).toLowerCase(),function(t){var n;do{if(n=y?t.lang:t.getAttribute(\"xml:lang\")||t.getAttribute(\"lang\"))return(n=n.toLowerCase())===e||0===n.indexOf(e+\"-\")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ye(!1),disabled:ye(!0),checked:function(e){var t=e.nodeName.toLowerCase();return\"input\"===t&&!!e.checked||\"option\"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return K.test(e.nodeName)},input:function(e){return J.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return\"input\"===t&&\"button\"===e.type||\"button\"===t},text:function(e){var t;return\"input\"===e.nodeName.toLowerCase()&&\"text\"===e.type&&(null==(t=e.getAttribute(\"type\"))||\"text\"===t.toLowerCase())},first:me(function(){return[0]}),last:me(function(e,t){return[t-1]}),eq:me(function(e,t,n){return[n<0?n+t:n]}),even:me(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:me(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:me(function(e,t,n){for(var r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e}),gt:me(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=de(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=he(t);function ve(){}function be(e){for(var t=0,n=e.length,r=\"\";t<n;t++)r+=e[t].value;return r}function we(e,t,n){var r=t.dir,i=t.next,a=i||r,o=n&&\"parentNode\"===a,s=x++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,i);return!1}:function(t,n,c){var u,l,p,f=[S,s];if(c){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,c))return!0}else for(;t=t[r];)if(1===t.nodeType||o)if(l=(p=t[w]||(t[w]={}))[t.uniqueID]||(p[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((u=l[a])&&u[0]===S&&u[1]===s)return f[2]=u[2];if(l[a]=f,f[2]=e(t,n,c))return!0}return!1}}function Te(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function Se(e,t,n,r,i){for(var a,o=[],s=0,c=e.length,u=null!=t;s<c;s++)(a=e[s])&&(n&&!n(a,r,i)||(o.push(a),u&&t.push(s)));return o}function xe(e,t,n,r,i,a){return r&&!r[w]&&(r=xe(r)),i&&!i[w]&&(i=xe(i,a)),ue(function(a,o,s,c){var u,l,p,f=[],d=[],h=o.length,y=a||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(t||\"*\",s.nodeType?[s]:s,[]),m=!e||!a&&t?y:Se(y,f,e,s,c),g=n?i||(a?e:h||r)?[]:o:m;if(n&&n(m,g,s,c),r)for(u=Se(g,d),r(u,[],s,c),l=u.length;l--;)(p=u[l])&&(g[d[l]]=!(m[d[l]]=p));if(a){if(i||e){if(i){for(u=[],l=g.length;l--;)(p=g[l])&&u.push(m[l]=p);i(null,g=[],u,c)}for(l=g.length;l--;)(p=g[l])&&(u=i?D(a,p):f[l])>-1&&(a[u]=!(o[u]=p))}}else g=Se(g===o?g.splice(h,g.length):g),i?i(null,o,g,c):I.apply(o,g)})}function ke(e){for(var t,n,i,a=e.length,o=r.relative[e[0].type],s=o||r.relative[\" \"],c=o?1:0,l=we(function(e){return e===t},s,!0),p=we(function(e){return D(t,e)>-1},s,!0),f=[function(e,n,r){var i=!o&&(r||n!==u)||((t=n).nodeType?l(e,n,r):p(e,n,r));return t=null,i}];c<a;c++)if(n=r.relative[e[c].type])f=[we(Te(f),n)];else{if((n=r.filter[e[c].type].apply(null,e[c].matches))[w]){for(i=++c;i<a&&!r.relative[e[i].type];i++);return xe(c>1&&Te(f),c>1&&be(e.slice(0,c-1).concat({value:\" \"===e[c-2].type?\"*\":\"\"})).replace(z,\"$1\"),n,c<i&&ke(e.slice(c,i)),i<a&&ke(e=e.slice(i)),i<a&&be(e))}f.push(n)}return Te(f)}return ve.prototype=r.filters=r.pseudos,r.setFilters=new ve,o=se.tokenize=function(e,t){var n,i,a,o,s,c,u,l=O[e+\" \"];if(l)return t?0:l.slice(0);for(s=e,c=[],u=r.preFilter;s;){for(o in n&&!(i=$.exec(s))||(i&&(s=s.slice(i[0].length)||s),c.push(a=[])),n=!1,(i=B.exec(s))&&(n=i.shift(),a.push({value:n,type:i[0].replace(z,\" \")}),s=s.slice(n.length)),r.filter)!(i=X[o].exec(s))||u[o]&&!(i=u[o](i))||(n=i.shift(),a.push({value:n,type:o,matches:i}),s=s.slice(n.length));if(!n)break}return t?s.length:s?se.error(e):O(e,c).slice(0)},s=se.compile=function(e,t){var n,i=[],a=[],s=j[e+\" \"];if(!s){for(t||(t=o(e)),n=t.length;n--;)(s=ke(t[n]))[w]?i.push(s):a.push(s);(s=j(e,function(e,t){var n=t.length>0,i=e.length>0,a=function(a,o,s,c,l){var p,h,m,g=0,v=\"0\",b=a&&[],w=[],T=u,x=a||i&&r.find.TAG(\"*\",l),k=S+=null==T?1:Math.random()||.1,O=x.length;for(l&&(u=o==d||o||l);v!==O&&null!=(p=x[v]);v++){if(i&&p){for(h=0,o||p.ownerDocument==d||(f(p),s=!y);m=e[h++];)if(m(p,o||d,s)){c.push(p);break}l&&(S=k)}n&&((p=!m&&p)&&g--,a&&b.push(p))}if(g+=v,n&&v!==g){for(h=0;m=t[h++];)m(b,w,o,s);if(a){if(g>0)for(;v--;)b[v]||w[v]||(w[v]=N.call(c));w=Se(w)}I.apply(c,w),l&&!a&&w.length>0&&g+t.length>1&&se.uniqueSort(c)}return l&&(S=k,u=T),b};return n?ue(a):a}(a,i))).selector=e}return s},c=se.select=function(e,t,n,i){var a,c,u,l,p,f=\"function\"==typeof e&&e,d=!i&&o(e=f.selector||e);if(n=n||[],1===d.length){if((c=d[0]=d[0].slice(0)).length>2&&\"ID\"===(u=c[0]).type&&9===t.nodeType&&y&&r.relative[c[1].type]){if(!(t=(r.find.ID(u.matches[0].replace(te,ne),t)||[])[0]))return n;f&&(t=t.parentNode),e=e.slice(c.shift().value.length)}for(a=X.needsContext.test(e)?0:c.length;a--&&(u=c[a],!r.relative[l=u.type]);)if((p=r.find[l])&&(i=p(u.matches[0].replace(te,ne),ee.test(c[0].type)&&ge(t.parentNode)||t))){if(c.splice(a,1),!(e=i.length&&be(c)))return I.apply(n,i),n;break}}return(f||s(e,d))(i,t,!y,n,!t||ee.test(e)&&ge(t.parentNode)||t),n},n.sortStable=w.split(\"\").sort(C).join(\"\")===w,n.detectDuplicates=!!p,f(),n.sortDetached=le(function(e){return 1&e.compareDocumentPosition(d.createElement(\"fieldset\"))}),le(function(e){return e.innerHTML=\"<a href='#'></a>\",\"#\"===e.firstChild.getAttribute(\"href\")})||pe(\"type|href|height|width\",function(e,t,n){if(!n)return e.getAttribute(t,\"type\"===t.toLowerCase()?1:2)}),n.attributes&&le(function(e){return e.innerHTML=\"<input/>\",e.firstChild.setAttribute(\"value\",\"\"),\"\"===e.firstChild.getAttribute(\"value\")})||pe(\"value\",function(e,t,n){if(!n&&\"input\"===e.nodeName.toLowerCase())return e.defaultValue}),le(function(e){return null==e.getAttribute(\"disabled\")})||pe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(e);w.find=S,w.expr=S.selectors,w.expr[\":\"]=w.expr.pseudos,w.uniqueSort=w.unique=S.uniqueSort,w.text=S.getText,w.isXMLDoc=S.isXML,w.contains=S.contains,w.escapeSelector=S.escape;var x=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&w(e).is(n))break;r.push(e)}return r},k=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},O=w.expr.match.needsContext;function j(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var A=/^<([a-z][^\\/\\0>:\\x20\\t\\r\\n\\f]*)[\\x20\\t\\r\\n\\f]*\\/?>(?:<\\/\\1>|)$/i;function C(e,t,n){return h(t)?w.grep(e,function(e,r){return!!t.call(e,r,e)!==n}):t.nodeType?w.grep(e,function(e){return e===t!==n}):\"string\"!=typeof t?w.grep(e,function(e){return s.call(t,e)>-1!==n}):w.filter(t,e,n)}w.filter=function(e,t,n){var r=t[0];return n&&(e=\":not(\"+e+\")\"),1===t.length&&1===r.nodeType?w.find.matchesSelector(r,e)?[r]:[]:w.find.matches(e,w.grep(t,function(e){return 1===e.nodeType}))},w.fn.extend({find:function(e){var t,n,r=this.length,i=this;if(\"string\"!=typeof e)return this.pushStack(w(e).filter(function(){for(t=0;t<r;t++)if(w.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)w.find(e,i[t],n);return r>1?w.uniqueSort(n):n},filter:function(e){return this.pushStack(C(this,e||[],!1))},not:function(e){return this.pushStack(C(this,e||[],!0))},is:function(e){return!!C(this,\"string\"==typeof e&&O.test(e)?w(e):e||[],!1).length}});var E,_=/^(?:\\s*(<[\\w\\W]+>)[^>]*|#([\\w-]+))$/;(w.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||E,\"string\"==typeof e){if(!(r=\"<\"===e[0]&&\">\"===e[e.length-1]&&e.length>=3?[null,e,null]:_.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof w?t[0]:t,w.merge(this,w.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:m,!0)),A.test(r[1])&&w.isPlainObject(t))for(r in t)h(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=m.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):h(e)?void 0!==n.ready?n.ready(e):e(w):w.makeArray(e,this)}).prototype=w.fn,E=w(m);var N=/^(?:parents|prev(?:Until|All))/,P={children:!0,contents:!0,next:!0,prev:!0};function I(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}w.fn.extend({has:function(e){var t=w(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(w.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,a=[],o=\"string\"!=typeof e&&w(e);if(!O.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&w.find.matchesSelector(n,e))){a.push(n);break}return this.pushStack(a.length>1?w.uniqueSort(a):a)},index:function(e){return e?\"string\"==typeof e?s.call(w(e),this[0]):s.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(w.uniqueSort(w.merge(this.get(),w(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),w.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return x(e,\"parentNode\")},parentsUntil:function(e,t,n){return x(e,\"parentNode\",n)},next:function(e){return I(e,\"nextSibling\")},prev:function(e){return I(e,\"previousSibling\")},nextAll:function(e){return x(e,\"nextSibling\")},prevAll:function(e){return x(e,\"previousSibling\")},nextUntil:function(e,t,n){return x(e,\"nextSibling\",n)},prevUntil:function(e,t,n){return x(e,\"previousSibling\",n)},siblings:function(e){return k((e.parentNode||{}).firstChild,e)},children:function(e){return k(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(j(e,\"template\")&&(e=e.content||e),w.merge([],e.childNodes))}},function(e,t){w.fn[e]=function(n,r){var i=w.map(this,t,n);return\"Until\"!==e.slice(-5)&&(r=n),r&&\"string\"==typeof r&&(i=w.filter(r,i)),this.length>1&&(P[e]||w.uniqueSort(i),N.test(e)&&i.reverse()),this.pushStack(i)}});var M=/[^\\x20\\t\\r\\n\\f]+/g;function D(e){return e}function R(e){throw e}function L(e,t,n,r){var i;try{e&&h(i=e.promise)?i.call(e).done(t).fail(n):e&&h(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}w.Callbacks=function(e){e=\"string\"==typeof e?function(e){var t={};return w.each(e.match(M)||[],function(e,n){t[n]=!0}),t}(e):w.extend({},e);var t,n,r,i,a=[],o=[],s=-1,c=function(){for(i=i||e.once,r=t=!0;o.length;s=-1)for(n=o.shift();++s<a.length;)!1===a[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=a.length,n=!1);e.memory||(n=!1),t=!1,i&&(a=n?[]:\"\")},u={add:function(){return a&&(n&&!t&&(s=a.length-1,o.push(n)),function t(n){w.each(n,function(n,r){h(r)?e.unique&&u.has(r)||a.push(r):r&&r.length&&\"string\"!==b(r)&&t(r)})}(arguments),n&&!t&&c()),this},remove:function(){return w.each(arguments,function(e,t){for(var n;(n=w.inArray(t,a,n))>-1;)a.splice(n,1),n<=s&&s--}),this},has:function(e){return e?w.inArray(e,a)>-1:a.length>0},empty:function(){return a&&(a=[]),this},disable:function(){return i=o=[],a=n=\"\",this},disabled:function(){return!a},lock:function(){return i=o=[],n||t||(a=n=\"\"),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=[e,(n=n||[]).slice?n.slice():n],o.push(n),t||c()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!r}};return u},w.extend({Deferred:function(t){var n=[[\"notify\",\"progress\",w.Callbacks(\"memory\"),w.Callbacks(\"memory\"),2],[\"resolve\",\"done\",w.Callbacks(\"once memory\"),w.Callbacks(\"once memory\"),0,\"resolved\"],[\"reject\",\"fail\",w.Callbacks(\"once memory\"),w.Callbacks(\"once memory\"),1,\"rejected\"]],r=\"pending\",i={state:function(){return r},always:function(){return a.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return w.Deferred(function(t){w.each(n,function(n,r){var i=h(e[r[4]])&&e[r[4]];a[r[1]](function(){var e=i&&i.apply(this,arguments);e&&h(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+\"With\"](this,i?[e]:arguments)})}),e=null}).promise()},then:function(t,r,i){var a=0;function o(t,n,r,i){return function(){var s=this,c=arguments,u=function(){var e,u;if(!(t<a)){if((e=r.apply(s,c))===n.promise())throw new TypeError(\"Thenable self-resolution\");u=e&&(\"object\"===(void 0===e?\"undefined\":_typeof(e))||\"function\"==typeof e)&&e.then,h(u)?i?u.call(e,o(a,n,D,i),o(a,n,R,i)):(a++,u.call(e,o(a,n,D,i),o(a,n,R,i),o(a,n,D,n.notifyWith))):(r!==D&&(s=void 0,c=[e]),(i||n.resolveWith)(s,c))}},l=i?u:function(){try{u()}catch(e){w.Deferred.exceptionHook&&w.Deferred.exceptionHook(e,l.stackTrace),t+1>=a&&(r!==R&&(s=void 0,c=[e]),n.rejectWith(s,c))}};t?l():(w.Deferred.getStackHook&&(l.stackTrace=w.Deferred.getStackHook()),e.setTimeout(l))}}return w.Deferred(function(e){n[0][3].add(o(0,e,h(i)?i:D,e.notifyWith)),n[1][3].add(o(0,e,h(t)?t:D)),n[2][3].add(o(0,e,h(r)?r:R))}).promise()},promise:function(e){return null!=e?w.extend(e,i):i}},a={};return w.each(n,function(e,t){var o=t[2],s=t[5];i[t[1]]=o.add,s&&o.add(function(){r=s},n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),o.add(t[3].fire),a[t[0]]=function(){return a[t[0]+\"With\"](this===a?void 0:this,arguments),this},a[t[0]+\"With\"]=o.fireWith}),i.promise(a),t&&t.call(a,a),a},when:function(e){var t=arguments.length,n=t,r=Array(n),a=i.call(arguments),o=w.Deferred(),s=function(e){return function(n){r[e]=this,a[e]=arguments.length>1?i.call(arguments):n,--t||o.resolveWith(r,a)}};if(t<=1&&(L(e,o.done(s(n)).resolve,o.reject,!t),\"pending\"===o.state()||h(a[n]&&a[n].then)))return o.then();for(;n--;)L(a[n],s(n),o.reject);return o.promise()}});var q=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;w.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&q.test(t.name)&&e.console.warn(\"jQuery.Deferred exception: \"+t.message,t.stack,n)},w.readyException=function(t){e.setTimeout(function(){throw t})};var F=w.Deferred();function V(){m.removeEventListener(\"DOMContentLoaded\",V),e.removeEventListener(\"load\",V),w.ready()}w.fn.ready=function(e){return F.then(e).catch(function(e){w.readyException(e)}),this},w.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--w.readyWait:w.isReady)||(w.isReady=!0,!0!==e&&--w.readyWait>0||F.resolveWith(m,[w]))}}),w.ready.then=F.then,\"complete\"===m.readyState||\"loading\"!==m.readyState&&!m.documentElement.doScroll?e.setTimeout(w.ready):(m.addEventListener(\"DOMContentLoaded\",V),e.addEventListener(\"load\",V));var H=function e(t,n,r,i,a,o,s){var c=0,u=t.length,l=null==r;if(\"object\"===b(r))for(c in a=!0,r)e(t,n,c,r[c],!0,o,s);else if(void 0!==i&&(a=!0,h(i)||(s=!0),l&&(s?(n.call(t,i),n=null):(l=n,n=function(e,t,n){return l.call(w(e),n)})),n))for(;c<u;c++)n(t[c],r,s?i:i.call(t[c],c,n(t[c],r)));return a?t:l?n.call(t):u?n(t[0],r):o},z=/^-ms-/,$=/-([a-z])/g;function B(e,t){return t.toUpperCase()}function W(e){return e.replace(z,\"ms-\").replace($,B)}var U=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=w.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},U(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if(\"string\"==typeof t)i[W(t)]=n;else for(r in t)i[W(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][W(t)]},access:function(e,t,n){return void 0===t||t&&\"string\"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(W):(t=W(t))in r?[t]:t.match(M)||[]).length;for(;n--;)delete r[t[n]]}(void 0===t||w.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!w.isEmptyObject(t)}};var X=new G,Y=new G,J=/^(?:\\{[\\w\\W]*\\}|\\[[\\w\\W]*\\])$/,K=/[A-Z]/g;function Z(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r=\"data-\"+t.replace(K,\"-$&\").toLowerCase(),\"string\"==typeof(n=e.getAttribute(r))){try{n=function(e){return\"true\"===e||\"false\"!==e&&(\"null\"===e?null:e===+e+\"\"?+e:J.test(e)?JSON.parse(e):e)}(n)}catch(e){}Y.set(e,t,n)}else n=void 0;return n}w.extend({hasData:function(e){return Y.hasData(e)||X.hasData(e)},data:function(e,t,n){return Y.access(e,t,n)},removeData:function(e,t){Y.remove(e,t)},_data:function(e,t,n){return X.access(e,t,n)},_removeData:function(e,t){X.remove(e,t)}}),w.fn.extend({data:function(e,t){var n,r,i,a=this[0],o=a&&a.attributes;if(void 0===e){if(this.length&&(i=Y.get(a),1===a.nodeType&&!X.get(a,\"hasDataAttrs\"))){for(n=o.length;n--;)o[n]&&0===(r=o[n].name).indexOf(\"data-\")&&(r=W(r.slice(5)),Z(a,r,i[r]));X.set(a,\"hasDataAttrs\",!0)}return i}return\"object\"===(void 0===e?\"undefined\":_typeof(e))?this.each(function(){Y.set(this,e)}):H(this,function(t){var n;if(a&&void 0===t)return void 0!==(n=Y.get(a,e))?n:void 0!==(n=Z(a,e))?n:void 0;this.each(function(){Y.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){Y.remove(this,e)})}}),w.extend({queue:function(e,t,n){var r;if(e)return t=(t||\"fx\")+\"queue\",r=X.get(e,t),n&&(!r||Array.isArray(n)?r=X.access(e,t,w.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||\"fx\";var n=w.queue(e,t),r=n.length,i=n.shift(),a=w._queueHooks(e,t);\"inprogress\"===i&&(i=n.shift(),r--),i&&(\"fx\"===t&&n.unshift(\"inprogress\"),delete a.stop,i.call(e,function(){w.dequeue(e,t)},a)),!r&&a&&a.empty.fire()},_queueHooks:function(e,t){var n=t+\"queueHooks\";return X.get(e,n)||X.access(e,n,{empty:w.Callbacks(\"once memory\").add(function(){X.remove(e,[t+\"queue\",n])})})}}),w.fn.extend({queue:function(e,t){var n=2;return\"string\"!=typeof e&&(t=e,e=\"fx\",n--),arguments.length<n?w.queue(this[0],e):void 0===t?this:this.each(function(){var n=w.queue(this,e,t);w._queueHooks(this,e),\"fx\"===e&&\"inprogress\"!==n[0]&&w.dequeue(this,e)})},dequeue:function(e){return this.each(function(){w.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||\"fx\",[])},promise:function(e,t){var n,r=1,i=w.Deferred(),a=this,o=this.length,s=function(){--r||i.resolveWith(a,[a])};for(\"string\"!=typeof e&&(t=e,e=void 0),e=e||\"fx\";o--;)(n=X.get(a[o],e+\"queueHooks\"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var Q=/[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/.source,ee=new RegExp(\"^(?:([+-])=|)(\"+Q+\")([a-z%]*)$\",\"i\"),te=[\"Top\",\"Right\",\"Bottom\",\"Left\"],ne=m.documentElement,re=function(e){return w.contains(e.ownerDocument,e)},ie={composed:!0};ne.getRootNode&&(re=function(e){return w.contains(e.ownerDocument,e)||e.getRootNode(ie)===e.ownerDocument});var ae=function(e,t){return\"none\"===(e=t||e).style.display||\"\"===e.style.display&&re(e)&&\"none\"===w.css(e,\"display\")};function oe(e,t,n,r){var i,a,o=20,s=r?function(){return r.cur()}:function(){return w.css(e,t,\"\")},c=s(),u=n&&n[3]||(w.cssNumber[t]?\"\":\"px\"),l=e.nodeType&&(w.cssNumber[t]||\"px\"!==u&&+c)&&ee.exec(w.css(e,t));if(l&&l[3]!==u){for(c/=2,u=u||l[3],l=+c||1;o--;)w.style(e,t,l+u),(1-a)*(1-(a=s()/c||.5))<=0&&(o=0),l/=a;l*=2,w.style(e,t,l+u),n=n||[]}return n&&(l=+l||+c||0,i=n[1]?l+(n[1]+1)*n[2]:+n[2],r&&(r.unit=u,r.start=l,r.end=i)),i}var se={};function ce(e){var t,n=e.ownerDocument,r=e.nodeName,i=se[r];return i||(t=n.body.appendChild(n.createElement(r)),i=w.css(t,\"display\"),t.parentNode.removeChild(t),\"none\"===i&&(i=\"block\"),se[r]=i,i)}function ue(e,t){for(var n,r,i=[],a=0,o=e.length;a<o;a++)(r=e[a]).style&&(n=r.style.display,t?(\"none\"===n&&(i[a]=X.get(r,\"display\")||null,i[a]||(r.style.display=\"\")),\"\"===r.style.display&&ae(r)&&(i[a]=ce(r))):\"none\"!==n&&(i[a]=\"none\",X.set(r,\"display\",n)));for(a=0;a<o;a++)null!=i[a]&&(e[a].style.display=i[a]);return e}w.fn.extend({show:function(){return ue(this,!0)},hide:function(){return ue(this)},toggle:function(e){return\"boolean\"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?w(this).show():w(this).hide()})}});var le,pe,fe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\\/\\0>\\x20\\t\\r\\n\\f]*)/i,he=/^$|^module$|\\/(?:java|ecma)script/i;le=m.createDocumentFragment().appendChild(m.createElement(\"div\")),(pe=m.createElement(\"input\")).setAttribute(\"type\",\"radio\"),pe.setAttribute(\"checked\",\"checked\"),pe.setAttribute(\"name\",\"t\"),le.appendChild(pe),d.checkClone=le.cloneNode(!0).cloneNode(!0).lastChild.checked,le.innerHTML=\"<textarea>x</textarea>\",d.noCloneChecked=!!le.cloneNode(!0).lastChild.defaultValue,le.innerHTML=\"<option></option>\",d.option=!!le.lastChild;var ye={thead:[1,\"<table>\",\"</table>\"],col:[2,\"<table><colgroup>\",\"</colgroup></table>\"],tr:[2,\"<table><tbody>\",\"</tbody></table>\"],td:[3,\"<table><tbody><tr>\",\"</tr></tbody></table>\"],_default:[0,\"\",\"\"]};function me(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||\"*\"):void 0!==e.querySelectorAll?e.querySelectorAll(t||\"*\"):[],void 0===t||t&&j(e,t)?w.merge([e],n):n}function ge(e,t){for(var n=0,r=e.length;n<r;n++)X.set(e[n],\"globalEval\",!t||X.get(t[n],\"globalEval\"))}ye.tbody=ye.tfoot=ye.colgroup=ye.caption=ye.thead,ye.th=ye.td,d.option||(ye.optgroup=ye.option=[1,\"<select multiple='multiple'>\",\"</select>\"]);var ve=/<|&#?\\w+;/;function be(e,t,n,r,i){for(var a,o,s,c,u,l,p=t.createDocumentFragment(),f=[],d=0,h=e.length;d<h;d++)if((a=e[d])||0===a)if(\"object\"===b(a))w.merge(f,a.nodeType?[a]:a);else if(ve.test(a)){for(o=o||p.appendChild(t.createElement(\"div\")),s=(de.exec(a)||[\"\",\"\"])[1].toLowerCase(),c=ye[s]||ye._default,o.innerHTML=c[1]+w.htmlPrefilter(a)+c[2],l=c[0];l--;)o=o.lastChild;w.merge(f,o.childNodes),(o=p.firstChild).textContent=\"\"}else f.push(t.createTextNode(a));for(p.textContent=\"\",d=0;a=f[d++];)if(r&&w.inArray(a,r)>-1)i&&i.push(a);else if(u=re(a),o=me(p.appendChild(a),\"script\"),u&&ge(o),n)for(l=0;a=o[l++];)he.test(a.type||\"\")&&n.push(a);return p}var we=/^key/,Te=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Se=/^([^.]*)(?:\\.(.+)|)/;function xe(){return!0}function ke(){return!1}function Oe(e,t){return e===function(){try{return m.activeElement}catch(e){}}()==(\"focus\"===t)}function je(e,t,n,r,i,a){var o,s;if(\"object\"===(void 0===t?\"undefined\":_typeof(t))){for(s in\"string\"!=typeof n&&(r=r||n,n=void 0),t)je(e,s,n,r,t[s],a);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&(\"string\"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=ke;else if(!i)return e;return 1===a&&(o=i,(i=function(e){return w().off(e),o.apply(this,arguments)}).guid=o.guid||(o.guid=w.guid++)),e.each(function(){w.event.add(this,t,i,r,n)})}function Ae(e,t,n){n?(X.set(e,t,!1),w.event.add(e,t,{namespace:!1,handler:function(e){var r,a,o=X.get(this,t);if(1&e.isTrigger&&this[t]){if(o.length)(w.event.special[t]||{}).delegateType&&e.stopPropagation();else if(o=i.call(arguments),X.set(this,t,o),r=n(this,t),this[t](),o!==(a=X.get(this,t))||r?X.set(this,t,!1):a={},o!==a)return e.stopImmediatePropagation(),e.preventDefault(),a.value}else o.length&&(X.set(this,t,{value:w.event.trigger(w.extend(o[0],w.Event.prototype),o.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===X.get(e,t)&&w.event.add(e,t,xe)}w.event={global:{},add:function(e,t,n,r,i){var a,o,s,c,u,l,p,f,d,h,y,m=X.get(e);if(U(e))for(n.handler&&(n=(a=n).handler,i=a.selector),i&&w.find.matchesSelector(ne,i),n.guid||(n.guid=w.guid++),(c=m.events)||(c=m.events=Object.create(null)),(o=m.handle)||(o=m.handle=function(t){return void 0!==w&&w.event.triggered!==t.type?w.event.dispatch.apply(e,arguments):void 0}),u=(t=(t||\"\").match(M)||[\"\"]).length;u--;)d=y=(s=Se.exec(t[u])||[])[1],h=(s[2]||\"\").split(\".\").sort(),d&&(p=w.event.special[d]||{},d=(i?p.delegateType:p.bindType)||d,p=w.event.special[d]||{},l=w.extend({type:d,origType:y,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&w.expr.match.needsContext.test(i),namespace:h.join(\".\")},a),(f=c[d])||((f=c[d]=[]).delegateCount=0,p.setup&&!1!==p.setup.call(e,r,h,o)||e.addEventListener&&e.addEventListener(d,o)),p.add&&(p.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),i?f.splice(f.delegateCount++,0,l):f.push(l),w.event.global[d]=!0)},remove:function(e,t,n,r,i){var a,o,s,c,u,l,p,f,d,h,y,m=X.hasData(e)&&X.get(e);if(m&&(c=m.events)){for(u=(t=(t||\"\").match(M)||[\"\"]).length;u--;)if(d=y=(s=Se.exec(t[u])||[])[1],h=(s[2]||\"\").split(\".\").sort(),d){for(p=w.event.special[d]||{},f=c[d=(r?p.delegateType:p.bindType)||d]||[],s=s[2]&&new RegExp(\"(^|\\\\.)\"+h.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"),o=a=f.length;a--;)l=f[a],!i&&y!==l.origType||n&&n.guid!==l.guid||s&&!s.test(l.namespace)||r&&r!==l.selector&&(\"**\"!==r||!l.selector)||(f.splice(a,1),l.selector&&f.delegateCount--,p.remove&&p.remove.call(e,l));o&&!f.length&&(p.teardown&&!1!==p.teardown.call(e,h,m.handle)||w.removeEvent(e,d,m.handle),delete c[d])}else for(d in c)w.event.remove(e,d+t[u],n,r,!0);w.isEmptyObject(c)&&X.remove(e,\"handle events\")}},dispatch:function(e){var t,n,r,i,a,o,s=new Array(arguments.length),c=w.event.fix(e),u=(X.get(this,\"events\")||Object.create(null))[c.type]||[],l=w.event.special[c.type]||{};for(s[0]=c,t=1;t<arguments.length;t++)s[t]=arguments[t];if(c.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,c)){for(o=w.event.handlers.call(this,c,u),t=0;(i=o[t++])&&!c.isPropagationStopped();)for(c.currentTarget=i.elem,n=0;(a=i.handlers[n++])&&!c.isImmediatePropagationStopped();)c.rnamespace&&!1!==a.namespace&&!c.rnamespace.test(a.namespace)||(c.handleObj=a,c.data=a.data,void 0!==(r=((w.event.special[a.origType]||{}).handle||a.handler).apply(i.elem,s))&&!1===(c.result=r)&&(c.preventDefault(),c.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,c),c.result}},handlers:function(e,t){var n,r,i,a,o,s=[],c=t.delegateCount,u=e.target;if(c&&u.nodeType&&!(\"click\"===e.type&&e.button>=1))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&(\"click\"!==e.type||!0!==u.disabled)){for(a=[],o={},n=0;n<c;n++)void 0===o[i=(r=t[n]).selector+\" \"]&&(o[i]=r.needsContext?w(i,this).index(u)>-1:w.find(i,this,null,[u]).length),o[i]&&a.push(r);a.length&&s.push({elem:u,handlers:a})}return u=this,c<t.length&&s.push({elem:u,handlers:t.slice(c)}),s},addProp:function(e,t){Object.defineProperty(w.Event.prototype,e,{enumerable:!0,configurable:!0,get:h(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[w.expando]?e:new w.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return fe.test(t.type)&&t.click&&j(t,\"input\")&&Ae(t,\"click\",xe),!1},trigger:function(e){var t=this||e;return fe.test(t.type)&&t.click&&j(t,\"input\")&&Ae(t,\"click\"),!0},_default:function(e){var t=e.target;return fe.test(t.type)&&t.click&&j(t,\"input\")&&X.get(t,\"click\")||j(t,\"a\")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},w.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},w.Event=function(e,t){if(!(this instanceof w.Event))return new w.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?xe:ke,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&w.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[w.expando]=!0},w.Event.prototype={constructor:w.Event,isDefaultPrevented:ke,isPropagationStopped:ke,isImmediatePropagationStopped:ke,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=xe,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=xe,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=xe,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},w.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&we.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Te.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},w.event.addProp),w.each({focus:\"focusin\",blur:\"focusout\"},function(e,t){w.event.special[e]={setup:function(){return Ae(this,e,Oe),!1},trigger:function(){return Ae(this,e),!0},delegateType:t}}),w.each({mouseenter:\"mouseover\",mouseleave:\"mouseout\",pointerenter:\"pointerover\",pointerleave:\"pointerout\"},function(e,t){w.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=e.relatedTarget,i=e.handleObj;return r&&(r===this||w.contains(this,r))||(e.type=i.origType,n=i.handler.apply(this,arguments),e.type=t),n}}}),w.fn.extend({on:function(e,t,n,r){return je(this,e,t,n,r)},one:function(e,t,n,r){return je(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,w(e.delegateTarget).off(r.namespace?r.origType+\".\"+r.namespace:r.origType,r.selector,r.handler),this;if(\"object\"===(void 0===e?\"undefined\":_typeof(e))){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&\"function\"!=typeof t||(n=t,t=void 0),!1===n&&(n=ke),this.each(function(){w.event.remove(this,e,n,t)})}});var Ce=/<script|<style|<link/i,Ee=/checked\\s*(?:[^=]|=\\s*.checked.)/i,_e=/^\\s*<!(?:\\[CDATA\\[|--)|(?:\\]\\]|--)>\\s*$/g;function Ne(e,t){return j(e,\"table\")&&j(11!==t.nodeType?t:t.firstChild,\"tr\")&&w(e).children(\"tbody\")[0]||e}function Pe(e){return e.type=(null!==e.getAttribute(\"type\"))+\"/\"+e.type,e}function Ie(e){return\"true/\"===(e.type||\"\").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute(\"type\"),e}function Me(e,t){var n,r,i,a,o,s;if(1===t.nodeType){if(X.hasData(e)&&(s=X.get(e).events))for(i in X.remove(t,\"handle events\"),s)for(n=0,r=s[i].length;n<r;n++)w.event.add(t,i,s[i][n]);Y.hasData(e)&&(a=Y.access(e),o=w.extend({},a),Y.set(t,o))}}function De(e,t,n,r){t=a(t);var i,o,s,c,u,l,p=0,f=e.length,y=f-1,m=t[0],g=h(m);if(g||f>1&&\"string\"==typeof m&&!d.checkClone&&Ee.test(m))return e.each(function(i){var a=e.eq(i);g&&(t[0]=m.call(this,i,a.html())),De(a,t,n,r)});if(f&&(o=(i=be(t,e[0].ownerDocument,!1,e,r)).firstChild,1===i.childNodes.length&&(i=o),o||r)){for(c=(s=w.map(me(i,\"script\"),Pe)).length;p<f;p++)u=i,p!==y&&(u=w.clone(u,!0,!0),c&&w.merge(s,me(u,\"script\"))),n.call(e[p],u,p);if(c)for(l=s[s.length-1].ownerDocument,w.map(s,Ie),p=0;p<c;p++)u=s[p],he.test(u.type||\"\")&&!X.access(u,\"globalEval\")&&w.contains(l,u)&&(u.src&&\"module\"!==(u.type||\"\").toLowerCase()?w._evalUrl&&!u.noModule&&w._evalUrl(u.src,{nonce:u.nonce||u.getAttribute(\"nonce\")},l):v(u.textContent.replace(_e,\"\"),u,l))}return e}function Re(e,t,n){for(var r,i=t?w.filter(t,e):e,a=0;null!=(r=i[a]);a++)n||1!==r.nodeType||w.cleanData(me(r)),r.parentNode&&(n&&re(r)&&ge(me(r,\"script\")),r.parentNode.removeChild(r));return e}w.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,a,o,s,c,u,l=e.cloneNode(!0),p=re(e);if(!(d.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||w.isXMLDoc(e)))for(o=me(l),r=0,i=(a=me(e)).length;r<i;r++)s=a[r],c=o[r],void 0,\"input\"===(u=c.nodeName.toLowerCase())&&fe.test(s.type)?c.checked=s.checked:\"input\"!==u&&\"textarea\"!==u||(c.defaultValue=s.defaultValue);if(t)if(n)for(a=a||me(e),o=o||me(l),r=0,i=a.length;r<i;r++)Me(a[r],o[r]);else Me(e,l);return(o=me(l,\"script\")).length>0&&ge(o,!p&&me(e,\"script\")),l},cleanData:function(e){for(var t,n,r,i=w.event.special,a=0;void 0!==(n=e[a]);a++)if(U(n)){if(t=n[X.expando]){if(t.events)for(r in t.events)i[r]?w.event.remove(n,r):w.removeEvent(n,r,t.handle);n[X.expando]=void 0}n[Y.expando]&&(n[Y.expando]=void 0)}}}),w.fn.extend({detach:function(e){return Re(this,e,!0)},remove:function(e){return Re(this,e)},text:function(e){return H(this,function(e){return void 0===e?w.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return De(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ne(this,e).appendChild(e)})},prepend:function(){return De(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Ne(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return De(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return De(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(w.cleanData(me(e,!1)),e.textContent=\"\");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return w.clone(this,e,t)})},html:function(e){return H(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if(\"string\"==typeof e&&!Ce.test(e)&&!ye[(de.exec(e)||[\"\",\"\"])[1].toLowerCase()]){e=w.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(w.cleanData(me(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return De(this,arguments,function(t){var n=this.parentNode;w.inArray(this,e)<0&&(w.cleanData(me(this)),n&&n.replaceChild(t,this))},e)}}),w.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},function(e,t){w.fn[e]=function(e){for(var n,r=[],i=w(e),a=i.length-1,s=0;s<=a;s++)n=s===a?this:this.clone(!0),w(i[s])[t](n),o.apply(r,n.get());return this.pushStack(r)}});var Le=new RegExp(\"^(\"+Q+\")(?!px)[a-z%]+$\",\"i\"),qe=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},Fe=function(e,t,n){var r,i,a={};for(i in t)a[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=a[i];return r},Ve=new RegExp(te.join(\"|\"),\"i\");function He(e,t,n){var r,i,a,o,s=e.style;return(n=n||qe(e))&&(\"\"!==(o=n.getPropertyValue(t)||n[t])||re(e)||(o=w.style(e,t)),!d.pixelBoxStyles()&&Le.test(o)&&Ve.test(t)&&(r=s.width,i=s.minWidth,a=s.maxWidth,s.minWidth=s.maxWidth=s.width=o,o=n.width,s.width=r,s.minWidth=i,s.maxWidth=a)),void 0!==o?o+\"\":o}function ze(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function t(){if(l){u.style.cssText=\"position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0\",l.style.cssText=\"position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%\",ne.appendChild(u).appendChild(l);var t=e.getComputedStyle(l);r=\"1%\"!==t.top,c=12===n(t.marginLeft),l.style.right=\"60%\",o=36===n(t.right),i=36===n(t.width),l.style.position=\"absolute\",a=12===n(l.offsetWidth/3),ne.removeChild(u),l=null}}function n(e){return Math.round(parseFloat(e))}var r,i,a,o,s,c,u=m.createElement(\"div\"),l=m.createElement(\"div\");l.style&&(l.style.backgroundClip=\"content-box\",l.cloneNode(!0).style.backgroundClip=\"\",d.clearCloneStyle=\"content-box\"===l.style.backgroundClip,w.extend(d,{boxSizingReliable:function(){return t(),i},pixelBoxStyles:function(){return t(),o},pixelPosition:function(){return t(),r},reliableMarginLeft:function(){return t(),c},scrollboxSize:function(){return t(),a},reliableTrDimensions:function(){var t,n,r,i;return null==s&&(t=m.createElement(\"table\"),n=m.createElement(\"tr\"),r=m.createElement(\"div\"),t.style.cssText=\"position:absolute;left:-11111px\",n.style.height=\"1px\",r.style.height=\"9px\",ne.appendChild(t).appendChild(n).appendChild(r),i=e.getComputedStyle(n),s=parseInt(i.height)>3,ne.removeChild(t)),s}}))}();var $e=[\"Webkit\",\"Moz\",\"ms\"],Be=m.createElement(\"div\").style,We={};function Ue(e){var t=w.cssProps[e]||We[e];return t||(e in Be?e:We[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=$e.length;n--;)if((e=$e[n]+t)in Be)return e}(e)||e)}var Ge=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ye={position:\"absolute\",visibility:\"hidden\",display:\"block\"},Je={letterSpacing:\"0\",fontWeight:\"400\"};function Ke(e,t,n){var r=ee.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||\"px\"):t}function Ze(e,t,n,r,i,a){var o=\"width\"===t?1:0,s=0,c=0;if(n===(r?\"border\":\"content\"))return 0;for(;o<4;o+=2)\"margin\"===n&&(c+=w.css(e,n+te[o],!0,i)),r?(\"content\"===n&&(c-=w.css(e,\"padding\"+te[o],!0,i)),\"margin\"!==n&&(c-=w.css(e,\"border\"+te[o]+\"Width\",!0,i))):(c+=w.css(e,\"padding\"+te[o],!0,i),\"padding\"!==n?c+=w.css(e,\"border\"+te[o]+\"Width\",!0,i):s+=w.css(e,\"border\"+te[o]+\"Width\",!0,i));return!r&&a>=0&&(c+=Math.max(0,Math.ceil(e[\"offset\"+t[0].toUpperCase()+t.slice(1)]-a-c-s-.5))||0),c}function Qe(e,t,n){var r=qe(e),i=(!d.boxSizingReliable()||n)&&\"border-box\"===w.css(e,\"boxSizing\",!1,r),a=i,o=He(e,t,r),s=\"offset\"+t[0].toUpperCase()+t.slice(1);if(Le.test(o)){if(!n)return o;o=\"auto\"}return(!d.boxSizingReliable()&&i||!d.reliableTrDimensions()&&j(e,\"tr\")||\"auto\"===o||!parseFloat(o)&&\"inline\"===w.css(e,\"display\",!1,r))&&e.getClientRects().length&&(i=\"border-box\"===w.css(e,\"boxSizing\",!1,r),(a=s in e)&&(o=e[s])),(o=parseFloat(o)||0)+Ze(e,t,n||(i?\"border\":\"content\"),a,r,o)+\"px\"}function et(e,t,n,r,i){return new et.prototype.init(e,t,n,r,i)}w.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=He(e,\"opacity\");return\"\"===n?\"1\":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,a,o,s=W(t),c=Xe.test(t),u=e.style;if(c||(t=Ue(s)),o=w.cssHooks[t]||w.cssHooks[s],void 0===n)return o&&\"get\"in o&&void 0!==(i=o.get(e,!1,r))?i:u[t];\"string\"===(a=void 0===n?\"undefined\":_typeof(n))&&(i=ee.exec(n))&&i[1]&&(n=oe(e,t,i),a=\"number\"),null!=n&&n==n&&(\"number\"!==a||c||(n+=i&&i[3]||(w.cssNumber[s]?\"\":\"px\")),d.clearCloneStyle||\"\"!==n||0!==t.indexOf(\"background\")||(u[t]=\"inherit\"),o&&\"set\"in o&&void 0===(n=o.set(e,n,r))||(c?u.setProperty(t,n):u[t]=n))}},css:function(e,t,n,r){var i,a,o,s=W(t);return Xe.test(t)||(t=Ue(s)),(o=w.cssHooks[t]||w.cssHooks[s])&&\"get\"in o&&(i=o.get(e,!0,n)),void 0===i&&(i=He(e,t,r)),\"normal\"===i&&t in Je&&(i=Je[t]),\"\"===n||n?(a=parseFloat(i),!0===n||isFinite(a)?a||0:i):i}}),w.each([\"height\",\"width\"],function(e,t){w.cssHooks[t]={get:function(e,n,r){if(n)return!Ge.test(w.css(e,\"display\"))||e.getClientRects().length&&e.getBoundingClientRect().width?Qe(e,t,r):Fe(e,Ye,function(){return Qe(e,t,r)})},set:function(e,n,r){var i,a=qe(e),o=!d.scrollboxSize()&&\"absolute\"===a.position,s=(o||r)&&\"border-box\"===w.css(e,\"boxSizing\",!1,a),c=r?Ze(e,t,r,s,a):0;return s&&o&&(c-=Math.ceil(e[\"offset\"+t[0].toUpperCase()+t.slice(1)]-parseFloat(a[t])-Ze(e,t,\"border\",!1,a)-.5)),c&&(i=ee.exec(n))&&\"px\"!==(i[3]||\"px\")&&(e.style[t]=n,n=w.css(e,t)),Ke(0,n,c)}}}),w.cssHooks.marginLeft=ze(d.reliableMarginLeft,function(e,t){if(t)return(parseFloat(He(e,\"marginLeft\"))||e.getBoundingClientRect().left-Fe(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+\"px\"}),w.each({margin:\"\",padding:\"\",border:\"Width\"},function(e,t){w.cssHooks[e+t]={expand:function(n){for(var r=0,i={},a=\"string\"==typeof n?n.split(\" \"):[n];r<4;r++)i[e+te[r]+t]=a[r]||a[r-2]||a[0];return i}},\"margin\"!==e&&(w.cssHooks[e+t].set=Ke)}),w.fn.extend({css:function(e,t){return H(this,function(e,t,n){var r,i,a={},o=0;if(Array.isArray(t)){for(r=qe(e),i=t.length;o<i;o++)a[t[o]]=w.css(e,t[o],!1,r);return a}return void 0!==n?w.style(e,t,n):w.css(e,t)},e,t,arguments.length>1)}}),w.Tween=et,et.prototype={constructor:et,init:function(e,t,n,r,i,a){this.elem=e,this.prop=n,this.easing=i||w.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=a||(w.cssNumber[n]?\"\":\"px\")},cur:function(){var e=et.propHooks[this.prop];return e&&e.get?e.get(this):et.propHooks._default.get(this)},run:function(e){var t,n=et.propHooks[this.prop];return this.options.duration?this.pos=t=w.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):et.propHooks._default.set(this),this}},et.prototype.init.prototype=et.prototype,et.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=w.css(e.elem,e.prop,\"\"))&&\"auto\"!==t?t:0},set:function(e){w.fx.step[e.prop]?w.fx.step[e.prop](e):1!==e.elem.nodeType||!w.cssHooks[e.prop]&&null==e.elem.style[Ue(e.prop)]?e.elem[e.prop]=e.now:w.style(e.elem,e.prop,e.now+e.unit)}}},et.propHooks.scrollTop=et.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},w.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:\"swing\"},w.fx=et.prototype.init,w.fx.step={};var tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function at(){nt&&(!1===m.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(at):e.setTimeout(at,w.fx.interval),w.fx.tick())}function ot(){return e.setTimeout(function(){tt=void 0}),tt=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i[\"margin\"+(n=te[r])]=i[\"padding\"+n]=e;return t&&(i.opacity=i.width=e),i}function ct(e,t,n){for(var r,i=(ut.tweeners[t]||[]).concat(ut.tweeners[\"*\"]),a=0,o=i.length;a<o;a++)if(r=i[a].call(n,t,e))return r}function ut(e,t,n){var r,i,a=0,o=ut.prefilters.length,s=w.Deferred().always(function(){delete c.elem}),c=function(){if(i)return!1;for(var t=tt||ot(),n=Math.max(0,u.startTime+u.duration-t),r=1-(n/u.duration||0),a=0,o=u.tweens.length;a<o;a++)u.tweens[a].run(r);return s.notifyWith(e,[u,r,n]),r<1&&o?n:(o||s.notifyWith(e,[u,1,0]),s.resolveWith(e,[u]),!1)},u=s.promise({elem:e,props:w.extend({},t),opts:w.extend(!0,{specialEasing:{},easing:w.easing._default},n),originalProperties:t,originalOptions:n,startTime:tt||ot(),duration:n.duration,tweens:[],createTween:function(t,n){var r=w.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(r),r},stop:function(t){var n=0,r=t?u.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)u.tweens[n].run(1);return t?(s.notifyWith(e,[u,1,0]),s.resolveWith(e,[u,t])):s.rejectWith(e,[u,t]),this}}),l=u.props;for(!function(e,t){var n,r,i,a,o;for(n in e)if(i=t[r=W(n)],a=e[n],Array.isArray(a)&&(i=a[1],a=e[n]=a[0]),n!==r&&(e[r]=a,delete e[n]),(o=w.cssHooks[r])&&\"expand\"in o)for(n in a=o.expand(a),delete e[r],a)n in e||(e[n]=a[n],t[n]=i);else t[r]=i}(l,u.opts.specialEasing);a<o;a++)if(r=ut.prefilters[a].call(u,e,l,u.opts))return h(r.stop)&&(w._queueHooks(u.elem,u.opts.queue).stop=r.stop.bind(r)),r;return w.map(l,ct,u),h(u.opts.start)&&u.opts.start.call(e,u),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always),w.fx.timer(w.extend(c,{elem:e,anim:u,queue:u.opts.queue})),u}w.Animation=w.extend(ut,{tweeners:{\"*\":[function(e,t){var n=this.createTween(e,t);return oe(n.elem,e,ee.exec(t),n),n}]},tweener:function(e,t){h(e)?(t=e,e=[\"*\"]):e=e.match(M);for(var n,r=0,i=e.length;r<i;r++)n=e[r],ut.tweeners[n]=ut.tweeners[n]||[],ut.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,a,o,s,c,u,l,p=\"width\"in t||\"height\"in t,f=this,d={},h=e.style,y=e.nodeType&&ae(e),m=X.get(e,\"fxshow\");for(r in n.queue||(null==(o=w._queueHooks(e,\"fx\")).unqueued&&(o.unqueued=0,s=o.empty.fire,o.empty.fire=function(){o.unqueued||s()}),o.unqueued++,f.always(function(){f.always(function(){o.unqueued--,w.queue(e,\"fx\").length||o.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],a=a||\"toggle\"===i,i===(y?\"hide\":\"show\")){if(\"show\"!==i||!m||void 0===m[r])continue;y=!0}d[r]=m&&m[r]||w.style(e,r)}if((c=!w.isEmptyObject(t))||!w.isEmptyObject(d))for(r in p&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(u=m&&m.display)&&(u=X.get(e,\"display\")),\"none\"===(l=w.css(e,\"display\"))&&(u?l=u:(ue([e],!0),u=e.style.display||u,l=w.css(e,\"display\"),ue([e]))),(\"inline\"===l||\"inline-block\"===l&&null!=u)&&\"none\"===w.css(e,\"float\")&&(c||(f.done(function(){h.display=u}),null==u&&(l=h.display,u=\"none\"===l?\"\":l)),h.display=\"inline-block\")),n.overflow&&(h.overflow=\"hidden\",f.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),c=!1,d)c||(m?\"hidden\"in m&&(y=m.hidden):m=X.access(e,\"fxshow\",{display:u}),a&&(m.hidden=!y),y&&ue([e],!0),f.done(function(){for(r in y||ue([e]),X.remove(e,\"fxshow\"),d)w.style(e,r,d[r])})),c=ct(y?m[r]:0,r,f),r in m||(m[r]=c.start,y&&(c.end=c.start,c.start=0))}],prefilter:function(e,t){t?ut.prefilters.unshift(e):ut.prefilters.push(e)}}),w.speed=function(e,t,n){var r=e&&\"object\"===(void 0===e?\"undefined\":_typeof(e))?w.extend({},e):{complete:n||!n&&t||h(e)&&e,duration:e,easing:n&&t||t&&!h(t)&&t};return w.fx.off?r.duration=0:\"number\"!=typeof r.duration&&(r.duration in w.fx.speeds?r.duration=w.fx.speeds[r.duration]:r.duration=w.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue=\"fx\"),r.old=r.complete,r.complete=function(){h(r.old)&&r.old.call(this),r.queue&&w.dequeue(this,r.queue)},r},w.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css(\"opacity\",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=w.isEmptyObject(e),a=w.speed(t,n,r),o=function(){var t=ut(this,w.extend({},e),a);(i||X.get(this,\"finish\"))&&t.stop(!0)};return o.finish=o,i||!1===a.queue?this.each(o):this.queue(a.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return\"string\"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||\"fx\",[]),this.each(function(){var t=!0,i=null!=e&&e+\"queueHooks\",a=w.timers,o=X.get(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&it.test(i)&&r(o[i]);for(i=a.length;i--;)a[i].elem!==this||null!=e&&a[i].queue!==e||(a[i].anim.stop(n),t=!1,a.splice(i,1));!t&&n||w.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||\"fx\"),this.each(function(){var t,n=X.get(this),r=n[e+\"queue\"],i=n[e+\"queueHooks\"],a=w.timers,o=r?r.length:0;for(n.finish=!0,w.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=a.length;t--;)a[t].elem===this&&a[t].queue===e&&(a[t].anim.stop(!0),a.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),w.each([\"toggle\",\"show\",\"hide\"],function(e,t){var n=w.fn[t];w.fn[t]=function(e,r,i){return null==e||\"boolean\"==typeof e?n.apply(this,arguments):this.animate(st(t,!0),e,r,i)}}),w.each({slideDown:st(\"show\"),slideUp:st(\"hide\"),slideToggle:st(\"toggle\"),fadeIn:{opacity:\"show\"},fadeOut:{opacity:\"hide\"},fadeToggle:{opacity:\"toggle\"}},function(e,t){w.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),w.timers=[],w.fx.tick=function(){var e,t=0,n=w.timers;for(tt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||w.fx.stop(),tt=void 0},w.fx.timer=function(e){w.timers.push(e),w.fx.start()},w.fx.interval=13,w.fx.start=function(){nt||(nt=!0,at())},w.fx.stop=function(){nt=null},w.fx.speeds={slow:600,fast:200,_default:400},w.fn.delay=function(t,n){return t=w.fx&&w.fx.speeds[t]||t,n=n||\"fx\",this.queue(n,function(n,r){var i=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(i)}})},function(){var e=m.createElement(\"input\"),t=m.createElement(\"select\").appendChild(m.createElement(\"option\"));e.type=\"checkbox\",d.checkOn=\"\"!==e.value,d.optSelected=t.selected,(e=m.createElement(\"input\")).value=\"t\",e.type=\"radio\",d.radioValue=\"t\"===e.value}();var lt,pt=w.expr.attrHandle;w.fn.extend({attr:function(e,t){return H(this,w.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){w.removeAttr(this,e)})}}),w.extend({attr:function(e,t,n){var r,i,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return void 0===e.getAttribute?w.prop(e,t,n):(1===a&&w.isXMLDoc(e)||(i=w.attrHooks[t.toLowerCase()]||(w.expr.match.bool.test(t)?lt:void 0)),void 0!==n?null===n?void w.removeAttr(e,t):i&&\"set\"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+\"\"),n):i&&\"get\"in i&&null!==(r=i.get(e,t))?r:null==(r=w.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!d.radioValue&&\"radio\"===t&&j(e,\"input\")){var n=e.value;return e.setAttribute(\"type\",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(M);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),lt={set:function(e,t,n){return!1===t?w.removeAttr(e,n):e.setAttribute(n,n),n}},w.each(w.expr.match.bool.source.match(/\\w+/g),function(e,t){var n=pt[t]||w.find.attr;pt[t]=function(e,t,r){var i,a,o=t.toLowerCase();return r||(a=pt[o],pt[o]=i,i=null!=n(e,t,r)?o:null,pt[o]=a),i}});var ft=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(M)||[]).join(\" \")}function yt(e){return e.getAttribute&&e.getAttribute(\"class\")||\"\"}function mt(e){return Array.isArray(e)?e:\"string\"==typeof e&&e.match(M)||[]}w.fn.extend({prop:function(e,t){return H(this,w.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[w.propFix[e]||e]})}}),w.extend({prop:function(e,t,n){var r,i,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return 1===a&&w.isXMLDoc(e)||(t=w.propFix[t]||t,i=w.propHooks[t]),void 0!==n?i&&\"set\"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&\"get\"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=w.find.attr(e,\"tabindex\");return t?parseInt(t,10):ft.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:\"htmlFor\",class:\"className\"}}),d.optSelected||(w.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),w.each([\"tabIndex\",\"readOnly\",\"maxLength\",\"cellSpacing\",\"cellPadding\",\"rowSpan\",\"colSpan\",\"useMap\",\"frameBorder\",\"contentEditable\"],function(){w.propFix[this.toLowerCase()]=this}),w.fn.extend({addClass:function(e){var t,n,r,i,a,o,s,c=0;if(h(e))return this.each(function(t){w(this).addClass(e.call(this,t,yt(this)))});if((t=mt(e)).length)for(;n=this[c++];)if(i=yt(n),r=1===n.nodeType&&\" \"+ht(i)+\" \"){for(o=0;a=t[o++];)r.indexOf(\" \"+a+\" \")<0&&(r+=a+\" \");i!==(s=ht(r))&&n.setAttribute(\"class\",s)}return this},removeClass:function(e){var t,n,r,i,a,o,s,c=0;if(h(e))return this.each(function(t){w(this).removeClass(e.call(this,t,yt(this)))});if(!arguments.length)return this.attr(\"class\",\"\");if((t=mt(e)).length)for(;n=this[c++];)if(i=yt(n),r=1===n.nodeType&&\" \"+ht(i)+\" \"){for(o=0;a=t[o++];)for(;r.indexOf(\" \"+a+\" \")>-1;)r=r.replace(\" \"+a+\" \",\" \");i!==(s=ht(r))&&n.setAttribute(\"class\",s)}return this},toggleClass:function(e,t){var n=void 0===e?\"undefined\":_typeof(e),r=\"string\"===n||Array.isArray(e);return\"boolean\"==typeof t&&r?t?this.addClass(e):this.removeClass(e):h(e)?this.each(function(n){w(this).toggleClass(e.call(this,n,yt(this),t),t)}):this.each(function(){var t,i,a,o;if(r)for(i=0,a=w(this),o=mt(e);t=o[i++];)a.hasClass(t)?a.removeClass(t):a.addClass(t);else void 0!==e&&\"boolean\"!==n||((t=yt(this))&&X.set(this,\"__className__\",t),this.setAttribute&&this.setAttribute(\"class\",t||!1===e?\"\":X.get(this,\"__className__\")||\"\"))})},hasClass:function(e){var t,n,r=0;for(t=\" \"+e+\" \";n=this[r++];)if(1===n.nodeType&&(\" \"+ht(yt(n))+\" \").indexOf(t)>-1)return!0;return!1}});var gt=/\\r/g;w.fn.extend({val:function(e){var t,n,r,i=this[0];return arguments.length?(r=h(e),this.each(function(n){var i;1===this.nodeType&&(null==(i=r?e.call(this,n,w(this).val()):e)?i=\"\":\"number\"==typeof i?i+=\"\":Array.isArray(i)&&(i=w.map(i,function(e){return null==e?\"\":e+\"\"})),(t=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()])&&\"set\"in t&&void 0!==t.set(this,i,\"value\")||(this.value=i))})):i?(t=w.valHooks[i.type]||w.valHooks[i.nodeName.toLowerCase()])&&\"get\"in t&&void 0!==(n=t.get(i,\"value\"))?n:\"string\"==typeof(n=i.value)?n.replace(gt,\"\"):null==n?\"\":n:void 0}}),w.extend({valHooks:{option:{get:function(e){var t=w.find.attr(e,\"value\");return null!=t?t:ht(w.text(e))}},select:{get:function(e){var t,n,r,i=e.options,a=e.selectedIndex,o=\"select-one\"===e.type,s=o?null:[],c=o?a+1:i.length;for(r=a<0?c:o?a:0;r<c;r++)if(((n=i[r]).selected||r===a)&&!n.disabled&&(!n.parentNode.disabled||!j(n.parentNode,\"optgroup\"))){if(t=w(n).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,a=w.makeArray(t),o=i.length;o--;)((r=i[o]).selected=w.inArray(w.valHooks.option.get(r),a)>-1)&&(n=!0);return n||(e.selectedIndex=-1),a}}}}),w.each([\"radio\",\"checkbox\"],function(){w.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=w.inArray(w(e).val(),t)>-1}},d.checkOn||(w.valHooks[this].get=function(e){return null===e.getAttribute(\"value\")?\"on\":e.value})}),d.focusin=\"onfocusin\"in e;var vt=/^(?:focusinfocus|focusoutblur)$/,bt=function(e){e.stopPropagation()};w.extend(w.event,{trigger:function(t,n,r,i){var a,o,s,c,u,p,f,d,g=[r||m],v=l.call(t,\"type\")?t.type:t,b=l.call(t,\"namespace\")?t.namespace.split(\".\"):[];if(o=d=s=r=r||m,3!==r.nodeType&&8!==r.nodeType&&!vt.test(v+w.event.triggered)&&(v.indexOf(\".\")>-1&&(v=(b=v.split(\".\")).shift(),b.sort()),u=v.indexOf(\":\")<0&&\"on\"+v,(t=t[w.expando]?t:new w.Event(v,\"object\"===(void 0===t?\"undefined\":_typeof(t))&&t)).isTrigger=i?2:3,t.namespace=b.join(\".\"),t.rnamespace=t.namespace?new RegExp(\"(^|\\\\.)\"+b.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:w.makeArray(n,[t]),f=w.event.special[v]||{},i||!f.trigger||!1!==f.trigger.apply(r,n))){if(!i&&!f.noBubble&&!y(r)){for(c=f.delegateType||v,vt.test(c+v)||(o=o.parentNode);o;o=o.parentNode)g.push(o),s=o;s===(r.ownerDocument||m)&&g.push(s.defaultView||s.parentWindow||e)}for(a=0;(o=g[a++])&&!t.isPropagationStopped();)d=o,t.type=a>1?c:f.bindType||v,(p=(X.get(o,\"events\")||Object.create(null))[t.type]&&X.get(o,\"handle\"))&&p.apply(o,n),(p=u&&o[u])&&p.apply&&U(o)&&(t.result=p.apply(o,n),!1===t.result&&t.preventDefault());return t.type=v,i||t.isDefaultPrevented()||f._default&&!1!==f._default.apply(g.pop(),n)||!U(r)||u&&h(r[v])&&!y(r)&&((s=r[u])&&(r[u]=null),w.event.triggered=v,t.isPropagationStopped()&&d.addEventListener(v,bt),r[v](),t.isPropagationStopped()&&d.removeEventListener(v,bt),w.event.triggered=void 0,s&&(r[u]=s)),t.result}},simulate:function(e,t,n){var r=w.extend(new w.Event,n,{type:e,isSimulated:!0});w.event.trigger(r,null,t)}}),w.fn.extend({trigger:function(e,t){return this.each(function(){w.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return w.event.trigger(e,t,n,!0)}}),d.focusin||w.each({focus:\"focusin\",blur:\"focusout\"},function(e,t){var n=function(e){w.event.simulate(t,e.target,w.event.fix(e))};w.event.special[t]={setup:function(){var r=this.ownerDocument||this.document||this,i=X.access(r,t);i||r.addEventListener(e,n,!0),X.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,i=X.access(r,t)-1;i?X.access(r,t,i):(r.removeEventListener(e,n,!0),X.remove(r,t))}}});var wt=e.location,Tt={guid:Date.now()},St=/\\?/;w.parseXML=function(t){var n;if(!t||\"string\"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,\"text/xml\")}catch(e){n=void 0}return n&&!n.getElementsByTagName(\"parsererror\").length||w.error(\"Invalid XML: \"+t),n};var xt=/\\[\\]$/,kt=/\\r?\\n/g,Ot=/^(?:submit|button|image|reset|file)$/i,jt=/^(?:input|select|textarea|keygen)/i;function At(e,t,n,r){var i;if(Array.isArray(t))w.each(t,function(t,i){n||xt.test(e)?r(e,i):At(e+\"[\"+(\"object\"===(void 0===i?\"undefined\":_typeof(i))&&null!=i?t:\"\")+\"]\",i,n,r)});else if(n||\"object\"!==b(t))r(e,t);else for(i in t)At(e+\"[\"+i+\"]\",t[i],n,r)}w.param=function(e,t){var n,r=[],i=function(e,t){var n=h(t)?t():t;r[r.length]=encodeURIComponent(e)+\"=\"+encodeURIComponent(null==n?\"\":n)};if(null==e)return\"\";if(Array.isArray(e)||e.jquery&&!w.isPlainObject(e))w.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join(\"&\")},w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=w.prop(this,\"elements\");return e?w.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!w(this).is(\":disabled\")&&jt.test(this.nodeName)&&!Ot.test(e)&&(this.checked||!fe.test(e))}).map(function(e,t){var n=w(this).val();return null==n?null:Array.isArray(n)?w.map(n,function(e){return{name:t.name,value:e.replace(kt,\"\\r\\n\")}}):{name:t.name,value:n.replace(kt,\"\\r\\n\")}}).get()}});var Ct=/%20/g,Et=/#.*$/,_t=/([?&])_=[^&]*/,Nt=/^(.*?):[ \\t]*([^\\r\\n]*)$/gm,Pt=/^(?:GET|HEAD)$/,It=/^\\/\\//,Mt={},Dt={},Rt=\"*/\".concat(\"*\"),Lt=m.createElement(\"a\");function qt(e){return function(t,n){\"string\"!=typeof t&&(n=t,t=\"*\");var r,i=0,a=t.toLowerCase().match(M)||[];if(h(n))for(;r=a[i++];)\"+\"===r[0]?(r=r.slice(1)||\"*\",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Ft(e,t,n,r){var i={},a=e===Dt;function o(s){var c;return i[s]=!0,w.each(e[s]||[],function(e,s){var u=s(t,n,r);return\"string\"!=typeof u||a||i[u]?a?!(c=u):void 0:(t.dataTypes.unshift(u),o(u),!1)}),c}return o(t.dataTypes[0])||!i[\"*\"]&&o(\"*\")}function Vt(e,t){var n,r,i=w.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&w.extend(!0,e,r),e}Lt.href=wt.href,w.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:wt.href,type:\"GET\",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(wt.protocol),global:!0,processData:!0,async:!0,contentType:\"application/x-www-form-urlencoded; charset=UTF-8\",accepts:{\"*\":Rt,text:\"text/plain\",html:\"text/html\",xml:\"application/xml, text/xml\",json:\"application/json, text/javascript\"},contents:{xml:/\\bxml\\b/,html:/\\bhtml/,json:/\\bjson\\b/},responseFields:{xml:\"responseXML\",text:\"responseText\",json:\"responseJSON\"},converters:{\"* text\":String,\"text html\":!0,\"text json\":JSON.parse,\"text xml\":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Vt(Vt(e,w.ajaxSettings),t):Vt(w.ajaxSettings,e)},ajaxPrefilter:qt(Mt),ajaxTransport:qt(Dt),ajax:function(t,n){\"object\"===(void 0===t?\"undefined\":_typeof(t))&&(n=t,t=void 0),n=n||{};var r,i,a,o,s,c,u,l,p,f,d=w.ajaxSetup({},n),h=d.context||d,y=d.context&&(h.nodeType||h.jquery)?w(h):w.event,g=w.Deferred(),v=w.Callbacks(\"once memory\"),b=d.statusCode||{},T={},S={},x=\"canceled\",k={readyState:0,getResponseHeader:function(e){var t;if(u){if(!o)for(o={};t=Nt.exec(a);)o[t[1].toLowerCase()+\" \"]=(o[t[1].toLowerCase()+\" \"]||[]).concat(t[2]);t=o[e.toLowerCase()+\" \"]}return null==t?null:t.join(\", \")},getAllResponseHeaders:function(){return u?a:null},setRequestHeader:function(e,t){return null==u&&(e=S[e.toLowerCase()]=S[e.toLowerCase()]||e,T[e]=t),this},overrideMimeType:function(e){return null==u&&(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(u)k.always(e[k.status]);else for(t in e)b[t]=[b[t],e[t]];return this},abort:function(e){var t=e||x;return r&&r.abort(t),O(0,t),this}};if(g.promise(k),d.url=((t||d.url||wt.href)+\"\").replace(It,wt.protocol+\"//\"),d.type=n.method||n.type||d.method||d.type,d.dataTypes=(d.dataType||\"*\").toLowerCase().match(M)||[\"\"],null==d.crossDomain){c=m.createElement(\"a\");try{c.href=d.url,c.href=c.href,d.crossDomain=Lt.protocol+\"//\"+Lt.host!=c.protocol+\"//\"+c.host}catch(e){d.crossDomain=!0}}if(d.data&&d.processData&&\"string\"!=typeof d.data&&(d.data=w.param(d.data,d.traditional)),Ft(Mt,d,n,k),u)return k;for(p in(l=w.event&&d.global)&&0==w.active++&&w.event.trigger(\"ajaxStart\"),d.type=d.type.toUpperCase(),d.hasContent=!Pt.test(d.type),i=d.url.replace(Et,\"\"),d.hasContent?d.data&&d.processData&&0===(d.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&(d.data=d.data.replace(Ct,\"+\")):(f=d.url.slice(i.length),d.data&&(d.processData||\"string\"==typeof d.data)&&(i+=(St.test(i)?\"&\":\"?\")+d.data,delete d.data),!1===d.cache&&(i=i.replace(_t,\"$1\"),f=(St.test(i)?\"&\":\"?\")+\"_=\"+Tt.guid+++f),d.url=i+f),d.ifModified&&(w.lastModified[i]&&k.setRequestHeader(\"If-Modified-Since\",w.lastModified[i]),w.etag[i]&&k.setRequestHeader(\"If-None-Match\",w.etag[i])),(d.data&&d.hasContent&&!1!==d.contentType||n.contentType)&&k.setRequestHeader(\"Content-Type\",d.contentType),k.setRequestHeader(\"Accept\",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(\"*\"!==d.dataTypes[0]?\", \"+Rt+\"; q=0.01\":\"\"):d.accepts[\"*\"]),d.headers)k.setRequestHeader(p,d.headers[p]);if(d.beforeSend&&(!1===d.beforeSend.call(h,k,d)||u))return k.abort();if(x=\"abort\",v.add(d.complete),k.done(d.success),k.fail(d.error),r=Ft(Dt,d,n,k)){if(k.readyState=1,l&&y.trigger(\"ajaxSend\",[k,d]),u)return k;d.async&&d.timeout>0&&(s=e.setTimeout(function(){k.abort(\"timeout\")},d.timeout));try{u=!1,r.send(T,O)}catch(e){if(u)throw e;O(-1,e)}}else O(-1,\"No Transport\");function O(t,n,o,c){var p,f,m,T,S,x=n;u||(u=!0,s&&e.clearTimeout(s),r=void 0,a=c||\"\",k.readyState=t>0?4:0,p=t>=200&&t<300||304===t,o&&(T=function(e,t,n){for(var r,i,a,o,s=e.contents,c=e.dataTypes;\"*\"===c[0];)c.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader(\"Content-Type\"));if(r)for(i in s)if(s[i]&&s[i].test(r)){c.unshift(i);break}if(c[0]in n)a=c[0];else{for(i in n){if(!c[0]||e.converters[i+\" \"+c[0]]){a=i;break}o||(o=i)}a=a||o}if(a)return a!==c[0]&&c.unshift(a),n[a]}(d,k,o)),!p&&w.inArray(\"script\",d.dataTypes)>-1&&(d.converters[\"text script\"]=function(){}),T=function(e,t,n,r){var i,a,o,s,c,u={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)u[o.toLowerCase()]=e.converters[o];for(a=l.shift();a;)if(e.responseFields[a]&&(n[e.responseFields[a]]=t),!c&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=a,a=l.shift())if(\"*\"===a)a=c;else if(\"*\"!==c&&c!==a){if(!(o=u[c+\" \"+a]||u[\"* \"+a]))for(i in u)if((s=i.split(\" \"))[1]===a&&(o=u[c+\" \"+s[0]]||u[\"* \"+s[0]])){!0===o?o=u[i]:!0!==u[i]&&(a=s[0],l.unshift(s[1]));break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(e){return{state:\"parsererror\",error:o?e:\"No conversion from \"+c+\" to \"+a}}}return{state:\"success\",data:t}}(d,T,k,p),p?(d.ifModified&&((S=k.getResponseHeader(\"Last-Modified\"))&&(w.lastModified[i]=S),(S=k.getResponseHeader(\"etag\"))&&(w.etag[i]=S)),204===t||\"HEAD\"===d.type?x=\"nocontent\":304===t?x=\"notmodified\":(x=T.state,f=T.data,p=!(m=T.error))):(m=x,!t&&x||(x=\"error\",t<0&&(t=0))),k.status=t,k.statusText=(n||x)+\"\",p?g.resolveWith(h,[f,x,k]):g.rejectWith(h,[k,x,m]),k.statusCode(b),b=void 0,l&&y.trigger(p?\"ajaxSuccess\":\"ajaxError\",[k,d,p?f:m]),v.fireWith(h,[k,x]),l&&(y.trigger(\"ajaxComplete\",[k,d]),--w.active||w.event.trigger(\"ajaxStop\")))}return k},getJSON:function(e,t,n){return w.get(e,t,n,\"json\")},getScript:function(e,t){return w.get(e,void 0,t,\"script\")}}),w.each([\"get\",\"post\"],function(e,t){w[t]=function(e,n,r,i){return h(n)&&(i=i||r,r=n,n=void 0),w.ajax(w.extend({url:e,type:t,dataType:i,data:n,success:r},w.isPlainObject(e)&&e))}}),w.ajaxPrefilter(function(e){var t;for(t in e.headers)\"content-type\"===t.toLowerCase()&&(e.contentType=e.headers[t]||\"\")}),w._evalUrl=function(e,t,n){return w.ajax({url:e,type:\"GET\",dataType:\"script\",cache:!0,async:!1,global:!1,converters:{\"text script\":function(){}},dataFilter:function(e){w.globalEval(e,t,n)}})},w.fn.extend({wrapAll:function(e){var t;return this[0]&&(h(e)&&(e=e.call(this[0])),t=w(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return h(e)?this.each(function(t){w(this).wrapInner(e.call(this,t))}):this.each(function(){var t=w(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=h(e);return this.each(function(n){w(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not(\"body\").each(function(){w(this).replaceWith(this.childNodes)}),this}}),w.expr.pseudos.hidden=function(e){return!w.expr.pseudos.visible(e)},w.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},w.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Ht={0:200,1223:204},zt=w.ajaxSettings.xhr();d.cors=!!zt&&\"withCredentials\"in zt,d.ajax=zt=!!zt,w.ajaxTransport(function(t){var n,r;if(d.cors||zt&&!t.crossDomain)return{send:function(i,a){var o,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(o in t.xhrFields)s[o]=t.xhrFields[o];for(o in t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||i[\"X-Requested-With\"]||(i[\"X-Requested-With\"]=\"XMLHttpRequest\"),i)s.setRequestHeader(o,i[o]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,\"abort\"===e?s.abort():\"error\"===e?\"number\"!=typeof s.status?a(0,\"error\"):a(s.status,s.statusText):a(Ht[s.status]||s.status,s.statusText,\"text\"!==(s.responseType||\"text\")||\"string\"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=s.ontimeout=n(\"error\"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout(function(){n&&r()})},n=n(\"abort\");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}}),w.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),w.ajaxSetup({accepts:{script:\"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript\"},contents:{script:/\\b(?:java|ecma)script\\b/},converters:{\"text script\":function(e){return w.globalEval(e),e}}}),w.ajaxPrefilter(\"script\",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type=\"GET\")}),w.ajaxTransport(\"script\",function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(r,i){t=w(\"<script>\").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on(\"load error\",n=function(e){t.remove(),n=null,e&&i(\"error\"===e.type?404:200,e.type)}),m.head.appendChild(t[0])},abort:function(){n&&n()}}});var $t,Bt=[],Wt=/(=)\\?(?=&|$)|\\?\\?/;w.ajaxSetup({jsonp:\"callback\",jsonpCallback:function(){var e=Bt.pop()||w.expando+\"_\"+Tt.guid++;return this[e]=!0,e}}),w.ajaxPrefilter(\"json jsonp\",function(t,n,r){var i,a,o,s=!1!==t.jsonp&&(Wt.test(t.url)?\"url\":\"string\"==typeof t.data&&0===(t.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&Wt.test(t.data)&&\"data\");if(s||\"jsonp\"===t.dataTypes[0])return i=t.jsonpCallback=h(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Wt,\"$1\"+i):!1!==t.jsonp&&(t.url+=(St.test(t.url)?\"&\":\"?\")+t.jsonp+\"=\"+i),t.converters[\"script json\"]=function(){return o||w.error(i+\" was not called\"),o[0]},t.dataTypes[0]=\"json\",a=e[i],e[i]=function(){o=arguments},r.always(function(){void 0===a?w(e).removeProp(i):e[i]=a,t[i]&&(t.jsonpCallback=n.jsonpCallback,Bt.push(i)),o&&h(a)&&a(o[0]),o=a=void 0}),\"script\"}),d.createHTMLDocument=(($t=m.implementation.createHTMLDocument(\"\").body).innerHTML=\"<form></form><form></form>\",2===$t.childNodes.length),w.parseHTML=function(e,t,n){return\"string\"!=typeof e?[]:(\"boolean\"==typeof t&&(n=t,t=!1),t||(d.createHTMLDocument?((r=(t=m.implementation.createHTMLDocument(\"\")).createElement(\"base\")).href=m.location.href,t.head.appendChild(r)):t=m),a=!n&&[],(i=A.exec(e))?[t.createElement(i[1])]:(i=be([e],t,a),a&&a.length&&w(a).remove(),w.merge([],i.childNodes)));var r,i,a},w.fn.load=function(e,t,n){var r,i,a,o=this,s=e.indexOf(\" \");return s>-1&&(r=ht(e.slice(s)),e=e.slice(0,s)),h(t)?(n=t,t=void 0):t&&\"object\"===(void 0===t?\"undefined\":_typeof(t))&&(i=\"POST\"),o.length>0&&w.ajax({url:e,type:i||\"GET\",dataType:\"html\",data:t}).done(function(e){a=arguments,o.html(r?w(\"<div>\").append(w.parseHTML(e)).find(r):e)}).always(n&&function(e,t){o.each(function(){n.apply(this,a||[e.responseText,t,e])})}),this},w.expr.pseudos.animated=function(e){return w.grep(w.timers,function(t){return e===t.elem}).length},w.offset={setOffset:function(e,t,n){var r,i,a,o,s,c,u=w.css(e,\"position\"),l=w(e),p={};\"static\"===u&&(e.style.position=\"relative\"),s=l.offset(),a=w.css(e,\"top\"),c=w.css(e,\"left\"),(\"absolute\"===u||\"fixed\"===u)&&(a+c).indexOf(\"auto\")>-1?(o=(r=l.position()).top,i=r.left):(o=parseFloat(a)||0,i=parseFloat(c)||0),h(t)&&(t=t.call(e,n,w.extend({},s))),null!=t.top&&(p.top=t.top-s.top+o),null!=t.left&&(p.left=t.left-s.left+i),\"using\"in t?t.using.call(e,p):(\"number\"==typeof p.top&&(p.top+=\"px\"),\"number\"==typeof p.left&&(p.left+=\"px\"),l.css(p))}},w.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){w.offset.setOffset(this,e,t)});var t,n,r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if(\"fixed\"===w.css(r,\"position\"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&\"static\"===w.css(e,\"position\");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=w(e).offset()).top+=w.css(e,\"borderTopWidth\",!0),i.left+=w.css(e,\"borderLeftWidth\",!0))}return{top:t.top-i.top-w.css(r,\"marginTop\",!0),left:t.left-i.left-w.css(r,\"marginLeft\",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&\"static\"===w.css(e,\"position\");)e=e.offsetParent;return e||ne})}}),w.each({scrollLeft:\"pageXOffset\",scrollTop:\"pageYOffset\"},function(e,t){var n=\"pageYOffset\"===t;w.fn[e]=function(r){return H(this,function(e,r,i){var a;if(y(e)?a=e:9===e.nodeType&&(a=e.defaultView),void 0===i)return a?a[t]:e[r];a?a.scrollTo(n?a.pageXOffset:i,n?i:a.pageYOffset):e[r]=i},e,r,arguments.length)}}),w.each([\"top\",\"left\"],function(e,t){w.cssHooks[t]=ze(d.pixelPosition,function(e,n){if(n)return n=He(e,t),Le.test(n)?w(e).position()[t]+\"px\":n})}),w.each({Height:\"height\",Width:\"width\"},function(e,t){w.each({padding:\"inner\"+e,content:t,\"\":\"outer\"+e},function(n,r){w.fn[r]=function(i,a){var o=arguments.length&&(n||\"boolean\"!=typeof i),s=n||(!0===i||!0===a?\"margin\":\"border\");return H(this,function(t,n,i){var a;return y(t)?0===r.indexOf(\"outer\")?t[\"inner\"+e]:t.document.documentElement[\"client\"+e]:9===t.nodeType?(a=t.documentElement,Math.max(t.body[\"scroll\"+e],a[\"scroll\"+e],t.body[\"offset\"+e],a[\"offset\"+e],a[\"client\"+e])):void 0===i?w.css(t,n,s):w.style(t,n,i,s)},t,o?i:void 0,o)}})}),w.each([\"ajaxStart\",\"ajaxStop\",\"ajaxComplete\",\"ajaxError\",\"ajaxSuccess\",\"ajaxSend\"],function(e,t){w.fn[t]=function(e){return this.on(t,e)}}),w.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,\"**\"):this.off(t,e||\"**\",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),w.each(\"blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu\".split(\" \"),function(e,t){w.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}});var Ut=/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g;w.proxy=function(e,t){var n,r,a;if(\"string\"==typeof t&&(n=e[t],t=e,e=n),h(e))return r=i.call(arguments,2),(a=function(){return e.apply(t||this,r.concat(i.call(arguments)))}).guid=e.guid=e.guid||w.guid++,a},w.holdReady=function(e){e?w.readyWait++:w.ready(!0)},w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=j,w.isFunction=h,w.isWindow=y,w.camelCase=W,w.type=b,w.now=Date.now,w.isNumeric=function(e){var t=w.type(e);return(\"number\"===t||\"string\"===t)&&!isNaN(e-parseFloat(e))},w.trim=function(e){return null==e?\"\":(e+\"\").replace(Ut,\"\")},\"function\"==typeof define&&define.amd&&define(\"jquery\",[],function(){return w});var Gt=e.jQuery,Xt=e.$;return w.noConflict=function(t){return e.$===w&&(e.$=Xt),t&&e.jQuery===w&&(e.jQuery=Gt),w},void 0===t&&(e.jQuery=e.$=w),w}),define(\"jqueryplugins\",[\"jquery\"],function(e){e.prototype.extend({popAttr:function(e){var t=this.attr(e);return this.removeAttr(e),t},popData:function(e){var t=this.data(e);return this.removeData(e),t},tag:function(){return this[0]&&this[0].tagName&&this[0].tagName.toLowerCase()},textNodes:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"*\";return 1===this.length&&this[0]instanceof Text?[this[0]]:this.get().concat(this.contents().get(),this.find(e).contents().get()).filter(function(e,t,n){return e instanceof Text&&n.indexOf(e)===t}).sort(function(e,t){return 2&e.compareDocumentPosition(t)?1:-1})},findAndFilter:function(e){return this.filter(e).add(this.find(e))}})}),function(){var e=void 0,t={};function n(){for(var e=0;e<arguments.length;e++)for(var t in arguments[e])this[t]=arguments[e][t]}function r(e,t){e.childAt=e.childAt||{};for(var n=t.start;n<t.end;n+=1)e.childAt[n]=t}function i(e,t,n,r){return!(e.canFollow&&!(e.canFollow.indexOf(n&&n.type)>-1)||e.cannotFollow&&(-1!==e.cannotFollow.indexOf(n&&n.type)||e.cannotFollow.indexOf(\"text\")>-1&&r)||e.peek&&e.peek.toLowerCase()!==t.slice(0,e.peek.length).toLowerCase())}function a(e){for(var n=e.innerText,r=[],a=0,s=a,c=n.length,u=null;a<c;){for(var l=n.slice(a),p=(r.length?r[0]:e).innerMode,f=0,d=p.length;f<d;f+=1){var h=t[p[f]];if(i(h,l,u,s<a)&&h.pattern.test(l)){var y=h.pattern.exec(l),m=h.fn(y),g=!1,v=0;if(m.matches){for(;v<r.length;v+=1){var b=r[v].type;if(b in m.matches){g=!0;break}0===b.indexOf(\"verbatim\")&&(b=\"verbatimOpener\"),m.cannotCross&&m.cannotCross.indexOf(b)>-1&&(v=r.length-1)}if(v>=r.length&&!m.isFront)continue}s<a&&e.addChild({type:\"text\",text:n.slice(s,a),innerMode:p}),s=a+=(u=e.addChild(m)).text.length,g&&(o(e,u,r[v]),r=r.slice(v+1)),u.isFrontToken()&&r.unshift(u);break}}f===d&&(a+=1,null===u&&(u={type:\"text\"}))}for(s<a&&e.addChild({type:\"text\",text:n.slice(s,a),innerMode:(r.length?r[0]:e).innerMode});r.length>0;)r.shift().demote();return e}function o(e,t,n){var i=e.children.indexOf(t),a=e.children.indexOf(n);t.children=e.children.splice(a+1,i-(a+1)),t.children.forEach(function(e){r(t,e)}),t.type=t.matches[n.type],t.innerText=\"\";for(var o=0,s=t.children.length;o<s;o++)t.innerText+=t.children[o].text;t.start=n.start,t.text=n.text+t.innerText+t.text,Object.keys(n).forEach(function(e){Object.hasOwnProperty.call(t,e)||(t[e]=n[e])}),t.isFront&&(t.isFront=!1),e.children.splice(a,1),r(e,t)}n.prototype={constructor:n,addChild:function(e){var t=this.lastChildEnd(),i=new n({start:t,end:e.text&&t+e.text.length,children:[]},e);return i.innerText&&a(i),this.children.push(i),r(this,i),i},firstChild:function(){return this.children&&this.children[0]||null},lastChild:function(){return this.children&&this.children[this.children.length-1]||null},lastChildEnd:function(){var e=this.lastChild();return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))},tokenAt:function(e){if(e<this.start||e>=this.end)return null;if(this.childAt)return this.childAt[e]&&this.childAt[e].tokenAt(e)||this;if(this.children.length)for(var t=0;t<this.children.length;t+=1){var n=this.children[t].tokenAt(e);if(n)return n}return this},pathAt:function(e){if(e<this.start||e>=this.end)return[];if(this.childAt)return(this.childAt[e]&&this.childAt[e].pathAt(e)||[]).concat(this);var t=[];if(this.children.length)for(var n=0;n<this.children.length;n+=1){var r=this.children[n].pathAt(e);if(r.length){t.concat(r);break}}return t.concat(this)},nearestTokenAt:function(e){return e<this.start||e>=this.end?null:this.children?this.children.reduce(function(t,n){return t||(e>=n.start&&e<n.end?n:null)},null):this},everyLeaf:function(e){return this.children&&0!==this.children.length?this.children.reduce(function(t,n){return t&&n.everyLeaf(e)},!0):!!e(this)},isWhitespace:function(){return this.everyLeaf(function(e){return\"whitespace\"===e.type||!e.text.trim()})},isFrontToken:function(){return this.isFront},isBackToken:function(){return\"matches\"in this},demote:function(){this.type=\"text\"},error:function(e){this.type=\"error\",this.message=e},toString:function(){var e=this.type+\"(\"+this.start+\"\\u2192\"+this.end+\")\";return this.children&&this.children.length>0&&(e+=\"[\"+this.children+\"]\"),e}},e={lex:function(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:\"start\";return a(new n({type:\"root\",start:r||0,end:t.length,text:t,innerText:t,children:[],childAt:{},innerMode:e.modes[i]}))},rules:t,modes:{}},\"object\"===(\"undefined\"==typeof module?\"undefined\":_typeof(module))?module.exports=e:\"function\"==typeof define&&define.amd?define(\"lexer\",[],function(){return e}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Lexer=e):this.TwineLexer=e}.call(eval(\"this\")||(\"undefined\"!=typeof global?global:window)),function(){var e;function t(e){return e&&\"object\"===(void 0===e?\"undefined\":_typeof(e))?(Object.keys(e).forEach(function(n){e[n]=t(e[n])}),e):(e+\"\").replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g,\"\\\\$&\")}function n(e){return function(){return\"(\"+e+Array.apply(0,arguments).join(\"|\")+\")\"}}var r=n(\"?:\"),i=n(\"?!\"),a=n(\"?=\"),o=\"[ \\\\f\\\\t\\\\v\\\\u00a0\\\\u2000-\\\\u200a\\\\u2028\\\\u2029\\\\u202f\\\\u205f\\\\u3000]*\",s=o.replace(\"*\",\"+\"),c=\"\\\\b\",u=\"[\\\\w\\\\-\\\\u00c0-\\\\u00de\\\\u00df-\\\\u00ff\\\\u0150\\\\u0170\\\\u0151\\\\u0171\\\\uD800-\\\\uDFFF]\",l=u.replace(\"\\\\-\",\"\"),p=r(\"\\\\n\",\"$\"),f=o+\"(\\\\*+)\"+s,d=o+\"((?:0\\\\.)+)\"+s,h=o+\"-{3,}\"+o+p,y=o+\"(==+>|<=+|=+><=+|<==+>)\"+o+p,m=o+\"(=+\\\\|+|\\\\|+=+|=+\\\\|+=+|\\\\|=+\\\\|)\"+o+p,g={opener:\"\\\\[\\\\[(?!\\\\[)\",text:\"(\"+function(){return\"[^\"+Array.apply(0,arguments).map(t).join(\"\")+\"]*\"}(\"]\")+\")\",rightSeparator:r(\"\\\\->\",\"\\\\|\"),leftSeparator:\"<\\\\-\",closer:\"\\\\]\\\\]\",legacySeparator:\"\\\\|\",legacyText:\"(\"+r(\"[^\\\\|\\\\]]\",\"\\\\]\"+i(\"\\\\]\"))+\"+)\"},v=l+\"*\"+l.replace(\"\\\\w\",\"a-zA-Z\")+l+\"*\",b=\"\\\\$(\"+v+\")\",w=\"_(\"+v+\")\",T=\"'s\"+s+\"(\"+v+\")\",S=\"(\"+v+\")\"+s+\"of\"+c+i(\"it\\\\b\"),x=\"'s\"+s,k=r(\"it\",\"time\",\"visits?\",\"exits?\",\"pos\")+c,O=\"its\"+s+\"(\"+v+\")\",j=\"its\"+s,A=\"(\"+v+\")\"+s+\"of\"+s+\"it\"+c,C=\"of\\\\b\"+s+\"it\"+c,E={opener:\"\\\\(\",name:\"(\"+r(\"\\\\$\",\"_\")+\"?\"+u+\"+):\"+i(\"\\\\/\"),closer:\"\\\\)\"},_=r(\"=<\",\"=>\",\"[gl]te?\\\\b\",\"n?eq\\\\b\",\"isnot\\\\b\",\"are\\\\b\",\"x\\\\b\",\"isa\\\\b\",\"or\"+s+\"a\"+c),N=\"[a-zA-Z][\\\\w\\\\-]*\",P=\"(?:\\\"[^\\\"]*\\\"|'[^']*'|[^'\\\">])*?\",I=\"\\\\|(\"+u+\"+)(>|\\\\))\",M=\"(<|\\\\()(\"+u+\"+)\\\\|\",D=\"\\\\b(\\\\d+(?:\\\\.\\\\d+)?(?:[eE][+\\\\-]?\\\\d+)?)\"+i(\"m?s\")+c;g.main=g.opener+r(g.text+g.rightSeparator,g.text.replace(\"*\",\"*?\")+g.leftSeparator)+g.text,e={upperLetter:\"[A-Z\\\\u00c0-\\\\u00de\\\\u0150\\\\u0170]\",lowerLetter:\"[a-z0-9_\\\\-\\\\u00df-\\\\u00ff\\\\u0151\\\\u0171]\",anyLetter:u,anyLetterStrict:l,whitespace:s,escapedLine:\"\\\\\\\\\\\\n\\\\\\\\?|\\\\n\\\\\\\\\",br:\"\\\\n(?!\\\\\\\\)\",commentFront:\"\\x3c!--\",commentBack:\"--\\x3e\",tag:\"<\\\\/?\"+N+P+\">\",tagPeek:\"<\",scriptStyleTag:\"<(\"+r(\"script\",\"style\",\"textarea\")+\")\"+P+\">[^]*?<\\\\/\\\\1>\",scriptStyleTagOpener:\"<\",url:\"(\"+r(\"https?\",\"mailto\",\"javascript\",\"ftp\",\"data\")+\":\\\\/\\\\/[^\\\\s<]+[^<.,:;\\\"')\\\\]\\\\s])\",bullet:\"\\\\*\",hr:h,heading:\"[ \\\\f\\\\t\\\\v\\\\u00a0\\\\u2000-\\\\u200a\\\\u2028\\\\u2029\\\\u202f\\\\u205f\\\\u3000]*(#{1,6})[ \\\\f\\\\t\\\\v\\\\u00a0\\\\u2000-\\\\u200a\\\\u2028\\\\u2029\\\\u202f\\\\u205f\\\\u3000]*\",align:y,column:m,bulleted:f,numbered:d,strikeOpener:t(\"~~\"),italicOpener:t(\"//\"),boldOpener:t(\"''\"),supOpener:t(\"^^\"),strongFront:t(\"**\"),strongBack:t(\"**\"),emFront:t(\"*\"),emBack:t(\"*\"),verbatimOpener:\"`+\",collapsedFront:\"{\",collapsedBack:\"}\",hookAppendedFront:\"\\\\[\"+i(\"=+\"),hookPrependedFront:I+\"\\\\[\"+i(\"=+\"),hookFront:\"\\\\[\"+i(\"=+\"),hookBack:\"\\\\]\"+i(M),hookAppendedBack:\"\\\\]\"+M,unclosedHook:\"\\\\[=+\",unclosedHookPrepended:I+\"\\\\[=+\",unclosedCollapsed:\"\\\\{=+\",passageLink:g.main+g.closer,passageLinkPeek:\"[[\",legacyLink:g.opener+g.legacyText+g.legacySeparator+g.legacyText+g.closer,legacyLinkPeek:\"[[\",simpleLink:g.opener+g.legacyText+g.closer,simpleLinkPeek:\"[[\",macroFront:E.opener+a(E.name),macroFrontPeek:\"(\",macroName:E.name,groupingFront:\"\\\\(\"+i(E.name),groupingFrontPeek:\"(\",groupingBack:\"\\\\)\",twine1Macro:\"<<[^>\\\\s]+\\\\s*(?:\\\\\\\\.|'(?:[^'\\\\\\\\]*\\\\\\\\.)*[^'\\\\\\\\]*'|\\\"(?:[^\\\"\\\\\\\\]*\\\\\\\\.)*[^\\\"\\\\\\\\]*\\\"|[^'\\\"\\\\\\\\>]|>(?!>))*>>\",twine1MacroPeek:\"<<\",validPropertyName:v,property:T,propertyPeek:\"'s\",belongingProperty:S,possessiveOperator:x,belongingOperator:\"of\\\\b\",belongingOperatorPeek:\"of\",itsOperator:j,itsOperatorPeek:\"its\",belongingItOperator:C,belongingItOperatorPeek:\"of\",variable:b,variablePeek:\"$\",tempVariable:w,tempVariablePeek:\"_\",hookName:\"\\\\?(\"+u+\"+)\\\\b\",hookNamePeek:\"?\",cssTime:\"(\\\\d+\\\\.?\\\\d*|\\\\d*\\\\.?\\\\d+)(m?s)\\\\b\",colour:r(r(\"Red\",\"Orange\",\"Yellow\",\"Lime\",\"Green\",\"Cyan\",\"Aqua\",\"Blue\",\"Navy\",\"Purple\",\"Fuchsia\",\"Magenta\",\"White\",\"Gray\",\"Grey\",\"Black\",\"Transparent\"),\"#[\\\\dA-Fa-f]{3}(?:[\\\\dA-Fa-f]{3})?\"),datatype:r(\"alnum\",\"alphanumeric\",\"any(?:case)?\",\"array\",\"bool(?:ean)?\",\"changer\",\"colou?r\",\"const\",\"command\",\"dm\",\"data\"+r(\"map\",\"type\",\"set\"),\"ds\",\"digit\",\"gradient\",\"empty\",\"even\",\"int\"+i(\"o\")+\"(?:eger)?\",\"lambda\",\"lowercase\",\"macro\",\"linebreak\",\"num(?:ber)?\",\"odd\",\"str(?:ing)?\",\"uppercase\",\"whitespace\")+c,number:D,boolean:r(\"true\",\"false\")+c,identifier:k,itsProperty:O,itsPropertyPeek:\"its\",belongingItProperty:A,escapedStringChar:\"\\\\\\\\[^\\\\n]\",singleStringOpener:\"'\",doubleStringOpener:'\"',singleStringCloser:\"'\",doubleStringCloser:'\"',is:\"is\"+i(s+\"not\"+c,s+\"an?\"+c,s+\"in\"+c,s+\"<\",s+\">\")+c,isNot:\"is\"+s+\"not\"+i(s+r(\"an?\",\"in\")+c)+c,isA:\"is\"+s+\"an?\"+c,isNotA:\"is\"+s+\"not\"+s+\"an?\"+c,matches:\"matches\\\\b\",doesNotMatch:\"does\"+s+\"not\"+s+\"match\"+c,and:\"and\\\\b\",or:\"or\\\\b\",not:\"not\\\\b\",inequality:\"((?:is(?:\"+s+\"not)?\"+o+\")*)(\"+r(\"<(?!=)\",\"<=\",\">(?!=)\",\">=\")+\")\",isIn:\"is\"+s+\"in\"+c,contains:\"contains\\\\b\",doesNotContain:\"does\"+s+\"not\"+s+\"contain\"+c,isNotIn:\"is\"+s+\"not\"+s+\"in\"+c,addition:t(\"+\")+i(\"=\"),subtraction:t(\"-\")+i(\"=\",\"type\"),multiplication:t(\"*\")+i(\"=\"),division:r(\"/\",\"%\")+i(\"=\"),comma:\",\",spread:\"\\\\.\\\\.\\\\.\"+i(\"\\\\.\"),to:r(\"to\\\\b\",\"=\"),into:\"into\\\\b\",making:\"making\\\\b\",where:\"where\\\\b\",when:\"when\\\\b\",via:\"via\\\\b\",each:\"each\\\\b\",augmentedAssign:r(\"\\\\+\",\"\\\\-\",\"\\\\*\",\"\\\\/\",\"%\")+\"=\",bind:\"2?bind\\\\b\",typeSignature:t(\"-type\")+c,incorrectOperator:_},\"object\"===(\"undefined\"==typeof module?\"undefined\":_typeof(module))?module.exports=e:\"function\"==typeof define&&define.amd?define(\"patterns\",[],function(){return e}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Patterns=e):this.Patterns=e}.call(eval(\"this\")||(\"undefined\"!=typeof global?global:window)),function(){var e=void 0;Object.assign=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};var t=Object.keys,n=Object.assign;function r(r){return Object.freeze({lex:function(r){function i(e){return e=e||\"innerText\",function(t){var n=t.reduceRight(function(e,t,n){return e||(n?t:\"\")},\"\"),r={};return r[e]=n,r}}function a(e,t){var n={};return n[e]=t,function(){return{isFront:!0,matches:n,cannotCross:[\"verbatimOpener\"]}}}var o=Object.bind(0,null);function s(e,t){return Object.keys(t).forEach(function(n){var r=t[n].fn;t[n].fn=function(t){var i=r(t);return i.text||(i.text=t[0]),i.type||(i.type=n),i.innerMode||(i.innerMode=e),i}}),t}var c=[],u=[],l=[],p=s(c,{hr:{fn:o},bulleted:{fn:function(e){return{depth:e[1].length}}},numbered:{fn:function(e){return{depth:e[1].length/2}}},heading:{fn:function(e){return{depth:e[1].length}}},align:{fn:function(e){var t=void 0,n=e[1],r=n.indexOf(\"><\");return~r?25===(t=Math.round(r/(n.length-2)*50))&&(t=\"center\"):\"<\"===n[0]&&\">\"===n.slice(-1)?t=\"justify\":n.indexOf(\">\")>-1?t=\"right\":n.indexOf(\"<\")>-1&&(t=\"left\"),{align:t}}},column:{fn:function(e){var t=void 0,n=e[1],r=n.indexOf(\"|\");return r&&r<n.length-1?t=\"center\":\"|\"===n[0]&&\"|\"===n.slice(-1)?t=\"none\":r===n.length-1?t=\"right\":r||(t=\"left\"),{column:t,width:/\\|+/.exec(n)[0].length,marginLeft:/^=*/.exec(n)[0].length,marginRight:/=*$/.exec(n)[0].length}}}});t(p).forEach(function(e){p[e].canFollow=[null,\"br\",\"hr\",\"bulleted\",\"numbered\",\"heading\",\"align\",\"column\",\"escapedLine\"],p[e].cannotFollow=[\"text\"]});var f=s(c,{twine1Macro:{fn:function(){return{type:\"error\",message:\"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros.\"}}},emBack:{fn:function(){return{matches:{emFront:\"em\"},cannotCross:[\"verbatimOpener\"]}}},strongBack:{fn:function(){return{matches:{strongFront:\"strong\"},cannotCross:[\"verbatimOpener\"]}}},strongFront:{fn:function(){return{isFront:!0}}},emFront:{fn:function(){return{isFront:!0}}},boldOpener:{fn:a(\"boldOpener\",\"bold\")},italicOpener:{fn:a(\"italicOpener\",\"italic\")},strikeOpener:{fn:a(\"strikeOpener\",\"strike\")},supOpener:{fn:a(\"supOpener\",\"sup\")},commentFront:{fn:function(){return{isFront:!0}}},commentBack:{fn:function(){return{matches:{commentFront:\"comment\"}}}},scriptStyleTag:{fn:o},tag:{fn:o},url:{fn:o},hookPrependedFront:{fn:function(e){return{name:e[1],hidden:\")\"===e[2],isFront:!0,tagPosition:\"prepended\"}}},hookFront:{fn:function(){return{isFront:!0}}},hookBack:{fn:function(){return{matches:{hookPrependedFront:\"hook\",hookFront:\"hook\"},cannotCross:[\"verbatimOpener\"]}}},hookAppendedBack:{fn:function(e){return{name:e[2],hidden:\"(\"===e[1],tagPosition:\"appended\",matches:{hookFront:\"hook\"},cannotCross:[\"verbatimOpener\"]}}},unclosedHook:{fn:o},unclosedHookPrepended:{fn:function(e){return{type:\"unclosedHook\",name:e[1],hidden:\")\"===e[2]}}},verbatimOpener:{fn:function(e){var t=e[0].length,n={};return n[\"verbatim\"+t]=\"verbatim\",{type:\"verbatim\"+t,isFront:!0,matches:n}}},unclosedCollapsed:{fn:o},collapsedFront:{fn:function(){return{isFront:!0}}},collapsedBack:{fn:function(){return{matches:{collapsedFront:\"collapsed\"},cannotCross:[\"verbatimOpener\"]}}},escapedLine:{fn:o},legacyLink:{fn:function(e){return{type:\"twineLink\",innerText:e[1],passage:e[2],innerMode:c}}},br:{fn:o}}),d=n(s(u,{macroFront:{fn:function(e){return{isFront:!0,name:e[1]}}},groupingBack:{fn:function(){return{matches:{groupingFront:\"grouping\",macroFront:\"macro\"},cannotCross:[\"singleStringOpener\",\"doubleStringOpener\"]}}},passageLink:{fn:function(e){var t=e[1]||\"\",n=e[2]||\"\",r=e[3]||\"\";return{type:\"twineLink\",innerText:n?r:t,passage:t?r:n,innerMode:c}}},simpleLink:{fn:function(e){return{type:\"twineLink\",innerText:e[1]||\"\",passage:e[1]||\"\",innerMode:c}}},variable:{cannotFollow:[\"macroFront\"],fn:i(\"name\")},tempVariable:{cannotFollow:[\"macroFront\"],fn:i(\"name\")}}),{hookFront:f.hookFront,hookBack:f.hookBack}),h=s(u,n({macroName:{canFollow:[\"macroFront\"],fn:i(\"name\")},groupingFront:{fn:function(){return{isFront:!0}}},property:{fn:i(\"name\"),canFollow:[\"variable\",\"hookName\",\"property\",\"tempVariable\",\"colour\",\"itsProperty\",\"belongingItProperty\",\"macro\",\"grouping\",\"string\",\"datatype\",\"hook\",\"boolean\",\"number\"]},possessiveOperator:{fn:o},itsProperty:{cannotFollow:[\"text\"],fn:i(\"name\")},itsOperator:{cannotFollow:[\"text\"],fn:o},belongingItProperty:{cannotFollow:[\"text\"],fn:i(\"name\")},belongingItOperator:{cannotFollow:[\"text\"],fn:o},belongingProperty:{cannotFollow:[\"text\"],fn:i(\"name\")},belongingOperator:{cannotFollow:[\"text\"],fn:o},escapedStringChar:{fn:function(){return{type:\"text\"}}},singleStringOpener:{fn:function(){return{isFront:!0,matches:{singleStringOpener:\"string\"},innerMode:l}}},doubleStringOpener:{fn:function(){return{isFront:!0,matches:{doubleStringOpener:\"string\"},innerMode:l}}},hookName:{fn:i(\"name\")},cssTime:{fn:function(e){return{value:+e[1]*(\"s\"===e[2].toLowerCase()?1e3:1)}}},datatype:{cannotFollow:[\"text\"],fn:function(e){return{name:e[0].toLowerCase()}}},colour:{cannotFollow:[\"text\"],fn:function(e){var t=e[0].toLowerCase(),n={red:\"e61919\",orange:\"e68019\",yellow:\"e5e619\",lime:\"80e619\",green:\"19e619\",cyan:\"19e5e6\",aqua:\"19e5e6\",blue:\"197fe6\",navy:\"1919e6\",purple:\"7f19e6\",fuchsia:\"e619e5\",magenta:\"e619e5\",white:\"fff\",black:\"000\",gray:\"888\",grey:\"888\"};return{colour:Object.hasOwnProperty.call(n,t)?\"#\"+n[t]:t}}},number:{fn:function(e){return{value:parseFloat(e[0])}}},inequality:{fn:function(e){return{operator:e[2],negate:e[1].indexOf(\"not\")>-1}}},augmentedAssign:{fn:function(e){return{operator:e[0][0]}}},identifier:{fn:i(\"name\"),cannotFollow:[\"text\"]},whitespace:{fn:o,cannotFollow:\"text\"},incorrectOperator:{fn:function(e){var t={\"=>\":\">=\",\"=<\":\"<=\",gte:\">=\",lte:\"<=\",gt:\">\",lt:\"<\",eq:\"is\",isnot:\"is not\",neq:\"is not\",isa:\"is a\",are:\"is\",x:\"*\",\"or a\":\"or\"}[e[0].toLowerCase().replace(/\\s+/g,\" \")];return{type:\"error\",message:\"Please say \"+(t?\"'\"+t+\"'\":\"something else\")+\" instead of '\"+e[0]+\"'.\",explanation:\"In the interests of readability, I want certain operators to be in a specific form.\"}},cannotFollow:\"text\"}},[\"boolean\",\"is\",\"to\",\"into\",\"where\",\"when\",\"via\",\"making\",\"each\",\"and\",\"or\",\"not\",\"isNot\",\"contains\",\"doesNotContain\",\"isIn\",\"isA\",\"isNotA\",\"isNotIn\",\"matches\",\"doesNotMatch\",\"bind\"].reduce(function(e,t){return e[t]={fn:o,cannotFollow:[\"text\"]},e},{}),[\"comma\",\"spread\",\"typeSignature\",\"addition\",\"subtraction\",\"multiplication\",\"division\"].reduce(function(e,t){return e[t]={fn:o},e},{}))),y=s(l,{singleStringCloser:h.singleStringOpener,doubleStringCloser:h.doubleStringOpener,escapedStringChar:h.escapedStringChar});c.push.apply(c,_toConsumableArray(t(p)).concat(_toConsumableArray(t(d)),_toConsumableArray(t(f)))),u.push.apply(u,_toConsumableArray(t(d)).concat(_toConsumableArray(t(h)))),l.push.apply(l,_toConsumableArray(t(y)));var m=n({},p,f,d,h,y);t(m).forEach(function(t){var n=e[t];m[t].pattern=\"string\"!=typeof n?n:RegExp(\"^(?:\"+n+\")\",\"i\"),e[t+\"Peek\"]&&(m[t].peek=e[t+\"Peek\"])}),n(r.rules,m);var g=r.modes;return g.start=g.markup=c,g.macro=u,g.string=l,r}(r).lex,Patterns:e})}\"object\"===(\"undefined\"==typeof module?\"undefined\":_typeof(module))?(e=require(\"./patterns\"),module.exports=r(require(\"./lexer\"))):\"function\"==typeof define&&define.amd?define(\"markup\",[\"lexer\",\"patterns\"],function(t,n){return e=n,r(t)}):this&&this.loaded&&this.modules?(e=this.modules.Patterns,this.modules.Markup=r(this.modules.Lexer)):(e=this.Patterns,this.TwineMarkup=r(this.TwineLexer))}.call(eval(\"this\")||(\"undefined\"!=typeof global?global:window)),define(\"utils/polyfills\",[],function(){var e=Array.prototype;\"function\"!=typeof e.includes&&(e.includes=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!Number.isNaN(t)&&Number.isFinite(n)&&void 0!==t)return e.indexOf.call(this,t,n)>-1;var r=Object(this),i=parseInt(r.length);if(i<=0)return!1;for(var a=n>=0?n:Math.max(0,i+n);a<i;){if(Object.is(t,r[a]))return!0;a+=1}return!1}),!window.Symbol&&(window.Symbol={iterator:\"_es6-shim iterator_\"})}),define(\"utils\",[\"jquery\",\"markup\",\"utils/polyfills\"],function(e){var t=String.fromCharCode,n=\"audio,blockquote,canvas,div,h1,h2,h3,h4,h5,hr,ol,p,pre,table,ul,video,tw-align,tw-story,tw-passage,tw-sidebar,tw-columns,tw-column,tw-meter\".split(\",\"),r=\"a,b,i,em,strong,sup,sub,abbr,acronym,s,strike,del,big,small,script,img,button,input,tw-link,tw-broken-link,tw-verbatim,tw-collapsed,tw-error,tw-colour,tw-icon\".split(\",\"),i=[\"audio\"],a=[function(e){return t(e)!==t(e).toLowerCase()},function(e){return t(e)!==t(e).toUpperCase()},function(e){return t(e).toLowerCase()!==t(e).toUpperCase()}].map(function(e){return\"[\"+Array.from(Array(57343)).map(function(e,t){return t}).filter(e).map(function(e,n,r){return e===r[n-1]+1&&e===r[n+1]-1?\"-\":t(e)}).join(\"\").replace(/\\-+/g,\"-\")+\"]\"}),o=_slicedToArray(a,3),s=o[0],c=o[1],u=o[2];function l(e){return\"instant\"===e?0:800}var p=void 0,f=[],d={},h=0,y={},m=0,g={},v=void 0;function b(e,t,n,r,i){var a=null,o=0,s=t+n;function c(n){1&e[0].compareDocumentPosition(document)&&(s=0),a&&(s-=n-a,o+=n-a),a=n,r>0&&h+m>0&&(s-=r,e.css(\"animation-delay\",(v.cssTimeUnit(e.css(\"animation-delay\"))||0)-r+\"ms\")),s<=0?i(o):requestAnimationFrame(c),s<=t&&e.css(\"visibility\",\"\")}s?requestAnimationFrame(c):c()}return e(document.documentElement).on(\"keydown keyup mousedown mouseup\",function(e){var t=e.key,n=e.button,r=e.type.includes(\"down\"),i=t?d:y,a=t&&v.insensitiveName(t)||n;i[a]&&!r?t?h=Math.max(h-1,0):m=Math.max(m-1,0):!i[a]&&r&&(t?h+=1:m+=1),i[a]=r}).on(\"mousemove\",function(e){var t=e.pageX,n=e.pageY;g.x=t,g.y=n}),v={lockProperty:function(e,t,n){var r=Object.create({configurable:0,writable:0});return n&&(r.value=n),Object.defineProperty(e,t,r),e},permutations:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=t.length,i=[[].concat(t)],a=Array(r).fill(0),o=1,s=void 0,c=void 0;o<r;)a[o]<o?(s=o%2&&a[o],c=t[o],t[o]=t[s],t[s]=c,++a[o],o=1,i.push([].concat(t))):(a[o]=0,++o);return i},shuffled:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t,n){var r=Math.random()*(n+1)|0;return r===n?e.push(t):(e.push(e[r]),e[r]=t),e},[])},matMul:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a;if(r.length>0)return(a=v).matMul.apply(a,[v.matMul(e,t)].concat(r));if(!t)return e;for(var o=[],s=0;s<e.length;s++){o[s]=[];for(var c=0;c<t[0].length;c++){for(var u=0,l=0;l<e[0].length;l++)u+=e[s][l]*t[l][c];o[s][c]=u}}return o},cssTimeUnit:function(e){return\"ms\"===(e=e.toLowerCase()).slice(-2)?+e.slice(0,-2)||0:\"s\"===e.slice(-1)&&1e3*+e.slice(0,-1)||0},nth:function(e){var t=(+e+\"\").slice(-1);return e+(\"1\"===t?\"st\":\"2\"===t?\"nd\":\"3\"===t?\"rd\":\"th\")},plural:function(e,t){return e+\" \"+t+(e>1?\"s\":\"\")},andList:function(e){return 1===e.length?e[0]:e.slice(0,-1).join(\", \")+\" and \"+e[e.length-1]},realWhitespace:\"[ \\\\n\\\\r\\\\f\\\\t\\\\v\\\\u00a0\\\\u2000-\\\\u200a\\\\u2028\\\\u2029\\\\u202f\\\\u205f\\\\u3000]\",anyRealLetter:\"[\\\\dA-Za-z\\\\u00c0-\\\\u00de\\\\u00df-\\\\u00ff\\\\u0150\\\\u0170\\\\u0151\\\\u0171\\\\uD800-\\\\uDFFF]\",anyUppercase:s,anyLowercase:c,anyCasedLetter:u,anyNewline:\"(?:\\\\n|\\\\r|\\\\r\\\\n)\",unescape:function(e){return e.replace(/&(?:amp|lt|gt|quot|nbsp|zwnj|#39|#96);/g,function(e){return{\"&amp;\":\"&\",\"&gt;\":\">\",\"&lt;\":\"<\",\"&quot;\":'\"',\"&#39;\":\"'\",\"&nbsp;\":String.fromCharCode(160),\"&zwnj;\":String.fromCharCode(8204)}[e]})},escape:function(e){return e.replace(/[&><\"']/g,function(e){return{\"&\":\"&amp;\",\">\":\"&gt;\",\"<\":\"&lt;\",'\"':\"&quot;\",\"'\":\"&#39;\"}[e]})},insensitiveName:function(e){return(e+\"\").toLowerCase().replace(/-|_/g,\"\")},allKeysDown:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return d[e]})},someKeysDown:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function(e){return d[e]})},buttonsDown:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return y[e]})},anyInputDown:function(){return h+m>0},mouseCoords:g,parentColours:function(e){for(var t={colour:null,backgroundColour:null},n=/^\\w+a\\(.+?,\\s*0\\s*\\)$|^transparent$/;e.length&&e[0]!==document;e=e.parent()){if(!t.backgroundColour){var r=e.css(\"background-color\");r.match(n)||(t.backgroundColour=r)}if(!t.colour){var i=e.css(\"color\");i.match(n)||(t.colour=i)}if(t.colour&&t.backgroundColour)return t}return{colour:\"#fff\",backgroundColour:\"#000\"}},childrenProbablyInline:function(e){var t=[];return[].every.call(e.findAndFilter(\"*\"),function(e){return!!(e.hidden||/none|inline/.test(e.style.display)||/display: (none|inline)/.test(e.getAttribute(\"style\")))||!n.includes(e.tagName.toLowerCase())&&!/display: (?!none|inline|inherit|unset)/.test(e.getAttribute(\"style\"))&&(!!r.includes(e.tagName.toLowerCase())||(t.push(e),!0))})&&t.every(function(e){return window.getComputedStyle(e).display.includes(\"inline\")})},transitionReplace:function(t,n,r){var i=t.closest(\"tw-hook\");i.length>0&&(t=i);var a=e(\"<tw-transition-container>\").css(\"position\",\"relative\");a.insertBefore(t.first());var o=void 0;n&&(o=e(\"<tw-transition-container>\").appendTo(a),n.appendTo(o));var s=e(\"<tw-transition-container>\").css(\"position\",\"absolute\").prependTo(a);t.detach().appendTo(s),v.transitionOut(s,r),n&&v.transitionIn(o,r,function(){o.unwrap().children().first().unwrap()})},transitionOut:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;0!==e.length&&(n=n||l(t),(e.length>1||!v.childrenProbablyInline(e)||![\"tw-hook\",\"tw-passage\",\"tw-expression\"].includes(e.tag()))&&(e=e.wrapAll(\"<tw-transition-container>\").parent()),o&&e.css(\"transform-origin\",o),e.attr(\"data-t8n\",t).addClass(\"transition-out\").css({\"animation-duration\":n+\"ms\",\"animation-delay\":r-a+\"ms\"}),requestAnimationFrame(function(){v.childrenProbablyInline(e)?e.css(\"display\",\"inline\"):e.parent().is(\"tw-backdrop,tw-story\")||e[0].setAttribute(\"style\",e[0].getAttribute(\"style\")+\"display:block !important;width:100%\")}),b(e,n,r-a,i,function(){e.remove()}))},transitionIn:function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;if(0!==t.length){r=r||l(n);var u=t.length>1||!v.childrenProbablyInline(t)||![\"tw-hook\",\"tw-passage\",\"tw-expression\"].includes(t.tag());u&&(t=t.wrapAll(\"<tw-transition-container>\").parent()),c&&t.css(\"transform-origin\",c),t.attr(\"data-t8n\",n).addClass(\"transition-in\").css(Object.assign({\"animation-duration\":r+\"ms\",\"animation-delay\":a-s+\"ms\"},a-s?{visibility:\"hidden\"}:{})),requestAnimationFrame(function(){v.childrenProbablyInline(t)?t.css(\"display\",\"inline\"):t.parent().is(\"tw-backdrop,tw-story\")||t[0].setAttribute(\"style\",t[0].getAttribute(\"style\")+\"display:block !important;width:100%\")}),b(t,r,a-s,o,function(n){var r=0===t.filter(i.join(\",\")).length;u&&r?(t.find(\"tw-transition-container\").each(function(t,r){(r=e(r)).css(\"animation-delay\",v.cssTimeUnit(r.css(\"animation-delay\")||0)-n+\"ms\")}),t.contents().unwrap()):t.removeClass(\"transition-in\").removeAttr(\"data-t8n\")})}},debounce:function(e){var t=void 0,n=void 0,r=0,i=function i(){Date.now()-r>300?(t=0,e.apply(void 0,_toConsumableArray(n))):t=requestAnimationFrame(i)};return function(){r=Date.now(),n=arguments,t&&cancelAnimationFrame(t),t=requestAnimationFrame(i)}},impossible:function(e,t){window.console&&console.error(e+\"(): \"+t)},assertMustHave:function(e,t){if(window.console)for(var n=0;n<t.length;n+=1)t[n]in e||console.error(\"Assertion failed: object lacks property \"+t[n])},assertOnlyHas:function(e,t){if(window.console)for(var n in e)t.includes(n)||console.error(\"Assertion failed: object had unexpected property '\"+n+\"'!\")},onStartup:function(e){f?f.push(e):e()},get storyElement(){return p}},e(function(){p=e(\"tw-story\"),f.forEach(function(e){return e()}),f=null}),Object.freeze(v)}),define(\"utils/naturalsort\",[],function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:String;return function(n,r){var i,a,o,s,c=/(^-?[0-9]+(\\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,u=/(^([\\w ]+,?[\\w ]+)?[\\w ]+,?[\\w ]+\\d+:\\d+(:\\d+)?[\\w ]?|^\\d{1,4}[\\/\\-]\\d{1,4}[\\/\\-]\\d{1,4}|^\\w+, \\w+ \\d+, \\d{4})/,l=/^0x[0-9a-f]+$/i,p=/^0/,f=t(n).trim(),d=t(r).trim(),h=f.replace(c,\"\\0$1\\0\").replace(/\\0$/,\"\").replace(/^\\0/,\"\").split(\"\\0\"),y=d.replace(c,\"\\0$1\\0\").replace(/\\0$/,\"\").replace(/^\\0/,\"\").split(\"\\0\"),m=parseInt(f.match(l))||1!==h.length&&f.match(u)&&Date.parse(f),g=parseInt(d.match(l))||m&&d.match(u)&&Date.parse(d)||null;if(e&&window.Intl&&window.Intl.Collator&&(o=window.Intl.Collator(e)),g){if(m<g)return-1;if(m>g)return 1}for(var v=0,b=Math.max(h.length,y.length);v<b;v++){if(i=!(h[v]||\"\").match(p)&&parseFloat(h[v])||h[v]||0,a=!(y[v]||\"\").match(p)&&parseFloat(y[v])||y[v]||0,isNaN(i)!==isNaN(a))return isNaN(i)?1:-1;if((void 0===i?\"undefined\":_typeof(i))!==(void 0===a?\"undefined\":_typeof(a)))i+=\"\",a+=\"\";else if(\"string\"==typeof i&&o&&0!==(s=o.compare(i,a)))return s;if(i<a)return-1;if(i>a)return 1}return 0}}}),define(\"twinescript/compiler\",[\"utils\"],function(e){var t=e.impossible,n=JSON.stringify;function r(e,t){for(var n=0;n<e.length;n+=1)if(t.includes(e[n].type))return n;return NaN}function i(e,t){var n=[];return e.length?([[\"error\"],[\"comma\"],[\"to\",\"into\"],[\"where\",\"when\",\"via\"],[\"making\",\"each\"],[\"typeSignature\"],[\"augmentedAssign\"],[\"and\",\"or\"],[\"is\",\"isNot\"],[\"contains\",\"doesNotContain\",\"isIn\",\"isNotIn\"],[\"isA\",\"isNotA\",\"matches\",\"doesNotMatch\"],[\"inequality\"],[\"addition\",\"subtraction\"],[\"multiplication\",\"division\"],{rightAssociative:[\"spread\",\"bind\"]},{rightAssociative:[\"not\",\"positive\",\"negative\"]},{rightAssociative:[\"belongingProperty\",\"belongingItProperty\",\"belongingOperator\",\"belongingItOperator\"]},[\"property\",\"itsProperty\",\"possessiveOperator\",\"itsOperator\"],[\"twineLink\"],[\"macro\"],[\"grouping\"]][\"most\"===t?\"reverse\":\"valueOf\"]().some(function(t){var i=void 0;if(i=t.rightAssociative?r(e,t.rightAssociative):function(e,t){return e.length-1-r.apply(void 0,[[].concat(_toConsumableArray(e)).reverse(),t])}(e,t),!Number.isNaN(i)&&i>-1)return n=[e[i],i],!0}),n):n}function a(e){if(\"inequality\"===e.type){var t=e.operator;return e.negate?{\">\":\"<=\",\"<\":\">=\",\">=\":\"<\",\"<=\":\">\"}[t]:t}return e.type}function o(e){var t=a(e);return{\">\":\"<\",\"<\":\">\",\">=\":\"<=\",\"<=\":\">=\",contains:\"isIn\",doesNotContain:\"isNotIn\",isIn:\"contains\",isA:\"typifies\",typifies:\"isA\",isNotA:\"untypifies\",untypifies:\"isNotA\"}[t]||t}var s=[\"inequality\",\"is\",\"isNot\",\"isIn\",\"contains\",\"doesNotContain\",\"isNotIn\",\"isA\",\"typifies\",\"isNotA\",\"untypifies\",\"matches\",\"doesNotMatch\"];return function e(r){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=c.isVarRef,l=c.isTypedVar,p=c.whitespaceError,f=c.elidedComparison,d=c.testNeedsRight,h=\"Operations.Identifiers.it\";if(!(r=[].concat(r)).length)return u&&p?\"TwineError.create('operation',\"+n(p)+\")\":\"\";var y=void 0;if(1===r.length){var m=(y=r[0]).type;if(\"identifier\"===m)return u?\"VarRef.create(Operations.Identifiers,\"+n(y.text)+\")\":\"Operations.Identifiers.\"+y.text.toLowerCase()+\" \";if(\"variable\"===m||\"tempVariable\"===m){var g=\"VarRef.create(\"+(\"tempVariable\"===m?\"section.stackTop.tempV\":\"State.v\")+\"ariables,\"+n(y.name)+\")\"+(u||l?\"\":\".get()\");return l?\"TypedVar.create(Datatype.create('any'),\"+g+\")\":g}if(\"hookName\"===m)return\"HookSet.create({type:'name', data:'\"+y.name+\"'}) \";if(\"string\"===m)return y.text.replace(/\\n/g,\"\\\\n\");if(\"hook\"===m)return\"CodeHook.create(\"+n(y.text.slice(1,-1))+\",\"+n(y.html||\"\")+\")\";if(\"colour\"===m)return\"Colour.create(\"+n(y.colour)+\")\";if(\"datatype\"===m)return\"Datatype.create(\"+n(y.name)+\")\";if(\"blockedValue\"===m)return\"section.blockedValue()\";if(\"root\"===m)return e(y.children);if(\"whitespace\"===m&&u&&p)return\"TwineError.create('operation',\"+n(p)+\")\"}var v,b=i(r,\"least\"),w=_slicedToArray(b,2);y=w[0],v=w[1];var T=(y||{}).type,S=r.slice(0,v),x=r.slice(v+1),k=function(e,t){return{isVarRef:!0,isTypedVar:t,whitespaceError:\"I need usable data to be on the \"+e+' of \"'+y.text+'\".'}},O=\"must\",j=\"mustn't\",A=\"may\",C=void 0,E=void 0,_=\"\",N=\"\",P=\"\",I=O,M=O,D=!1;if(T)if(\"comma\"===T)N=\",\",M=A;else if(\"spread\"===T)_=\"Operations.makeSpreader(\",P=\")\",I=A;else if(\"bind\"===T)_=\"VarBind.create(\",E=e(x,k(\"right\")),P=(y.text.startsWith(\"2\")?\",'two way'\":\"\")+\")\",I=j;else if(\"to\"===T)_=\"Operations.makeAssignmentRequest(Operations.setIt(\",E=e(x,k(\"right\")),N=\"),\",C=e(S,k(\"left\",!0)),P=\",'to')\";else if(\"into\"===T)_=\"Operations.makeAssignmentRequest(\",E=e(S,k(\"left\")),N=\",Operations.setIt(\",C=e(x,k(\"right\",!0)),P=\"),'into')\";else if(\"typeSignature\"===T)_=\"TypedVar.create(\",N=\",\",E=e(x,k(\"right\")),P=\")\",l=!1;else if(\"where\"===T||\"when\"===T||\"via\"===T)_=\"Lambda.create(\",C=e(S,{isVarRef:!0,whitespaceError:null}).trim()||\"undefined\",N=\",\"+n(y.type)+\",\",E=n(e(x)),P=\",\"+n(r.map(function(e){return e.text}).join(\"\"))+\")\";else if(\"making\"===T||\"each\"===T)\"each\"===T?(_=\"Lambda.create(\",E=e(x,k(\"right\")).trim(),P=\",'where','true',\"+n(r.map(function(e){return e.text}).join(\"\"))+\")\",I=A):(_=\"Lambda.create(\",C=e(S,{isVarRef:!0,whitespaceError:null}).trim()||\"undefined\",N=\",\"+n(y.type)+\",\",E=e(x,k(\"right\")).trim(),P=\",\"+n(r.map(function(e){return e.text}).join(\"\"))+\")\");else if(\"augmentedAssign\"===T)_=\"Operations.makeAssignmentRequest(\",C=e(S,k(\"left\")),N=\",\",E=\"Operations[\"+n(y.operator)+\"](\"+e(S)+\",\"+e(x)+\")\",P=\",\"+n(y.operator)+\")\";else if(\"and\"===T||\"or\"===T){var R=function e(t){var n=i(t,\"least\"),r=_slicedToArray(n,2),a=r[0],o=r[1];if(a)return s.includes(a.type)?a:[\"and\",\"or\"].includes(a.type)?e(t.slice(0,o))||e(t.slice(o+1)):void 0},L=R(S),q=R(x),F=\"TwineError.create('operation', 'This use of \\\"is not\\\" and \\\"\"+T+\"\\\" is grammatically ambiguous','Maybe try rewriting this as \\\"__ is not __ \"+T+\" __ is not __\\\"') \";if(_=\"Operations.\"+T+\"(\",N=\",\",P=\")\",f===y.type)_=P=\"\",C=e(S,{isVarRef:u,elidedComparison:f}).trim(),E=e(x,{elidedComparison:f}).trim();else if(L&&!q){var V=L,H=n(a(V));if(\"isNot\"===V.type||\"isNotA\"===V.type||\"untypifies\"===V.type)return F;E=\"Operations.elidedComparisonOperator(\"+n(y.type)+\",\"+H+\",\"+e(x,{elidedComparison:T})+\")\"}else if(!L&&q){var z=q,$=r.indexOf(z),B=n(o(z));if(\"isNot\"===z.type||\"isNotA\"===z.type||\"untypifies\"===z.type)return F;E=\"Operations.elidedComparisonOperator(\"+n(y.type)+\",\"+B+\",\"+e(S,{elidedComparison:T})+\")\",C=e([].concat(_toConsumableArray(r.slice($+1)),[Object.assign(Object.create(z),_defineProperty({},\"inequality\"===z.type?\"operator\":\"type\",o(z)))],_toConsumableArray(r.slice(v+1,$))))}u=!1}else if(s.includes(T))D=!0,u=!1,_=\"Operations[\"+n(a(y))+\"](\",N=\",\",P=\")\";else if(\"addition\"===T||\"subtraction\"===T){if(!e(S,{testNeedsRight:!0}).trim())return y.type={addition:\"positive\",subtraction:\"negative\"}[T],e(r,{isVarRef:u,whitespaceError:p,elidedComparison:f,testNeedsRight:d});u=!1,_=\"Operations[\"+n(y.text)+\"](\",N=\",\",P=\")\"}else if(\"multiplication\"===T||\"division\"===T)u=!1,_=\"Operations[\"+n(y.text)+\"](\",N=\",\",P=\")\";else if(\"positive\"===T||\"negative\"===T)u=!1,C=\"negative\"===T?\"-1\":\"1\",_=\"Operations['*'](\",N=\",\",P=\")\";else if(\"not\"===T)_=\"Operations.not(\",E=e(x),P=\")\",I=A;else if(\"belongingProperty\"===T)_=\"VarRef.create(\",E=e(x,k(\"right\")),P=\",\"+n(y.name)+\")\"+(u?\"\":\".get()\"),I=A;else if(\"belongingOperator\"===T||\"belongingItOperator\"===T)C=y.type.includes(\"It\")?h:e(x,k(\"right\")),E=e(S),_=\"VarRef.create(\",N=\",{computed:true,value:\",P=\"})\"+(u?\"\":\".get()\");else if(\"property\"===T)_=\"VarRef.create(\",C=e(S,k(\"left\")),P=\",\"+n(y.name)+\")\"+(u?\"\":\".get()\"),M=A;else if(\"itsProperty\"===T||\"belongingItProperty\"===T)_=\"VarRef.create(\",C=h,P=\",\"+n(y.name)+\")\"+(u?\"\":\".get()\"),I=M=A;else if(\"possessiveOperator\"===T||\"itsOperator\"===T)y.type.includes(\"it\")&&(C=h,I=A),_=\"VarRef.create(\",N=\",{computed:true,value:\",P=\"})\"+(u?\"\":\".get()\"),l=!1;else if(\"twineLink\"===T)N='Macros.run(\"link-goto\", [section,'+n(y.innerText)+\",\"+n(y.passage)+\"])\",I=M=j;else if(\"macro\"===T){var W=y.children[0],U=\"$\"===W.text[0]||\"_\"===W.text[0];\"macroName\"===W.type||U||t(\"Compiler.compile\",\"macro token had no macroName child token\"),N=\"Macros.run\"+(U?\"Custom\":\"\")+\"(\"+(U?\"VarRef.create(\"+(\"_\"===W.text[0]?\"section.stackTop.tempV\":\"State.v\")+\"ariables,\"+n(W.text.trim().slice(1,-1))+\").get()\":'\"'+y.name+'\"')+\", [section,\"+e(y.children.slice(1),{isTypedVar:l})+\"])\",I=M=j}else if(\"grouping\"===T)N=\"(\"+e(y.children,{isVarRef:u})+\")\",I=M=j;else if(\"error\"===T)return\"TwineError.create('syntax',\"+n(y.message)+(y.explanation?\", \"+n(y.explanation):\"\")+\")\";return v>-1?(C=(C||e(S,{isVarRef:u,isTypedVar:l})).trim(),E=(E||e(x)).trim(),D&&!C&&(C=h),I===O&&!C||M===O&&!E?d&&M&&!E?\"\":\"TwineError.create('operation','I need usable code to be \"+(I===O?\"left \":\"\")+(I===O&&M===O?\"and \":\"\")+(M===O?\"right \":\"\")+'of \"'+y.text+\"\\\"')\":I===j&&C||M===j&&E?\"TwineError.create('operation','There can't be code to the \"+(I===j?\"left \":\"\")+(I===j&&M===j?\"or \":\"\")+(M===j?\"right \":\"\")+'of \"'+y.text+\"\\\"')\":_+C+N+E+P):1===r.length?((\"value\"in r[0]?r[0].value:r[0].text)+\"\").trim()||\" \":r.reduce(function(t,n){return t+e(n,{isVarRef:u,isTypedVar:l})},\"\")}}),define(\"internaltypes/twineerror\",[\"jquery\",\"utils\"],function(e,t){var n=t.impossible,r=t.escape;e(document.documentElement).on(\"click\",\"tw-folddown\",function(t){var n=t.target;for((n=e(n)).toggleClass(\"open\");n&&!n.next().length;)n=n.parent();n&&n.next().toggle()});var i={syntax:\"The markup seems to contain a mistake.\",saving:\"I tried to save or load the game, but I couldn't do it.\",operation:\"I tried to perform an operation on some data, but the data's type was incorrect.\",macrocall:\"I tried to use a macro, but its call wasn't written correctly.\",datatype:\"I tried to use a macro, but was given the wrong type of data to it.\",custommacro:\"I tried to use a custom macro, but its code hook had a mistake in it.\",infinite:\"I almost ended up doing the same thing over and over, forever.\",property:\"I tried to access a value in a string/array/datamap, but I couldn't find it.\",unimplemented:\"I currently don't have this particular feature. I'm sorry.\",javascript:\"This error message was reported by your browser's Javascript engine. I don't understand it either, but it usually means that an expression was badly written.\",propagated:\"Click the 'Open' button to see the code hook as it was executed.\",user:\"This is a custom error created by (error:). It usually means you used a custom macro incorrectly.\",assertion:\"This command exists to provide a helpful error if a certain important condition wasn't true.\"},a={error:[],warning:[]},o={create:function(e,t,r,a){return t&&\"string\"==typeof t||n(\"TwineError.create\",\"has a bad message string\"),r||e in i||n(\"TwineError.create\",\"no error explanation given\"),\"user\"!==e&&(t=t[0].toUpperCase()+t.slice(1)),Object.assign(Object.create(this),{type:e,message:t,explanation:r,source:void 0,innerDOM:a,appendTitleText:!1})},fromError:function(e){return o.create(\"javascript\",\"\\u2615 \"+e.message)},containsError:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return e||(t instanceof Error?t:o.isPrototypeOf(t)?t:!!Array.isArray(t)&&o.containsError.apply(o,_toConsumableArray(t)))},!1)},createWarning:function(e,t){return Object.assign(this.create(e,t),{warning:!0})},render:function(n){var o=this;n=n||this.source||\"\";var s=e(\"<tw-error class='\"+(\"javascript\"===this.type?\"javascript \":\"\")+(this.warning?\"warning\":\"error\")+\"' title='\"+r(n)+\"'>\"+r(this.message+(this.appendTitleText?\" \"+n:\"\"))+\"</tw-error>\"),c=e(\"<tw-error-explanation>\").text(this.explanation||i[this.type]).hide(),u=e(\"<tw-folddown tabindex=0>\");return this.innerDOM&&e(\"<tw-open-button>\").on(\"click\",function(){var n=e(\"<tw-backdrop><tw-dialog></tw-backdrop>\");n.find(\"tw-dialog\").prepend(o.innerDOM,e(\"<tw-link tabindex=0>OK</tw-link>\").on(\"click\",function(){o.innerDOM.detach(),n.remove()}).wrap(\"<tw-dialog-links>\").parent()),t.storyElement.prepend(n)}).appendTo(s),s.append(u).append(c),s.data(\"TwineError\",this),a.error.forEach(function(e){return e(o,n)}),s},on:function(e,t){if(e in a)return\"function\"!=typeof t||a[e].includes(t)||a[e].push(t),o;n(\"TwineError.on\",\"invalid event name\")}};return o}),define(\"renderer\",[\"utils\",\"markup\",\"twinescript/compiler\",\"internaltypes/twineerror\"],function(e,t,n,r){var i=e.escape,a=e.impossible,o=e.insensitiveName,s=void 0;function c(e,t){return\"<\"+t+\">\"+e+\"</\"+t+\">\"}function u(e,t){var n=s.render(e.children);return n&&c(n,t)}var l,p,f=\"text-align: center; max-width:50%; \",d=RegExp(t.Patterns.macroFront+t.Patterns.macroName,\"ig\");return s={options:{debug:!1,blockerMacros:[],metadataMacros:[]},preprocess:function(e){var i=s.options.metadataMacros;if(!(e.match(d)||[]).some(function(e){return i.some(function(t){return o(e.slice(1,-1))===t})}))return{};var a=!1,c={};return t.lex(e).children.forEach(function e(t){if(\"macro\"===t.type){if(i.some(function(e){return t.name===e})){if(r.isPrototypeOf(c[t.name]))return;if(a)return void(c[t.name]=r.create(\"syntax\",\"The (\"+t.name+\":) macro can't appear after non-metadata macros.\"));if(c[t.name])return void(c[t.name]=r.create(\"syntax\",\"There is more than one (\"+t.name+\":) macro.\"));c[t.name]={code:n(t),source:t.text}}else a=!0;t.children.forEach(function e(t){\"macro\"===t.type&&i.some(function(e){return t.name===e})?c[t.name]=r.create(\"syntax\",\"The (\"+t.name+\":) macro can't be inside another macro.\"):t.children.forEach(e)})}else t.children.forEach(e)}),c},exec:(l=void 0,p=void 0,function(e){return\"string\"!=typeof e?(a(\"Renderer.exec\",\"source was not a string, but \"+(void 0===e?\"undefined\":_typeof(e))),\"\"):e===l?p:(l=e,p=s.render(t.lex(e).children))}),render:function e(a){var l=\"\",p=[];if(!a)return l;for(var d=a.length,h=0;h<d;h+=1){var y=a[h];switch(y.type){case\"error\":l+=r.create(\"syntax\",y.message,y.explanation).render(i(y.text))[0].outerHTML;break;case\"numbered\":case\"bulleted\":var m=\"numbered\"===y.type?\"ol\":\"ul\";l+=\"<\"+m+\">\";for(var g=1;h<d&&a[h];){if(\"br\"===a[h].type){if(l+=\"</li>\",!a[h+1]||a[h+1].type!==y.type)break}else a[h].type===y.type?(l+=(\"<\"+m+\">\").repeat(Math.max(0,a[h].depth-g)),l+=(\"</\"+m+\">\").repeat(Math.max(0,g-a[h].depth)),l+=\"<li>\",g=a[h].depth):l+=e([a[h]]);h+=1}l+=(\"</\"+m+\">\").repeat(g+1);break;case\"align\":for(;y&&\"align\"===y.type;){var v=y.align,b=h+=1;if(\"left\"===v){h-=1;break}for(;h<d&&a[h]&&\"align\"!==a[h].type;)h+=1;var w=e(a.slice(b,h)),T=\"\";switch(v){case\"center\":T+=f+\"margin-left: auto; margin-right: auto;\";break;case\"justify\":case\"right\":T+=\"text-align: \"+v+\";\";break;default:+v&&(T+=f+\"margin-left: \"+v+\"%;\")}l+=\"<tw-align \"+(T?'style=\"'+T+'\"':\"\")+\">\"+w+\"</tw-align>\\n\",y=a[h]}break;case\"column\":for(var S=[];y&&\"column\"===y.type;){var x=y.column,k=h+=1;if(\"none\"===x){h-=1;break}for(;h<d&&a[h]&&\"column\"!==a[h].type;)h+=1;S.push({text:y.text,type:x,body:e(a.slice(k,h)),width:y.width,marginLeft:y.marginLeft,marginRight:y.marginRight}),y=a[h]}S.length&&function(){var e=S.reduce(function(e,t){return e+t.width},0);l+=\"<tw-columns>\"+S.map(function(t){return\"<tw-column type=\"+t.type+'  style=\"width:'+t.width/e*100+\"%; margin-left: \"+t.marginLeft+\"em; margin-right: \"+t.marginRight+'em;\">'+t.body+\"</tw-column>\\n\"}).join(\"\")+\"</tw-columns>\"}();break;case\"heading\":for(l+=\"<h\"+y.depth+\">\";++h<d&&a[h];){if(\"br\"===a[h].type){l+=\"</h\"+y.depth+\">\";break}l+=e([a[h]])}break;case\"br\":if(!p.length||/td|th/.test(p[0])){l+=\"<br>\";for(var O=a[h+1];O&&(\"br\"===O.type||\"tag\"===O.type&&/^<br\\b/i.test(O.text));)l+=\"<tw-consecutive-br\"+(\"tag\"===O.type?\" data-raw\":\"\")+\"></tw-consecutive-br>\",O=a[(h+=1)+1]}break;case\"hr\":l+=\"<hr>\";break;case\"escapedLine\":case\"comment\":break;case\"inlineUrl\":l+='<a class=\"link\" href=\"'+i(y.text)+'\">'+y.text+\"</a>\";break;case\"scriptStyleTag\":case\"tag\":var j=y.text.toLowerCase();/^<\\/?(?:table|thead|tbody|tr|tfoot|td|th)\\b/.test(j)&&p[y.text.startsWith(\"</\")?\"shift\":\"unshift\"](j),l+=y.text.startsWith(\"</\")?y.text:y.text.replace(/>$/,\" data-raw>\");break;case\"sub\":case\"sup\":case\"strong\":case\"em\":l+=u(y,y.type);break;case\"strike\":l+=u(y,\"s\");break;case\"bold\":l+=u(y,\"b\");break;case\"italic\":l+=u(y,\"i\");break;case\"twineLink\":var A=_slicedToArray(t.lex(\"(link-goto:\"+JSON.stringify(y.innerText)+\",\"+JSON.stringify(y.passage)+\")\").children,1)[0];l+='<tw-expression type=\"macro\" name=\"link-goto\"'+(s.options.debug?' title=\"'+i(y.text)+'\"':\"\")+' js=\"'+i(n(A))+'\"></tw-expression>';break;case\"hook\":l+=\"<tw-hook \"+(y.hidden?\"hidden \":\"\")+(y.name?'name=\"'+o(y.name)+'\"':\"\")+(s.options.debug&&y.name?' title=\"Hook: ?'+y.name+'\"':\"\")+' source=\"'+i(y.innerText)+'\"></tw-hook>';break;case\"unclosedHook\":return l+=\"<tw-hook \"+(y.hidden?\"hidden \":\"\")+(y.name?'name=\"'+o(y.name)+'\"':\"\")+'source=\"'+i(a.slice(h+1,d).map(function(e){return e.text}).join(\"\"))+'\"></tw-hook>';case\"verbatim\":l+=c(i(y.innerText).replace(/\\n/g,\"<br>\"),\"tw-verbatim\");break;case\"collapsed\":l+=u(y,\"tw-collapsed\");break;case\"unclosedCollapsed\":return l+=\"<tw-collapsed>\"+e(a.slice(h+1,d))+\"</tw-collapsed>\";case\"variable\":case\"tempVariable\":case\"macro\":var C=function(){var t=[],a=[];if(\"macro\"===y.type&&function n(r){\"string\"!==r.type&&\"hook\"!==r.type&&r.children.every(n);var i=r.firstChild();if(\"macro\"===r.type&&i&&\"macroName\"===i.type&&s.options.blockerMacros.includes(o(i.text.slice(0,-1))))t.push(r);else if(\"hook\"===r.type){if(!r.everyLeaf(function(e){return\"error\"!==e.type||(a.push(e),!1)}))return!1;r.html=e(r.children)}return!0}(y),a.length)return{v:r.create(\"syntax\",\"This code hook's markup contained \"+a.length+\" error\"+(a.length?\"s\":\"\")+\":<br>\\u2014\"+a.map(function(e){return e.message}).join(\"<br>\\u2014\")).render(i(y.text))[0].outerHTML};var c=t.length&&t.map(function(e){var t=n(e);return e.type=\"blockedValue\",t});l+='<tw-expression type=\"'+y.type+'\" name=\"'+i(y.name||y.text)+'\"'+(s.options.debug?' title=\"'+i(y.text)+'\"':\"\")+(t.length?' blockers=\"'+i(JSON.stringify(c))+'\"':\"\")+' js=\"'+i(n(y))+'\"></tw-expression>',t.forEach(function(e){return e.type=\"macro\"})}();if(\"object\"===(void 0===C?\"undefined\":_typeof(C)))return C.v;break;default:l+=y.children&&y.children.length?e(y.children):y.text}}return l}},Object.freeze(s)}),define(\"passages\",[\"jquery\",\"utils/naturalsort\",\"utils\",\"markup\",\"renderer\",\"internaltypes/twineerror\"],function(e,t,n,r,i,a){var o=n.unescape,s=n.onStartup,c=Object.assign;function u(e){var t=o(e.html()),n=i.preprocess(t);return c(new Map([[\"source\",t],[\"tags\",(e.attr(\"tags\")||\"\").split(/\\s/)||[]],[\"name\",e.attr(\"name\")]]),{TwineScript_TypeName:\"a passage datamap\",TwineScript_ObjectName:\"a passage datamap\",metadata:n})}var l=c(new Map,{TwineScript_ObjectName:\"the Passages datamap\",getTagged:function(e){var n=t(\"en\",function(e){return e.get(\"name\")}),r=[];return this.forEach(function(t){var n=t instanceof Map&&t.get(\"tags\");Array.isArray(n)&&n.includes(e)&&r.push(t)}),r.sort(n)},getStorylets:function(e,n){var r=n?n.filter(e,[].concat(_toConsumableArray(l.values()))):[].concat(_toConsumableArray(l.values()));if(a.containsError(r))return r;var i=[],o=-1/0,s=r.reduce(function(t,n){if(t)return t;var r=n.get(\"storylet\");if(r){var s=e.speculate(r,n.get(\"name\"),\"a (storylet:) macro\");if(a.containsError(s))return s.message=\"There's an error in the storylet passage \\\"\"+n.get(\"name\")+'\":\\n'+s.message,s.source=r.TwineScript_ToSource(),s;if(s){var c=n.get(\"exclusivity\");o=Math.max(o,\"number\"==typeof c?c:0),i.push(n)}}},void 0);if(s)return s;var c=t(\"en\");return i.filter(function(e){var t=e.get(\"exclusivity\");return(t=\"number\"==typeof t?t:0)===o}).sort(function(e,t){var n=e.get(\"urgency\"),r=t.get(\"urgency\");return(n=\"number\"==typeof n?n:0)!==(r=\"number\"==typeof r?r:0)?r-n:c(e.get(\"name\"),t.get(\"name\"))})},allStorylets:function(){return[].concat(_toConsumableArray(l.values())).filter(function(e){return e.get(\"storylet\")})},loadMetadata:function(e){var t=[];return l.forEach(function(n){n.metadata&&Object.keys(n.metadata).forEach(function(r){if(a.containsError(n.metadata[r]))t.push(n.metadata[r]);else{var i=n.metadata[r],o=i.code,s=i.source,c=e.speculate(o,n.get(\"name\"),\"a (\"+r+\":) macro\"),u='In \"'+n.get(\"name\")+'\":\\n';if(a.containsError(c))return c.message=u+c.message,c.source=s,void t.push(c);c instanceof Map?c.forEach(function(e,t){return l(t,e)}):l(r,c)}function l(e,r){n.has(e)?t.push(a.create(\"syntax\",\"This passage's datamap already has a '\"+JSON.stringify(e)+\"' data name.\")):n.set(e,r)}}),n.metadata=void 0}),t},hasValid:function(e){var t=this.get(e);return t&&t instanceof Map&&t.has(\"source\")},create:u});return s(function(){Array.from(e(\"tw-storydata > tw-passagedata\")).forEach(function(t){t=e(t),l.set(t.attr(\"name\"),new u(t))})}),l}),define(\"utils/operationutils\",[\"utils/naturalsort\",\"utils\",\"internaltypes/twineerror\",\"patterns\"],function(e,t,n,r){var i=t.impossible,a=t.nth,o=t.insensitiveName,s=t.permutations,c=r.validPropertyName,u=\"object\",l=\"boolean\",p=\"string\",f=\"number\",d=\"function\";function h(e){return!!e&&((void 0===e?\"undefined\":_typeof(e))===u||(void 0===e?\"undefined\":_typeof(e))===d)}function y(e){return e&&Object.getPrototypeOf(e)===Object.prototype}function m(e){return Array.isArray(e)?\"array\":e instanceof Map?\"datamap\":e instanceof Set?\"dataset\":(void 0===e?\"undefined\":_typeof(e))===p?p:e&&(void 0===e?\"undefined\":_typeof(e))===u?u:\"\"}function g(e){if(!h(e))return e;if(_typeof(e.TwineScript_Clone)===d)return e.TwineScript_Clone();if(Array.isArray(e))return[].concat(_toConsumableArray(e));if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if((void 0===e?\"undefined\":_typeof(e))===d)return Object.assign(e.bind(),e);switch(Object.getPrototypeOf(e)){case Object.prototype:return Object.assign({},e);case null:return Object.assign(Object.create(null),e)}return i(\"OperationUtils.clone\",\"The value \"+e+\" cannot be cloned!\"),e}function v(e){return h(e)&&\"TwineScript_ObjectName\"in e?e.TwineScript_ObjectName:Array.isArray(e)?\"an array\":e instanceof Map?\"a datamap\":e instanceof Set?\"a dataset\":(void 0===e?\"undefined\":_typeof(e))===l?\"the boolean value '\"+e+\"'\":(void 0===e?\"undefined\":_typeof(e))===p||(void 0===e?\"undefined\":_typeof(e))===f?\"the \"+(void 0===e?\"undefined\":_typeof(e))+\" \"+JSON.stringify(e):void 0===e?\"an empty variable\":\"...whatever this is\"}function b(e,t){return(void 0===e?\"undefined\":_typeof(e))!==u&&(void 0===t?\"undefined\":_typeof(t))!==u?e===t:Array.isArray(e)&&Array.isArray(t)?e.length===t.length&&e.every(function(e,n){return b(t[n],e)}):e instanceof Map&&t instanceof Map?b(Array.from(e.entries()).sort(),Array.from(t.entries()).sort()):e instanceof Set&&t instanceof Set?b([].concat(_toConsumableArray(e)),[].concat(_toConsumableArray(t))):e&&_typeof(e.TwineScript_is)===d?e.TwineScript_is(t):e&&(void 0===e?\"undefined\":_typeof(e))===u&&t&&(void 0===t?\"undefined\":_typeof(t))===u&&y(e)&&y(t)?b(Object.getOwnPropertyNames(e).map(function(t){return[t,e[t]]}),Object.getOwnPropertyNames(t).map(function(e){return[e,t[e]]})):Object.is(e,t)}return Object.freeze({isObject:h,isPureObject:y,singleTypeCheck:function e(t,n){if(null===n)return void 0===t;var r=void 0===t?\"undefined\":_typeof(t);if((void 0===n?\"undefined\":_typeof(n))!==d&&n.pattern){if(\"optional\"===n.pattern||\"zero or more\"===n.pattern)return void 0===t||e(t,n.innerType);if(\"either\"===n.pattern)return n.innerType.some(function(n){return e(t,n)});if(\"lambda\"===n.pattern&&e(t,n.innerType))return n.clauses.includes(\"where\")===\"where\"in t&&n.clauses.includes(\"making\")===\"making\"in t&&n.clauses.includes(\"via\")===\"via\"in t&&n.clauses.includes(\"with\")===\"with\"in t;if(\"insensitive set\"===n.pattern)return n.innerType.includes(o(t));if(\"range\"===n.pattern)return n.range(t);if(\"wrapped\"===n.pattern)return e(t,n.innerType)}return(void 0===n||void 0!==t)&&(\"anything\"===n.TwineScript_TypeName&&void 0!==t&&!t.TwineScript_Unstorable||\"everything\"===n.TwineScript_TypeName&&void 0!==t||(n===String?r===p:n===Boolean?r===l:n===parseInt?r===f&&!Number.isNaN(t)&&!(t+\"\").includes(\".\"):n===Number?r===f&&!Number.isNaN(t):n===Array?Array.isArray(t):n===Map||n===Set?t instanceof n:Object.isPrototypeOf.call(n,t)))},isValidDatamapName:function(e,t){if(e instanceof Map||i(\"isValidDatamapName\",\"called with non-Map\"),n.containsError(t))return t;if((void 0===t?\"undefined\":_typeof(t))!==p&&(void 0===t?\"undefined\":_typeof(t))!==f)return n.create(\"property\",\"Only strings and numbers can be used as data names for \"+v(e)+\", not \"+v(t)+\".\");var r=(void 0===t?\"undefined\":_typeof(t))===p?+t:\"\"+t;return!(!Number.isNaN(r)&&e.has(r))||n.create(\"property\",\"You mustn't use both \"+v(t)+\" and \"+v(r)+\" as data names in the same datamap.\")},collectionType:m,isSequential:function(e){return(void 0===e?\"undefined\":_typeof(e))===p||Array.isArray(e)||_typeof(e.hooks)===d},unstorableValue:function e(t){return t&&t.TwineScript_Unstorable&&t||Array.isArray(t)&&t.find(e)||t instanceof Map&&[].concat(_toConsumableArray(t.values())).find(e)||t instanceof Set&&[].concat(_toConsumableArray(t)).find(e)},clone:g,objectName:v,typeName:function e(t){var n=y(t);if(n&&t.innerType)return t.typeName?t.typeName:\"insensitive set\"===t.pattern?\"a case-insensitive string name\":\"either\"===t.pattern?(Array.isArray(t.innerType)||i(\"typeName\",'\"either\" pattern had non-array inner type'),t.innerType.map(e).join(\" or \")):\"optional\"===t.pattern?\"(optional) \"+e(t.innerType):e(t.innerType);if(n&&t.pattern&&\"range\"===t.pattern){if(t.name)return t.name;var r=t.min,a=t.max;return\"a\"+(r>0?\" positive\":\"\")+(t.integer?\" whole\":\"\")+\" number\"+(0===r?\" between 0 and \"+a:a<1/0?\" up to \"+a:\"\")}return t===String||t===Number||t===Boolean?\"a \"+_typeof(t()):t===parseInt?\"a whole number\":t===Map?\"a datamap\":t===Set?\"a dataset\":t===Array?\"an array\":h(t)&&\"TwineScript_TypeName\"in t?t.TwineScript_TypeName:v(t)},typeID:function(e){var t=void 0===e?\"undefined\":_typeof(e);return[l,p,f].includes(t)?t:Array.isArray(e)?\"array\":e instanceof Map?\"datamap\":e instanceof Set?\"dataset\":e.TwineScript_TypeID||\"\"},toSource:function t(r,o){return n.containsError(r)&&i(\"toSource\",\"received a TwineError\"),_typeof(r.TwineScript_ToSource)===d?r.TwineScript_ToSource():y(r)&&\"first\"in r&&\"last\"in r?(r.first<0?(-1!==r.first?a(-r.first):\"\")+\"last\":a(r.first+1))+\"to\"+(r.last<0?(-1!==r.last?a(-r.last):\"\")+\"last\":a(r.last+1)):Array.isArray(r)?\"(a:\"+(\"property\"===o?r.map(function(e){return e+(e>0)}):r).map(t)+\")\":r instanceof Map?\"(dm:\"+Array.from(r.entries()).sort(function(t,n){return[t[0],n[0]].sort(e(\"en\"))[0]===t[0]?-1:1}).map(function(e){return e.map(t)})+\")\":r instanceof Set?\"(ds:\"+Array.from(r).sort(e(\"en\")).map(t)+\")\":(void 0===r?\"undefined\":_typeof(r))===f&&\"property\"===o?r<0?-1===r?\"last\":a(-r)+\"last\":a(r+1):(void 0===r?\"undefined\":_typeof(r))===p&&\"property\"===o?RegExp(c).test(r)?r:\"(\"+JSON.stringify(r)+\")\":JSON.stringify(r)},is:b,contains:function(e,t){if(e||\"\"===e){if((void 0===e?\"undefined\":_typeof(e))===p)return(void 0===t?\"undefined\":_typeof(t))!==p?n.create(\"operation\",v(e)+\" can only contain strings, not \"+v(t)+\".\"):e.includes(t);if(Array.isArray(e))return e.some(function(e){return b(e,t)});if(e instanceof Set||e instanceof Map)return Array.from(e.keys()).some(function(e){return b(e,t)})}return n.create(\"operation\",v(e)+\" cannot contain any values, let alone \"+v(t))},isA:function(e,t){return _typeof(t.TwineScript_IsTypeOf)===d?t.TwineScript_IsTypeOf(e):n.create(\"operation\",'\"is a\" should only be used to compare type names, not '+v(t)+\".\")},matches:function e(t,r){var i=!1;if(t&&_typeof(t.TwineScript_IsTypeOf)===d){var a=t.TwineScript_IsTypeOf(r);if(n.containsError(a))return a;i|=a}if(r&&_typeof(r.TwineScript_IsTypeOf)===d){var o=r.TwineScript_IsTypeOf(t);if(n.containsError(o))return o;i|=o}if(i)return!0;if(Array.isArray(t)&&Array.isArray(r)){for(var c=0,u=0,l=!0;l&&c<t.length&&u<r.length;){var p=t[c],f=r[u];if(p.rest){for(;u<r.length&&e(p,f);)f=r[u+=1];c+=1}else if(f.rest){for(;c<t.length&&e(p,f);)p=t[c+=1];u+=1}else e(p,f)?(c+=1,u+=1):l=!1}return l&&c>=t.length&&u>=r.length}return t instanceof Map&&r instanceof Map?e(Array.from(t.entries()).sort(),Array.from(r.entries()).sort()):t instanceof Set&&r instanceof Set?(t=[].concat(_toConsumableArray(t)),s.apply(void 0,_toConsumableArray(r)).some(function(n){return e(t,n)})):b(t,r)},subset:function e(t,r,i){if(!r||!i)return n.create(\"macrocall\",\"The sub\"+m(t)+\" index value must not be \"+(r&&i)+\".\");var a=(void 0===t?\"undefined\":_typeof(t))===p;if(a&&(t=Array.from(t)),r<0&&(r=Math.max(0,t.length+r+1)),i<0&&(i=Math.max(0,t.length+i+1)),r>i)return e(arguments[0],i,r);var o=t.slice(r>0?r-1:r,i).map(g);return a?o.join(\"\"):o},range:function e(t,n){if(t>n)return e(n,t);var r=[t];for(n-=t;n-- >0;)r.push(++t);return r},printBuiltinValue:function e(t){return n.containsError(t)?t:t&&_typeof(t.TwineScript_Print)===d?t.TwineScript_Print():t instanceof Map?(t=Array.from(t.entries()),n.containsError(t)?t:t.reduce(function(t,n){var r=_slicedToArray(n,2),i=r[0],a=r[1];return t+\"<tr><td>`\"+e(i)+\"`</td><td>`\"+e(a)+\"`</td></tr>\"},\"<table class=datamap>\")+\"</table>\"):t instanceof Set?Array.from(t.values()).map(e)+\"\":Array.isArray(t)?t.map(e)+\"\":t&&_typeof(t.jquery)===p?t:h(t)?n.create(\"unimplemented\",\"I don't know how to print this value yet.\"):t+\"\"},unique:function(e,t,n){return!n.slice(t+1).some(function(t){return b(e,t)})}})}),define(\"utils/renderutils\",[\"jquery\",\"utils\",\"renderer\"],function(e,t,n){var r=RegExp(t.realWhitespace+\"+\"),i=RegExp(t.realWhitespace+\"+\",\"g\");function a(e,t,n){var r=e.textContent.length;if(!(t>=r)){var i=void 0,a=[i=0===t?e:e.splitText(t)];return n&&(n<=0&&(n=r-n),n<r&&a.push(i.splitText(n-t))),a}}var o,s=(o=void 0,function(){if(void 0!==o)return o;var t=e(\"<p>\");return t[0].normalize?(t.append(document.createTextNode(\"0-\"),document.createTextNode(\"2\"),document.createTextNode(\"\"))[0].normalize(),o=1===t.contents().length):o=!1});var c=\"tw-collapsed,[collapsing=true]\";var u=/^(=*)([^=]+)=*$/;return Object.freeze({dialog:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.section,a=r.parent,o=void 0===a?t.storyElement:a,s=r.cd,c=r.message,u=void 0===c?\"\":c,l=r.defaultValue,p=r.buttons,f=void 0===p?[{name:\"OK\",confirm:!0,callback:Object}]:p,d=e(\"<tw-backdrop><tw-dialog>\"+(l||\"\"===l?\"<input type=text style='display:block;margin:0 auto'></input>\\n\":\"\")+\"<tw-dialog-links>\"+(f.length?f.reduce(function(e,t,n){var r=t.name;return e+\"<tw-link style='margin:0 \"+(n===f.length-1?\"0 0 0.5em\":0===n?\"0.5em 0 0\":\"0.5em\")+\"' tabindex=0>\"+r+\"</tw-link>\"},\"\"):\"<tw-link tabindex=0>\"+f[0].name+\"</tw-link>\")+\"</tw-dialog-links></tw-dialog></tw-backdrop>\"),h=d.find(\"tw-dialog\");if(o.append(d),i){i.renderInto(u,h,Object.assign({},s,{append:\"prepend\"}));var y=s&&s.transition&&d.find(\"tw-dialog > tw-transition-container\");y&&y.length&&y.appendTo(d).append(h.prepend(y.contents().detach()))}else h.prepend(n.exec(u));if(l){var m=d.find(\"input\").last();m.val(l).on(\"keypress\",function(e){13===e.which&&(d.remove(),f.filter(function(e){return e.confirm}).forEach(function(e){return e.callback()}))}),setTimeout(function(){return m.focus()},100)}return f.reverse().forEach(function(t,n){e(d.find(\"tw-link\").get(-n-1)).on(\"click\",function(){d.remove(),t.callback()})}),d},realWhitespace:r,textNodeToChars:function(e){var t=[].concat(_toConsumableArray(e.textContent));return 1===t.length?[e]:t.reduce(function(e,t){return t.match(r)&&e.length&&e[e.length-1].match(r)?e[e.length-1]+=t:e.push(t),e},[]).reduce(function(t,n){var r=e;return n.length<e.textContent.length&&(e=e.splitText(n.length)),t.concat(r)},[])},findTextInNodes:function e(t,n){var r=[],i=\"\",o=[];if(!t.length||!n)return o;for(;t.length>0;){r.push(t[0]),i+=t[0].textContent,t.shift();var s=i.indexOf(n);if(s>-1){for(var c,u=i.length-(s+n.length);s>=r[0].textContent.length;)s-=r[0].textContent.length,r.shift();if(1===r.length){var l=a(r[0],s,s+n.length);o.push(l[0]),l[1]&&t.unshift(l[1]);break}o.push(a(r[0],s,r[0].length)[0]),(c=o).push.apply(c,_toConsumableArray(r.slice(1,-1)));var p=a(r[r.length-1],0,r[r.length-1].textContent.length-u);o.push(p[0]),p[1]&&t.unshift(p[1]),o=o.filter(Boolean);break}}return[o].concat(_toConsumableArray(e(t,n)))},collapse:function(t){function n(t){return 0===e(this||t).parentsUntil(c).filter(\"tw-verbatim, tw-expression, [collapsing=false]\").length}var r=function e(t){var n=t[0],r=t.parent();if(!r.length||t.findAndFilter(\"tw-story\").length)return null;var i=r.textNodes().filter(function(e){var t=e.compareDocumentPosition(n);return 4&t&&!(8&t)});return(i=i[i.length-1])||e(r)}(t);e(r).parents(c).length||(r=null);var a=function e(t){var n=t[0],r=t.parent();if(!r.length||t.findAndFilter(\"tw-story\").length)return null;var i=r.textNodes().filter(function(e){var t=e.compareDocumentPosition(n);return 2&t&&!(8&t)})[0];return i||e(r)}(t);e(a).parents(c).length||(a=null);var o=\"br:not([data-raw]),tw-consecutive-br:not([data-raw])\";t.find(o).filter(n).replaceWith(document.createTextNode(\" \"));var u=(t=e(t.get().map(function(t){return e(t).filter(n).is(o)?e(document.createTextNode(\" \")).replaceAll(t)[0]:t}))).textNodes(),l=0;u.reduce(function(e,t){return n(t)?(t.textContent=t.textContent.replace(i,\" \"),\" \"!==t.textContent[0]||e&&e.textContent&&!(e.textContent.search(/\\s$/)>-1)||(t.textContent=t.textContent.slice(1)),t):document.createTextNode(\"A\")},r),[].concat(_toConsumableArray(u)).reverse().every(function(e){return!!n(e)&&(e.textContent.match(/^\\s*$/)?(l+=e.textContent.length,e.textContent=\"\",!0):(e.textContent=e.textContent.replace(/\\s+$/,function(e){return l+=e.length,\"\"}),!1))}),l>0&&a&&(u[u.length-1].textContent+=\" \"),t[0]&&s()&&t[0].normalize()},geomStringRegExp:u,geomParse:function(e){var t=e.length,n=u.exec(e)||[],r=_slicedToArray(n,3),i=r[0],a=r[1],o=r[2];return i?{marginLeft:a.length/t*100,size:o.length/t*100}:{marginLeft:0,size:0}}})}),define(\"datatypes/hookset\",[\"jquery\",\"utils\",\"utils/renderutils\",\"utils/operationutils\"],function(e,t,n,r){var i=n.textNodeToChars,a=n.realWhitespace,o=n.findTextInNodes,s=r.toSource;function c(n){var r=n.dom,s=e();this.next&&(s=s.add(c.call(this.next,n)));var u=function(t,n){if(Array.isArray(n))return n.reduce(function(e,n){return e.add(t.get(n))},e());if(n&&\"object\"===(void 0===n?\"undefined\":_typeof(n))&&\"first\"in n&&\"last\"in n){var r=n.first,o=n.last,s=t.length;r<0&&(r+=s),o<0&&(o+=s);for(var c=[t.get(r)];r!==o;)r+=Math.sign(o-r),c.push(t.get(r));return e(c)}if(\"string\"==typeof n){if(\"chars\"===n){var u=[],l=!0,p=!1,f=void 0;try{for(var d,h=t.textNodes(\":not(tw-error, tw-error *)\")[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var y=d.value,m=!0,g=!1,v=void 0;try{for(var b,w=i(y)[Symbol.iterator]();!(m=(b=w.next()).done);m=!0){var T=b.value;T.textContent.match(a)||u.push(T)}}catch(e){g=!0,v=e}finally{try{!m&&w.return&&w.return()}finally{if(g)throw v}}}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return e(u)}if(\"links\"===n)return t.findAndFilter(\"tw-link, .enchantment-link\");if(\"visited\"===n)return t.findAndFilter(\"tw-link.visited\");if(\"lines\"===n){var S=t.findAndFilter(\"br:not(tw-sidebar *),tw-consecutive-br:not(tw-sidebar *)\").get(),x=[[]];return t.textNodes(\":not(tw-error, tw-error *):not(tw-sidebar, tw-sidebar *)\").forEach(function(e){S.length&&2&e.compareDocumentPosition(S[0])&&(S.shift(),x.push([])),x[x.length-1]=x[x.length-1].concat(e)}),x=x.map(function(t){return t.map(function(n){for(var r=n.parentNode;e(r).textNodes().every(function(e){return t.includes(e)})&&!t.every(function(t){return e(r).has(t).length});){r=(n=r).parentNode}return n})}),e(x.map(function(t){return e(t).wrapAll(\"<tw-pseudo-hook>\").parent()[0]}))}}return e(t.get(n))};if(this.selector){var l=void 0;if(\"string\"===this.selector.type)l=function(t,n){var r=o(n.textNodes(),t),i=e();return r.forEach(function(t){i=i.add(e(t).wrapAll(\"<tw-pseudo-hook>\").parent())}),i}(this.selector.data,r);else{if(\"base\"===this.selector.type)return s.add(u(c.call(this.selector.data,n),this.property));var p=function(e){var n='tw-hook[name=\"'+(e=t.insensitiveName(e).replace(/\"/g,\"&quot;\"))+'\"],tw-enchantment[name=\"'+e+'\"]';return n+={page:\", tw-story\",passage:\", tw-passage\",sidebar:\", tw-sidebar\",link:\", tw-link, .enchantment-link\"}[e]||\"\"}(this.selector.data);l=r.findAndFilter(p).add(r.parentsUntil(t.storyElement.parent())).filter(p)}s=this.property?s.add(u(l,this.property)):s.add(l)}return s}function u(e){if(!e)return[];var n=e.selector,r=e.property,i=e.next;return[JSON.stringify([\"base\"===n.type?u(n.data):t.insensitiveName(n.data),r])].concat(_toConsumableArray(u(i))).sort()}var l=Object.freeze({forEach:function(t,n){var r=c.call(this,t).each(function(t){n(e(this),t)});return t.dom.findAndFilter(\"tw-pseudo-hook\").contents().unwrap(),r},hooks:function(e){return c.call(this,e)},get TwineScript_ObjectName(){return this.property||this.next?\"a complex hook name\":\"?\"+this.selector.data+\" (a hook name)\"},TwineScript_TypeID:\"hookName\",TwineScript_TypeName:\"a hook name (like ?this)\",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){var e=\"\",n=this.selector,r=n.type,i=n.data;return\"name\"===r?i.match(RegExp(\"^\"+t.anyRealLetter+\"+$\"))?e+=\"?\"+i:e+=\"(hooks-named:\"+JSON.stringify(i)+\")\":\"string\"===r?e+=JSON.stringify(i):\"base\"===r&&(e+=i.TwineScript_ToSource()+\"'s \"+s(this.property,\"property\")),this.next&&(e+=\" + \"+this.next.TwineScript_ToSource()),e},\"TwineScript_+\":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t},TwineScript_is:function(e){return u(this)+\"\"==u(e)+\"\"},TwineScript_GetProperty:function(e){return l.create({type:\"base\",data:this},e,void 0)},TwineScript_Properties:[\"chars\",\"links\",\"lines\",\"visited\"],TwineScript_Clone:function(){return l.create(this.selector,this.property,this.next)},create:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return Object.assign(Object.create(this||l),{selector:Object.freeze(e),property:t,next:n})},from:function(e){return l.isPrototypeOf(e)||\"string\"==typeof e||t.impossible(\"HookSet.from() was given a non-HookSet non-string.\"),l.isPrototypeOf(e)?e:l.create({type:\"string\",data:e})}});return l}),define(\"internaltypes/changedescriptor\",[\"jquery\",\"utils\",\"renderer\",\"datatypes/hookset\"],function(e,t,n,r){var i=t.assertOnlyHas,a=t.impossible,o=t.transitionIn,s=n.exec,c=Object.assign,u=Object.keys,l=Object.create,p=Object.seal,f=function(e){return e.split(/\\n/g).reduce(function(e,t,n,r){var i=r.length;return e.concat(document.createTextNode(t),n!==i-1&&document.createElement(t.length?\"br\":\"tw-consecutive-br\"))},[])},d=void 0,h={source:\"\",appendSource:null,enabled:!0,enablers:null,verbatim:!1,target:null,append:\"\",newTargets:null,transition:\"\",transitionTime:null,transitionDeferred:!1,transitionDelay:0,transitionSkip:0,transitionOrigin:null,loopVars:null,styles:null,attr:null,data:null,functions:null,section:null,timestamp:0,summary:function(){var e=this;return[\"source\",\"appendSource\",\"enabled\",\"verbatim\",\"target\",\"append\",\"newTargets\",\"transition\",\"transitionTime\",\"transitionDeferred\",\"transitionDelay\",\"transitionSkip\",\"transitionOrigin\",\"functions\",\"enablers\"].filter(function(t){return e.hasOwnProperty(t)}).concat([this.attr.length&&\"attr\",this.styles.length&&\"styles\",u(this.loopVars).length&&\"loopVars\",u(this.data).length&&\"data\"].filter(Boolean))},create:function(e,t){var n=c(l(this),{attr:[].concat(this.attr||[]),styles:[].concat(this.styles||[]),loopVars:this.loopVars||{},data:this.data||{}},e);return t&&t.run(n),n},update:function(){var e=this,t=this.section,n=this.newTargets,i=this.transition,a=this.transitionDeferred,s=this.append,c=this.target;\"function\"==typeof c&&(c=c());var l=function(t){if(Array.isArray(e.styles)&&e.styles.length>0){var n=e.styles.reduce(function(e,t){return u(t).forEach(function(n){var r=t[n];e[+(\"function\"==typeof r)][n]=r}),e},[{},{}]),r=_slicedToArray(n,2),i=r[0],a=r[1];t.css(i),setTimeout(function(){return t.css(a)})}e.attr&&e.attr.forEach(function(e){return t.attr(e)}),e.data&&t.data(e.data)};if(Array.isArray(n)&&n.length&&(c=n.map(function(e){return e.target})),[].concat(c).forEach(function(e){r.isPrototypeOf(e)?e.forEach(t,l):l(e)}),i&&!a&&!s){var p=c,f=void 0;do{!(f=p.data(\"timestamp\"))&&(p=p.parent())}while(!f&&p.length);o(c,i,this.transitionTime,this.transitionDelay,this.transitionSkip,f?Date.now()-f:0,this.transitionOrigin)}},render:function(){var t=this,n=this.source,u=this.transition,l=this.transitionTime,p=this.transitionDeferred,y=this.enabled,m=this.enablers,g=this.data,v=this.section,b=this.newTargets,w=this.functions,T=this.appendSource,S=this.target,x=this.target,k=this.append;if(\"function\"==typeof S&&(S=S()),i(this,d),!k)return a(\"ChangeDescriptor.render\",\"This doesn't have an 'append' method chosen.\"),e();if(m&&m.length){var O=m[0],j=O.descriptor,A=O.changer,C=j.render();if(A){var E=h.create({section:v,target:C});A.run(E),E.update()}return C}if(!y||void 0!==S.attr(\"hidden\"))return h.create({target:S,data:c({},g,{originalSource:n,hidden:!0})}).update(),e();if(Array.isArray(b)&&b.length&&(S=b),!S)return a(\"ChangeDescriptor.render\",\"ChangeDescriptor has source but not a target!\"),e();var _=e();if([].concat(S).filter(function(e){return!e.jquery}).map(function(e){var t=k,n=void 0;if(e.target&&e.append){var r=e;t=r.append,n=r.before,e=e.target}return{elements:e.hooks(v,x).filter(function(){return!(n&&1&this.compareDocumentPosition(document)&&2&this.compareDocumentPosition(x[0]))}),append:t}},[]).forEach(function(n){var r=n.elements,i=n.append;r.each(function(n,r){r=e(r),_=_.add(t.create({target:r,append:i,newTargets:null}).render()),r.filter(\"tw-pseudo-hook\").contents().unwrap()})}),_.length||Array.isArray(S)||r.isPrototypeOf(S))return _;if(!(k in S)){if(\"replace\"!==k)return a(\"ChangeDescriptor.render\",\"The target doesn't have a '\"+k+\"' method.\"),e();S[0]instanceof Text?k=\"replaceWith\":(S.empty(),k=\"append\")}return S[0]instanceof Text&&(\"append\"===k&&(k=\"after\"),\"prepend\"===k&&(k=\"before\")),_=e(n&&(this.verbatim?f(n):e.parseHTML(s(n),document,!0))),Array.isArray(T)&&T.forEach(function(n){var r=n.source,i=n.append,a=e(t.verbatim?f(r):e.parseHTML(s(r),document,!0));_=\"append\"===i?_.add(a):\"prepend\"===i?a.add(_):a}),S[k](_.length?_:void 0),S.data(\"timestamp\",Date.now()),this.update(),u&&!p&&o(\"replace\"===k?S:_,u,l,this.transitionDelay,this.transitionSkip,this.expedite,this.transitionOrigin),w&&w.forEach(function(e){return e(S)}),_}};return d=u(h),p(h)}),define(\"datatypes/changercommand\",[\"utils\",\"utils/operationutils\",\"internaltypes/changedescriptor\",\"internaltypes/twineerror\"],function(e,t,n,r){var i=e.impossible,a=t.is,o=t.toSource,s={},c={TwineScript_TypeID:\"changer\",TwineScript_TypeName:\"a changer\",TwineScript_Print:function(){return\"`[A (\"+this.macroName+\":) changer]`\"},TwineScript_ToSource:function(){return\"(\"+this.macroName+\":\"+(\"else\"===this.name?\"\":this.params.map(o))+\")\"+(this.next?\"+\"+this.next.TwineScript_ToSource():\"\")},summary:function(){var e=n.create();return this.run(e),e.summary()},create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Array.isArray(t)||i(\"ChangerCommand.create\",\"params was not an array but \"+t),Object.assign(Object.create(this),{macroName:e,params:t,next:n,TwineScript_ObjectName:\"a (\"+e+\":) changer\"})},\"TwineScript_+\":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t},TwineScript_is:function(e){if(c.isPrototypeOf(e))return this.macroName===e.macroName&&a(this.params,e.params)&&a(this.next,e.next)},TwineScript_Clone:function(){return this.create(this.macroName,this.params,this.next)},run:function(e){var t=s[this.macroName].apply(s,[e].concat(_toConsumableArray(this.params)));if(r.containsError(t))return t;this.next&&this.next.run(e)},register:function(e,t){s[e]=t}};return Object.freeze(c)}),define(\"state\",[\"utils\",\"passages\",\"datatypes/changercommand\",\"internaltypes/twineerror\",\"utils/operationutils\",\"markup\",\"twinescript/compiler\"],function(e,t,n,r,i,a,o){var s=e.impossible,c=i.objectName,u=i.toSource,l=a.lex,p=Object.assign,f=Object.create,d=[\"localStorage\",\"sessionStorage\"].map(function(e){try{return!!window[e]&&(window[e].setItem(\"test\",\"1\"),window[e].removeItem(\"test\"),!0)}catch(e){return!1}}),h=p(f(null),{TwineScript_ObjectName:\"this story's variables\",TwineScript_TypeDefs:f(null),TwineScript_VariableStore:!0,TwineScript_MockVisits:null}),y={passage:\"\",variables:h,create:function(e,t){var n=f(y);return n.passage=e||\"\",n.variables=p(f(this.variables),t),n}},m=[],g=-1,v=y.create(),b=void 0,w={forward:[],back:[],load:[]},T=void 0;function S(e){v=(m[g]||y).create(e),function(){if(T.hasSessionStorage){var e=T.serialise();if(\"string\"==typeof e)try{sessionStorage.setItem(\"Saved Session\",e)}catch(e){return}}}()}return T=p({get passage(){return v.passage},get variables(){return v.variables},get pastLength(){return g},get futureLength(){return m.length-1-g},get mockVisits(){return v.variables.TwineScript_MockVisits||[]},set mockVisits(e){v.variables.TwineScript_MockVisits=e},passageNameVisited:function(e){var n=0;if(!t.get(e))return 0;for(var r=0;r<=g;r++)n+=+(e===m[r].passage);return n},passageNameLastVisited:function(e){if(!t.get(e))return 1/0;if(e===v.passage)return 0;for(var n=g;n>0;n--)if(m[n].passage===e)return g-n+1;return 1/0},pastPassageNames:function(){for(var e=[],t=g-1;t>=0;t--)e.unshift(m[t].passage);return e},timelinePassageNames:function(){return m.map(function(e){return e.passage})},play:function(e){v||s(\"State.play\",\"present is undefined!\"),v.passage=e,m=m.slice(0,g+1).concat(v),g+=1,S(e),w.forward.forEach(function(t){return t(e)})},rewind:function(e){var t=1,n=!1;if(e)if(\"string\"==typeof e){if((t=this.passageNameLastVisited(e))===1/0)return}else\"number\"==typeof e&&(t=e);for(;t>0&&g>0;t--)n=!0,g-=1;return n&&(S(m[g].passage),w.back.forEach(function(e){return e()})),n},fastForward:function(e){var t=1,n=!1;for(\"number\"==typeof e&&(t=e);t>0&&m.length>0;t--)n=!0,g+=1;return n&&(S(m[g].passage),w.forward.forEach(function(e){return e(m[g].passage,\"fastForward\")})),n},on:function(e,t){if(e in w)return\"function\"!=typeof t||w[e].includes(t)||w[e].push(t),T;s(\"State.on\",\"invalid event name\")},reset:function(){m=[],g=-1,v=y.create(),b=void 0,w.load.forEach(function(e){return e(m)})},hasStorage:d[0],hasSessionStorage:d[1]},function(){function e(e,t){Object.keys(t).forEach(function(n){return!n.startsWith(\"TwineScript_\")&&(t[n]=e.eval(o(l(t[n],0,\"macro\"))))})}return{serialise:function(){var e=m.slice(0,g+1),t=e.map(function(e){return Object.keys(e.variables).filter(function(t){return e.variables[t]&&(n=e.variables[t],i=void 0===n?\"undefined\":_typeof(n),!(!r.containsError(n)&&(\"function\"==typeof n.TwineScript_ToSource||Array.isArray(n)||n instanceof Map||n instanceof Set||\"string\"===i||\"number\"===i||\"boolean\"===i||Object.isPrototypeOf.call(h.TwineScript_TypeDefs,n))));var n,i}).map(function(t){return[t,e.variables[t]]})});if(b||(b=t.reduce(function(e,t,n){var r=_slicedToArray(t,2),i=r[0],a=r[1];return e||i&&[i,a,n+1]},void 0)),b){var n=_slicedToArray(b,3),i=n[0],a=n[1],o=n[2];return r.create(\"saving\",\"The variable $\"+i+\" holds \"+c(a)+\" (which is, or contains, a complex data value) on turn \"+o+\"; the game can no longer be saved.\")}try{return JSON.stringify(e,function(e,t){return this.TwineScript_VariableStore?\"TwineScript_TypeDefs\"===e?Object.keys(t).reduce(function(e,n){return e[n]=u(t[n]),e},{}):u(t):t})}catch(e){return!1}},deserialise:function(n,r){var i,a=void 0,o=h,s=\"The save data is unintelligible.\";try{a=JSON.parse(r)}catch(e){return Error(s)}return Array.isArray(a)?(i=(a=a.map(function(r){if(\"object\"!==(void 0===r?\"undefined\":_typeof(r))||!r.hasOwnProperty(\"passage\")||!r.hasOwnProperty(\"variables\"))return Error(s);if(!t.hasValid(r.passage))return Error(\"The data refers to a passage named '\"+r.passage+\"', but it isn't in this story.\");if(r.variables=p(f(o),r.variables),Object.hasOwnProperty.call(r.variables,\"TwineScript_TypeDefs\")){var i=r.variables.TwineScript_TypeDefs=p(f(o.TwineScript_TypeDefs),r.variables.TwineScript_TypeDefs);try{e(n,i)}catch(e){return Error(s)}}try{e(n,r.variables)}catch(e){return Error(s)}return o=r.variables,p(f(y),r)})).find(function(e){return e instanceof Error}))?i:(m=a,w.load.forEach(function(e){return e(m)}),g=m.length-1,S(m[g].passage),!0):Error(s)}}}()),Object.seal(y),Object.freeze(T)}),define(\"internaltypes/varref\",[\"state\",\"internaltypes/twineerror\",\"utils\",\"utils/operationutils\",\"datatypes/hookset\"],function(e,t,n,r,i){var a=n.impossible,o=n.andList,s=n.nth,c=r.is,u=r.isObject,l=r.toSource,p=r.isSequential,f=r.objectName,d=r.typeName,h=r.clone,y=r.isValidDatamapName,m=r.subset,g=r.collectionType,v=r.unstorableValue,b=r.matches,w=void 0,T=0,S={set:[],delete:[]};function x(e,n){var r=void 0;if(e instanceof Map&&(r=t.containsError(y(e,n))))return r;if(p(e)){var a=void 0,s=\"You can only access position strings/numbers ('4th', 'last', '2ndlast', (2), etc.) or slices ('1stTo2ndlast', '3rdTo5th'), \",c=\"You can't access the '0th' or '0thlast' position of \"+f(e)+\".\";if(\"number\"==typeof n){if(0===n)return t.create(\"property\",\"You can't access elements at position 0 of \"+f(e)+\".\",\"Only positive and negative position values exist.\");n>0&&(n-=1)}else if(\"string\"==typeof n&&(a=/^(\\d+)(?:st|[nr]d|th)last$/i.exec(n))){if(\"0\"===a[1])return t.create(\"property\",c);n=-a[1]}else if(\"string\"==typeof n&&(a=/^(\\d+)(?:st|[nr]d|th)$/i.exec(n))){if(\"0\"===a[1])return t.create(\"property\",c);n=a[1]-1}else if(\"string\"==typeof n&&(a=/^(?:(\\d+)(?:st|[nr]d|th)(last)?|last)to(?:(\\d+)(?:st|[nr]d|th)(last)?|last)$/i.exec(n))){var u=_slicedToArray(a,5),l=u[1],d=void 0===l?0:l,h=u[2],m=u[3],g=void 0===m?0:m;n={last:g=u[4]?-g:g-1,first:d=h?-d:d-1}}else if(\"last\"===n)n=-1;else if(\"random\"===n){if(!e.length)return t.create(\"property\",\"I can't get a random value from \"+f(e)+\", because it's empty\");n=Math.random()*Array.from(e).length|0}else{if(i.isPrototypeOf(e)&&!i.TwineScript_Properties.includes(n))return t.create(\"property\",s+o(i.TwineScript_Properties.map(function(e){return\"'\"+e+\"'\"}))+\" of \"+f(e)+\", not \"+f(n)+\".\");if(![\"length\",\"any\",\"all\",\"start\",\"end\",\"random\"].includes(n)&&!i.isPrototypeOf(e))return t.create(\"property\",s+\"'length', 'any', 'all', 'start', 'end', and 'random' of \"+f(e)+\", not \"+f(n)+\".\")}}else if(e instanceof Set){if(![\"length\",\"any\",\"all\"].includes(n))return t.create(\"property\",\"You can only get the 'length', 'any' and 'all' of \"+f(e)+\".\",\"To check contained values, use the 'contains' operator.\");\"length\"===n&&(n=\"size\")}else{if(Array.isArray(e.TwineScript_Properties)&&!e.TwineScript_Properties.includes(n))return t.create(\"property\",\"You can only get the \"+o(e.TwineScript_Properties.map(function(e){return\"'\"+e+\"'\"}))+\" of \"+f(e)+\", not \"+f(n)+\".\");if(\"number\"==typeof e||\"boolean\"==typeof e)return t.create(\"property\",\"You can't get data values from \"+f(e)+\".\")}return n}function k(e,t){return t-0<0&&Math.abs(t)<=e.length?e.length+(t-0):t}function O(e,t){if(void 0===e)return e;if(e instanceof Map||w.isPrototypeOf(e))return e.get(t);if(\"any\"===t||\"all\"===t||\"start\"===t||\"end\"===t)return function(e,t){var n=\"'\"+t+\"' value\"+(\"any\"===t?\"\":\"s\")+\" of \";return{determiner:t,array:[].concat(_toConsumableArray(e)),string:\"string\"==typeof e&&e,TwineScript_ObjectName:n+f(e),TwineScript_TypeName:n+\"a data structure\",TwineScript_Unstorable:!0,TwineScript_Print:function(){return\"`[\"+this.TwineScript_TypeName+\"]`\"}}}(e,t);if(\"string\"==typeof e&&(e=[].concat(_toConsumableArray(e))),p(e)&&Number.isFinite(t)&&(t=k(e,t)),e.TwineScript_GetProperty)return e.TwineScript_GetProperty(t);var n=e[t];return\"function\"!=typeof n?n:void 0}function j(e){if(e.computed){var t=e.value;return w.isPrototypeOf(t)&&(t=t.get()),\"string\"==typeof t?\"('\"+t+\"')\":\"(\"+t+\")\"}return\"number\"==typeof e?s(e):\"'\"+e+\"'\"}function A(n,r,a){if(n.TwineScript_VariableStore){if(n.TwineScript_TypeDefs&&r in n.TwineScript_TypeDefs){var o=n.TwineScript_TypeDefs[r];if(\"const\"===o.name){if(void 0!==n[r])return t.create(\"operation\",\"I can't alter \"+(n===e.variables?\"$\":\"_\")+r+\" because it's been restricted to a constant value.\",\"This variable can't be changed for the rest of the story.\")}else if(!b(o,a))return t.create(\"operation\",\"I can't set \"+(n===e.variables?\"$\":\"_\")+r+\" to \"+d(a)+\" because it's been restricted to \"+l(o)+\"-type data.\",\"You can restrict a variable or data name by giving a typed variable to (set:) or (put:).\")}return!0}return Array.isArray(r)?r.map(function(e){return A(n,e)}):n instanceof Map?\"string\"==typeof r||t.create(\"operation\",f(n)+\" can only have string data names, not \"+f(r)+\".\"):p(n)?[\"length\",\"random\",\"any\",\"all\",\"start\",\"end\"].includes(r)?t.create(\"operation\",\"I can't forcibly alter the '\"+r+\"' of \"+f(n)+\".\",\"start\"===r||\"end\"===r?\"Alter the values at actual positions, like 1st or 2ndlast, rather than just the '\"+r+\"'.\":void 0):+r==(0|r)||t.create(\"property\",f(n)+\" can only have position keys ('3rd', '1st', (5), etc.), not \"+j(r)+\".\"):n.TwineScript_Identifiers&&r in n?t.create(\"keyword\",\"I can't alter the value of the '\"+r+\"' identifier.\",\"You can only alter data in variables and hooks, not fixed identifiers.\"):t.create(\"operation\",\"I can't modify \"+f(n),n instanceof Set?\"You should use an (array:) if you need to modify the data inside this dataset.\":i.isPrototypeOf(n)?\"You should alter hooks indirectly using macros like (replace:) or (enchant:).\":void 0)}function C(e,t,n){var r=t;e instanceof Map?e.set(t,n):(p(e)&&(t=k(e,t)),e.TwineScript_Set?e.TwineScript_Set(t):e[t]=n),S.set.forEach(function(t){return t(e,r,n)})}function E(e,t){var n=t;p(e)&&(t=k(e,t)),Array.isArray(e)&&/^(?:[1-9]\\d*|0)$/.exec(t)?e.splice(t,1):e instanceof Map||e instanceof Set?e.delete(t):delete e[t],S.delete.forEach(function(t){return t(e,n)})}function _(e){return Object.assign(Object.create(w),{error:e})}function N(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r;if(r&&\"object\"===(void 0===r?\"undefined\":_typeof(r))&&\"last\"in r&&\"first\"in r){if(i.isPrototypeOf(n))return n.TwineScript_GetProperty(r);var s=r.first,c=r.last;return m(n,s+(s>=0),c+(c>=0))}if(Array.isArray(r))return i.isPrototypeOf(n)?n.TwineScript_GetProperty(r):r.map(function(e){return N(n,e,e)})[\"string\"==typeof n?\"join\":\"valueOf\"](\"\");var u=O(n,r);if(void 0===u){if(n===e.variables)return T;if(n.TwineScript_VariableStore)return t.create(\"property\",\"There isn't a temp variable named _\"+a+\" in this place.\",\"Temp variables only exist inside the same passage and hook in which they're (set:).\");if(Array.isArray(n)&&\"number\"==typeof r)return t.create(\"property\",\"This array of \"+(n.length+1)+\" elements doesn't have a \"+j(a)+\" element.\",n.length?\"It contains: \"+o(n.map(f))+\".\":\"The array is empty.\");var l=Array.from(\"function\"==typeof n.keys&&n.keys());return t.create(\"property\",\"I can't find a \"+j(a)+\" data name in \"+f(n),n instanceof Map&&l.length?\"Its names include: \"+o(l)+\".\":void 0)}return u}function P(e,n){var r=this,i=this.compiledPropertyChain.reduce(function(e,t){var n=void 0;return n=0===e.length?r.object:N.apply(void 0,_toConsumableArray(e[e.length-1])),e.push([n,t])&&e},[]).reduceRight(e,n);return t.containsError(i)?i:void 0}return w=Object.freeze({get:function(){return this.error?this.error:N(this.deepestObject,this.compiledPropertyChain.slice(-1)[0],this.propertyChain.slice(-1)[0])},set:function(n){var r=this;return this.error?this.error:!this.object||this.object.TwineScript_VariableStore||this.object.TwineScript_Identifiers?P.call(this,function(n,i,a){var o,s=_slicedToArray(i,2),c=s[0],l=s[1];if(o=t.containsError(n,c,l)||t.containsError(A(c,l,n)))return o;var d;if(d=v(n))return t.create(\"operation\",f(n)+\" can't be stored\"+(g(n)?\" because it holds \"+f(d)+\".\":\"\"));if(a>0)c=h(c);else if(c.TwineScript_VariableStore&&c!==e.variables){for(var y=c;y.TwineScript_VariableStore&&!y.hasOwnProperty(l);)y=Object.getPrototypeOf(y);y.TwineScript_VariableStore&&(c=y)}if(\"string\"==typeof c){if(\"string\"!=typeof n)return t.create(\"datatype\",\"I can't put this non-string value, \"+f(n)+\", in a string.\");if(n.length!==(Array.isArray(l)?l.length:1))return t.create(\"datatype\",f(n)+\"is not the right length to fit into this string location.\");c=[].concat(_toConsumableArray(c));var m=[].concat(_toConsumableArray(n));[].concat(l).forEach(function(e){0+e<0&&(e=c.length+(0+e)),c=[].concat(_toConsumableArray(c.slice(0,e)),[m.shift()],_toConsumableArray(c.slice(e+1)))}),c=c.join(\"\")}else u(c)&&(void 0!==n.TwineScript_KnownName&&(n.TwineScript_KnownName=r.TwineScript_ObjectName),Array.isArray(l)&&p(n)?(\"string\"==typeof n&&(n=[].concat(_toConsumableArray(n))),l.map(function(e,t){return[e,n[t]]}).forEach(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return C(c,n,r)})):C(c,l,n));return c},n):t.create(\"macrocall\",\"I can't (set:) \"+f(this)+\", if the \"+(f(this.object).match(/ (.+$)/)||[\"\",\"value\"])[1]+\" isn't stored in a variable.\",\"Modifying data structures that aren't in variables won't change the game state at all.\")},delete:function(){return this.error?this.error:P.call(this,function(e,n,r){var i,a=_slicedToArray(n,2),o=a[0],s=a[1];if(i=t.containsError(e,o,s)||t.containsError(A(o,s)))return i;if(r>0&&(o=h(o)),null===e){var c=\"string\"==typeof o;c&&(o=[].concat(_toConsumableArray(o))),Array.isArray(s)?(p(o)&&(s=[].concat(_toConsumableArray(new Set(s)))).sort(function(e,t){return k(o,t)-k(o,e)}),s.forEach(function(e){return E(o,e)})):E(o,s),c&&(o=o.join(\"\"))}else C(o,s,e);return o},null)},defineType:function(e){var n=this.object,r=this.compiledPropertyChain;if(!n||!n.TwineScript_VariableStore||1!==r.length||!n.TwineScript_TypeDefs)return t.create(\"unimplemented\",\"I can only restrict the datatypes of variables, not data names or anything else.\");var i=r[0];Object.hasOwnProperty.call(n,\"TwineScript_TypeDefs\")||(n.TwineScript_TypeDefs=Object.create(n.TwineScript_TypeDefs));var a=n.TwineScript_TypeDefs,o=a[i];if(o&&!c(o,e))return t.create(\"operation\",\"I can't redefine the type of \"+f(this)+\" to \"+(e.TwineScript_ObjectName||d(e))+\", as it is already \"+(o.TwineScript_ObjectName||d(o))+\".\");a[i]=e,\"const\"===e.name&&(n[i]=void 0)},matches:function(e,t){return this.object===e&&this.compiledPropertyChain[0]===t},getName:function(){return this.compiledPropertyChain[0]},create:function(e,n){var r=void 0;if(r=t.containsError(e))return _(r);n=[].concat(n),w.isPrototypeOf(e)&&(n=e.propertyChain.concat(n),e=e.object);var i=function(e,n){return{compiledPropertyChain:n.reduce(function(r,i,a){var o;return i.computed&&(i=i.value),w.isPrototypeOf(i)&&(i=i.get()),i=Array.isArray(i)?i.map(function(t){return x(e,t)}):x(e,i),(o=t.containsError(r,i))?o:(a<n.length-1&&(e=N(e,i)),r.push(i),r)},[]),deepestObject:e}}(e,n),a=i.compiledPropertyChain,o=i.deepestObject;return(r=t.containsError(a,o))?_(r):Object.assign(Object.create(w),{object:e,propertyChain:n,compiledPropertyChain:a,deepestObject:o})},TwineScript_ToSource:function(){var t=this,n=function(e,n){return!n&&t.object.TwineScript_VariableStore?e:j(e)};return(this.object===e.variables?\"$\":this.object.TwineScript_VariableStore?\"_\":f(this.object)+\"'s \")+(1===this.propertyChain.length?n(this.propertyChain[0]):this.propertyChain.reduce(function(e,t,r){return e+\"'s \"+n(t,r)}))},get TwineScript_ObjectName(){return this.TwineScript_ToSource()+(this.object.TwineScript_VariableStoreName?\" in \"+this.object.TwineScript_VariableStoreName:\"\")},on:function(e,t){if(e in S)return\"function\"!=typeof t||S[e].includes(t)||S[e].push(t),w;a(\"VarRef.on\",\"invalid event name\")}})}),define(\"internaltypes/varscope\",[],function(){return Object.seal({TwineScript_ObjectName:\"the temporary variables\",TwineScript_VariableStore:!0,TwineScript_TypeDefs:Object.create(null)})}),define(\"internaltypes/twinenotifier\",[\"jquery\",\"utils\"],function(e,t){var n=t.impossible,r={create:function(e){return e||n(\"TwineNotifier.create\",\"called with only 1 string.\"),Object.assign(Object.create(r),{message:e})},render:function(){return e(\"<tw-notifier>\").attr(\"message\",this.message)}};return r}),define(\"datatypes/custommacro\",[\"jquery\",\"utils/operationutils\",\"internaltypes/changedescriptor\",\"internaltypes/varref\",\"internaltypes/varscope\",\"internaltypes/twineerror\",\"internaltypes/twinenotifier\"],function(e,t,n,r,i,a,o){var s=t.objectName,c=t.matches,u=Object.assign,l=Object.create,p=function(t){return function(c){for(var p=arguments.length,f=Array(p>1?p-1:0),d=1;d<p;d++)f[d-1]=arguments[d];t.called+=1;var h=t.varNames,y=t.params,m=t.body,g=u(l(i),{TwineScript_VariableStoreName:t.TwineScript_ObjectName+\" call #\"+t.called,TwineScript_TypeDefs:l(null)}),v=[],b=0;f.forEach(function(e,t){var n=h[b];g.TwineScript_TypeDefs[n]=y[b].datatype.rest?y[b].datatype.create(\"array\"):y[b].datatype;var i=r.create(g,n);if(y[b].datatype.rest){var a=(g[n]||[]).concat(e);if(t<f.length-1)return void(g[n]=a);i.set(a)}else i.set(e),b+=1;v.push(o.create(s(i)+\" is now \"+s(g[n])))}),f.length&&(b+=1),y[b]&&y[b].datatype.rest&&(r.create(g,h[b]).set([]),g.TwineScript_TypeDefs[name]=y[b].datatype.create(\"array\"));var w=void 0,T=e(\"<p>\").append(m.html);c.stack.unshift({tempVariables:g,dom:T,output:function(e){w=e}}),c.execute(),c.stackTop.blocked&&c.stack.shift();var S,x,k=T.find(\"tw-error\");return k.length?(T.prepend(v.map(function(e){return e.render()}),\"<br>\"),a.create(\"propagated\",k.length+\" error\"+(k.length>1?\"s\":\"\")+\" occurred when running \"+t.TwineScript_ObjectName+\".\",void 0,T)):void 0===w?a.create(\"custommacro\",t.TwineScript_ObjectName+\" didn't output any data or hooks using (output:) or (output-data:).\"):n.isPrototypeOf(w)?(S=w,x=u({TwineScript_TypeID:\"command\",TwineScript_ObjectName:\"a custom command\",TwineScript_TypeName:\"a custom command\",TwineScript_Print:function(){return\"`[a custom command]`\"},TwineScript_Attach:function(e){return e.run(S),x},TwineScript_Run:function(){return S}})):w}},f=Object.freeze({TwineScript_TypeID:\"macro\",TwineScript_TypeName:\"a custom macro\",get TwineScript_ObjectName(){return this.TwineScript_KnownName?\"the \"+this.TwineScript_KnownName+\" macro\":\"a custom macro\"},TwineScript_GetProperty:function(e){if(\"params\"===e)return[].concat(_toConsumableArray(this.params))},TwineScript_Properties:[\"params\"],TwineScript_Print:function(){return\"`[\"+this.TwineScript_ObjectName+\"]`\"},TwineScript_Clone:function(){return u(l(f),this)},TwineScript_ToSource:function(){return\"(macro:\"+this.params.map(function(e){return e.TwineScript_ToSource()}).concat(\"\")+this.body.TwineScript_ToSource()+\")\"},create:function(e,t){var n=u(l(this),{params:e,called:0,varNames:e.map(function(e){return e.varRef.propertyChain[0]}),typeSignature:e.map(function(e){var t=void 0;return t=e.datatype.toTypeSignatureObject?e.datatype.toTypeSignatureObject({rest:e.rest}):{pattern:\"range\",range:function(t){return c(e.datatype,t)}},e.rest?{pattern:\"zero or more\",innerType:t}:t}),body:t,TwineScript_KnownName:\"\"});return n.fn=p(n),n}});return f}),define(\"datatypes/lambda\",[\"utils/operationutils\",\"internaltypes/varscope\",\"internaltypes/varref\",\"internaltypes/twineerror\"],function(e,t,n,r){var i=e.objectName,a=Object.freeze({TwineScript_TypeID:\"lambda\",TwineScript_TypeName:\"a lambda\",get TwineScript_ObjectName(){return'a \"'+(\"making\"in this?\"making ... \":\"\")+(\"where\"in this?\"where ... \":\"\")+(\"when\"in this?\"when ... \":\"\")+(\"via\"in this?\"via ... \":\"\")+'\" lambda'},TwineScript_Print:function(){return\"`[A lambda]`\"},TwineScript_is:function(e){return e===this},TwineScript_ToSource:function(){return this.source},TypeSignature:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:\"lambda\",innerType:a,clauses:t,typeName:'a \"'+t.concat(\"\").join(\" ...\")+'\" lambda'}},TwineScript_Clone:function(){return Object.assign(Object.create(a),this)},create:function(e,o,s,c){var u=void 0;function l(e){var r=e&&e.varRef?e.varRef:e;return void 0===r||r&&n.isPrototypeOf(r)&&t.isPrototypeOf(r.object)&&1===r.propertyChain.length}if(\"making\"===o&&!l(s))return r.create(\"syntax\",\"I need a temp variable, or typed temp variable, to the right of '\"+o+\"', not \"+i(s)+\".\");if(r.containsError(e))return e;if(a.isPrototypeOf(e)){if(\"when\"===o||\"when\"in e)return r.create(\"syntax\",\"A 'when' lambda cannot have any other clauses, such as '\"+o+\"'.\");if(o in e&&(\"where\"!==o||\"true\"!==e[o]))return r.create(\"syntax\",\"This lambda has two '\"+o+\"' clauses.\");u=e}else{if(\"when\"===o&&void 0!==e)return r.create(\"syntax\",\"A 'when' lambda shouldn't begin with a temp variable (just use 'when' followed by the condition).\");if(!l(e))return r.create(\"syntax\",\"This lambda needs to start with a single temp variable, or typed temp variable, not \"+i(e)+\".\");(u=Object.create(this)).loop=e||\"\"}return u.source=c.trim(),u[o]=s,u.making&&u.making.getName()===(u.loop&&u.loop.getName())?r.create(\"syntax\",\"This lambda has two variables named '\"+u.loop.getName()+\"'.\",\"Lambdas should have all-unique parameter names.\"):u},apply:function(e,n){var i=n.loop,a=n.pos,o=n.making,s=n.ignoreVia,c=n.tempVariables;function u(e,t){if(e)if(\"datatype\"in e&&\"varRef\"in e){var n=e.varRef.create(c,e.varRef.propertyChain);n.defineType(e.datatype);var i=n.set(t);if(r.containsError(i))return i}else c[e.getName()]=t}c=c||Object.create(e.stack.length?e.stackTop.tempVariables:t);var l=u(this.loop,i)||u(this.making,o);if(r.containsError(l))return l;e.stack.unshift(Object.assign(Object.create(e.stackTop||null),{tempVariables:c,lambdaPos:this.when?void 0:a}));var p=e.eval(\"Operations\");!i||this.making||this.when?p.initialiseIt(r.create(\"operation\",\"I can't use 'it', or an implied 'it', in \"+this.TwineScript_ObjectName)):p.initialiseIt(i);var f=!s&&this.via,d=e.eval(\"where\"in this||\"when\"in this?\"Operations.where(\"+(this.where||this.when)+\",\"+(f||\"true\")+\",null)\":f||\"true\");return e.stack.shift(),d},filter:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=void 0,o=t.reduce(function(t,o,s){if(a=r.containsError(t))return a;var c=n.apply(e,{loop:o,pos:s+1,ignoreVia:!0,tempVariables:i});return(a=r.containsError(c))?a:t.concat(c?[o]:[])},[]);return(a=r.containsError(o))?a:o}});return a}),define(\"datatypes/codehook\",[\"internaltypes/twineerror\",\"renderer\"],function(e,t){var n=t.exec;return Object.freeze({TwineScript_TypeName:\"a code hook\",TwineScript_ObjectName:\"a code hook\",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return\"[\"+this.source+\"]\"},create:function(t,r){r||(r=n(t));var i=e.containsError(r);return i||Object.assign(Object.create(this),{source:t,html:r})}})}),define(\"datatypes/colour\",[\"jquery\",\"utils\"],function(e,t){var n=t.matMul,r=Math.max,i=Math.min,a=Math.sin,o=Math.cos,s=Math.pow,c=Math.round,u=Math.floor,l=Math.atan2,p=Math.cbrt,f=Math.sqrt,d=Math.PI,h=Object.assign,y=Object.create,m=/^([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])$/,g=/^([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])$/,v=y(null);function b(e){var t=e.r,n=e.g,a=e.b,o=e.a,s=r(t/=255,n/=255,a/=255),u=i(t,n,a),l=(s+u)/2,p=s-u;if(s===u)return{h:0,s:0,l:l};var f=void 0;switch(s){case t:f=(n-a)/p+(n<a?6:0);break;case n:f=(a-t)/p+2;break;case a:f=(t-n)/p+4}return{h:f=c(60*f),s:l>.5?p/(2-s-u):p/(s+u),l:l,a:o}}var w=[.96422,1,.82521],T=24389/27,S=216/24389,x=function(e){return e.map(function(e){return[e]})},k=function(e){return e.map(function(e){return e[0]})};function O(e){var t=e.l,r=e.c,i=e.h,c=e.a;t*=100;var u=[];u[1]=(t+16)/116,u[0]=r*o(i*d/180)/500+u[1],u[2]=u[1]-r*a(i*d/180)/200;var l=[s(u[0],3)>S?s(u[0],3):(116*u[0]-16)/T,t>T*S?s((t+16)/116,3):t/T,s(u[2],3)>S?s(u[2],3):(116*u[2]-16)/T].map(function(e,t){return e*w[t]}),p=k(n([[.9555766,-.0230393,.0631636],[-.0282895,1.0099416,.0210077],[.0122982,-.020483,1.3299098]],n([[3.2404542,-1.5371385,-.4985314],[-.969266,1.8760108,.041556],[.0556434,-.2040259,1.0572252]],x(l)))).map(function(e){return 255*e}),f=_slicedToArray(p,3);return{r:f[0],g:f[1],b:f[2],a:c}}function j(e){var t=O(e);return[t.r,t.g,t.b].every(function(e){return e>=0&&e<=255})}var A=Object.freeze({TwineScript_TypeID:\"colour\",TwineScript_TypeName:\"a colour\",TwineScript_ObjectName:\"a colour\",TwineScript_DebugName:function(){return\"a colour \"+this.TwineScript_Print()},\"TwineScript_+\":function(e){var t=this.toRGBA(),n=e.toRGBA();return A.create({r:Math.min(Math.round(.6*(t.r+n.r)),255),g:Math.min(Math.round(.6*(t.g+n.g)),255),b:Math.min(Math.round(.6*(t.b+n.b)),255),a:(t.a+n.a)/2})},TwineScript_Print:function(){var e=this.toRGBA();return\"<tw-colour style='background-color:rgba(\"+[e.r,e.g,e.b,e.a]+\");'></tw-colour>\"},TwineScript_is:function(e){if(!A.isPrototypeOf(e))return!1;if(e.lcha&&this.lcha)return e.lcha.l===this.lcha.l&&e.lcha.c===this.lcha.c&&e.lcha.h===this.lcha.h&&e.a===this.a;var t=this.toRGBA();return(e=e.toRGBA()).r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a},TwineScript_Clone:function(){return A.create(this)},toRGBAString:function(){var e=this.toRGBA();return\"rgba(\"+e.r+\", \"+e.g+\", \"+e.b+\", \"+e.a+\")\"},toHSLA:function(){return b(this.toRGBA())},toRGBA:function(){return this.lch?O(function(e){if(j(e))return e;var t=(e=h({},e)).c,n=0;for(e.c/=2;t-n>1e-5;)j(e)?n=e.c:t=e.c,e.c=(t+n)/2;return e}(h({},this.lch,{a:this.a}))):this},toLCHA:function(){return this.lch?h({},this.lch):(t=(e=this).r,r=e.g,i=e.b,a=e.a,o=k(n([[1.0478112,.0228866,-.050127],[.0295424,.9904844,-.0170491],[-.0092345,.0150436,.7521316]],n([[.4124564,.3575761,.1804375],[.2126729,.7151522,.072175],[.0193339,.119192,.9503041]],x([t/255,r/255,i/255])))).map(function(e,t){return e/w[t]}).map(function(e){return e>S?p(e):(T*e+16)/116}),c=[116*o[1]-16,500*(o[0]-o[1]),200*(o[1]-o[2])],u=180*l(c[2],c[1])/d,{l:c[0]/100,c:f(s(c[1],2)+s(c[2],2)),h:u>=0?u:u+360,a:a});var e,t,r,i,a,o,c,u},LCHRotate:function(e){e<0&&(e=360+e);var t=this.toLCHA();return t.h=(t.h+e)%360,t.a=this.a,A.create(t)},TwineScript_GetProperty:function(e){if(\"lch\"===e){var t=this.toLCHA();return new Map([[\"l\",t.l],[\"c\",t.c],[\"h\",t.h]])}var n=this.toRGBA();return\"h\"===e||\"s\"===e||\"l\"===e?b(n)[e]:\"r\"===e||\"g\"===e||\"b\"===e||\"a\"===e?n[e]:void 0},TwineScript_Properties:[\"h\",\"s\",\"l\",\"r\",\"g\",\"b\",\"a\",\"lch\"],TwineScript_ToSource:function(){var e=!this.lch&&b(this);if(e&&!e.h&&!e.s){if(1===e.l)return\"white\";if(0===e.l)return\"black\"}return\"(\"+(this.lch?\"lch\":\"hsl\")+\":\"+(this.lch?[this.lch.l,this.lch.c,this.lch.h]:[e.h,e.s,e.l])+(1!==this.a?\",\"+this.a:\"\")+\")\"},create:function(t){return\"string\"==typeof t?this.create((A.isHexString(t)?function(e){return\"string\"!=typeof e?e:(e=(e=e.replace(\"#\",\"\")).replace(m,\"$1$1$2$2$3$3\"),{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)})}:function(t){if(t in v)return v[t];var n=e(\"<p>\").css(\"background-color\",t).css(\"background-color\");return n=\"transparent\"===n?{r:0,g:0,b:0,a:0}:n.startsWith(\"rgb\")?n.match(/\\d+/g).reduce(function(e,t,n){return e[\"rgb\"[n]]=+t,e},{}):{r:192,g:192,b:192},v[t]=n,n})(t)):!(\"h\"in t&&\"s\"in t&&\"l\"in t)||\"r\"in t||\"g\"in t||\"b\"in t?(\"a\"in t&&\"number\"==typeof t.a||(t.a=1),h(y(this),\"h\"in t&&\"c\"in t&&!(\"s\"in t)&&\"l\"in t?{a:t.a,lch:{l:t.l,c:t.c,h:t.h}}:t)):this.create(function(e){var t=e.h,n=e.s,r=e.l,i=e.a;if(0===n){var a=u(255*r);return{r:a,g:a,b:a}}var o=r<.5?r*(1+n):r+n-r*n,s=2*r-o;function c(e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?s+6*(o-s)*e:e<.5?o:e<2/3?s+(o-s)*(2/3-e)*6:s}return{r:u(255*c((t/=360)+1/3)),g:u(255*c(t)),b:u(255*c(t-1/3)),a:i}}(t))},isHexString:function(e){return\"string\"==typeof e&&\"#\"===e[0]&&(e.slice(1).match(m)||e.slice(1).match(g))},isCSS3Function:function(e){return\"string\"==typeof e&&/^(?:rgb|hsl)a?\\(\\s*\\d+\\s*,\\s*\\d+%?\\s*,\\s*\\d+%?(?:,\\s*\\d+(?:\\.\\d+)?\\s*)?\\)$/.test(e)}});return A}),define(\"datatypes/gradient\",[\"utils/operationutils\"],function(e){var t=e.toSource,n=Object.freeze({TwineScript_TypeID:\"gradient\",TwineScript_TypeName:\"a gradient\",TwineScript_ObjectName:\"a gradient\",TwineScript_DebugName:function(){return\"a gradient \"+this.TwineScript_Print()},TwineScript_GetProperty:function(e){var t=this;return\"angle\"===e?this.angle:\"stops\"===e?this.stops.map(function(e){return new Map([[t.repeating?\"pixels\":\"percent\",e.stop],[\"colour\",e.colour.TwineScript_Clone()]])}):void 0},TwineScript_Properties:[\"angle\",\"stops\"],TwineScript_ToSource:function(){return\"(gradient:\"+this.angle+\",\"+this.stops.map(function(e){return t(e.stop)+\",\"+t(e.colour)})+\")\"},TwineScript_is:function(e){var t=this;return e.angle===this.angle&&e.stops.length===this.stops.length&&e.stops.every(function(e,n){var r=e.colour,i=e.stop;return t.stops[n].stop===i&&t.stops[n].colour.TwineScript_is(r)})},TwineScript_Clone:function(){return n.create(this.angle,[].concat(_toConsumableArray(this.stops)))},TwineScript_Print:function(){return\"<tw-colour style='background:\"+this.toLinearGradientString()+\"'></tw-colour>\"},create:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object.assign(Object.create(this),{angle:e,stops:t.sort(function(e,t){return e.stop-t.stop}),repeating:n})},multiply:function(e){return n.create(this.angle,this.stops.map(function(t){return{colour:t.colour,stop:t.stop*e}}))},toLinearGradientString:function(){var e=this;return(this.repeating?\"repeating-\":\"\")+\"linear-gradient(\"+this.angle+\"deg, \"+this.stops.reduce(function(t,n){var r=n.colour,i=n.stop;return t+r.toRGBAString()+\" \"+i*(e.repeating?1:100)+(e.repeating?\"px,\":\"%,\")},\"\").slice(0,-1)+\")\"}});return n}),define(\"datatypes/datatype\",[\"utils\",\"utils/operationutils\",\"datatypes/changercommand\",\"datatypes/colour\",\"datatypes/gradient\",\"datatypes/lambda\",\"datatypes/custommacro\",\"internaltypes/twineerror\"],function(e,t,n,r,i,a,o,s){var c=e.realWhitespace,u=e.anyRealLetter,l=e.anyCasedLetter,p=e.anyNewline,f=t.objectName,d=Object.assign,h=Object.seal,y=Object.keys,m=Math.floor,g=Math.abs,v=void 0,b=void 0,w={TwineScript_TypeID:\"datatype\",TwineScript_TypeName:\"a datatype\",TwineScript_Print:function(){return\"`[\"+this.TwineScript_ObjectName+\"]`\"},get TwineScript_ObjectName(){return\"the \"+(this.rest?\"...\":\"\")+this.name+\" datatype\"},TwineScript_is:function(e){return w.isPrototypeOf(e)&&e.name===this.name},TwineScript_Clone:function(){return this.rest?this:Object.create(this)},TwineScript_ToSource:function(){return(this.rest?\"...\":\"\")+this.name},TwineScript_IsTypeOf:function(e){var t=this.name,n=this.rest;return!!v[t]&&v[t](e,n)},toTypeSignatureObject:function(){var e={pattern:\"range\",range:v[this.name]};return this.rest?{pattern:\"zero or more\",innerType:e}:e},create:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=\"datamap\"===e?\"dm\":\"dataset\"===e?\"ds\":\"number\"===e?\"num\":\"string\"===e?\"str\":\"color\"===e?\"colour\":\"boolean\"===e?\"bool\":\"alphanumeric\"===e?\"alnum\":\"integer\"===e?\"int\":e;var n=Object.create(this);return n.name=e,n.rest=t,n},from:function(e){var t=y(b).find(function(t){return b[t](e)});return t?w.create(t):s.create(\"datatype\",f(e)+\" doesn't correspond to a datatype value.\")}};return b={array:Array.isArray,dm:function(e){return e instanceof Map},ds:function(e){return e instanceof Set},datatype:function(e){return w.isPrototypeOf(e)},changer:function(e){return n.isPrototypeOf(e)},colour:function(e){return r.isPrototypeOf(e)},gradient:function(e){return i.isPrototypeOf(e)},lambda:function(e){return a.isPrototypeOf(e)},macro:function(e){return o.isPrototypeOf(e)},str:function(e){return\"string\"==typeof e},num:function(e){return\"number\"==typeof e},bool:function(e){return\"boolean\"==typeof e}},v=d({},b,{even:function(e){return!isNaN(e)&&m(g(e))%2==0},odd:function(e){return!isNaN(e)&&m(g(e))%2==1},empty:function(e){return e instanceof Map||e instanceof Set?!e.size:!(!Array.isArray(e)&&\"string\"!=typeof e)&&!e.length},int:function(e){return\"number\"==typeof e&&e===(0|e)},uppercase:function(e){return\"string\"==typeof e&&1===[].concat(_toConsumableArray(e)).length&&[].concat(_toConsumableArray(e)).every(function(e){return e!==e.toLowerCase()})},lowercase:function(e){return\"string\"==typeof e&&1===[].concat(_toConsumableArray(e)).length&&[].concat(_toConsumableArray(e)).every(function(e){return e!==e.toUpperCase()})},whitespace:function(e){return\"string\"==typeof e&&!!e.match(\"^\"+c+\"$\")},digit:function(e){return\"string\"==typeof e&&!!e.match(\"^\\\\d$\")},alnum:function(e){return\"string\"==typeof e&&!!e.match(\"^\"+u+\"$\")},anycase:function(e){return\"string\"==typeof e&&!!e.match(\"^\"+l+\"$\")},linebreak:function(e){return\"string\"==typeof e&&!!e.match(\"^\"+p+\"$\")},any:function(){return!0},const:function(){return!0}}),h(w)}),define(\"datatypes/typedvar\",[\"utils/operationutils\",\"datatypes/datatype\",\"internaltypes/varref\",\"internaltypes/twineerror\"],function(e,t,n,r){var i=e.typeName,a=e.matches,o=e.toSource,s=e.unstorableValue,c=Object.freeze,u=Object.assign,l=Object.create,p=c({TwineScript_TypeName:\"a typed variable name\",get TwineScript_ObjectName(){return this.TwineScript_ToSource()},TwineScript_Print:function(){return\"`[A typed variable name]`\"},TwineScript_Unstorable:!0,TwineScript_Clone:function(){return u(l(p),{datatype:this.datatype.TwineScript_Clone(),varRef:this.varRef})},TwineScript_ToSource:function(){return o(this.datatype)+\"-type \"+this.varRef.TwineScript_ToSource()},TwineScript_GetProperty:function(e){return\"name\"===e?this.getName():this[e]},TwineScript_Properties:[\"datatype\",\"name\"],TwineScript_IsTypeOf:function(e){return a(this.datatype,e)},get:function(){var e;return(e=this.varRef).get.apply(e,arguments)},getName:function(){return this.varRef.getName()},defineType:function(){if(\"any\"!==this.datatype.name)return this.varRef.defineType(this.datatype)},create:function(e,t){var n;if(n=r.containsError(t)||r.containsError(e)||t.error)return n;var a=s(e);return a&&!p.isPrototypeOf(a)?r.create(\"syntax\",\"The -type syntax can't have \"+i(a)+\" to its left.\"):u(l(this),{datatype:e,varRef:t})}});return p}),define(\"macros\",[\"jquery\",\"utils/naturalsort\",\"utils\",\"utils/operationutils\",\"datatypes/changercommand\",\"datatypes/custommacro\",\"datatypes/lambda\",\"datatypes/hookset\",\"datatypes/codehook\",\"datatypes/typedvar\",\"datatypes/datatype\",\"internaltypes/changedescriptor\",\"internaltypes/twineerror\"],function(e,t,n,r,i,a,o,s,c,u,l,p,f){var d=n.insensitiveName,h=n.nth,y=n.plural,m=n.andList,g=n.lockProperty,v=(r.clone,r.objectName),b=r.typeName,w=r.singleTypeCheck,T=r.toSource,S=void 0,x={};function k(e,n,r){var i=n.fn,a=n.typeSignature,s=n.isChanger,u=void 0!==s&&s,l=r[0];r=function(e){return e.reduce(function(e,n){if(n&&!0===n.spreader){var r=n.value,i=f.containsError(r);if(i)e.push(i);else if(Array.isArray(r)||\"string\"==typeof r)for(var a=0;a<r.length;a++)e.push(r[a]);else r instanceof Set?e.push.apply(e,_toConsumableArray(Array.from(r).sort(t(\"en\")))):e.push(f.create(\"operation\",\"I can't spread out \"+v(r)+\", because it is not a string, dataset, or array.\"))}else e.push(n);return e},[])}(r.slice(1)),a=[].concat(a||[]);var p=!e,d=p?\"\":\"(\"+(Array.isArray(e)&&e.length>1?e[0]:e)+\":)\";e=p?\"this custom macro\":\"the \"+d+\" macro\";var g=void 0;g=a.length>0?e+\" must only be given \"+m(a.map(b))+(a.length>1?\", in that order\":\".\"):e+\" must not be given any data.\"+(p?\"\":\" Just write \"+d);for(var T=void 0,x=function(t,n){var i=a[t],s=r[t];if(f.containsError(s))return{v:s};if(c.isPrototypeOf(s)&&u)return{v:f.create(\"syntax\",\"Please put this hook outside the parentheses of the changer macro, not inside it.\",\"Hooks should appear after a macro\"+(p?\".\":\": \"+d+\"[Some text]\"))};if(t>=a.length&&!T)return{v:f.create(\"datatype\",r.length-a.length+\" too many values were given to \"+e+\".\",g)};if(i||(i=T),!i.innerType||\"rest\"!==i.pattern&&\"zero or more\"!==i.pattern||(T=i.innerType,\"rest\"===i.pattern&&(i=i.innerType)),!w(s,i)){if(void 0===s){var l=a.filter(function(e){return!(\"optional\"===e.pattern||\"zero or more\"===e.pattern)}).length;return{v:f.create(\"datatype\",e+\" needs \"+y(l-t,\"more value\")+\".\",g)}}return s&&s.TwineScript_Unstorable&&(i===S.TypeSignature.Any||i.innerType&&i.innerType===S.TypeSignature.Any)?{v:f.create(\"datatype\",e+\"'s \"+h(t+1)+\" value, \"+v(s)+\", is not valid data for this macro.\",g)}:s&&o.isPrototypeOf(s)&&\"lambda\"===i.pattern?{v:f.create(\"datatype\",e+\"'s \"+h(t+1)+\" value (a lambda) should have \"+m([\"where\",\"when\",\"making\",\"via\",\"with\"].filter(function(e){return i.clauses.includes(e)}).map(function(e){return\"a '\"+e+\"' clause\"}))+\", not \"+m([\"where\",\"when\",\"making\",\"via\",\"with\"].filter(function(e){return e in s}).map(function(e){return\"a '\"+e+\"' clause\"}))+\".\")}:\"insensitive set\"===i.pattern?{v:f.create(\"datatype\",v(s)+\" is not a valid name string for \"+e+\".\",\"Only the following names are recognised (capitalisation and hyphens ignored): \"+m(i.innerType)+\".\")}:{v:f.create(\"datatype\",e+\"'s \"+h(t+1)+\" value is \"+v(s)+\", but should be \"+b(i)+\".\",i.message||g)}}},k=0,O=Math.max(r.length,a.length);k<O;k+=1){var j=x(k);if(\"object\"===(void 0===j?\"undefined\":_typeof(j)))return j.v}return i.apply(void 0,[l].concat(_toConsumableArray(r)))}function O(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={fn:t,typeSignature:n};r&&(i.isChanger=!0),Object.freeze(i),Array.isArray(e)?e.forEach(function(e){return g(x,d(e),i)}):g(x,d(e),i)}return S={has:function(e){return e=d(e),x.hasOwnProperty(e)},get:function(e){return e=d(e),x.hasOwnProperty(e)&&x[e]},add:function e(t,n,r){return O(t,n,r),e},addChanger:function e(t,n,r,a){return O(t,n,a,!0),i.register(Array.isArray(t)?t[0]:t,r),e},addCommand:function e(t,n,r,i){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return O(t,function(e,t,n,r){return function(i){for(var a=arguments.length,o=Array(a>1?a-1:0),s=1;s<a;s++)o[s-1]=arguments[s];var c=t.apply(void 0,o);if(c)return c;var u=p.create(),l=Object.assign({TwineScript_TypeID:\"command\",TwineScript_ObjectName:\"a (\"+e+\":) command\",TwineScript_TypeName:\"a (\"+e+\":) command\",TwineScript_Print:function(){return\"`[A (\"+e+\":) command]`\"},TwineScript_ToSource:function(){return\"(\"+e+\":\"+o.map(T)+\")\"},TwineScript_is:function(e){return T(this)===T(e)}},r?{TwineScript_Attach:function(e,t){return u.section=e,t.run(u),l},TwineScript_Run:function(e){return n.apply(void 0,[u,e].concat(o))}}:{TwineScript_Run:function(e){return n.apply(void 0,[e].concat(o))}});return l}}([].concat(t)[0],n,r,a),i),e},TypeSignature:{optional:function(e){return{pattern:\"optional\",innerType:e}},zeroOrMore:function(e){return{pattern:\"zero or more\",innerType:e}},either:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:\"either\",innerType:t}},rest:function(e){return{pattern:\"rest\",innerType:e}},insensitiveSet:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:\"insensitive set\",innerType:t}},numberRange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;return{pattern:\"range\",min:e,max:t,range:function(n){return\"number\"==typeof n&&!Number.isNaN(n)&&n>=e&&n<=t}}},nonNegativeInteger:{pattern:\"range\",integer:!0,min:0,max:1/0,range:function(e){return\"number\"==typeof e&&!Number.isNaN(e)&&e>=0&&!(e+\"\").includes(\".\")}},positiveInteger:{pattern:\"range\",integer:!0,min:1,max:1/0,range:function(e){return\"number\"==typeof e&&!Number.isNaN(e)&&e>=1&&!(e+\"\").includes(\".\")}},wrapped:function(e,t){return{pattern:\"wrapped\",innerType:e,message:t}},Any:{TwineScript_TypeName:\"anything\"},Everything:{TwineScript_TypeName:\"everything\"}},run:function(e,t){return S.has(e)?k(e,S.get(e),t):f.create(\"macrocall\",\"I can't run the macro '\"+e+\"' because it doesn't exist.\",\"Did you mean to run a macro? If you have a word written like (this:), it is regarded as a macro name.\")},runCustom:function(e,t){return a.isPrototypeOf(e)?k(\"\",e,t):f.create(\"macrocall\",\"I can't call \"+v(e)+\" because it isn't a custom macro.\")}},Object.assign(S.TypeSignature,{positiveNumber:S.TypeSignature.numberRange(Math.pow(2,-52),1/0),nonNegativeNumber:S.TypeSignature.numberRange(0,1/0),percent:S.TypeSignature.numberRange(0,1)}),Object.freeze(S)}),define(\"datatypes/varbind\",[\"jquery\",\"utils\",\"utils/operationutils\",\"internaltypes/varref\",\"internaltypes/twineerror\"],function(e,t,n,r,i){var a=n.objectName;return r.on(\"set\",function(n,r){n.TwineScript_VariableStore&&e(t.storyElement).find(\"[data-2bind]\").each(function(t,i){var a=(i=e(i)).data(\"twoWayBindEvent\");\"function\"==typeof a&&a(i,n,r)})}),Object.freeze({TwineScript_TypeName:\"a bound variable\",TwineScript_ObjectName:\"a bound variable\",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return(\"two way\"===this.bind?\"2\":\"\")+\"bind \"+this.varRef.TwineScript_ToSource()},set:function(e){var t,n=this.varRef.set(e);if(t=i.containsError(n))return t},create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"one way\";return r.isPrototypeOf(e)?e.error?e.error:Object.assign(Object.create(this),{varRef:e,bind:t}):i.create(\"operation\",\"I can only 'bind' a variable, not \"+a(e)+\".\")}})}),define(\"datatypes/assignmentrequest\",[\"utils/operationutils\",\"datatypes/typedvar\",\"datatypes/datatype\",\"internaltypes/varref\",\"internaltypes/twineerror\"],function(e,t,n,r,i){var a=e.objectName,o=e.matches;return Object.freeze({assignmentRequest:!0,TwineScript_TypeName:\"a 'to' or 'into' expression\",TwineScript_ObjectName:\"a 'to' or 'into' expression\",TwineScript_Unstorable:!0,set:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=void 0,c=[],u=function e(s,c){var u,l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],p=[],f=void 0;if(f=c&&r.isPrototypeOf(c)?c.get():c,u=i.containsError(f))return u;if(Array.isArray(f)&&Array.isArray(s)){for(var d=0,h=0;d<s.length&&h<f.length;){var y=s[d],m=f[h];if(t.isPrototypeOf(y)&&y.datatype.rest||n.isPrototypeOf(y)&&y.rest){for(var g=h;h<f.length&&o(y,m);)m=f[h+=1];t.isPrototypeOf(y)?y.datatype=[y.datatype]:n.isPrototypeOf(y)&&(y=n.create(\"array\")),p=p.concat(e(y,r.isPrototypeOf(c)?r.create(c,{first:g+1,last:h+1}):f.slice(g,h)))}else p=p.concat(e(y,r.isPrototypeOf(c)?r.create(c,h+1):m)),h+=1;d+=1}return d<s.length?l&&i.create(\"operation\",\"I can't unpack this array because it needs \"+(s.length-d)+\" more value\"+(s.length-d>0?\"s\":\"\")+\".\"):p}if(s instanceof Map&&f instanceof Map){var v=!0,b=!1,w=void 0;try{for(var T,S=s.entries()[Symbol.iterator]();!(v=(T=S.next()).done);v=!0){var x=_slicedToArray(T.value,2),k=x[0],O=x[1];if(!f.has(k))return l&&i.create(\"operation\",\"I can't unpack this datamap because it needs a '\"+k+\"' data name.\");p=p.concat(e(O,r.isPrototypeOf(c)?r.create(c,k):f.get(k)))}}catch(e){b=!0,w=e}finally{try{!v&&S.return&&S.return()}finally{if(b)throw w}}return p}if(t.isPrototypeOf(s)){if(\"function\"==typeof s.datatype.destructure)return[{dest:s,value:f,src:c}].concat(s.datatype.destructure(f));if(!o(f,s.datatype))return[l&&i.create(\"operation\",\"I can't unpack \"+a(f)+\" into \"+s.varRef.TwineScript_ToSource()+\" because it doesn't match \"+a(s.datatype)+\".\")];p=p.concat(e(s.datatype,f))}return r.isPrototypeOf(s)||t.isPrototypeOf(s)?p.concat({dest:s,value:f,src:c}):\"function\"==typeof s.destructure?p.concat(s.destructure(f)):o(f,s)?p:l&&i.create(\"operation\",\"I tried to unpack, but \"+a(s)+\" in the pattern didn't match \"+a(f)+\".\")}(this.dest,this.src);if(s=i.containsError(u))return s;if(!u.length)return i.create(\"operation\",\"I can't store a new value inside \"+a(this.dest)+\" that isn't in a variable.\",\"You need a variable, or a data structure containing variables at certain positions, to store the value.\");var l=!0,p=!1,f=void 0;try{for(var d,h=u.reverse()[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var y=d.value,m=y.dest,g=y.value,v=y.src;if(t.isPrototypeOf(m)){if(s=i.containsError(m.defineType()))return s;m=m.varRef}if(s=m.set(g),i.isPrototypeOf(s))return s;e&&v&&v.delete(),c.shift(a(m)+\" is now \"+a(g))}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return c.join(\"; \")},create:function(e,t,n){return Object.assign(Object.create(this),{dest:e,src:t,operator:n})}})}),define(\"twinescript/operations\",[\"jquery\",\"state\",\"datatypes/assignmentrequest\",\"utils/operationutils\",\"internaltypes/varref\",\"datatypes/typedvar\",\"datatypes/datatype\",\"internaltypes/twineerror\"],function(e,t,n,r,i,a,o,s){var c=r.isObject,u=r.collectionType,l=r.is,p=r.isA,f=r.clone,d=r.unique,h=r.contains,y=r.matches,m=r.objectName,g=void 0,v=0;function b(e,t,n,r){return n=n||\"do this to\",function(i,a){1===t.length&&(a=i);var o;return(o=s.containsError(i,a))?o:(void 0===i?\"undefined\":_typeof(i))!==e||(void 0===a?\"undefined\":_typeof(a))!==e?s.create(\"operation\",\"I can only \"+n+\" \"+e+\"s, not \"+m((void 0===i?\"undefined\":_typeof(i))!==e?i:a)+\".\",r):t(i,a)}}function w(e){return function(t,n){var r;if(r=s.containsError(t,n))return r;if((void 0===t?\"undefined\":_typeof(t))!==(void 0===n?\"undefined\":_typeof(n))||c(t)&&\"TwineScript_TypeName\"in t&&c(n)&&\"TwineScript_TypeName\"in n&&t.TwineScript_TypeName!==n.TwineScript_TypeName||u(t)!==u(n)){var i=m(t)+\" isn't the same type of data as \"+m(n);return s.create(\"operation\",i[0].toUpperCase()+i.slice(1))}return e(t,n)}}function T(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function r(i,a){var o=void 0;if(o=s.containsError(i,a))return o;v=i;var c=i.determiner?[i,a]:a.determiner?[a,i]:[],u=_slicedToArray(c,2),l=u[0],p=u[1];if(l){var f=l.determiner;if(\"start\"===f||\"end\"===f){if(t)return s.create(\"operation\",\"I can't use '\"+t+\"' with the 'start' or 'end' of \"+m(l)+\".\");if(p.determiner){if(\"start\"===p.determiner||\"end\"===p.determiner)return s.create(\"operation\",\"I can't compare one value's 'start' or 'end' with another value's 'start' or 'end'.\",\"Please change one of them to use an exact range, such as '1stto4th' or '2ndlasttolast'.\");var d=[p,l];l=d[0],p=d[1]}for(var h=l.string||l.array,y=0;y<h.length+1;y+=1){var g=y?\"end\"===f?h.slice(-y):h.slice(0,y):h.constructor(),b=l===i?r(g,a):r(i,g);if(o=s.containsError(b))return o;if(b!==n)return b}return n}var w=\"all\"===f;return l.array.reduce(function(e,t){var n,o=l===i?r(t,a):r(i,t);return(n=s.containsError(e,o))?n:w?e&&o:e||o},w)}return e(i,a)}}function S(e,t){return T(function(t,n){var r=e(t,n);return s.containsError(r)?r:!r},t,!0)}var x=\"If one of these values is a number, you may want to write a check that it 'is not 0'. Also, if one is a string, you may want to write a check that it 'is not \\\"\\\" '.\";return g={create:function(n){var r=Object.create(this);return r.Identifiers={TwineScript_Identifiers:!0,get it(){return v},get time(){return n.stackTop&&n.stackTop.evaluateOnly?s.create(\"operation\",\"'time' can't be used in \"+n.stackTop.evaluateOnly+\".\"):Date.now()-n.timestamp},get visits(){var e=n.stackTop.speculativePassage,r=function(n){return n===(e||t.passage)};return t.pastPassageNames().filter(r).length+t.mockVisits.filter(r).length+(!e||e===t.passage)},get visit(){return r.Identifiers.visits},get exits(){return n.stackTop&&n.stackTop.evaluateOnly?s.create(\"operation\",\"'exit' and 'exits' can't be used in \"+n.stackTop.evaluateOnly+\".\"):n.dom.find(\"tw-enchantment, tw-link\").filter(function(t,n){return e(n).data(\"enchantmentEvent\")||e(n).parent().data(\"linkPassageName\")||e(n).parent().data(\"clickEvent\")}).length},get exit(){return r.Identifiers.exits},get pos(){return n.stackTop&&!n.stackTop.evaluateOnly&&n.stackTop.lambdaPos?+n.stackTop.lambdaPos||1:s.create(\"operation\",\"'pos' can only be used in lambdas that aren't 'when' lambdas.\")}},r},elidedComparisonOperator:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return r.reduce(function(n,r){return\"boolean\"==typeof r?r:g[e](n,g[t](v,r))},\"and\"===e)},and:b(\"boolean\",w(function(e,t){return e&&t}),\"use 'and' to join\",x),or:b(\"boolean\",w(function(e,t){return e||t}),\"use 'or' to join\",x),not:b(\"boolean\",function(e){return!e},\"use 'not' to invert\",x),\"+\":w(function(e,t){if(Array.isArray(e))return[].concat(_toConsumableArray(e),_toConsumableArray(t));var n=void 0;return e instanceof Map?(n=new Map(e),t.forEach(function(e,t){return n.set(t,e)}),n):e instanceof Set?new Set([].concat(_toConsumableArray(e),_toConsumableArray(t)).filter(d).map(f)):\"function\"==typeof e[\"TwineScript_+\"]?e[\"TwineScript_+\"](t):\"string|number|boolean\".includes(void 0===e?\"undefined\":_typeof(e))?e+t:s.create(\"operation\",\"I can't use + on \"+m(e)+\".\")}),\"-\":w(function(e,t){if(Array.isArray(e))return e.filter(function(e){return!t.some(function(t){return l(e,t)})});if(e instanceof Set){var n=[].concat(_toConsumableArray(t));return new Set([].concat(_toConsumableArray(e)).filter(function(e){return!n.some(function(t){return l(e,t)})}))}return\"string\"==typeof e?e.split(t).join(\"\"):\"number\"==typeof e?e-t:s.create(\"operation\",\"I can't use - on \"+m(e)+\".\")}),\"*\":b(\"number\",w(function(e,t){return e*t}),\"multiply\"),\"/\":b(\"number\",w(function(e,t){return 0===t?s.create(\"operation\",\"I can't divide \"+m(e)+\" by zero.\"):e/t}),\"divide\"),\"%\":b(\"number\",w(function(e,t){return 0===t?s.create(\"operation\",\"I can't modulo \"+m(e)+\" by zero.\"):e%t}),\"modulus\"),\"<\":T(b(\"number\",w(function(e,t){return e<t}),\"do < to\"),\"<\"),\">\":T(b(\"number\",w(function(e,t){return e>t}),\"do > to\"),\">\"),\"<=\":T(b(\"number\",w(function(e,t){return e<=t}),\"do <= to\"),\"<=\"),\">=\":T(b(\"number\",w(function(e,t){return e>=t}),\"do >= to\"),\">=\"),is:T(l),isNot:S(l),contains:T(h,\"contains\"),doesNotContain:S(h,\"does not contain\"),isIn:T(function(e,t){return h(t,e)},\"is in\"),isNotIn:S(function(e,t){return h(t,e)},\"is not in\"),isA:T(p,\"is a\"),isNotA:S(p,\"is not a\"),typifies:T(function(e,t){return p(t,e)}),untypifies:S(function(e,t){return p(t,e)}),matches:T(y),doesNotMatch:S(y),where:function(e,t,n){var r;return(r=s.containsError(e))?r:\"boolean\"!=typeof e?s.create(\"operation\",\"This lambda's 'where' clause must evaluate to true or false, not \"+m(e)+\".\"):e?t:n},makeSpreader:function(e){if(a.isPrototypeOf(e)||o.isPrototypeOf(e)){var t=f(e);return(a.isPrototypeOf(e)?t.datatype:t).rest=!0,t}return{value:e,spreader:!0,TwineScript_TypeName:\"a spreaded '...' value\",TwineScript_ObjectName:\"a spreaded '...' value\",TwineScript_Unstorable:!0}},makeAssignmentRequest:function(e,t,r){var i=s.containsError(e,t);return i||n.create(e,t,r)},setIt:function(e){return i.isPrototypeOf(e)||a.isPrototypeOf(e)?(v=e.get(),e):e},initialiseIt:function(e){v=e}},Object.freeze(g)}),define(\"twinescript/environ\",[\"macros\",\"state\",\"utils\",\"datatypes/colour\",\"datatypes/hookset\",\"datatypes/lambda\",\"datatypes/datatype\",\"datatypes/varbind\",\"datatypes/codehook\",\"datatypes/typedvar\",\"internaltypes/varref\",\"internaltypes/twineerror\",\"twinescript/operations\"],function(Macros,State,Utils,Colour,HookSet,Lambda,Datatype,VarBind,CodeHook,TypedVar,VarRef,TwineError,OperationsProto){return function(section){\"object\"===(void 0===section?\"undefined\":_typeof(section))&&section||Utils.impossible(\"TwineScript.environ\",\"no Section argument was given!\");var Operations=OperationsProto.create(section);return section.eval=function(){try{return eval(arguments[0])}catch(e){return e}},section}}),define(\"section\",[\"jquery\",\"utils\",\"renderer\",\"twinescript/environ\",\"twinescript/operations\",\"state\",\"utils/operationutils\",\"utils/renderutils\",\"datatypes/changercommand\",\"datatypes/hookset\",\"datatypes/colour\",\"datatypes/lambda\",\"internaltypes/changedescriptor\",\"internaltypes/varscope\",\"internaltypes/twineerror\",\"internaltypes/twinenotifier\"],function(e,t,n,r,i,a,o,s,c,u,l,p,f,d,h,y){var m,g=o.printBuiltinValue,v=o.objectName,b=o.typeID,w=s.collapse;function T(e,n,r){if(n&&\"object\"===(void 0===n?\"undefined\":_typeof(n))&&c.isPrototypeOf(n)){if(r.data(\"originalSource\",r.popAttr(\"source\")),!this.renderInto(r.data(\"originalSource\"),r,n)){var i=t.insensitiveName(e.attr(\"name\"));if([\"if\",\"elseif\",\"unless\",\"else\",\"testfalse\"].includes(i)&&(e.addClass(\"false\"),\"elseif\"!==i&&(this.stackTop.lastHookShown=!1)),r.data(\"live\")){var a=r.data(\"live\"),o=a.delay,s=a.event;(function(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;a&&t.assertMustHave(a,[\"when\"]);var o=n.data(\"originalSource\")||\"\",s=_slicedToArray(this.stack,1)[0].tempVariables,c=this.whenUnblocked.bind(this,function(){if(r.inDOM()){var t=a&&a.filter(r,[!0],s);h.containsError(t)?t.render(e.attr(\"title\")).replaceAll(e):!a||t[0]?(r.renderInto(o,n,{append:\"replace\"}),t||n.find(\"tw-expression[name='stop']\").length||r.inDOM()&&setTimeout(c,i)):setTimeout(c,i)}});setTimeout(c,i)}).call(this,e,r,o,s)}return}}else{if(!1===n)return r.attr(\"source\")&&(r.data(\"originalSource\",r.popAttr(\"source\")),r.data(\"hidden\",!0)),e.addClass(\"false\"),void(this.stackTop.lastHookShown=!1);!0!==n&&e.replaceWith(h.create(\"datatype\",v(n)+\" cannot be attached to this hook.\",\"Only Booleans and changers can be attached to hooks.\").render(e.attr(\"title\")))}this.stackTop.lastHookShown=!0}function S(t){var n=(t instanceof e?t[0]:t).nextSibling;if(n&&(n instanceof Text&&!n.textContent.trim()||[\"br\",\"tw-consecutive-br\"].includes((n.tagName||\"\").toLowerCase()))){var r=S(n),i=r.whitespace,a=r.nextElem;return{whitespace:e(n).add(i),nextElem:a}}return{whitespace:e(),nextElem:e(n)}}var x={add:[],remove:[]};return m={create:function(e){var n=Object.assign(Object.create(this),{timestamp:Date.now(),dom:e||t.storyElement,stack:[],enchantments:[],unblockCallbacks:[]});return n=r(n)},get stackTop(){return this.stack[0]},inDOM:function(){return e(t.storyElement).find(this.dom).length>0},evaluateTwineMarkup:function(t,n){var r=e(\"<p>\");this.stack.unshift({desc:f.create({target:r,source:t,section:this,append:\"append\"}),tempVariables:this.stackTop.tempVariables,evaluateOnly:n,finalIter:!0}),this.execute();var i;return(i=r.find(\"tw-error\")).length>0?i:r},speculate:function(e,t,n){this.stack.unshift({evaluateOnly:n,finalIter:!0,tempVariables:Object.assign(Object.create(d),{TwineScript_VariableStoreName:n}),speculativePassage:t});var r=void 0;return r=p.isPrototypeOf(e)?e.apply(this,{fail:!1,pass:!0}):this.eval(e),this.stack.shift(),r},renderInto:function(t,n,r){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=f.create({target:n,source:t,section:this,append:\"append\"});if(r)if(c.isPrototypeOf(r)){var s=r.run(o);if(h.containsError(s))return s.render(n.attr(\"title\")).replaceAll(n),!1}else Object.assign(o,r);if((n=o.target,this.stack.length>=50)&&this.stack.reduce(function(e,t){return e+!!t.finalIter},0)>=50)return h.create(\"infinite\",\"Printing this expression may have trapped me in an infinite loop.\").render(n.attr(\"title\")).replaceAll(n),!1;var u=function(t,r,a){var o=n instanceof e&&n.is(\"tw-hook\")&&n.parents(\"tw-collapsed,[collapsing=true]\").length>0;i.stack.unshift({desc:t,finalIter:a,tempVariables:r,collapses:o,evaluateOnly:i.stackTop&&i.stackTop.evaluateOnly})};if(a||(a=Object.create(this.stack.length?this.stackTop.tempVariables:d)),!a.hasOwnProperty(\"TwineScript_VariableStoreName\")){var l=n&&n.tag();a.TwineScript_VariableStoreName=\"tw-hook\"===l?n.attr(\"name\")?\"?\"+n.attr(\"name\"):\"an unnamed hook\":\"tw-expression\"===l?\"a \"+n.attr(\"type\")+\" expression\":\"tw-passage\"===l?\"this passage\":\"an unknown scope\"}return Object.keys(o.loopVars).length?function(){var e=Object.assign({},o.loopVars),t=Math.min.apply(Math,_toConsumableArray(Object.keys(e).map(function(t){return e[t].length})));if(y.create(t+\" loop\"+(1!==t?\"s\":\"\")).render().prependTo(n),t){for(var r=function(n){u(o,Object.keys(e).reduce(function(t,r){return t[r]=e[r][n],t},Object.create(a),n===t-1))},s=t-1;s>=0;s-=1)r(s);for(s=t-1;s>=0&&!i.stackTop.blocked;s-=1)i.execute()}}():(u(o,a,!0),this.execute()),0===this.stack.length&&this.updateEnchantments(),o.enabled},execute:function(){var n=this,r=this.stackTop,a=r.desc,o=r.dom,s=r.collapses,u=r.evaluateOnly;a&&!o&&(o=a.render(),this.stackTop.dom=o,this.stackTop.desc=void 0),o.findAndFilter(\"tw-hook,tw-expression\").each(function(r,a){if(n.stackTop.blocked)return!1;switch((a=e(a)).tag()){case\"tw-hook\":var o=a.popAttr(\"source\")||\"\";if(o&&a.data(\"originalSource\",o),a.data(\"tempVariables\",n.stackTop.tempVariables),a.popAttr(\"hidden\")){a.data(\"hidden\",!0);break}o&&n.renderInto(o,a);break;case\"tw-expression\":if(a.attr(\"blockers\")){if(u)return void a.removeAttr(\"blockers\").removeAttr(\"js\").replaceWith(h.create(\"syntax\",\"I can't use a macro like (prompt:) or (confirm:) in \"+u+\".\",\"Please rewrite this without putting such macros here.\").render(a.attr(\"title\"),a));var s=[];try{s=JSON.parse(a.popAttr(\"blockers\")),a.data(\"blockers\",s)}catch(e){t.impossible(\"Section.execute\",\"JSON.parse blockers failed.\")}}if(a.data(\"blockers\")){var p=a.data(\"blockers\");if(p.length){n.stackTop.blocked=!0;var d=n.eval(p.shift());return h.containsError(d)&&(n.stackTop.blocked=!1,a.removeData(\"blockers\").replaceWith(d.render(a.attr(\"title\"),a))),!1}a.removeData(\"blockers\")}a.attr(\"js\")&&function(n){var r=this.eval(n.popAttr(\"js\")||\"\");this.stackTop.evaluateOnly&&r&&(c.isPrototypeOf(r)||\"function\"==typeof r.TwineScript_Run)&&(r=h.create(\"syntax\",\"I can't work out what \"+this.stackTop.evaluateOnly+\" should evaluate to, because it contains a \"+(c.isPrototypeOf(r)?\"changer.\":\"command.\"),\"Please rewrite this without putting changers or commands here.\"));var a=void 0,o=void 0,s=e();for(o=n;c.isPrototypeOf(r);){var u=S(o);if(a=u.whitespace,(o=u.nextElem)[0]instanceof Text&&\"+\"===o[0].textContent.trim()){var p,d=o,m=S(d);if(p=m.whitespace,(o=m.nextElem).is(\"tw-expression\")){var w=this.eval(o.popAttr(\"js\"));if(h.containsError(w)){r=w;break}var x=i[\"+\"](r,w);e(a).add(d).add(p).remove(),r=h.containsError(x)?h.create(\"operation\",\"I can't combine \"+v(r)+\" with \"+v(w)+\".\",\"function\"==typeof w.TwineScript_Run?\"If you want to attach this changer to \"+v(w)+\", remove the + between them.\":\"Changers can only be added to other changers.\"):x;continue}}if(o.is(\"tw-expression\")){var k=this.eval(o.popAttr(\"js\"));if(h.containsError(k)){r=k;break}if(k&&\"object\"===(void 0===k?\"undefined\":_typeof(k))&&\"function\"==typeof k.TwineScript_Attach){r=k.TwineScript_Attach(this,r);break}return c.isPrototypeOf(k)?void n.replaceWith(h.create(\"operation\",\"Changers like (\"+r.macroName+\":) need to be combined using + between them.\",\"Place the + between the changer macros, or the variables holding them. The + is absent only between a changer and its attached hook or command.\").render(n.attr(\"title\"))):void n.replaceWith(h.create(\"operation\",v(k)+\" can't have changers like (\"+r.macroName+\":) attached.\",\"Changers placed just before hooks, links and commands will attempt to attach, but in this case it didn't work.\").render(n.attr(\"title\")))}if(o.is(\"tw-hook\")){a.remove(),s=o;break}r.macroName||t.impossible(\"Section.runExpression\",\"changer has no macroName\");var O=n.attr(\"title\")||\"(\"+r.macroName+\": ...)\";return void n.replaceWith(h.create(\"syntax\",\"The (\"+r.macroName+\":) changer should be stored in a variable or attached to a hook.\",\"Macros like this should appear before a hook: \"+O+\"[Some text]\").render(n.attr(\"title\")))}n.attr(\"return\",b(r)),s=s.length?s:S(n).nextElem.filter(\"tw-hook\");var j=void 0;if(j=h.containsError(r))j instanceof Error&&(j=h.fromError(j)),n.replaceWith(j.render(n.attr(\"title\"),n));else if(y.isPrototypeOf(r))n.append(r.render());else if(r&&\"function\"==typeof r.TwineScript_Run)if(r=r.TwineScript_Run(this),h.containsError(r))n.replaceWith(r.render(n.attr(\"title\")));else if(f.isPrototypeOf(r)){if(r.data&&r.data.live)return void n.replaceWith(h.create(\"unimplemented\",\"I currently can't attach (live:) or (event:) macros to commands - only hooks.\").render(n.attr(\"title\")));r.section=this,r.target=o,this.renderInto(\"\",o,r)}else{if(\"blocked\"===r)return this.stackTop.blocked=!0,void n.attr(\"js\",\"section.blockedValue()\");r&&t.impossible(\"Section.runExpression\",\"TwineScript_Run() returned a non-ChangeDescriptor \"+(void 0===r?\"undefined\":_typeof(r))+': \"'+r+'\"')}else!s.length&&(\"string\"==typeof r||\"number\"==typeof r||r instanceof Map||r instanceof Set||Array.isArray(r)||l.isPrototypeOf(r))||r&&\"function\"==typeof r.TwineScript_Print&&!c.isPrototypeOf(r)?(r=g(r),h.containsError(r)?(r instanceof Error&&(r=h.fromError(r)),n.replaceWith(r.render(n.attr(\"title\")))):\"string\"!=typeof r?t.impossible(\"printBuiltinValue() produced a non-string \"+(void 0===r?\"undefined\":_typeof(r))):this.renderInto(r,n)):s.length?T.call(this,n,r,s):c.isPrototypeOf(r)||\"boolean\"==typeof r||t.impossible(\"Section.runExpression\",\"The expression evaluated to an unknown value: \"+r)}.call(n,a)}}),this.stackTop.blocked||(o.length&&s&&w(o),o.findAndFilter(\"tw-collapsed,[collapsing=true]\").each(function(){w(e(this))}),this.stack.shift())},updateEnchantments:function(){this.enchantments.forEach(function(e){e.disenchant(),e.enchantScope()})},on:function(e,t){return x[e].push(t),this},addEnchantment:function(e){var t=this;this.enchantments.push(e),x.add.forEach(function(n){return n(t,e)})},removeEnchantment:function(e){var t=this,n=this.enchantments.indexOf(e);this.enchantments.splice(n,1),e.disenchant(),x.remove.forEach(function(n){return n(t,e)})},unblock:function(e){for(this.stack.length||t.impossible(\"Section.unblock\",\"stack is empty\"),this.stackTop.blocked=!1,void 0!==e&&(this.stackTop.blockedValues=(this.stackTop.blockedValues||[]).concat(e));this.stack.length&&!this.stackTop.blocked;)this.execute();if(!this.stack.length)for(;this.unblockCallbacks.length>0;){if(this.unblockCallbacks.shift()(),this.stackTop&&this.stackTop.blocked)return}},whenUnblocked:function(e){this.stack.length&&this.stackTop.blocked?this.unblockCallbacks=this.unblockCallbacks.concat(e):e()},blockedValue:function(){var e=this.stackTop;return e||t.impossible(\"Section.blockedValue\",\"stack is empty\"),e.blockedValues&&e.blockedValues.length||t.impossible(\"Section.blockedValue\",\"blockedValues is missing or empty\"),e.blockedValues.shift()}},Object.preventExtensions(m)}),define(\"engine\",[\"jquery\",\"utils\",\"state\",\"section\",\"passages\"],function(e,t,n,r,i){var a,o=t.escape,s=t.impossible,c=t.passageSelector,u=t.transitionOut,l=Object.create(null);function p(e,t){return\"<tw-include type=\"+e+\" title='\"+o(t.get(\"name\"))+\"'>\"+t.get(\"source\")+\"</tw-include>\"}function f(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.assertOnlyHas(o,[\"stretch\",\"transition\"]);var f=i.get(a),d=t.storyElement,h=d.parent(),y=o.stretch,m=o.transition,g=(m=void 0===m?{}:m).depart,v=void 0===g?\"instant\":g,b=m.arrive,w=void 0===b?\"dissolve\":b,T=m.departOrigin,S=m.arriveOrigin,x=m.time;h.findAndFilter(\"tw-enchantment\").each(function(t,n){var r=(n=e(n)).data(\"enchantedProperties\");r&&d.css(r.reduce(function(e,t){return e[t]=\"\",e},{})),n[0]===h[0]&&(h=d.unwrap().parent())}),i.hasValid(a)||s(\"Engine.showPassage\",\"There's no passage with the name \\\"\"+a+'\"!');var k,O,j,A,C=d.children(c).not(\".transition-out, .transition-out *\"),E=(f.get(\"tags\")||[]).join(\" \"),_=(k=e(\"<tw-passage><tw-sidebar>\"),O=k.children(\"tw-sidebar\"),j=e('<tw-icon tabindex=0 alt=\"Undo\" title=\"Undo\">&#8630;</tw-icon>'),A=e('<tw-icon tabindex=0 alt=\"Redo\" title=\"Redo\">&#8631;</tw-icon>'),n.pastLength<=0&&j.css(\"visibility\",\"hidden\"),n.futureLength<=0&&A.css(\"visibility\",\"hidden\"),O.append(j,A),k);\"function\"==typeof T&&(T=T.call(C)),\"function\"==typeof S&&(S=S.call(_)),d.detach(),_.appendTo(d).attr({tags:E}),!y&&v&&(u(C,v,x,0,0,0,T),C.css(\"position\",\"absolute\")),d.attr({tags:E});var N=r.create(_),P=f.get(\"source\");P=i.getTagged(\"header\").map(p.bind(0,\"header\")).join(\"\")+(l.debug?i.getTagged(\"debug-header\").map(p.bind(0,\"debug-header\")).join(\"\"):\"\")+P+i.getTagged(\"footer\").map(p.bind(0,\"footer\")).join(\"\")+(l.debug?i.getTagged(\"debug-footer\").map(p.bind(0,\"debug-footer\")).join(\"\"):\"\"),n.pastLength<=0&&(l.debug&&(P=i.getTagged(\"debug-startup\").map(p.bind(0,\"debug-startup\")).join(\"\")+P),P=i.getTagged(\"startup\").map(p.bind(0,\"startup\")).join(\"\")+P),N.renderInto(P,_,{transition:w,transitionTime:x,transitionOrigin:S}),h.append(d.parents().length?d.parents().last():d),scroll(0,y?_.offset().top-.05*e(window).height():d.offset().top)}return a={goBack:function(e){n.rewind()&&f(n.passage,e)},goForward:function(e){n.fastForward()&&f(n.passage,e)},goToPassage:function(e,t){n.play(e),f(e,t)},toggleFullscreen:function(){var e=document.documentElement;document.fullscreenElement?document.exitFullscreen():document.msFullscreenElement?document.msExitFullscreen():(e.msRequestFullscreen||e.requestFullscreen).call(e)},showPassage:f,options:l},Object.freeze(a)}),define(\"debugmode/panel\",[\"jquery\"],function(e){return Object.freeze({create:function(t){var n=t.className,r=t.rowAdd,i=t.rowCheck,a=t.columnHead,o=t.tabName,s=t.tabUpdate,c=e(\"<div class='panel panel-\"+n+\"' hidden><table class='panel-rows'></table></div>\"),u=e(\"<button class='tab tab-\"+n+\"'>0 \"+o+\"s</button>\");return u.click(function(){u.toggleClass(\"enabled\"),u.parent().siblings(\".panel\").attr(\"hidden\",\"\"),u.is(\".enabled\")&&(u.siblings(\".tab:not(.tab-\"+n+\")\").removeClass(\"enabled\"),c.removeAttr(\"hidden\"))}),s||(s=function(e){return u.text(e+\" \"+o+(1!==e?\"s\":\"\"))}),Object.assign(Object.create(this),{tabName:o,tab:u,panel:c,panelRows:c.find(\".panel-rows\"),rowAdd:r,rowCheck:i,columnHead:a,tabUpdate:s})},update:function(t,n){var r=this.rowCheck,i=this.rowAdd,a=this.panelRows,o=this.columnHead,s=[],c=a.children();t.forEach(function(t){var n=c.filter(function(n,i){return r(t,e(i))}),o=i(t);n.length?n.replaceWith(o):a.append(o),s.push(o[0])}),c.filter(function(e,t){return!s.includes(t)}).remove(),this.tabUpdate(n),n>0&&!a.find(\".panel-head\").length?a.prepend(o()):0===n&&a.find(\".panel-head\").remove()}})}),define(\"debugmode/mode\",[\"jquery\",\"utils\",\"state\",\"internaltypes/varref\",\"internaltypes/twineerror\",\"utils/operationutils\",\"engine\",\"passages\",\"section\",\"debugmode/panel\"],function(e,t,n,r,i,a,o,s,c,u){var l=t.escape,p=t.nth,f=t.storyElement,d=t.debounce,h=a.objectName,y=a.isObject,m=a.toSource;return function(t,a){var g=e(document.documentElement),v=e(\"<tw-debugger>\\n\\t\\t<div class='panel panel-errors' hidden><table></table></div>\\n\\t\\t<div class='tabs'></div>\\n\\t\\t<label style='user-select:none'>Turns: </label><select class='turns' disabled></select><button class='show-invisibles'>Debug View</button><button class='show-dom'>DOM View</button>\\n\\t\\t<div class='resizer'>\\n\\t\\t</tw-debugger>\"),b=v.find(\".tabs\"),w=v.find(\".show-dom\"),T=v.find(\".show-invisibles\"),S=v.find(\".turns\");v.find(\".resizer\").mousedown(function(e){if(1!==e.which)return!0;e.stopPropagation();var t=e.pageX,n=v.width();g.on(\"mousemove.debugger-resizer\",function(e){var r=e.pageX;v.width((n+t-r|0)+\"px\")}).on(\"mouseup.debugger-resizer\",function(){g.off(\".debugger-resizer\")})}),T.click(function(){g.toggleClass(\"debug-mode\").removeClass(\"dom-debug-mode\"),T.toggleClass(\"enabled\"),w.removeClass(\"enabled\")}),w.click(function(){g.toggleClass(\"dom-debug-mode\").removeClass(\"debug-mode\"),w.toggleClass(\"enabled\"),T.removeClass(\"enabled\")}),n.timelinePassageNames().forEach(function(e,t){S.append(\"<option value=\"+t+\">\"+(t+1)+\": \"+e+\"</option>\")}),S.val(n.pastLength),n.pastLength>0&&S.removeAttr(\"disabled\"),S.change(function(e){var t=e.target.value-n.pastLength;0!==t&&(n[t<0?\"rewind\":\"fastForward\"](Math.abs(t)),o.showPassage(n.passage))}),n.on(\"forward\",function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=n.pastLength;i>=1&&S.removeAttr(\"disabled\"),r?(S.find(\"[selected]\").removeAttr(\"selected\"),S.val(i)):(S.children().each(function(t,n){t>=i&&e(n).remove()}),S.append(\"<option value=\"+i+\">\"+(i+1)+\": \"+t+\"</option>\").val(i))}).on(\"back\",function(){n.pastLength<=1&&S.attr(\"disabled\"),S.find(\"[selected]\").removeAttr(\"selected\"),S.val(n.pastLength)}).on(\"load\",function(e){S.empty(),S[e.length<=1?\"attr\":\"removeAttr\"](\"disabled\"),e.forEach(function(e,t){return S.append(\"<option value=\"+t+\">\"+(t+1)+\": \"+e.passage+\"</option>\")})});var x=new Set,k=u.create({className:\"variables\",tabName:\"Variable\",rowAdd:function(t){var n=t.name,r=t.path,i=t.value,a=t.tempScope,o=t.type,s=y(i)&&i.TwineScript_DebugName?i.TwineScript_DebugName():l(h(i)),c=\"\";r.length&&(c=r.reduce(function(e,t){return e+t+\"'s \"},\"\"));var u=o?m(o):\"\",p=s.length>48&&!i.TwineScript_DebugName,f=\"object\"===(void 0===i?\"undefined\":_typeof(i))||p,d=p?s.slice(0,48)+\"\\u2026\":s;return e('<div class=\"variable-row\">').attr(\"data-name\",n).attr(\"data-path\",r+\"\").attr(\"data-scope\",a||\"\").css(\"padding-left\",Math.min(5,r.length)+\"em\").append(\"<td class='variable-type'>\"+(u?u+\"-type \":\"\")+\"</td>\",\"<td class='variable-name'>\"+(c?\"<span class='variable-path'>\"+(a?\"_\":\"$\")+l(c)+\"</span> \":\"\")+(c?\"\":a?\"_\":\"$\")+l(n+\"\")+\"</td>\",\"<td class='temporary-variable-scope'>\"+(a||\"\")+\"</td>\",\"<td class='variable-value'>\"+d+\"</td><td class='panel-row-buttons'>\"+(f?\"<tw-folddown tabindex=0>(source:) </tw-folddown>\":\"\")+\"</td>\").add(f?\"<tr class='variable-row panel-row-source' style='display:none'><td colspan='5'>\"+l(m(i))+\"</td></tr>\":\"\")},rowCheck:function(e,t){var n=e.name,r=e.path,i=e.tempScope;return t.attr(\"data-name\")===n&&t.attr(\"data-path\")===r+\"\"&&t.attr(\"data-scope\")===i},columnHead:function(){return'<tr class=\"panel-head\"><th>Type</th><th>Name</th><th>Scope</th><th>Value</th></tr>'}}),O=d(function(){var e=[],t=n.variables,r=e.length;function i(t){if(!(e.length>500)){e.push(t);var n=t.path.concat(t.name),r=t.value,a=t.tempScope;Array.isArray(r)?r.forEach(function(e,t){return i({name:p(t+1),path:n,value:e,tempScope:a})}):r instanceof Map?[].concat(_toConsumableArray(r)).forEach(function(e){var t=_slicedToArray(e,2),r=t[0],o=t[1];return i({name:r,path:n,value:o,tempScope:a})}):r instanceof Set&&[].concat(_toConsumableArray(r)).forEach(function(e){return i({name:\"???\",path:n,value:e,tempScope:a})})}}for(var a in t)a.startsWith(\"TwineScript\")||(r+=1,i({name:a,path:[],value:t[a],tempScope:\"\",type:t.TwineScript_TypeDefs&&t.TwineScript_TypeDefs[a]}));e.push.apply(e,_toConsumableArray(x)),r+=x.size,k.update(e,r),k.panel[(r?\"remove\":\"add\")+\"Class\"](\"panel-variables-empty\")}),j=void 0;r.on(\"set\",function(e,t,r){if(e!==n.variables&&e.TwineScript_VariableStoreName){var i=e.TwineScript_VariableStoreName,a=e.TwineScript_TypeDefs&&e.TwineScript_TypeDefs[t],o=[].concat(_toConsumableArray(x)).find(function(e){return e.name===t&&e.tempScope===i});o?o.value=r:x.add({name:t,path:[],value:r,tempScope:i,type:a})}O(),j()}).on(\"delete\",function(){O(),j()}),k.panel.append(\"<div class='panel-variables-bottom'>\\n\\t\\t\\t<button class='panel-variables-copy'>Copy $ variables as (set:) call</button>\\n\\t\\t\\t<input class='clipboard' type=\\\"text\\\" style='opacity:0;pointer-events:none;position:absolute;'></input>\\n\\t\\t</div>\").removeAttr(\"hidden\"),k.tab.addClass(\"enabled\");var A=k.panel.find(\".clipboard\");g.on(\"click\",\".panel-variables-copy\",function(){var e=[];for(var t in n.variables)t.startsWith(\"TwineScript\")||e.push(\"$\"+t+\" to \"+m(n.variables[t]));A.val(\"(set:\"+e+\")\")[0].select(),document.execCommand(\"copy\")});var C=u.create({className:\"enchantments\",tabName:\"Enchantment\",rowAdd:function(t){var n=t.scope,r=t.changer,i=t.name,a=t.localHook,o=void 0;return o=r?l(h(r)):\"<em>enchanted via (\"+i+\":)</em>\",e('<div class=\"enchantment-row\">').data(\"enchantment\",t).append(\"<td><span class='enchantment-name'>\"+m(n)+(a?\"</span><span class=enchantment-local>\"+(a.attr(\"name\")?\"?\"+a.attr(\"name\"):\"an unnamed hook\"):\"\")+\"</span></td><td class='enchantment-value'>\"+o+\"</td>\"+(r?\"<td class='panel-row-buttons'><tw-folddown tabindex=0>(source:)</tw-folddown></td>\":\"\")).add(r?\"<tr class='panel-row-source' style='display:none'><td colspan='3'>\"+l(m(r))+\"</td></tr>\":\"\")},rowCheck:function(e,t){return t.data(\"enchantment\")===e},columnHead:function(){return'<tr class=\"panel-head\"><th>Scope</th><th>Value</th></div>'}}),E=d(function(e){C.update(e.enchantments,e.enchantments.length)});c.on(\"add\",E).on(\"remove\",E);var _=c.create(f),N=u.create({className:\"storylets\",tabName:\"Storylet\",rowAdd:function(t){var n=t.name,r=t.active,i=t.storyletSource,a=t.exclusive,o=t.urgent;return e('<tr class=\"storylet-row '+(r?\"\":\"storylet-closed\")+'\">').attr(\"data-name\",n).append(\"<td class='storylet-name'>\"+n+\"</td><td class='storylet-lambda'>\"+i+\"</td><td class='storylet-exclusive'>\"+a+\"</td><td class='storylet-urgent'>\"+o+\"</td>\")},rowCheck:function(e,t){var n=e.name;return t.attr(\"data-name\")===l(n+\"\")},columnHead:function(){return\"<tr class=\\\"panel-head\\\"><th>Name</th><th>Condition</th><th class='storylet-exclusive'>Exclusivity</th><th class='storylet-urgent'>Urgency</th></tr>\"}});N.tab.hide(),j=d(function(){var e=s.getStorylets(_),t=i.containsError(e),n=s.allStorylets();N.update(n.map(function(n){return{name:n.get(\"name\"),storyletSource:n.get(\"storylet\").TwineScript_ToSource(),active:!t&&e.some(function(e){return e.get(\"name\")===n.get(\"name\")}),exclusive:\"number\"==typeof n.get(\"exclusivity\")?n.get(\"exclusivity\"):0,urgent:\"number\"==typeof n.get(\"urgency\")?n.get(\"urgency\"):0}}),t?0:e.length),N.panel[(t?\"add\":\"remove\")+\"Class\"](\"storylet-error\");var r=n.some(function(e){return e.get(\"exclusivity\")&&\"number\"==typeof e.get(\"exclusivity\")}),a=n.some(function(e){return e.get(\"urgency\")&&\"number\"==typeof e.get(\"urgency\")});N.panel[(r?\"add\":\"remove\")+\"Class\"](\"panel-exclusive\"),N.panel[(a?\"add\":\"remove\")+\"Class\"](\"panel-urgent\"),n.length&&N.tab.show()});var P=u.create({className:\"source\",tabName:\"Source\",rowAdd:e.noop,rowCheck:e.noop,tabUpdate:e.noop,columnHead:e.noop});P.tab.text(\"Source\");var I=u.create({className:\"errors\",tabName:\"Error\",rowAdd:e.noop,rowCheck:e.noop,columnHead:e.noop}),M=function(t,r){if(\"propagated\"!==t.type){I.panelRows.children().length>500&&I.panelRows.children(\":first-child\").remove();var i=e('<tr class=\"error-row\"><td class=\"error-passage\">'+n.passage+'</td><td class=\"error-message\">'+t.message+\"</td></tr>\");i.find(\".error-message\").attr(\"title\",r),I.panelRows.append(i),I.tabUpdate(I.panelRows.children().length)}};function D(){x=new Set,O(),j(),C.panelRows.empty(),C.tabUpdate(0),n.passage&&P.panelRows.text(s.get(n.passage).get(\"source\"))}i.on(\"error\",M),v.prepend(k.panel,C.panel,I.panel,N.panel,P.panel),b.prepend(k.tab,C.tab,I.tab,N.tab,P.tab),n.on(\"forward\",D).on(\"back\",D).on(\"load\",D),t&&(M(t,a),D()),e(document.body).append(v)}}),define(\"macrolib/values\",[\"macros\",\"utils\",\"utils/operationutils\",\"datatypes/colour\",\"datatypes/gradient\",\"datatypes/datatype\",\"datatypes/hookset\",\"internaltypes/twineerror\"],function(e,t,n,r,i,a,o,s){var c=t.realWhitespace,u=t.nth,l=t.anyRealLetter,p=n.subset,f=n.objectName,d=n.clone,h=n.toSource,y=e.TypeSignature,m=y.rest,g=y.zeroOrMore,v=y.either,b=y.optional,w=y.insensitiveSet,T=y.numberRange,S=y.percent,x=y.nonNegativeInteger,k=y.positiveInteger,O=y.Any,j=Math.max,A=Math.min,C=Math.round,E=Math.floor,_=Math.ceil;function N(e){return function(){var t=e.apply(void 0,arguments);return\"number\"!=typeof t||isNaN(t)?s.create(\"macrocall\",\"This mathematical expression doesn't compute!\"):t}}e.add([\"str\",\"string\",\"text\"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.join(\"\")},[g(e.TypeSignature.either(String,Number,Boolean,Array))])(\"source\",function(e,t){return t&&\"command\"===t.TwineScript_TypeID&&!t.TwineScript_ToSource?s.create(\"datatype\",\"I can't construct the source code of a command created by a custom macro.\"):h(t)},[O])(\"substring\",function(e,t,n,r){return p(t,n,r)},[String,parseInt,parseInt])(\"lowercase\",function(e,t){return t.toLowerCase()},[String])(\"uppercase\",function(e,t){return t.toUpperCase()},[String])(\"lowerfirst\",function(e,t){return t.replace(RegExp(l+\"+\"),function(e){return(e=Array.from(e))[0].toLowerCase()+e.slice(1).join(\"\").toLowerCase()})},[String])(\"upperfirst\",function(e,t){return t.replace(RegExp(l+\"+\"),function(e){return(e=Array.from(e))[0].toUpperCase()+e.slice(1).join(\"\").toLowerCase()})},[String])(\"words\",function(e,t){return t.split(RegExp(c+\"+\")).filter(Boolean)},[String])([\"str-repeated\",\"string-repeated\"],function(e,t,n){return 0===n.length?s.create(\"macrocall\",\"I can't repeat an empty string.\"):n.repeat(t)},[x,String])([\"str-reversed\",\"string-reversed\"],function(e,t){return[].concat(_toConsumableArray(t)).reverse().join(\"\")},[String])(\"joined\",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return r.join(t)},[m(String)])(\"plural\",function(e,t,n,r){return n&&\"\"!==r?t+\" \"+(1!==Math.abs(t)?r||n+\"s\":n):s.create(\"macrocall\",\"The (plural:) macro can't be given empty strings.\")},[parseInt,String,b(String)])([\"str-nth\",\"string-nth\"],function(e,t){return u(t)},[parseInt])([\"num\",\"number\"],function(e,t){return Number.isNaN(+t)?s.create(\"macrocall\",\"I couldn't convert \"+f(t)+\" to a number.\"):+t},[String])(\"datatype\",function(e,t){return a.from(t)},[O])(\"datapattern\",function(e,t){return function e(t){var n,r=void 0;return Array.isArray(t)?r=t.map(e):t instanceof Map?(r=new Map,[].concat(_toConsumableArray(t)).forEach(function(t){var n=_slicedToArray(t,2),i=n[0],a=n[1];return r.set(i,e(a))})):r=a.from(t),(n=s.containsError(r))?n:r}(t)},[O])([\"rgb\",\"rgba\"],function(e){return r.create({r:arguments.length<=1?void 0:arguments[1],g:arguments.length<=2?void 0:arguments[2],b:arguments.length<=3?void 0:arguments[3],a:arguments.length<=4?void 0:arguments[4]})},[T(0,255),T(0,255),T(0,255),b(S)])([\"hsl\",\"hsla\"],function(e,t,n,i,a){return(t=C(t)%360)<0&&(t+=360),r.create({h:t,s:n,l:i,a:a})},[Number,S,S,b(S)])([\"lch\",\"lcha\"],function(e,t,n,i,a){return(i=C(i)%360)<0&&(i+=360),r.create({l:t,c:n,h:i,a:a})},[S,T(0,132),Number,b(S)])(\"complement\",function(e,t){return t.LCHRotate(180)},[r])(\"palette\",function(e,t,n){var i=n.toLCHA(),a=i.l,o={l:a<=.75?.75+a/3:.75-3*(1-a),c:80,h:i.h,a:1},s=void 0,c=void 0,u=void 0;return s=r.create(o),o.l+=a<=.75?-.1:.1,o.l<.5&&(o.l*=.5/o.l),c=r.create(o),o.l+=a<=.85?.15:-.15,u=r.create(o),\"adjacent\"===t?(c=(s=s.LCHRotate(-30)).LCHRotate(30),u=s.LCHRotate(60)):\"triad\"===t&&(u=s.LCHRotate(180),c=s.LCHRotate(140),s=s.LCHRotate(-140)),[n,s,c,u]},[w(\"mono\",\"adjacent\",\"triad\"),r])(\"gradient\",function(e,t){for(var n=arguments.length,a=Array(n>2?n-2:0),o=2;o<n;o++)a[o-2]=arguments[o];if((t=C(t)%360)<0&&(t+=360),a.length<4)return s.create(\"datatype\",\"(gradient:) must be given at least 2 colour-stop pairs of numbers and colours.\");var c=void 0,u=[],l=a.reduce(function(e,t){if(s.containsError(e))return e;if(void 0===c)c=t;else{if(\"number\"!=typeof c||!r.isPrototypeOf(t))return s.create(\"datatype\",\"(gradient:) colour-stops should be pairs of numbers and colours, not colours and numbers.\");u.push({stop:c,colour:d(t)}),c=void 0}return e},!0);return s.containsError(l)?l:void 0!==c?s.create(\"macrocall\",\"This gradient has a colour-stop percent without a colour.\"):i.create(t,u)},[Number,m(v(S,r))])(\"stripes\",function(e,t,n){for(var r=arguments.length,a=Array(r>3?r-3:0),o=3;o<r;o++)a[o-3]=arguments[o];(t=C(t)%360)<0&&(t+=360);var s=0,c=[];return a.forEach(function(e){c.push({stop:s,colour:d(e)}),s+=n,c.push({stop:s,colour:d(e)})}),i.create(t,c,!0)},[Number,k,r,m(r)])(\"hooks-named\",function(e,t){return t?o.create({type:\"name\",data:t}):s.create(\"datatype\",\"(hooks-named:) can't be given an empty string.\")},[String])(\"cond\",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=2){var n=arguments.length<=t+1?void 0:arguments[t+1];if(t===(arguments.length<=1?0:arguments.length-1)-1||s.containsError(n))return n;if(\"boolean\"!=typeof n)return s.create(\"datatype\",\"(cond:)'s \"+u(t+1)+\" value is \"+f(n)+\", but should be a boolean.\");if(n)return arguments.length<=t+1+1?void 0:arguments[t+1+1]}return s.create(\"macrocall\",\"An odd number of values must be given to (cond:), not \"+(arguments.length<=1?0:arguments.length-1),\"(cond:) must be given one or more pairs of booleans and values, as well as one final value.\")},[Boolean,O,m(O)]),{weekday:[function(){return[\"Sun\",\"Mon\",\"Tues\",\"Wednes\",\"Thurs\",\"Fri\",\"Satur\"][(new Date).getDay()]+\"day\"},null],monthday:[function(){return(new Date).getDate()},null],currenttime:[function(){var e=new Date,t=e.getHours()<12;return(e.getHours()%12||12)+\":\"+((e.getMinutes()<10?\"0\":\"\")+e.getMinutes())+\" \"+(t?\"A\":\"P\")+\"M\"},null],currentdate:[function(){return(new Date).toDateString()},null],min:[A,m(Number)],max:[j,m(Number)],abs:[Math.abs,Number],sign:[Math.sign,Number],sin:[Math.sin,Number],cos:[Math.cos,Number],tan:[Math.tan,Number],floor:[E,Number],round:[C,Number],trunc:[function(e){return e>0?E(e):_(e)},Number],ceil:[_,Number],pow:[N(Math.pow),[Number,Number]],exp:[Math.exp,Number],sqrt:[N(Math.sqrt),Number],log:[N(Math.log),Number],log10:[N(Math.log10),Number],log2:[N(Math.log2),Number],random:[function(e,t){var n=void 0,r=void 0;return t?(n=A(e,t),r=j(e,t)):(n=0,r=e),r+=1,~~(Math.random()*(r-n))+n},[parseInt,e.TypeSignature.optional(parseInt)]],either:[function(){var e;return e=~~(Math.random()*arguments.length),arguments.length<=e?void 0:arguments[e]},m(O)],nth:[function(e){var t;return e<=0?s.create(\"datatype\",\"(nth:)'s first value should be a positive whole number, not \"+e):(t=(e-1)%(arguments.length<=1?0:arguments.length-1)+1,arguments.length<=t?void 0:arguments[t])},[parseInt,m(O)]],\"\":function(){var t=this;Object.keys(this).forEach(function(n){if(n){var r=t[n][0],i=t[n][1];e.add(n,function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return r.apply(void 0,n)},i)}})}}[\"\"]()}),define(\"macrolib/commands\",[\"jquery\",\"macros\",\"utils\",\"state\",\"passages\",\"renderer\",\"engine\",\"internaltypes/twineerror\",\"internaltypes/twinenotifier\",\"datatypes/assignmentrequest\",\"datatypes/hookset\",\"datatypes/codehook\",\"datatypes/lambda\",\"datatypes/colour\",\"datatypes/gradient\",\"internaltypes/varref\",\"datatypes/typedvar\",\"datatypes/varbind\",\"utils/operationutils\",\"utils/renderutils\"],function(e,t,n,r,i,a,o,s,c,u,l,p,f,d,h,y,m,g,v,b){var w=v.printBuiltinValue,T=v.objectName,S=v.clone,x=v.toSource,k=b.dialog,O=b.geomParse,j=b.geomStringRegExp,A=t.TypeSignature,C=A.Any,E=A.Everything,_=A.rest,N=A.either,P=A.optional,I=A.zeroOrMore,M=A.positiveInteger,D=A.positiveNumber,R=Object.assign,L=Math.floor,q=Math.ceil,F=Math.abs,V=Math.max,H=Math.min,z=e.noop;function $(e){return\"(\"+e+\" \"+o.options.ifid+\") \"}[\"set\",\"put\",\"unpack\"].forEach(function(e){return t.add(e,function(t){for(var n=0;n<(arguments.length<=1?0:arguments.length-1);n+=1){var r=arguments.length<=n+1?void 0:arguments[n+1];if(\"into\"===r.operator&&\"set\"===e)return s.create(\"macrocall\",\"Please say 'to' when using the (set:) macro.\");if(\"to\"===r.operator&&\"set\"!==e)return s.create(\"macrocall\",\"Please say 'into' when using the (put:) or (unpack:) macro.\");if((y.isPrototypeOf(r.dest)||m.isPrototypeOf(r.dest))===(\"unpack\"===e))return s.create(\"macrocall\",\"unpack\"===e?\"Please use the (unpack:) macro with arrays, datamaps or (p:) patterns containing variables to the right of 'into'.\":\"Please use the (\"+e+\":) macro with just single variables and typed variables to the \"+(\"set\"===e?\"left of 'to'.\":\"right of 'into'.\"));var i=r.set();if(s.containsError(i))return i}return{TwineScript_TypeID:\"instant\",TwineScript_TypeName:\"a (\"+e+\":) operation\",TwineScript_ObjectName:\"a (\"+e+\":) operation\",TwineScript_Unstorable:!0,TwineScript_Print:function(){return o.options.debug,\"\"}}},[_(u)])}),t.add(\"move\",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=1){var n=arguments.length<=t+1?void 0:arguments[t+1];if(\"into\"!==n.operator)return s.create(\"macrocall\",\"Please say 'into' when using the (move:) macro.\");var r=n.set(!0);if(s.containsError(r))return r}return{TwineScript_TypeID:\"instant\",TwineScript_TypeName:\"a (move:) operation\",TwineScript_ObjectName:\"a (move:) operation\",TwineScript_Unstorable:!0,TwineScript_Print:function(){return o.options.debug,\"\"}}},[_(u)]),t.addCommand(\"display\",function(e){if(!i.hasValid(e))return s.create(\"macrocall\",\"I can't (display:) the passage '\"+e+\"' because it doesn't exist.\")},function(e,t,r){return R(e,{source:n.unescape(i.get(r).get(\"source\"))})},[String])(\"print\",z,function(e,t,n){return R(e,{source:w(n)})},[C])([\"verbatim-print\",\"v6m-print\"],z,function(e,t,n){return R(e,{verbatim:!0,source:w(n)})},[C])([\"verbatim-source\",\"v6m-source\"],function(e){if(e&&\"command\"===e.TwineScript_TypeID&&!e.TwineScript_ToSource)return s.create(\"datatype\",\"I can't construct the source code of a command created by a custom macro.\")},function(e,t,n){return R(e,{verbatim:!0,source:w(x(n))})},[C])(\"go-to\",function(e){if(!i.hasValid(e))return s.create(\"macrocall\",\"I can't (go-to:) the passage '\"+e+\"' because it doesn't exist.\")},function(e,t,n){return requestAnimationFrame(function(){return o.goToPassage(n,{transition:e.data.passageT8n})}),\"blocked\"},[String])(\"undo\",z,function(e){return r.pastLength<1?s.create(\"macrocall\",\"I can't (undo:) on the first turn.\"):(requestAnimationFrame(function(){return o.goBack({transition:e.data.passageT8n})}),\"blocked\")},[]),n.onStartup(function(){return e(n.storyElement).on(\"click.icon\",\"tw-icon\",function(t){var n=e(this),i=n.data(\"clickEvent\"),a=n.attr(\"alt\");i&&i(n),\"Undo\"===a&&(t.stopPropagation(),o.goBack()),\"Redo\"===a&&(t.stopPropagation(),o.goForward()),\"Fullscreen\"===a&&(t.stopPropagation(),o.toggleFullscreen()),\"Reload\"===a&&(r.hasSessionStorage&&sessionStorage.removeItem(\"Saved Session\"),window.location.reload())})}),[[\"Undo\",\"&#8630;\",function(){return r.pastLength>0}],[\"Redo\",\"&#8631;\",function(){return r.futureLength>0}],[\"Fullscreen\",\"&#9974;\",function(){return document.fullscreenEnabled||document.msFullscreenEnabled}],[\"Restart\",\"&#10226;\",Object]].forEach(function(e){var n=_slicedToArray(e,3),r=n[0],i=n[1],a=n[2];t.addCommand(\"icon-\"+r.toLowerCase(),function(e,t){if(\"string\"==typeof e&&\"string\"==typeof t){var n=[].concat(_toConsumableArray(e)).length,i=[].concat(_toConsumableArray(t)).length;if(n>1&&i>1)return s.create(\"datatype\",\"One of the two strings given to (icon-\"+r.toLowerCase()+\":) should be 1 character long, for its icon.\");if(1===n&&1===i)return s.create(\"datatype\",\"One of the two strings given to (icon-\"+r.toLowerCase()+\":) should be 2 or more characters long, for its label.\")}},function(e,t,n,o){if(\"string\"==typeof o&&1===[].concat(_toConsumableArray(o)).length||\"string\"==typeof n&&[].concat(_toConsumableArray(n)).length>1){var s=[o,n];n=s[0],o=s[1]}return R(e,{source:'<tw-icon tabindex=0 alt=\"'+r+'\" '+(o?'data-label=\"'+o.replace('\"',\"&quot;\")+'\"':\"\")+' title=\"'+r+'\" '+(a()?\"\":'style=\"visibility:hidden\"')+\">\"+(n||i)+\"</tw-icon>\"})},[P(String),P(String)])}),t.addCommand(\"icon-counter\",function(e,t,n){var r=\" label string given to (icon-counter:) can't be empty or only whitespace.\";return t&&t.trim()?\"string\"!=typeof n||n.trim()?void 0:s.create(\"datatype\",\"The 2nd \"+r):s.create(\"datatype\",\"The 1st \"+r)},function(e,t,r,i,a){e.attr.push({\"data-2bind\":!0}),e.data.twoWayBindEvent=function(t,n,o){if(r.varRef.matches(n,o)){var s=r.varRef.get();if(\"number\"==typeof s)e.target.children(\"tw-icon\").text(s>0?L(s):q(s)).attr(\"data-label\",1!==F(s)&&void 0!==a?a:i)}};var o=r.varRef.get();return\"number\"!=typeof o?s.create(\"datatype\",\"(icon-counter:) can only be bound to a variable holding a number, not \"+T(o)+\".\"):R(e,{source:'<tw-icon data-label=\"'+n.escape(1!==F(o)&&void 0!==a?a:i)+'\">'+(o>0?L(o):q(o))+\"</tw-icon>\"})},[g,String,P(String)]),t.addCommand(\"meter\",function(e,t,n,r){return\"string\"!=typeof r||r.trim()?-1===n.search(j)||!n.includes(\"=\")&&n.length>1?s.create(\"datatype\",'The (meter:) macro requires a sizing line(\"==X==\", \"==X\", \"=XXXX=\" etc.) be provided, not '+JSON.stringify(n)+\".\"):void 0:s.create(\"datatype\",\"The label string given to (meter:) can't be empty or only whitespace.\")},function(e,t,n,r,i,a,o){a&&\"string\"!=typeof a&&(o=a,a=void 0),o||(o=d.create({h:0,s:0,l:.5,a:.5})),d.isPrototypeOf(o)&&(o=h.create(90,[{colour:o,stop:0},{colour:o,stop:1}]));var c=O(i),u=c.marginLeft,l=c.size,p=u>0&&Math.ceil(u+l)<100,f=function(e){var t=V(0,H(1,e/r)),n=o.repeating?o:o.multiply(r/e);return\"height:100%;background-repeat:no-repeat;background-image:\"+(p?R(n,n.repeating?{}:{angle:270}).toLinearGradientString()+\", \":\"\")+R(n,n.repeating?{}:{angle:p||0===u?90:270}).toLinearGradientString()+\";background-size:\"+(p?Array(2).fill(50*t+\"%\"):100*t+\"%\")+\";background-position-x:\"+(p?-100/(2-t)+100+\"%,\"+100/(2-t)+\"%\":0===u?\"left\":\"right\")+\";text-align:\"+(p?\"center\":0===u?\"left\":\"right\")};e.styles.push({\"margin-left\":u+\"%\",width:l+\"%\",height:\"1.5em\",display:\"block\"}),e.attr.push({\"data-2bind\":!0});var y=a&&t.stackTop.tempVariables;e.data.twoWayBindEvent=function(t,r,i){if(n.varRef.matches(r,i)){var o=n.varRef.get();if(\"number\"==typeof o){var s=e.target.children(\"tw-meter\");if(s.attr(\"style\",f(o)),a){var c=R({},e,{source:a,target:s,append:\"replace\",transitionDeferred:!1});e.section.renderInto(\"\",null,c,y)}}}};var m=n.varRef.get();return\"number\"!=typeof m?s.create(\"datatype\",\"(meter:) can only be bound to a variable holding a number, not \"+T(m)+\".\"):R(e,{source:'<tw-meter style=\"'+f(m)+'\">'+(a||\"\")+\"</tw-meter>\"})},[g,D,String,P(N(String,d,h)),P(N(d,h))]),[[\"cycling-link\"],[\"seq-link\",\"sequence-link\"]].forEach(function(e,n){return t.addCommand(e,function(){return\"\"===(arguments.length<=0?void 0:arguments[0])?s.create(\"datatype\",\"The first string in a (\"+e[0]+\":) can't be empty.\"):arguments.length<=(g.isPrototypeOf(arguments.length<=0?void 0:arguments[0])?2:1)?s.create(\"datatype\",\"I need two or more strings to \"+(n?\"sequence\":\"cycle\")+\" through, not just '\"+(t=arguments.length-1,arguments.length<=t?void 0:arguments[t])+\"'.\"):void 0;var t},function(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];var o=void 0;g.isPrototypeOf(i[0])&&(o=i.shift());var c=0;if(o&&\"two way\"===o.bind){e.attr.push({\"data-2bind\":!0});var u=i.indexOf(o.varRef.get());u>-1&&(c=u)}var l=t.stackTop.tempVariables;function p(t,r){var a=c>=i.length-1&&n,u=\"\"===i[c]?\"\":a?i[c]:\"<tw-link>\"+i[c]+\"</tw-link>\";if(a&&(e.data.clickEvent=void 0),o&&!r){var p=o.set(i[c]);if(s.containsError(p))return void t.replaceWith(p.render(i[c]))}var f=R({},e,{source:u,transitionDeferred:!1});e.section.renderInto(\"\",null,f,l)}i[c]&&(e.data.clickEvent=function(e){c=(c+1)%i.length,p(e,!1)})&&(e.data.twoWayBindEvent=function(e,t,n){if(o.varRef.matches(t,n)){var r=o.varRef.get(),a=i.indexOf(r);a>-1&&a!==c&&(c=a,p(e,!0))}});var f=\"<tw-link>\"+i[c]+\"</tw-link>\";if(o){var d=o.set(i[c]);if(s.containsError(d))return d}return R(e,{source:f,append:\"replace\",transitionDeferred:!0})},[N(g,String),_(String)])}),n.onStartup(function(){return e(n.storyElement).on(\"change.dropdown-macro\",\"select\",function(){var t=e(this),n=t.closest(\"tw-expression, tw-hook\").data(\"dropdownEvent\");n&&n(t)})}),t.addCommand(\"dropdown\",function(e){var t;return\"\"===(arguments.length<=1?void 0:arguments[1])||\"\"===(t=(arguments.length<=1?0:arguments.length-1)-1+1,arguments.length<=t?void 0:arguments[t])?s.create(\"datatype\",\"The first or last strings in a (dropdown:) can't be empty.\",\"Because empty strings create separators within (dropdown:)s, having them at the start or end doesn't make sense.\"):(arguments.length<=1?0:arguments.length-1)<=1?s.create(\"datatype\",\"I need two or more strings to create a (dropdown:) menu, not just \"+(arguments.length<=1?0:arguments.length-1)+\".\"):void 0},function(t,r,i){for(var a=arguments.length,o=Array(a>3?a-3:0),c=3;c<a;c++)o[c-3]=arguments[c];var u=0;if(\"two way\"===i.bind){t.attr.push({\"data-2bind\":!0});var l=o.indexOf(i.varRef.get());l>-1&&(u=l)}var p=Math.max.apply(Math,_toConsumableArray(o.map(function(e){return[].concat(_toConsumableArray(e)).length}))),f=\"<select>\"+o.map(function(e,t){return\"<option\"+(t===u?\" selected\":\"\")+(\"\"===e?\" disabled\":\"\")+\">\"+n.escape(e||\"\\u2500\".repeat(p))+\"</option>\"}).join(\"\\n\")+\"</select>\";t.data.dropdownEvent=function(e){var t=e.val(),n=i.set(t);s.containsError(n)&&e.replaceWith(n.render(t))},t.data.twoWayBindEvent=function(e,t,n){if(i.varRef.matches(t,n)){var r=i.varRef.get(),a=o.indexOf(r);a>-1&&a!==u&&(e.find(\"select\").val(r),u=a)}},t.styles.push({\"background-color\":function(){return n.parentColours(e(this)).backgroundColour}});var d=i.set(o[u]);return s.containsError(d)?d:R(t,{source:f,append:\"replace\"})},[g,String,_(String)]),n.onStartup(function(){return e(n.storyElement).on(\"input.checkbox-macro\",\"input[type=checkbox]\",function(){var t=e(this),n=t.closest(\"tw-expression\").data(\"checkboxEvent\");n&&n(t)})});var B=1;t.addCommand(\"checkbox\",function(){},function(e,t,n,r){var i=!1,a=\"checkbox-\"+ ++B;if(\"two way\"===n.bind){e.attr.push({\"data-2bind\":!0});var o=n.varRef.get();\"boolean\"==typeof o&&(i=o),e.data.twoWayBindEvent=function(e,t,r){if(n.varRef.matches(t,r)){var i=n.varRef.get();\"boolean\"==typeof i&&e.children(\"input[type=checkbox]\").prop(\"checked\",i)}}}return e.data.checkboxEvent=function(e){var t=e.is(\":checked\"),r=n.set(t);s.containsError(r)&&e.replaceWith(r.render(\"\"))},R(e,{source:'<input id=\"'+a+'\" type=\"checkbox\" '+(i?\"checked\":\"\")+'><label for=\"'+a+'\">'+r+\"</label>\",append:\"replace\"})},[g,String]),n.onStartup(function(){return e(document).on(\"fullscreenchange\",function(){e(\"input[type=checkbox][id^=fullscreen]\",n.storyElement).each(function(t,n){(e(n).closest(\"tw-expression\").data(\"fullscreenEvent\")||Object)(n)})})}),t.addCommand(\"checkbox-fullscreen\",function(){},function(t,n,r){var i=\"fullscreenCheckbox-\"+ ++B;return t.data.fullscreenEvent=function(t){return e(t).prop(\"checked\",!(!document.fullscreenElement&&!document.msFullscreenElement))},t.data.checkboxEvent=function(){return o.toggleFullscreen()},R(t,{source:'<input id=\"'+i+'\" type=\"checkbox\" '+(document.fullscreenEnabled||document.msFullscreenEnabled?\" \":\"disabled \")+(document.fullscreenElement||document.msFullscreenElement?\"checked\":\"\")+'><label for=\"'+i+'\">'+r+\"</label>\",append:\"replace\"})},[String]),n.onStartup(function(){return e(n.storyElement).on(\"input.input-box-macro\",\"textarea\",function(){var t=e(this),n=t.closest(\"tw-expression\").data(\"inputBoxEvent\");n&&n(t)})}),[\"input-box\",\"force-input-box\"].forEach(function(e){return t.addCommand(e,function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=g.isPrototypeOf(n[0]),a=\"number\"==typeof n[1+i],o=\"string\"==typeof n[1+i+a],c=n[+i];if(\"string\"!=typeof c||-1===c.search(j)||!c.includes(\"=\")&&c.length>1)return s.create(\"datatype\",\"The (\"+e+':) macro requires a sizing line(\"==X==\", \"==X\", \"=XXXX=\" etc.) be provided, not '+JSON.stringify(c)+\".\");if(\"force-input-box\"===e&&!o)return s.create(\"datatype\",\"The (\"+e+\":) macro requires a string of text to forcibly input.\");var u=1+i+a+o;return n.length>u?s.create(\"datatype\",\"An incorrect combination of values was given to this (\"+e+\":) macro.\"):void 0},function(t,r){for(var i=arguments.length,a=Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];var c=\"force-input-box\"===e,u=g.isPrototypeOf(a[0]),l=\"number\"==typeof a[1+u],p=u&&a[0],f=l?a[1+u]:3,d=O(a[+u]),h=d.marginLeft,y=d.size,m=\"string\"==typeof a[1+u+l]?a[1+u+l]:\"\",v=c?\"\":m;if(\"two way\"===p.bind){t.attr.push({\"data-2bind\":!0});var b=p.varRef.get();if(\"string\"==typeof b){v=c?m.slice(0,b.length):b;var w=p.set(v);if(s.containsError(w))return w}t.data.twoWayBindEvent=function(e,t,n){if(p.varRef.matches(t,n)){var r=p.varRef.get();\"string\"==typeof r&&e.find(\"textarea\").val(c?m.slice(0,r.length):r)}}}else if(p){var T=p.set(c?\"\":m);if(s.containsError(T))return T}c||(t.data.inputBoxEvent=function(e){var t=e.val(),n=p.set(t);s.containsError(n)&&e.replaceWith(n.render(\"\"))});var S='<textarea style=\"width:100%\" rows='+f+\">\"+n.escape(v)+\"</textarea>\";if(c){var x=Array.from(m);t.data.inputBoxEvent=function(e){var t=e.val().length,n=x.slice(0,t).join(\"\");if(e.val(n),p){var r=p.set(n);s.containsError(r)&&e.replaceWith(r.render(\"\"))}return!0}}return t.styles.push({display:\"block\",\"margin-left\":h+\"%\",width:y+\"%\",\"border-style\":function(){return this.style.borderStyle||\"solid\"}}),R(t,{source:S,append:\"replace\"})},[N(g,String),P(N(M,String)),P(N(M,String)),P(String)])}),[\"show\",\"rerun\"].forEach(function(n){return t.addCommand(n,z,function(t,r){for(var i=arguments.length,a=Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];return a.forEach(function(i){return i.forEach(r,function(i){var a=i.data(\"hidden\");if(void 0!==a!=(\"rerun\"===n))if(i.removeData(\"hidden\"),a instanceof e)i.empty().append(a);else{var o=i.data(\"tempVariables\");r.renderInto(\"\",null,R({},t,{append:\"replace\",source:i.data(\"originalSource\")||\"\",target:i}),o&&Object.create(o))}})}),t},[_(l)])});var W=function(e){return[\"I can't use a dialog macro in \"+e+\".\",\"Please rewrite this without putting such macros here.\"]};t.addCommand(\"hide\",z,function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach(function(t){return t.forEach(e,function(e){Boolean(e.data(\"hidden\"))||e.data(\"hidden\",e.contents().detach())})})},[_(l)],!1)(\"stop\",z,z,[],!1)(\"load-game\",z,function(e,t){var n=localStorage.getItem($(\"Saved Game\")+t);if(!n)return s.create(\"saving\",\"I can't find a save slot named '\"+t+\"'!\");var i=r.deserialise(e,n);if(i instanceof Error){var a=k({message:\"Sorry to interrupt... The story tried to load saved data, but there was a problem.\\n\"+i.message+\"\\n\\nThat data might have been saved from a different version of this story. Should I delete it?\\n(Type 'delete' and choose Yes to delete it.)\\n\\nEither way, the story will now continue without loading the data.\",defaultValue:\"\",buttons:[{name:\"Yes\",confirm:!0,callback:function(){\"delete\"===a.find(\"input\").last().val()&&localStorage.removeItem($(\"Saved Game\")+t),e.unblock(\"\")}},{name:\"No\",cancel:!0,callback:function(){return e.unblock()}}]});return\"blocked\"}requestAnimationFrame(o.showPassage.bind(o,r.passage,!1))},[String],!1)(\"mock-visits\",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!o.options.debug)return s.create(\"operation\",\"(mock-visits:) cannot be used outside of debug mode.\",\"This macro is not meant to be used outside of debugging your story.\");var r=t.find(function(e){return!i.hasValid(e)});return r?s.create(\"datatype\",\"I can't mock-visit '\"+r+\"' because no passage with that name exists.\"):void 0},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];r.mockVisits=S(n)},[_(String)],!1)([\"dialog\",\"alert\"],function(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];if(g.isPrototypeOf(e)){if(\"two way\"===e.bind)return s.create(\"datatype\",\"(dialog:) shouldn't be given two-way bound variables.\");if(void 0===t)return s.create(\"datatype\",\"(dialog:) needs a message string to display.\")}else void 0!==t&&i.unshift(t);var o=i.findIndex(function(e){return\"\"===e});if(o>-1)return s.create(\"datatype\",\"(dialog:)'s \"+n.nth(o+1)+\" link text shouldn't be an empty string.\")},function(e,t,n,r){for(var i=arguments.length,a=Array(i>4?i-4:0),o=4;o<i;o++)a[o-4]=arguments[o];return g.isPrototypeOf(n)||(void 0!==r&&a.unshift(r),r=n,n=void 0),a.length||(a=[\"OK\"]),k({section:t,message:r,cd:e,buttons:a.map(function(e){return{name:e,callback:function(){t.unblock(n&&n.set(e)||\"\")}}})}),\"blocked\"},[N(g,String),I(String)])(\"open-url\",z,function(e,t){window.open(t,\"\")},[String],!1)([\"restart\",\"reload\"],z,function(){if(r.pastLength<1)return s.create(\"infinite\",\"I mustn't (restart:) the story in the starting passage.\");r.hasSessionStorage&&sessionStorage.removeItem(\"Saved Session\"),window.location.reload()},[],!1)(\"goto-url\",z,function(e,t){window.location.assign(t)},[String],!1)(\"ignore\",z,z,[I(E)])(\"assert-exists\",function(e){if(\"\"===e)return s.create(\"datatype\",\"(assert-exists:) mustn't be given an empty string.\")},function(e,t,n){var r=0;return(\"string\"==typeof n?l.create({type:\"string\",data:n}):n).forEach(t,function(){++r}),r?e:s.create(\"assertion\",\"I didn't see any \"+(\"string\"==typeof n?\"text occurrences of\":\"hooks matching\")+\" \"+x(n)+\" in this passage.\")},[N(l,String)]),t.add(\"assert\",function(e,t){return t?{TwineScript_TypeID:\"instant\",TwineScript_TypeName:\"an (assert:) operation\",TwineScript_ObjectName:\"an (assert:) operation\",TwineScript_Unstorable:!0,TwineScript_Print:function(){return\"\"}}:R(s.create(\"assertion\",\"An assertion failed: \"),{appendTitleText:!0})},[Boolean])(\"save-game\",function(e,t,n){if(n=n||\"\",!r.hasStorage)return!1;var i=r.serialise();if(s.containsError(i))return i;if(!1===i)return!1;try{return localStorage.setItem($(\"Saved Game\")+t,i),localStorage.setItem($(\"Saved Game Filename\")+t,n),!0}catch(e){return!1}},[String,P(String)])(\"prompt\",function(e,t,n,r,i){if(e.stackTop&&e.stackTop.evaluateOnly)return s.create.apply(s,[\"macrocall\"].concat(_toConsumableArray(W(e.stackTop.evaluateOnly))));if(\"\"===i)return s.create(\"datatype\",\"The text for (prompt:)'s confirm link can't be blank.\");var a=k({section:e,message:t,defaultValue:n,buttons:[{name:i||\"OK\",confirm:!0,callback:function(){return e.unblock(a.find(\"input\").last().val())}},{name:r||\"Cancel\",cancel:!0,callback:function(){return e.unblock(n)}}]});setTimeout(function(){return a.find(\"input\").last().focus()},100)},[String,String,P(String),P(String)])(\"confirm\",function(e,t,n,r){return e.stackTop&&e.stackTop.evaluateOnly?s.create.apply(s,[\"macrocall\"].concat(_toConsumableArray(W(e.stackTop.evaluateOnly)))):\"\"===r?s.create(\"datatype\",\"The text for (confirm:)'s confirm link can't be blank.\"):void k({section:e,message:t,defaultValue:!1,buttons:[{name:r||\"OK\",confirm:!0,callback:function(){return e.unblock(!0)}},{name:n||\"Cancel\",cancel:!0,callback:function(){return e.unblock(!1)}}]})},[String,P(String),P(String)])(\"page-url\",function(){return window.location.href},[]),a.options.blockerMacros.push(\"prompt\",\"confirm\")}),define(\"macrolib/datastructures\",[\"jquery\",\"utils\",\"utils/naturalsort\",\"macros\",\"utils/operationutils\",\"state\",\"engine\",\"passages\",\"datatypes/lambda\",\"datatypes/datatype\",\"datatypes/typedvar\",\"internaltypes/varref\",\"internaltypes/twineerror\"],function(e,t,n,r,i,a,o,s,c,u,l,p,f){var d=t.shuffled,h=t.permutations,y=i.objectName,m=i.subset,g=i.collectionType,v=i.isValidDatamapName,b=i.is,w=i.unique,T=i.clone,S=i.range,x=r.TypeSignature,k=x.optional,O=x.rest,j=x.either,A=x.zeroOrMore,C=x.Any,E=x.nonNegativeInteger;r.add([\"a\",\"array\"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n},A(j(l,C)))(\"range\",function(e,t,n){return S(t,n)},[parseInt,parseInt])(\"subarray\",function(e,t,n,r){return m(t,n,r)},[Array,parseInt,parseInt])(\"reversed\",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reverse().map(T)},A(C))(\"shuffled\",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return d.apply(void 0,n).map(T)},[C,O(C)])(\"sorted\",function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return r.sort(n(\"en\"))},[j(Number,String),O(j(Number,String))])(\"rotated\",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===(t*=-1)?f.create(\"macrocall\",\"I can't rotate these values by 0 positions.\"):Math.abs(t)>=r.length?f.create(\"macrocall\",\"I can't rotate these \"+r.length+\" values by \"+t+\" positions.\"):r.slice(t).concat(r.slice(0,t)).map(T)},[parseInt,C,O(C)])(\"rotated-to\",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=t.filter(e,r);if(f.containsError(a))return a;if(!a.length)return f.create(\"macrocall\",\"None of these \"+r.length+\" values matched the lambda, so I can't rotate them.\");var o=r.indexOf(a[0]);return r.slice(o).concat(r.slice(0,o)).map(T)},[c.TypeSignature(\"where\"),C,O(C)])(\"repeated\",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];for(var a=[];t-- >0;)a.push.apply(a,r);return a.map(T)},[E,O(C)])(\"interlaced\",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=Math.min.apply(Math,_toConsumableArray(n.map(function(e){return e.length}))),a=[],o=0;o<i;o+=1)for(var s=0;s<n.length;s+=1)a.push(T(n[s][o]));return a},[Array,O(Array)])(\"permutations\",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.length?h.apply(void 0,n):[]},[A(C)]),r.add(\"altered\",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return r.map(function(n,r){return t.apply(e,{loop:n,pos:r+1})})},[c.TypeSignature(\"via\"),A(C)])(\"find\",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return t.filter(e,r)},[c.TypeSignature(\"where\"),A(C)])([\"all-pass\",\"pass\"],function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=t.filter(e,r);return f.containsError(a)||a.length===r.length},[c.TypeSignature(\"where\"),A(C)])(\"some-pass\",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=t.filter(e,r);return f.containsError(a)||a.length>0},[c.TypeSignature(\"where\"),A(C)])(\"none-pass\",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=t.filter(e,r);return f.containsError(a)||0===a.length},[c.TypeSignature(\"where\"),A(C)])(\"folded\",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return\"where\"in t&&(r=t.filter(e,r)),f.containsError(r)||r.reduce(function(n,r,i){return t.apply(e,{making:n,loop:r,pos:i+1})})},[j(c.TypeSignature(\"where\",\"via\",\"making\"),c.TypeSignature(\"via\",\"making\")),O(C)]),r.add(\"datanames\",function(e,t){return Array.from(t.keys()).sort(n(\"en\"))},[Map])(\"datavalues\",function(e,t){return Array.from(t.entries()).sort(n(\"en\",function(e){return String(e[0])})).map(function(e){return T(e[1])})},[Map])(\"dataentries\",function(e,t){return Array.from(t.entries()).sort(function(e,t){return[e[0],t[0]].sort(n(\"en\"))[0]===e[0]?-1:1}).map(function(e){return new Map([[\"name\",e[0]],[\"value\",T(e[1])]])})},[Map])(\"history\",function(e,t){var n=a.mockVisits.concat(a.pastPassageNames());if(!t)return n;var r=t.filter(e,n.map(function(e){return s.get(e)}));return f.containsError(r)?r:r.map(function(e){return e.get(\"name\")})},[k(c.TypeSignature(\"where\"))])(\"passage\",function(e,t){return T(s.get(t||a.passage))||f.create(\"macrocall\",\"There's no passage named '\"+t+\"' in this story.\")},[k(String)])(\"passages\",function(e,t){var r=n(\"en\"),i=[].concat(_toConsumableArray(s.values())).map(function(e){return T(e)}),a=t?t.filter(e,i):i,o=f.containsError(a);return o||a.sort(function(e,t){return r(e.get(\"name\"),t.get(\"name\"))})},[k(c.TypeSignature(\"where\"))])(\"open-storylets\",function(e,t){if(e.stackTop.evaluateOnly)return f.create(\"macrocall\",\"(open-storylets:) can't be used in \"+e.stackTop.evaluateOnly+\".\");var n=s.getStorylets(e,t),r=f.containsError(n);return r||n.map(T)},[k(c.TypeSignature(\"where\"))])(\"savedgames\",function(){function e(e){return\"(\"+e+\" \"+o.options.ifid+\") \"}var t=0,n=void 0,r=new Map;do{if(!a.hasStorage)break;n=localStorage.key(t),t+=1;var i=e(\"Saved Game\");n&&n.startsWith(i)&&(n=n.slice(i.length),r.set(n,localStorage.getItem(e(\"Saved Game Filename\")+n)))}while(n);return r},[])([\"datamap\",\"dm\"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=void 0,a=new Map,o=n.reduce(function(e,t){var n=void 0;if(f.containsError(e))return e;if(void 0===i)i=t;else{if(n=f.containsError(v(a,i)))return n;if(a.has(i))return f.create(\"macrocall\",\"You used the same data name (\"+y(i)+\") twice in the same (datamap:) call.\");a.set(i,T(t)),i=void 0}return e},!0);return f.containsError(o)?o:void 0!==i?f.create(\"macrocall\",\"This datamap has a data name without a value.\"):a},A(j(l,C)))([\"dataset\",\"ds\"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new Set(n.filter(w).map(T))},A(C))(\"count\",function e(t,n){for(var r=arguments.length,i=Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];if(i.length>1){var o,s=i.map(function(r){return e(t,n,r)});return(o=f.containsError(s))?o:s.reduce(function(e,t){return e+t},0)}var c=i[0];switch(g(n)){case\"dataset\":case\"datamap\":return f.create(\"macrocall\",\"(count:) shouldn't be given a datamap or dataset.\",\"You should use the 'contains' operator instead. For instance, write: $variable contains 'value'.\");case\"string\":return\"string\"!=typeof c?f.create(\"macrocall\",y(n)+\" can't contain  \"+y(c)+\" because it isn't also a string.\"):c?n.split(c).length-1:0;case\"array\":return n.reduce(function(e,t){return e+b(t,c)},0);default:return f.create(\"macrocall\",y(n)+\" can't contain values, let alone \"+y(c)+\".\")}},[C,O(C)])}),define(\"macrolib/stylechangers\",[\"jquery\",\"macros\",\"utils\",\"utils/renderutils\",\"datatypes/colour\",\"datatypes/hookset\",\"datatypes/gradient\",\"datatypes/changercommand\",\"datatypes/lambda\",\"internaltypes/changedescriptor\",\"internaltypes/twineerror\"],function(e,t,n,r,i,a,o,s,c,u,l){var p=r.geomParse,f=r.geomStringRegExp,d=Object.assign,h=t.TypeSignature,y=h.either,m=h.wrapped,g=h.optional,v=h.Any,b=h.Everything,w=h.zeroOrMore,T=h.rest,S=h.insensitiveSet,x=h.positiveNumber,k=h.positiveInteger,O=h.nonNegativeNumber,j=h.percent,A=[m(Boolean,'If you gave a number, you may instead want to check that the number is not 0. If you gave a string, you may instead want to check that the string is not \"\".')];n.onStartup(function(){return e(n.storyElement).on(\"mouseenter.hover-macro\",\"[hover=false]\",function(){var t=e(this),n=t.data(\"hoverChanger\");t.data({mouseoutStyle:t.attr(\"style\")||\"\"}),u.create({target:t},n).update(),t.attr(\"hover\",!0)}).on(\"mouseleave.hover-macro\",\"[hover=true]\",function(){var t=e(this),n=t.data(\"mouseoutStyle\");t.attr(\"style\",n).removeData(\"mouseoutStyle\").attr(\"hover\",!1)})});var C,E,_=S(\"instant\",\"dissolve\",\"fade\",\"rumble\",\"shudder\",\"pulse\",\"zoom\",\"flicker\",\"slideleft\",\"slideright\",\"slideup\",\"slidedown\",\"fadeleft\",\"faderight\",\"fadeup\",\"fadedown\",\"blur\"),N=S(\"dotted\",\"dashed\",\"solid\",\"double\",\"groove\",\"ridge\",\"inset\",\"outset\",\"none\");t.addChanger(\"if\",function(e,t){return s.create(\"if\",[t])},function(e,t){return e.enabled=e.enabled&&t},A)(\"unless\",function(e,t){return s.create(\"unless\",[t])},function(e,t){return e.enabled=e.enabled&&!t},A)(\"elseif\",function(e,t){return\"lastHookShown\"in e.stack[0]?s.create(\"elseif\",[!1===e.stack[0].lastHookShown&&!!t]):l.create(\"macrocall\",\"There's no (if:) or something else before this to do (else-if:) with.\")},function(e,t){return e.enabled=e.enabled&&t},A)(\"else\",function(e){return\"lastHookShown\"in e.stack[0]?s.create(\"else\",[!1===e.stack[0].lastHookShown]):l.create(\"macrocall\",\"There's nothing before this to do (else:) with.\")},function(e,t){return e.enabled=e.enabled&&t},null)(\"hidden\",function(){return s.create(\"hidden\")},function(e){return e.enabled=!1},null)([\"verbatim\",\"v6m\"],function(){return s.create(\"verbatim\")},function(e){return e.verbatim=!0},null)(\"live\",function(e,t){return s.create(\"live\",[t])},function(e,t){e.enabled=!1,e.data.live={delay:t}},g(Number))(\"event\",function(e,t){return s.create(\"event\",[t])},function(e,t){e.enabled=!1,e.data.live={event:t}},c.TypeSignature(\"when\"))(\"more\",function(){return s.create(\"more\")},function(e){e.enabled=!1,e.data.live={event:{when:!0,filter:function(e){return 0!==e.eval(\"Operations\").Identifiers.exits?[]:[!0]}}}},null)(\"after\",function(e,t,n){return s.create(\"after\",[t].concat(void 0!==n?[n]:[]))},function(e,t,r){e.enabled=!1,e.data.live={event:{when:!0,filter:function(e){return n.anyInputDown()&&(t-=r),e.eval(\"Operations\").Identifiers.time>t?[!0]:[]}}}},[x,g(O)])(\"hook\",function(e,t){return t?s.create(\"hook\",[t]):l.create(\"datatype\",\"(hook:) names can't be empty strings.\")},function(e,t){return e.attr.push({name:t})},[String])([\"for\",\"loop\"],function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return t.loop?s.create(\"for\",[t].concat(r)):l.create(\"datatype\",\"The lambda provided to (for:) must refer to a temp variable, not just 'it'.\")},function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a,o=t.filter(e.section,r);if(a=l.containsError(o))return a;e.loopVars[t.loop.getName()]=o||[]},[c.TypeSignature(\"where\"),w(v)])([\"transition\",\"t8n\"],function(e,t){return s.create(\"transition\",[n.insensitiveName(t)])},function(t,r){return t.transition=r,\"zoom\"===r&&(t.transitionOrigin=function(){var t=e(this).offset(),r=t.left,i=t.top;return n.mouseCoords.x-r+\"px \"+(n.mouseCoords.y-i)+\"px\"}),t},[_])([\"transition-time\",\"t8n-time\"],function(e,t){return s.create(\"transition-time\",[t])},function(e,t){return e.transitionTime=t,e.data.passageT8n=d(e.data.passageT8n||{},{time:t}),e},[x])([\"transition-delay\",\"t8n-delay\"],function(e,t){return s.create(\"transition-delay\",[t])},function(e,t){return e.transitionDelay=t,e},[O])([\"transition-skip\",\"t8n-skip\"],function(e,t){return s.create(\"transition-skip\",[t])},function(e,t){return e.transitionSkip=t,e},[x])([\"transition-depart\",\"t8n-depart\"],function(e,t){return s.create(\"transition-depart\",[n.insensitiveName(t)])},function(t,r){return t.data.passageT8n=d(t.data.passageT8n||{},{depart:r}),\"zoom\"===r&&(t.data.passageT8n.departOrigin=function(){var t=e(this).offset(),r=t.left,i=t.top;return n.mouseCoords.x-r+\"px \"+(n.mouseCoords.y-i)+\"px\"}),t},[_])([\"transition-arrive\",\"t8n-arrive\"],function(e,t){return s.create(\"transition-arrive\",[n.insensitiveName(t)])},function(t,r){return t.data.passageT8n=d(t.data.passageT8n||{},{arrive:r}),\"zoom\"===r&&(t.data.passageT8n.arriveOrigin=function(){var t=e(this),r=t.offset(),i=r.left,a=r.top,o=t.height();return{\"transform-origin\":100*(n.mouseCoords.x-i)/t.width()+\"% \"+100*(n.mouseCoords.y-a)/o+\"%\",height:o+\"px\"}}),t},[_])(\"button\",function(){return s.create(\"button\",[])},function(e){return e.attr.push({class:function(){return this.className+(this.classList.contains(\"enchantment-button\")?\"\":\" \".repeat(this.className.length>0)+\"enchantment-button\")}}),e},[])([\"border\",\"b4r\"],function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return s.create(\"border\",r.map(n.insensitiveName))},function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t.styles.push({display:function(){var t=e(this).css(\"display\");return r.every(function(e){return\"none\"===e})||!t.includes(\"inline\")?t:\"inline-block\"},\"border-style\":r.join(\" \"),\"border-width\":function(){return this.style.borderWidth||\"2px\"}}),t},[N].concat(_toConsumableArray(Array(3).fill(g(N)))))([\"border-size\",\"b4r-size\"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.create(\"border-size\",n)},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({\"border-width\":n.map(function(e){return e+\"px\"}).join(\" \")}),e},[O].concat(_toConsumableArray(Array(3).fill(g(O)))))(\"corner-radius\",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.create(\"corner-radius\",n)},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({\"border-radius\":n.map(function(e){return e+\"px\"}).join(\" \"),padding:function(){return this.style.padding||n.map(function(e){return e+\"px\"}).join(\" \")}}),e},[O].concat(_toConsumableArray(Array(3).fill(g(O)))))([\"border-colour\",\"b4r-colour\",\"border-color\",\"b4r-color\"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.create(\"border-colour\",n.map(function(e){return i.isPrototypeOf(e)?e.toRGBAString(e):e}))},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({\"border-color\":n.join(\" \")}),e},[y(String,i)].concat(_toConsumableArray(Array(3).fill(g(y(String,i))))))(\"opacity\",function(e,t){return s.create(\"opacity\",[t])},function(e,t){return e.styles.push({opacity:t})},[j])(\"font\",function(e,t){return s.create(\"font\",[t])},function(e,t){return e.styles.push({\"font-family\":t}),e},[String])(\"align\",function(e,t){var n=void 0,r=t.indexOf(\"><\");if(!/^(==+>|<=+|=+><=+|<==+>)$/.test(t))return l.create(\"datatype\",'The (align:) macro requires an alignment arrow (\"==>\", \"<==\", \"==><=\" etc.) be provided, not \"'+t+'\"');if(~r){var i=Math.round(r/(t.length-2)*50);n=d({\"text-align\":\"center\",\"max-width\":\"50%\"},25===i?{\"margin-left\":\"auto\",\"margin-right\":\"auto\"}:{\"margin-left\":i+\"%\"})}else n=\"<\"===t[0]&&\">\"===t.slice(-1)?{\"text-align\":\"justify\",\"max-width\":\"50%\"}:t.includes(\">\")?{\"text-align\":\"right\"}:{\"text-align\":\"left\"};return n.display=\"inline-block\",s.create(\"align\",[n])},function(e,t){e.styles.push(t)},[String])([\"text-colour\",\"text-color\",\"color\",\"colour\"],function(e,t){return s.create(\"text-colour\",[t])},function(e,t){return i.isPrototypeOf(t)&&(t=t.toRGBAString(t)),e.styles.push({color:t}),e},[y(String,i)])([\"text-size\",\"size\"],function(e,t){return s.create(\"text-size\",[t])},function(e,t){return e.styles.push({\"font-size\":24*t+\"px\",\"line-height\":36*t+\"px\"}),e},[O])(\"text-indent\",function(e,t){return s.create(\"text-indent\",[t])},function(e,t){return e.styles.push({\"text-indent\":t+\"px\",display:\"inline-block\"}),e},[O])([\"text-rotate-z\",\"text-rotate\"],function(e,t){return s.create(\"text-rotate-z\",[t])},function(t,n){return t.styles.push({display:\"inline-block\",transform:function(){var t=e(this).css(\"transform\")||\"\";return\"none\"===t&&(t=\"\"),t+\" rotate(\"+n+\"deg)\"}}),t},[Number])(\"text-rotate-y\",function(e,t){return s.create(\"text-rotate-y\",[t])},function(t,n){return t.styles.push({display:\"inline-block\",transform:function(){var t=e(this).css(\"transform\")||\"\";return\"none\"===t&&(t=\"\"),t+\" perspective(50vw) rotateY(\"+n+\"deg)\"}}),t},[Number])(\"text-rotate-x\",function(e,t){return s.create(\"text-rotate-x\",[t])},function(t,n){return t.styles.push({display:\"inline-block\",transform:function(){var t=e(this).css(\"transform\")||\"\";return\"none\"===t&&(t=\"\"),t+\" perspective(50vw) rotateX(\"+n+\"deg)\"}}),t},[Number])([\"background\",\"bg\"],function(e,t){return s.create(\"background\",[t])},function(t,r){var a=void 0;return i.isPrototypeOf(r)?r=r.toRGBAString(r):o.isPrototypeOf(r)&&(r=r.toLinearGradientString(r)),a=i.isHexString(r)||i.isCSS3Function(r)?{\"background-color\":r}:r.startsWith(\"linear-gradient(\")||r.startsWith(\"repeating-linear-gradient(\")?{\"background-image\":r}:{\"background-size\":\"cover\",\"background-image\":\"url(\"+r+\")\"},t.styles.push(a,{display:function(){var t=e(this);return!t.children().length||n.childrenProbablyInline(t)?e(this).css(\"display\"):\"block\"}}),t},[y(String,i,o)]).apply(void 0,_toConsumableArray((C={color:function(){return\"transparent\"}},E=d(Object.create(null),{none:{},bold:{\"font-weight\":\"bold\"},italic:{\"font-style\":\"italic\"},underline:{\"text-decoration\":\"underline\"},doubleunderline:{\"text-decoration\":\"underline\",\"text-decoration-style\":\"double\"},wavyunderline:{\"text-decoration\":\"underline\",\"text-decoration-style\":\"wavy\"},strike:{\"text-decoration\":\"line-through\"},doublestrike:{\"text-decoration\":\"line-through\",\"text-decoration-style\":\"double\"},wavystrike:{\"text-decoration\":\"line-through\",\"text-decoration-style\":\"wavy\"},superscript:{\"vertical-align\":\"super\",\"font-size\":\".83em\"},subscript:{\"vertical-align\":\"sub\",\"font-size\":\".83em\"},blink:{animation:\"fade-in-out 1s steps(1,end) infinite alternate\"},shudder:{animation:\"shudder linear 0.1s 0s infinite\"},mark:{\"background-color\":\"hsla(60, 100%, 50%, 0.6)\"},condense:{\"letter-spacing\":\"-0.08em\"},expand:{\"letter-spacing\":\"0.1em\"},outline:[{\"text-shadow\":function(){var t=e(this).css(\"color\");return\"-1px -1px 0 \"+t+\", 1px -1px 0 \"+t+\",-1px  1px 0 \"+t+\", 1px  1px 0 \"+t}},{color:function(){return n.parentColours(e(this)).backgroundColour}}],shadow:{\"text-shadow\":function(){return\"0.08em 0.08em 0.08em \"+e(this).css(\"color\")}},emboss:{\"text-shadow\":function(){return\"0.04em 0.04em 0em \"+e(this).css(\"color\")}},smear:[{\"text-shadow\":function(){var t=e(this).css(\"color\");return\"0em   0em 0.02em \"+t+\",-0.2em 0em  0.5em \"+t+\", 0.2em 0em  0.5em \"+t}},C],blur:[{\"text-shadow\":function(){return\"0em 0em 0.08em \"+e(this).css(\"color\")}},C],blurrier:[{\"text-shadow\":function(){return\"0em 0em 0.2em \"+e(this).css(\"color\")},\"user-select\":\"none\"},C],mirror:{display:\"inline-block\",transform:\"scaleX(-1)\"},upsidedown:{display:\"inline-block\",transform:\"scaleY(-1)\"},fadeinout:{animation:\"fade-in-out 2s ease-in-out infinite alternate\"},rumble:{animation:\"rumble linear 0.1s 0s infinite\"},sway:{animation:\"sway linear 2.5s 0s infinite\"},buoy:{animation:\"buoy linear 2.5s 0s infinite\"},fidget:{animation:function(){return\"fidget step-end 60s \"+60*-Math.random()+\"s infinite\"+(Math.random()<.5?\" reverse\":\"\")}}}),[\"text-style\",function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return s.create(\"text-style\",r.map(n.insensitiveName))},function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0;i<n.length;i+=1)\"none\"===n[i]?e.styles=[]:e.styles=e.styles.concat(E[n[i]]);return e},[T(S.apply(void 0,_toConsumableArray(Object.keys(E))))]])))(\"collapse\",function(){return s.create(\"collapse\")},function(e){return e.attr.push({collapsing:!0}),e},[])(\"hover-style\",function(e,t){var n=u.create(),r=(t.run(n),n.summary());return r+\"\"==\"styles\"||r.every(function(e){return\"styles\"===e||\"attr\"===e})&&n.attr.every(function(e){return Object.keys(e)+\"\"==\"style\"})?s.create(\"hover-style\",[t]):l.create(\"datatype\",\"The changer given to (hover-style:) must only change the hook's style.\")},function(e,t){return e.data.hoverChanger=t,e.attr.push({hover:function(e,t){return void 0!==t&&t}}),e},[s])(\"css\",function(e,t){return t.trim().endsWith(\";\")||(t+=\";\"),s.create(\"css\",[t])},function(t,n){return t.attr.push({style:function(){return(e(this).attr(\"style\")||\"\")+n}}),t},[String])(\"test-true\",function(){return s.create(\"test-true\",[])},function(e){return e.enabled=!0},w(b))(\"test-false\",function(){return s.create(\"test-false\",[])},function(e){return e.enabled=!1},w(b)),t.addCommand(\"animate\",e.noop,function(e,t,r,i,a){r.forEach(t,function(t){var r=void 0;if(\"zoom\"===name){var o=t.offset(),s=o.left,c=o.top;r=n.mouseCoords.x-s+\"px \"+(n.mouseCoords.y-c)+\"px\"}n.transitionIn(t,i,e.transitionTime||a,e.transitionDelay,e.transitionSkip,0,r)})},[T(a),S.apply(void 0,_toConsumableArray(_.innerType.filter(function(e){return\"instant\"!==e}))),g(x)]),[\"box\",\"float-box\"].forEach(function(r){return t.addChanger(r,function(e,t,n){var i=-1===t.search(f)||t.length>1&&!t.includes(\"=\"),a=\"float-box\"===r&&(-1===n.search(f)||n.length>1&&!n.includes(\"=\"));return i||a?l.create(\"datatype\",\"The (\"+r+':) macro requires a sizing line(\"==X==\", \"==X\", \"=XXXX=\" etc.) be provided, not \"'+(i?t:n)+'\".'):s.create(r,[t,n].filter(function(e){return void 0!==e}))},function(t,i,a){var o,s=p(i),c=s.marginLeft,u=s.size,l=void 0;if(\"float-box\"===r){var f=p(a);l=f.marginLeft,a=f.size}var h=\"box\"===r?\"%\":\"vw\",y=(_defineProperty(o={display:\"block\",width:u+h,\"max-width\":u+h},\"box\"===r?\"margin-left\":\"left\",c+h),_defineProperty(o,\"box-sizing\",\"content-box\"),_defineProperty(o,\"overflow-y\",\"auto\"),_defineProperty(o,\"padding\",function(){return e(this).css(\"padding\")||\"1em\"}),o);return void 0!==a&&(y.height=a+(\"box\"===r?\"em\":\"vh\")),\"float-box\"===r&&d(y,{position:\"fixed\",top:l+\"vh\",\"background-color\":function(){return n.parentColours(e(this)).backgroundColour}}),t.styles.push(y),t},[String,\"box\"===r?g(k):String])})}),define(\"internaltypes/enchantment\",[\"jquery\",\"utils\",\"internaltypes/changedescriptor\",\"datatypes/changercommand\",\"utils/operationutils\",\"internaltypes/twineerror\",\"utils/renderutils\"],function(e,t,n,r,i,a,o){var s=i.objectName,c=o.collapse,u={create:function(n){return t.assertOnlyHas(n,[\"scope\",\"localHook\",\"section\",\"attr\",\"data\",\"changer\",\"functions\",\"lambda\",\"name\"]),Object.assign(Object.create(this),{enchantments:e()},n)},enchantScope:function(){var i=this,o=this.attr,u=this.data,l=this.functions,p=this.section,f=this.scope,d=this.localHook,h=this.lambda,y=[];f.forEach(p,function(m,g){if(!d||d.has(m[0]).length){var v=void 0;if(h)if(v=h.apply(p,{loop:f.TwineScript_GetProperty(g),pos:g+1}),a.containsError(v))m.replaceWith(v.render(\"\")),h=v=null;else if(r.isPrototypeOf(v)){var b=v.summary();(b.includes(\"newTargets\")||b.includes(\"target\"))&&(m.replaceWith(a.create(\"macrocall\",\"The changer produced by the 'via' lambda given to (enchant:) can't include a revision or enchantment changer like (replace:) or (click:).\").render(\"\")),h=v=null)}else m.replaceWith(a.create(\"macrocall\",\"The 'via' lambda given to (enchant:) must return a changer, not \"+s(v)+\".\").render(\"\")),h=v=null;else v=i.changer;var w=!o&&!u&&(!v||v.summary().every(function(e){return e.startsWith(\"transition\")})),T=w?m:m.wrap(\"<tw-enchantment>\").parent();if(o&&T.attr(o),u&&T.data(u),l&&l.forEach(function(e){return e(T)}),v){var S=n.create({section:p,target:T});if(v.run(S),S.update(),m.is(t.storyElement)){var x=Object.keys(Object.assign.apply(Object,[{}].concat(_toConsumableArray(S.styles))));m.css(x.reduce(function(e,t){return e[t]=\"inherit\",e},{})),T.data({enchantedProperties:x})}else if(m.is(\"tw-passage\")&&S.styles.some(function(e){return\"margin-left\"in e||\"margin\"in e||\"margin-right\"in e})){var k=\"padding-left\",O=\"padding-right\";t.storyElement.css(k,\"0px\").css(O,\"0px\"),T.data({enchantedProperties:[k,O]})}}m.is(t.storyElement)&&T.css({width:\"100%\",height:\"100%\"}),\"true\"===T.attr(\"collapsing\")&&(T.find(\"[collapsing=false]\").each(function(){e(this).removeAttr(\"collapsing\")}),c(T)),w||y.push(T)}}),this.enchantments=e(y)},disenchant:function(){this.enchantments.each(function(){e(this).contents().unwrap();var n=e(this).data(\"enchantedProperties\");n&&t.storyElement.css(n.reduce(function(e,t){return e[t]=\"\",e},{}))})}};return Object.freeze(u)}),define(\"macrolib/enchantments\",[\"jquery\",\"utils\",\"utils/operationutils\",\"engine\",\"state\",\"passages\",\"macros\",\"datatypes/hookset\",\"datatypes/changercommand\",\"datatypes/lambda\",\"internaltypes/enchantment\",\"internaltypes/twineerror\"],function(e,t,n,r,i,a,o,s,c,u,l,p){var f=n.is,d=o.TypeSignature,h=d.either,y=d.rest,m=d.optional;function g(e,t){if(c.isPrototypeOf(t)){var n=t.summary();if([\"newTargets\",\"target\",\"appendSource\",\"functions\"].some(function(e){return n.includes(e)}))return p.create(\"datatype\",\"The changer given to (\"+e+\":) can't include a revision or enchantment changer like (replace:) or (click:).\")}}[\"enchant\",\"change\"].forEach(function(e){o.addCommand(e,function(t,n){var r=g(e,n);if(r)return r},function(t,n,r){var i,a=l.create((_defineProperty(i={scope:s.from(n)},c.isPrototypeOf(r)?\"changer\":\"lambda\",r),_defineProperty(i,\"section\",t),i));return\"enchant\"===e?(t.addEnchantment(a),t.updateEnchantments()):a.enchantScope(),\"\"},[h(s,String),h(c,u.TypeSignature(\"via\"))],!1)}),o.addChanger(\"enchant-in\",function(e,t,n){var r=g(\"enchant-in\",n);return r||c.create(\"enchant-in\",[t,n])},function(e,t,n){return e.functions=(e.functions||[]).concat(function(r){var i;e.section.addEnchantment(l.create((_defineProperty(i={scope:s.from(t),localHook:r},c.isPrototypeOf(n)?\"changer\":\"lambda\",n),_defineProperty(i,\"section\",e.section),i)))}),e},[h(s,String),h(c,u.TypeSignature(\"via\"))]),[[\"link-style\",s.create({type:\"name\",data:\"link\"})],[\"line-style\",s.create({type:\"base\",data:s.create({type:\"name\",data:\"page\"})},\"lines\",void 0)],[\"char-style\",s.create({type:\"base\",data:s.create({type:\"name\",data:\"page\"})},\"chars\",void 0)]].forEach(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];o.addChanger(n,function(e,t){var r=g(n,t);return r||c.create(n,[t])},function(e,t){return e.functions=(e.functions||[]).concat(function(n){var i;e.section.addEnchantment(l.create((_defineProperty(i={scope:r,localHook:n},c.isPrototypeOf(t)?\"changer\":\"lambda\",t),_defineProperty(i,\"section\",e.section),i)))}),e},[h(c,u.TypeSignature(\"via\"))])});var v=[\"replace\",\"append\",\"prepend\"];function b(n,i){return t.onStartup(function(){var r=n.classList.replace(/ /g,\".\"),i=n.blockClassList?n.blockClassList.replace(/ /g,\".\"):\"\",a=\".\"+r+(i?\",.\"+i:\"\");t.storyElement.on(n.event.map(function(e){return e+\".enchantment\"}).join(\" \"),a,function(){var t=e(Array.from(e(this).parents(a).add(this)).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0]),n=t.data(\"enchantmentEvent\");n&&n(t)})}),[function(e,t,n){if(!t)return p.create(\"datatype\",\"A string given to this (\"+i+\":) macro was empty.\");if(n){var r=g(i,n);if(r)return r}return c.create(i,[s.from(t)].concat(n?[n]:[]))},function(e,t,a){e.enabled=!1,e.transitionDeferred=!0,n.rerender&&(e.newTargets=(e.newTargets||[]).concat({target:t,append:n.rerender}));var o=e.section&&e.section.stackTop?e.section.stackTop.tempVariables:Object.create(null),s=l.create(_defineProperty({functions:[function(e){e.attr(\"class\",e.children().is(\"tw-story, tw-sidebar, tw-passage\")||\"block\"===e.children().css(\"display\")?n.blockClassList:n.classList)}],attr:(n.classList+\"\").match(/\\b(?:link|enchantment-clickblock)\\b/)?{tabIndex:\"0\"}:{},data:{enchantmentEvent:function(){e.section.stackTop&&e.section.stackTop.blocked||(n.once&&e.section.removeEnchantment(s),n.goto?r.goToPassage(n.goto,{transition:n.transition}):n.undo?r.goBack({transition:n.transition}):e.section.renderInto(e.source,null,Object.assign({},e,{enabled:!0,transitionDeferred:!1}),o))}},scope:t,section:e.section,name:i},c.isPrototypeOf(a)?\"changer\":\"lambda\",a));return e.section&&(e.section.addEnchantment(s),s.enchantScope()),e},[h(s,String),m(h(c,u.TypeSignature(\"via\")))]]}v.forEach(function(t){o.addChanger(t,function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.every(Boolean)?c.create(t,r.map(s.from)):p.create(\"datatype\",\"A string given to this (\"+t+\":) macro was empty.\")},function(n){for(var r,i=arguments.length,a=Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return e(n.target).parents().filter(\"tw-collapsed,[collapsing=true]\").length>0||n.attr.some(function(e){return e.collapsing})||(n.attr=[].concat(_toConsumableArray(n.attr),[{collapsing:!1}])),n.newTargets=n.newTargets||[],(r=n.newTargets).push.apply(r,_toConsumableArray(a.filter(function(e){return!n.newTargets.some(function(n){var r=n.target,i=n.append;return f(e,r)&&t===i})}).map(function(e){return{target:e,append:t,before:!0}}))),n},y(h(s,String)))(t+\"-with\",function(e,n){return c.create(t+\"-with\",[n])},function(e,n){return e.appendSource=(e.appendSource||[]).concat({source:n,append:t}),e},String)});var w=\"ontouchstart\"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,T=[{name:\"click\",enchantDesc:{event:[\"click\"],once:!0,rerender:\"\",classList:\"link enchantment-link\",blockClassList:\"enchantment-clickblock\"}},{name:\"mouseover\",enchantDesc:{event:[\"mouseenter\",w?\"click\":\"\"].filter(Boolean),once:!0,rerender:\"\",classList:\"enchantment-mouseover\",blockClassList:\"enchantment-mouseoverblock\"}},{name:\"mouseout\",enchantDesc:{event:[\"mouseleave\",w?\"click\":\"\"].filter(Boolean),once:!0,rerender:\"\",classList:\"enchantment-mouseout\",blockClassList:\"enchantment-mouseoutblock\"}}];T.forEach(function(e){return o.addChanger.apply(o,[e.name].concat(_toConsumableArray(b(e.enchantDesc,e.name))))}),t.onStartup(function(){T.forEach(function(n){var r=n.enchantDesc;r.blockClassList&&t.storyElement.on(r.event.map(function(e){return e+\".enchantment\"}).join(\" \"),function(){var t=e(Array.from(e(this).parents(\".\"+r.blockClassList.replace(/ /g,\".\"))).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0]),n=t.data(\"enchantmentEvent\");n&&n(t)})})}),v.forEach(function(e){T.forEach(function(t){var n=Object.assign({},t.enchantDesc,{rerender:e}),r=t.name+\"-\"+e;o.addChanger.apply(o,[r].concat(_toConsumableArray(b(n,r))))})}),T.forEach(function(e){[\"goto\",\"undo\"].forEach(function(t){var n=e.name+\"-\"+t;o.addCommand(n,function(e,r){return!e||!r&&\"goto\"===t?p.create(\"datatype\",\"A string given to this (\"+n+\":) macro was empty.\"):\"goto\"!==t||a.hasValid(r)?void 0:p.create(\"macrocall\",\"I can't (\"+n+\":) the passage '\"+r+\"' because it doesn't exist.\")},function(r,a,o,c){if(\"undo\"===t&&i.pastLength<1)return p.create(\"macrocall\",\"I can't (undo:) on the first turn.\");var u=b(Object.assign({},e.enchantDesc,{transition:r.data.passageT8n},\"undo\"===t?{undo:!0}:{goto:c}),n);return(0,_slicedToArray(u,2)[1])({section:a},s.from(o)),Object.assign(r,{source:\"\"})},[h(s,String)].concat(\"undo\"===t?[]:String))})})}),define(\"macrolib/metadata\",[\"macros\",\"renderer\",\"utils/operationutils\",\"datatypes/lambda\",\"internaltypes/twineerror\"],function(e,t,n,r,i){var a=n.clone,o=n.objectName,s=n.isValidDatamapName,c=e.TypeSignature,u=c.zeroOrMore,l=c.Any,p=t.options.metadataMacros,f=function(e){return{TwineScript_TypeName:\"a (\"+e+\":) macro\",TwineScript_ObjectName:\"a (\"+e+\":) macro\",TwineScript_Unstorable:!0,TwineScript_Print:function(){return\"\"}}};[[\"storylet\",r.TypeSignature(\"when\")],[\"urgency\",Number],[\"exclusivity\",Number]].forEach(function(t){var n=_slicedToArray(t,2),r=n[0],i=n[1];e.add(r,function(e,t){return e.stackTop.speculativePassage?t:f(r)},i),p.push(r)}),e.add(\"metadata\",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var c=void 0,u=new Map,l=n.reduce(function(e,t){var n=void 0;if(i.containsError(e))return e;if(void 0===c)c=t;else{if(n=i.containsError(s(u,c)))return n;if(u.has(c))return i.create(\"macrocall\",\"You used the same data name (\"+o(c)+\") twice in the same (metadata:) call.\");u.set(c,a(t)),c=void 0}return e},!0);return i.containsError(l)?l:void 0!==c?i.create(\"macrocall\",\"This (metadata:) macro has a data name without a value.\"):e.stackTop.speculativePassage?u:f(\"storylet\")},u(l)),p.push(\"metadata\")}),define(\"macrolib/patterns\",[\"jquery\",\"macros\",\"utils\",\"utils/operationutils\",\"datatypes/datatype\",\"datatypes/typedvar\",\"internaltypes/twineerror\"],function(e,t,n,r,i,a,o){var s=n.anyRealLetter,c=n.anyUppercase,u=n.anyLowercase,l=n.anyCasedLetter,p=n.realWhitespace,f=n.impossible,d=r.objectName,h=r.toSource,y=t.TypeSignature,m=y.rest,g=y.either,v=y.optional,b=y.nonNegativeInteger,w=Object.assign,T=Object.create,S=m(g(String,i,a)),x=function e(t){var n,r=t.name,y=t.fullArgs,m=t.args,g=t.makeRegExpString,v=void 0===g?function(e){return e.join(\"\")}:g,b=t.insensitive,S=void 0!==b&&b,x=t.canContainTypedVars,k=void 0===x||x,O=t.canBeUsedAlone,j=void 0===O||O,A=m||y,C=A.map(function e(t){if(a.isPrototypeOf(t)){if(!k)return o.create(\"operation\",\"Optional string patterns, like (\"+r+\":)\"+(\"p-many\"===r?\" with min 0\":\"\")+\", can't have typed variables inside them.\");var n=e(t.datatype);return o.containsError(n)?n:\"(\"+n+\")\"}if(i.isPrototypeOf(t)){if(!k&&\"typedVars\"in t&&t.typedVars().length)return o.create(\"operation\",\"(\"+r+\":) can't have typed variables inside its pattern.\");if(t.regExp)return(t.rest?\"(?:\":\"\")+(S?t.insensitive().regExp:t.regExp)+(t.rest?\")*\":\"\");var h=t.name,y=t.rest?\"*\":\"\";return\"alnum\"===h?s+y:\"whitespace\"===h?p+y:\"uppercase\"===h?(S?l:c)+y:\"lowercase\"===h?(S?l:u)+y:\"anycase\"===h?l+y:\"digit\"===h?\"\\\\d\"+y:\"linebreak\"===h?\"(?:\\\\r|\\\\n|\\\\r\\\\n)\"+y:\"str\"===h?\".*?\":[\"even\",\"odd\",\"int\",\"num\"].includes(h)?o.create(\"datatype\",\"Please use string datatypes like 'digit' in (\"+r+\":) instead of number datatypes.\"):o.create(\"datatype\",\"The (\"+r+\":) macro must only be given string-related datatypes, not \"+d(t)+\".\")}return\"string\"==typeof t?(t=t.replace(/[.*+\\-?^${}()|[\\]\\\\]/g,\"\\\\$&\"),S&&(t=t.replace(RegExp(\"(\"+c+\"|\"+u+\")\",\"g\"),function(e){return\"[\"+e.toUpperCase()+e.toLowerCase()+\"]\"})),t):(f(\"createPattern\",\"mapper() was given a non-string non-datatype \"+t),\"\")});if(n=o.containsError(C))return n;var E=v(C),_=w(T(i),{name:r,regExp:E,insensitive:function(){return S?_:e({name:r,fullArgs:y,args:A.map(function(e){return i.isPrototypeOf(e)&&\"function\"==typeof e.insensitive?e.insensitive():e}),makeRegExpString:v,insensitive:!0,canContainTypedVars:k,canBeUsedAlone:j})},typedVars:function(){return A.reduce(function(t,n){return a.isPrototypeOf(n)&&(t=t.concat(S?a.create(e({name:\"p-ins\",fullArgs:[n.datatype],insensitive:!0}),n.varRef):n),n=n.datatype),i.isPrototypeOf(n)&&\"function\"==typeof n.typedVars&&(t=t.concat(n.typedVars())),t},[])},destructure:function(t){if(\"string\"!=typeof t)return[o.create(\"operation\",\"I can't unpack \"+d(t)+\" into \"+this.TwineScript_ToSource()+\" because it isn't a string.\")];var n=this.typedVars();if(!n.length)return[];var r=(RegExp(\"^\"+(this.rest?\"(?:\":\"\")+E+(this.rest?\")*\":\"\")+\"$\").exec(t)||[]).slice(1);return r.length?r.map(function(t,r){var i=n[r];if(i)return i.datatype.rest&&!i.datatype.regExp&&((i=i.TwineScript_Clone()).datatype=e({name:\"p\",fullArgs:[i.datatype]})),{dest:i,value:t||\"\",src:void 0}}).filter(Boolean):[o.create(\"operation\",\"I can't unpack \"+d(t)+\" because it doesn't match the pattern \"+this.TwineScript_ToSource()+\".\")]},TwineScript_IsTypeOf:function(e){return j?\"string\"==typeof e&&!!e.match(\"^\"+(this.rest?\"(?:\":\"\")+E+(this.rest?\")*\":\"\")+\"$\"):o.create(\"operation\",\"A (\"+r+\":) datatype must only be used with a (p:) macro.\")},TwineScript_toTypeSignatureObject:function(){var e=this;return{pattern:\"range\",name:r,range:function(t){return e.TwineScript_IsTypeOf(t)}}},TwineScript_ToSource:function(){return(this.rest?\"...\":\"\")+\"(\"+r+\":\"+y.map(h)+\")\"}});return Object.defineProperty(_,\"TwineScript_ObjectName\",{get:function(){return\"a (\"+r+\":) datatype\"}}),_};t.add([\"p\",\"pattern\"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return x({name:\"p\",fullArgs:n})},S)([\"p-either\",\"pattern-either\"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return x({name:\"p-either\",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return\"(?:\"+e.join(\"|\")+\")\"}})},S)([\"p-opt\",\"pattern-opt\",\"p-optional\",\"pattern-optional\"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return x({name:\"p-opt\",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return\"(?:\"+e.join(\"\")+\")?\"}})},S)([\"p-not\",\"pattern-not\"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.find(function(e){return\"string\"==typeof e?1!==[].concat(_toConsumableArray(e)).length:e.rest||e.regExp||[\"str\",\"empty\"].includes(e.name)})?o.create(\"datatype\",\"(p-not:) should only be given single character\"):x({name:\"p-not\",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return\"[^\"+e.join(\"\")+\"]\"}})},S)([\"p-many\",\"pattern-many\"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var s=n.slice(),c=void 0,u=void 0;if(\"number\"==typeof n[0]&&(c=n.shift(),u=\"number\"==typeof n[0]?n.shift():1/0),void 0!==u&&u<c)return o.create(\"datatype\",\"The (p-many:) macro needs to be given string patterns, not just min and max numbers.\");if(!n.length)return o.create(\"datatype\",\"The (p-many:) macro needs to be given string patterns, not just min and max numbers.\");var l=n.find(function(e){return\"string\"!=typeof e&&!i.isPrototypeOf(e)&&!a.isPrototypeOf(e)});return l?o.create(\"datatype\",\"This (p-many:) macro can only be given a min and max number followed by datatypes or strings, but was also given \"+d(l)+\".\"):x({name:\"p-many\",args:n,fullArgs:s,canContainTypedVars:c>0,makeRegExpString:function(e){return\"(?:\"+e.join(\"\")+\")\"+(void 0!==c?\"{\"+c+(u===1/0?\",\":u!==c?\",\"+u:\"\")+\"}\":\"+\")}})},[m(g(b,String,i,a))])([\"p-ins\",\"pattern-ins\",\"p-insensitive\",\"pattern-insensitive\"],function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return x({name:\"p-ins\",fullArgs:n,insensitive:!0})},S)([\"split\",\"splitted\"],function(e,t,n){if(t=x({name:\"split\",fullArgs:[t],canContainTypedVars:!1}),o.containsError(t))return t;if(!n)return[\"\"];if(!t.regExp)return[].concat(_toConsumableArray(n));for(var r=RegExp(t.regExp),i=[],a=void 0;n&&(a=r.exec(n));){if(a.index+a[0].length===0)return i;i.push(n.slice(0,a.index)),n=n.slice(a.index+a[0].length)}return i.concat(n||[])},[g(String,i),String])(\"trimmed\",function(e,t,n){return void 0===n||i.isPrototypeOf(t)&&\"whitespace\"===t.name?t.trim():(t=x({name:\"trimmed\",fullArgs:[t],canContainTypedVars:!1}),o.containsError(t)?t:t.regExp?n.replace(RegExp(\"^(\"+t.regExp+\")*|(\"+t.regExp+\")*$\",\"g\"),\"\"):n)},[g(String,i),v(String)])}),define(\"macrolib/links\",[\"jquery\",\"macros\",\"utils\",\"state\",\"passages\",\"engine\",\"datatypes/changercommand\",\"internaltypes/changedescriptor\",\"datatypes/hookset\",\"datatypes/lambda\",\"internaltypes/twineerror\"],function(e,t,n,r,i,a,o,s,c,u,l){var p=t.TypeSignature,f=p.optional,d=p.rest,h=p.either,y=[\"Links can't have empty strings for their displayed text.\",\"In the link syntax, a link's displayed text is inside the [[ and ]], and on the non-pointy side of the -> or <- arrow if it's there.\"],m=Object.assign;function g(e,t,r){r=r||t;var a=i.hasValid(t)&&t===r,o=e.evaluateTwineMarkup(n.unescape(r),\"a link's passage name\"),s=void 0;if(a){var c=o.children().length>0?\"`\".repeat((r.match(/`+/)||[]).reduce(function(e,t){return Math.max(e,t.length+1)},1)):\"\";t=c+\"\\0\".repeat(!!c)+t+\"\\0\".repeat(!!c)+c}else o.findAndFilter(\"tw-error\").length&&(s=o.findAndFilter(\"tw-error\").data(\"TwineError\")),r=o.text();return{text:t,passage:r,error:s}}n.onStartup(function(){e(n.storyElement).on(\"click.passage-link\",\"tw-link\",function(){var t=e(this),n=t.closest(\"tw-expression\"),r=t.closest(\"tw-expression, tw-hook\"),i=r.data(\"clickEvent\"),o=r.data(\"section\");if(!(o&&o.stackTop&&o.stackTop.blocked))if(i){if(t.find(\"tw-error\").length>0)return;i(t)}else{var s=n.data(\"linkPassageName\"),c=Object.assign({},n.data(\"passageT8n\")||{});n.find(\"tw-enchantment\").each(function(t,n){Object.assign(c,e(n).data(\"passageT8n\")||{})}),s?a.goToPassage(s,{transition:c}):t.is(\"[undo]\")?a.goBack({transition:c}):t.is(\"[fullscreen]\")&&a.toggleFullscreen()}}),e(document).on(\"fullscreenchange\",function(){e(\"tw-link[fullscreen]\",n.storyElement).each(function(t,n){(e(n).closest(\"tw-expression, tw-hook\").data(\"fullscreenEvent\")||Object)(n)})})}),[[\"link\",\"link-replace\"],[\"link-reveal\"],[\"link-repeat\"],[\"link-rerun\"]].forEach(function(e){return t.addChanger(e,function(t,n,r){if(!n)return l.create(\"datatype\",y[0]);if(r){var i=r.summary();if([\"newTargets\",\"target\",\"appendSource\",\"functions\"].some(function(e){return i.includes(e)}))return l.create(\"datatype\",\"The changer given to (\"+e[0]+\":) can't include a revision or enchantment changer like (replace:) or (click:).\")}return o.create(e[0],[n].concat(r||[]))},function(t,n,r){var i=e[0],a=t.section&&t.section.stackTop?t.section.stackTop.tempVariables:Object.create(null),o=s.create({source:\"<tw-link tabindex=0>\"+n+\"</tw-link>\",target:function(){return t.target},append:\"replace\",data:{section:t.section,clickEvent:function(e){t.enablers=t.enablers.filter(function(e){return e.descriptor!==o}),\"link-reveal\"===i&&e.contents().unwrap();var n=e.parent();\"link-rerun\"===i&&e.detach(),\"link\"!==i&&\"link-rerun\"!==i&&\"click-block\"!==i||n.empty(),t.section.renderInto(\"\",null,t,a),\"link-rerun\"===i&&n.prepend(e)}}});return t.enablers=(t.enablers||[]).concat({descriptor:o,changer:r}),t},[String,f(o)])}),t.addCommand(\"link-goto\",function(e){if(!e)return l.create.apply(l,[\"datatype\"].concat(y))},function(e,t,a,o){var s,c=g(t,a,o);if(a=c.text,o=c.passage,s=c.error)return s;if(e.transition){var u=\"transition\";return l.create(\"datatype\",\"Please attach (\"+u+\"-depart:) or (\"+u+\"-arrive:) to a passage link, not (\"+u+\":).\")}var p=void 0;return i.hasValid(o)||(p='<tw-broken-link passage-name=\"'+n.escape(o)+'\">'+a+\"</tw-broken-link>\"),p=p||\"<tw-link tabindex=0 \"+(r.passageNameVisited(o)>0?'class=\"visited\" ':\"\")+\">\"+a+\"</tw-link>\",e.data.linkPassageName=o,e.data.section=t,m(e,{source:p,transitionDeferred:!0})},[String,f(String)])(\"link-storylet\",function(){var e,t=(e=1===arguments.length||\"string\"!=typeof(arguments.length<=0?void 0:arguments[0])?0:1,arguments.length<=e?void 0:arguments[e]);if(!t||\"string\"==typeof t)return l.create(\"datatype\",\"(link-storylet:) should be given one index number or one 'where' lambda, after the optional link text string.\")},function(e,t){var n,a,o,s=(n=2+(1==(arguments.length<=2?0:arguments.length-2)?0:3==(arguments.length<=2?0:arguments.length-2)||\"string\"==typeof(arguments.length<=2?void 0:arguments[2])?1:2),arguments.length<=n?void 0:arguments[n]),c=\"string\"==typeof(arguments.length<=2?void 0:arguments[2])&&(arguments.length<=2?void 0:arguments[2]),p=(a=(arguments.length<=2?0:arguments.length-2)-1+2,(arguments.length<=a?void 0:arguments[a])!==s&&(o=(arguments.length<=2?0:arguments.length-2)-1+2,arguments.length<=o?void 0:arguments[o]));if(e.transition){var f=\"transition\";return l.create(\"datatype\",\"Please attach (\"+f+\"-depart:) or (\"+f+\"-arrive:) to (link-storylet:), not (\"+f+\":).\")}var d=u.isPrototypeOf(s),h=i.getStorylets(t,d&&s),y=l.containsError(h);if(y)return y;var g=h[d?0:s<0?h.length+s:s-1],v=void 0;if(g)g=g.get(\"name\"),c=c||g,v=v||\"<tw-link tabindex=0 \"+(r.passageNameVisited(g)>0?'class=\"visited\" ':\"\")+\">\"+c+\"</tw-link>\",e.data.linkPassageName=g,e.data.section=t;else{if(!p)return e;v=p}return m(e,{source:v,transitionDeferred:!0})},[h(parseInt,String,u.TypeSignature(\"where\")),f(h(parseInt,String,u.TypeSignature(\"where\"))),f(String)])(\"link-undo\",function(e){if(!e)return l.create(\"datatype\",y[0])},function(e,t,n){return r.pastLength<1?l.create(\"macrocall\",\"I can't use (link-undo:) on the first turn.\"):(e.data.section=t,m(e,{source:\"<tw-link tabindex=0 undo>\"+n+\"</tw-link>\",transitionDeferred:!0}))},[String])(\"link-show\",function(e){if(!e)return l.create(\"datatype\",y[0])},function(t,n,r){for(var i=arguments.length,a=Array(i>3?i-3:0),o=3;o<i;o++)a[o-3]=arguments[o];return t.data.section=n,t.data.clickEvent=function(r){r.contents().unwrap(),a.forEach(function(r){return r.forEach(n,function(r){var i=r.data(\"originalSource\")||\"\",a=r.data(\"hidden\");if(a)if(r.removeData(\"hidden\"),a instanceof e)r.empty().append(a);else{var o=r.data(\"tempVariables\");n.renderInto(\"\",null,m({},t,{source:i,target:r,transitionDeferred:!1}),o&&Object.create(o))}})})},m(t,{source:\"<tw-link tabindex=0>\"+r+\"</tw-link>\",transitionDeferred:!0})},[String,d(c)])(\"link-fullscreen\",function(e,t){if(!e||!t)return l.create(\"datatype\",y[0])},function(e,t,n,r){var i=function(){return document.fullscreenEnabled||document.msFullscreenEnabled?\"<tw-link tabindex=0 fullscreen>\"+(document.fullscreenElement||document.msFullscreenElement?r:n)+\"</tw-link>\":r?\"<tw-broken-link>\"+r+\"</tw-broken-link>\":\"\"},a=t.stackTop.tempVariables;return e.data.section=t,e.data.fullscreenEvent=function(){(document.fullscreenEnabled||document.msFullscreenEnabled)&&e.data.section.whenUnblocked(function(){var t=m({},e,{append:\"replace\",source:i(),transitionDeferred:!1});e.section.renderInto(\"\",null,t,a)})},m(e,{source:i(),transitionDeferred:!0})},[String,String,f(String)]),t.addChanger([\"link-reveal-goto\"],function(e,t,n,r){if(!t)return l.create.apply(l,[\"datatype\"].concat(y));if(o.isPrototypeOf(n)){if(o.isPrototypeOf(r))return l.create(\"datatype\",\"You mustn't give two changers to (link-reveal-goto:)\");r=n,n=void 0}if(r){var i=r.summary();if([\"newTargets\",\"target\",\"appendSource\",\"functions\"].some(function(e){return i.includes(e)}))return l.create(\"datatype\",\"The changer given to (link-reveal-goto:) can't include a revision or enchantment changer like (replace:) or (click:).\")}var a=g(e,t,n);return t=a.text,n=a.passage,a.error||o.create(\"link-reveal-goto\",[t,n,r].filter(function(e){return void 0!==e}))},function(e,t,o,c){if(i.hasValid(o)){var u=r.passageNameVisited(o),l=e.section&&e.section.stackTop?e.section.stackTop.tempVariables:Object.create(null),p=s.create({source:\"<tw-link tabindex=0 \"+(u>0?'class=\"visited\" ':\"\")+\">\"+t+\"</tw-link>\",target:e.target,append:\"replace\",data:{section:e.section,append:\"replace\",clickEvent:function(t){e.enablers=e.enablers.filter(function(e){return e.descriptor!==p}),t.contents().unwrap(),e.section.renderInto(\"\",null,e,l),e.section.whenUnblocked(function(){return a.goToPassage(o,{transition:e.data.passageT8n})})}}});return e.enablers=(e.enablers||[]).concat({descriptor:p,changer:c}),e}e.source='<tw-broken-link passage-name=\"'+n.escape(o)+'\">'+t+\"</tw-broken-link>\"},[String,f(h(o,String)),f(o)])}),define(\"macrolib/custommacros\",[\"utils\",\"macros\",\"state\",\"utils/operationutils\",\"datatypes/changercommand\",\"datatypes/custommacro\",\"datatypes/codehook\",\"datatypes/typedvar\",\"internaltypes/twineerror\"],function(e,t,n,r,i,a,o,s,c){var u=t.add,l=t.addChanger,p=t.addCommand,f=t.TypeSignature,d=f.rest,h=f.either,y=f.Any,m=r.objectName;u(\"macro\",function(t){for(var r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];var u=void 0,l=[];for(u=0;u<i.length;u+=1){var p=u===i.length-1;if(s.isPrototypeOf(i[u])===p)return c.create(\"datatype\",\"The \"+(p?\"\":e.nth(i.length-u+1)+\"-\")+\"last value given to (macro:) should be a \"+(p?\"code hook\":\"datatyped variable\")+\", not \"+m(i[u]));if(!p){var f=\"A custom macro\";if(i[u].varRef.object===n.variables)return c.create(\"datatype\",f+\"'s typed variables must be temp variables (with a '_'), not global variables (with a '$').\",\"Write them with a _ symbol at the start instead of a $ symbol.\");if(i[u].varRef.propertyChain.length>1)return c.create(\"datatype\",f+\"'s typed variables can't be properties inside a data structure.\");if(i[u].datatype.rest&&u!==i.length-2)return c.create(\"datatype\",f+\" can only have one spread variable, and it must be its last variable.\");var d=i[u].varRef.propertyChain[0];if(l.includes(d))return c.create(\"datatype\",f+\"'s typed variables can't both be named '\"+d+\"'.\");l.push(d)}}return a.create(i.slice(0,-1),i[i.length-1])},[d(h(s,o))]);var g=function(e,t,n){if(!t.some(function(e){if(\"function\"==typeof e.output)return e.output(n),!0}))return c.create(\"macrocall\",\"(\"+e+\":) should only be used inside a code hook passed to (macro:).\")};p([\"output-data\",\"out-data\"],function(){},function(e,t){var n=e.stack;return g(\"output-data\",n,t)||\"blocked\"},[y],!1),l([\"output\",\"out\"],function(e){return Object.assign(i.create(\"output\",[e]))},function(e,t){var n=t.stack,r=t.stackTop;return e.loopVars=Object.keys(r.tempVariables).reduce(function(e,t){return e[t]=[r.tempVariables[t]],e},{}),g(\"output\",n,e),r.blocked=!0,e},[]),p(\"error\",function(e){if(!e)return c.create(\"datatype\",\"This (error:) macro was given an empty string.\")},function(e,t){var n=e.stack;return g(\"error\",n,c.create(\"user\",t))||\"blocked\"},[String],!1)}),define(\"repl\",[\"utils\",\"engine\",\"markup\",\"twinescript/compiler\",\"twinescript/environ\"],function(e,t,n,r,i){e.onStartup(function(){return setTimeout(function(){t.options.debug&&(window.REPL=function(e){var t=r(n.lex(\"(print:\"+e+\")\"));console.log(t);var a=i({}).eval(t);return a.TwineScript_Run?a.TwineScript_Run().source:a},window.LEX=function(e){var t=n.lex(e);return 1===t.length?t[0]:t})})})}),require.config({paths:{jquery:\"../node_modules/jquery/dist/jquery\",almond:\"../node_modules/almond/almond\",\"es6-shim\":\"../node_modules/es6-shim/es6-shim\",jqueryplugins:\"utils/jqueryplugins\",markup:\"./markup/markup\",lexer:\"./markup/lexer\",patterns:\"./markup/patterns\"},deps:[\"es6-shim\",\"jqueryplugins\"]}),require([\"jquery\",\"debugmode/mode\",\"renderer\",\"state\",\"section\",\"engine\",\"passages\",\"utils\",\"utils/renderutils\",\"internaltypes/twineerror\",\"macros\",\"macrolib/values\",\"macrolib/commands\",\"macrolib/datastructures\",\"macrolib/stylechangers\",\"macrolib/enchantments\",\"macrolib/metadata\",\"macrolib/patterns\",\"macrolib/links\",\"macrolib/custommacros\",\"repl\"],function($,DebugMode,Renderer,State,Section,Engine,Passages,Utils,_ref118,TwineError){var dialog=_ref118.dialog;function __HarloweEval(text){return eval(text+\"\")}var _installHandlers=function(){$(document.documentElement).on(\"keydown\",function(e){13===e.which&&\"0\"===e.target.getAttribute(\"tabindex\")&&$(e.target).trigger(\"click\")}),Engine.options.debug?DebugMode():TwineError.on(\"error\",function(e,t){return!$(\"tw-debugger\").length&&DebugMode(e,t)}),_installHandlers=null},oldOnError;function printJSError(e){var t=e.name+\": \"+e.message;if(e.stack){var n=e.stack.split(\"\\n\"),r=n.findIndex(function(e){return e.includes(\"__HarloweEval\")});t+=\"\\n\"+n.slice(0,r).join(\"\\n\").replace(/\\([^\\)]+\\)/g,\"\")}return\"<div style='font-family:monospace;overflow-y:scroll;max-height:30vh'>```\"+t+\"```</div>\"}oldOnError=window.onerror,window.onerror=function(e,t,n,r,i){window.onerror=oldOnError,Utils.storyElement.parent().append(dialog({message:\"Sorry to interrupt, but this page's code has got itself in a mess.\\n\\n\"+printJSError(i)+\"\\n(This is probably due to a bug in the Harlowe game engine.)\"})),\"function\"==typeof oldOnError&&oldOnError.apply(void 0,arguments)},Utils.onStartup(function(){var e=$(\"tw-storydata\");if(0!==e.length){var t=e.attr(\"options\");t&&t.split(/\\s/).forEach(function(e){Renderer.options[e]=Engine.options[e]=!0});var n=e.attr(\"startnode\");Renderer.options.ifid=Engine.options.ifid=e.attr(\"ifid\"),n||(n=[].reduce.call($(\"tw-passagedata\"),function(e,t){var n=t.getAttribute(\"pid\");return n<e?n:e},1/0)),n=$(\"tw-passagedata[pid=\"+n+\"]\").attr(\"name\"),_installHandlers();var r=!1;$(\"[role=script]\").each(function(e){try{__HarloweEval($(this).html())}catch(t){r||(r=!0,dialog({parent:Utils.storyElement.parent(),message:\"There is a problem with this story's \"+Utils.nth(e+1)+\" script:\\n\\n\"+printJSError(t)}))}}),$(\"[role=stylesheet]\").each(function(e){$(document.head).append('<style data-title=\"Story stylesheet '+(e+1)+'\">'+$(this).html())});var i=Section.create(),a=Passages.loadMetadata(i);if(a.length){var o=dialog({parent:Utils.storyElement.parent(),message:\"These errors occurred when running the `(metadata:)` macro calls in this story's passages:<p></p>\"});a.forEach(function(e){return o.find(\"p\").append(e.render(\"\"))})}var s=!Engine.options.debug&&State.hasSessionStorage&&sessionStorage.getItem(\"Saved Session\");s&&!0===State.deserialise(i,s)?Engine.showPassage(State.passage,!1):Engine.goToPassage(n)}})}),define(\"harlowe\",function(){}),require([\"harlowe\"])}();\n</script>\n\n</body>\n</html>\n","setup": function(){"use strict";var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],r=!0,o=!1,n=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){o=!0,n=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw n}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toArray(e){return Array.isArray(e)?e:Array.from(e)}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}(function(){var e=void 0,t={};function a(){for(var e=0;e<arguments.length;e++)for(var t in arguments[e])this[t]=arguments[e][t]}function r(e,t){e.childAt=e.childAt||{};for(var a=t.start;a<t.end;a+=1)e.childAt[a]=t}function o(e,t,a,r){return!(e.canFollow&&!(e.canFollow.indexOf(a&&a.type)>-1)||e.cannotFollow&&(-1!==e.cannotFollow.indexOf(a&&a.type)||e.cannotFollow.indexOf("text")>-1&&r)||e.peek&&e.peek.toLowerCase()!==t.slice(0,e.peek.length).toLowerCase())}function n(e){for(var a=e.innerText,r=[],n=0,s=n,c=a.length,l=null;n<c;){for(var h=a.slice(n),d=(r.length?r[0]:e).innerMode,u=0,m=d.length;u<m;u+=1){var p=t[d[u]];if(o(p,h,l,s<n)&&p.pattern.test(h)){var g=p.pattern.exec(h),b=p.fn(g),y=!1,f=0;if(b.matches){for(;f<r.length;f+=1){var v=r[f].type;if(v in b.matches){y=!0;break}0===v.indexOf("verbatim")&&(v="verbatimOpener"),b.cannotCross&&b.cannotCross.indexOf(v)>-1&&(f=r.length-1)}if(f>=r.length&&!b.isFront)continue}s<n&&e.addChild({type:"text",text:a.slice(s,n),innerMode:d}),s=n+=(l=e.addChild(b)).text.length,y&&(i(e,l,r[f]),r=r.slice(f+1)),l.isFrontToken()&&r.unshift(l);break}}u===m&&(n+=1,null===l&&(l={type:"text"}))}for(s<n&&e.addChild({type:"text",text:a.slice(s,n),innerMode:(r.length?r[0]:e).innerMode});r.length>0;)r.shift().demote();return e}function i(e,t,a){var o=e.children.indexOf(t),n=e.children.indexOf(a);t.children=e.children.splice(n+1,o-(n+1)),t.children.forEach(function(e){r(t,e)}),t.type=t.matches[a.type],t.innerText="";for(var i=0,s=t.children.length;i<s;i++)t.innerText+=t.children[i].text;t.start=a.start,t.text=a.text+t.innerText+t.text,Object.keys(a).forEach(function(e){Object.hasOwnProperty.call(t,e)||(t[e]=a[e])}),t.isFront&&(t.isFront=!1),e.children.splice(n,1),r(e,t)}a.prototype={constructor:a,addChild:function(e){var t=this.lastChildEnd(),o=new a({start:t,end:e.text&&t+e.text.length,children:[]},e);return o.innerText&&n(o),this.children.push(o),r(this,o),o},firstChild:function(){return this.children&&this.children[0]||null},lastChild:function(){return this.children&&this.children[this.children.length-1]||null},lastChildEnd:function(){var e=this.lastChild();return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))},tokenAt:function(e){if(e<this.start||e>=this.end)return null;if(this.childAt)return this.childAt[e]&&this.childAt[e].tokenAt(e)||this;if(this.children.length)for(var t=0;t<this.children.length;t+=1){var a=this.children[t].tokenAt(e);if(a)return a}return this},pathAt:function(e){if(e<this.start||e>=this.end)return[];if(this.childAt)return(this.childAt[e]&&this.childAt[e].pathAt(e)||[]).concat(this);var t=[];if(this.children.length)for(var a=0;a<this.children.length;a+=1){var r=this.children[a].pathAt(e);if(r.length){t.concat(r);break}}return t.concat(this)},nearestTokenAt:function(e){return e<this.start||e>=this.end?null:this.children?this.children.reduce(function(t,a){return t||(e>=a.start&&e<a.end?a:null)},null):this},everyLeaf:function(e){return this.children&&0!==this.children.length?this.children.reduce(function(t,a){return t&&a.everyLeaf(e)},!0):!!e(this)},isWhitespace:function(){return this.everyLeaf(function(e){return"whitespace"===e.type||!e.text.trim()})},isFrontToken:function(){return this.isFront},isBackToken:function(){return"matches"in this},demote:function(){this.type="text"},error:function(e){this.type="error",this.message=e},toString:function(){var e=this.type+"("+this.start+"\u2192"+this.end+")";return this.children&&this.children.length>0&&(e+="["+this.children+"]"),e}},e={lex:function(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start";return n(new a({type:"root",start:r||0,end:t.length,text:t,innerText:t,children:[],childAt:{},innerMode:e.modes[o]}))},rules:t,modes:{}},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e:"function"==typeof define&&define.amd?define("lexer",[],function(){return e}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Lexer=e):this.TwineLexer=e}).call(eval("this")||("undefined"!=typeof global?global:window)),function(){var e;function t(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))?(Object.keys(e).forEach(function(a){e[a]=t(e[a])}),e):(e+"").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function a(e){return function(){return"("+e+Array.apply(0,arguments).join("|")+")"}}var r=a("?:"),o=a("?!"),n=a("?="),i="[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",s=i.replace("*","+"),c="\\b",l="[\\w\\-\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",h=l.replace("\\-",""),d=r("\\n","$"),u=i+"(\\*+)"+s,m=i+"((?:0\\.)+)"+s,p=i+"-{3,}"+i+d,g=i+"(==+>|<=+|=+><=+|<==+>)"+i+d,b=i+"(=+\\|+|\\|+=+|=+\\|+=+|\\|=+\\|)"+i+d,y={opener:"\\[\\[(?!\\[)",text:"("+function(){return"[^"+Array.apply(0,arguments).map(t).join("")+"]*"}("]")+")",rightSeparator:r("\\->","\\|"),leftSeparator:"<\\-",closer:"\\]\\]",legacySeparator:"\\|",legacyText:"("+r("[^\\|\\]]","\\]"+o("\\]"))+"+)"},f=h+"*"+h.replace("\\w","a-zA-Z")+h+"*",v="\\$("+f+")",k="_("+f+")",w="'s"+s+"("+f+")",x="("+f+")"+s+"of"+c+o("it\\b"),T="'s"+s,C=r("it","time","visits?","exits?","pos")+c,S="its"+s+"("+f+")",A="its"+s,N="("+f+")"+s+"of"+s+"it"+c,_="of\\b"+s+"it"+c,O={opener:"\\(",name:"("+r("\\$","_")+"?"+l+"+):"+o("\\/"),closer:"\\)"},L=r("=<","=>","[gl]te?\\b","n?eq\\b","isnot\\b","are\\b","x\\b","isa\\b","or"+s+"a"+c),E="[a-zA-Z][\\w\\-]*",F="(?:\"[^\"]*\"|'[^']*'|[^'\">])*?",P="\\|("+l+"+)(>|\\))",I="(<|\\()("+l+"+)\\|",H="\\b(\\d+(?:\\.\\d+)?(?:[eE][+\\-]?\\d+)?)"+o("m?s")+c;y.main=y.opener+r(y.text+y.rightSeparator,y.text.replace("*","*?")+y.leftSeparator)+y.text,e={upperLetter:"[A-Z\\u00c0-\\u00de\\u0150\\u0170]",lowerLetter:"[a-z0-9_\\-\\u00df-\\u00ff\\u0151\\u0171]",anyLetter:l,anyLetterStrict:h,whitespace:s,escapedLine:"\\\\\\n\\\\?|\\n\\\\",br:"\\n(?!\\\\)",commentFront:"\x3c!--",commentBack:"--\x3e",tag:"<\\/?"+E+F+">",tagPeek:"<",scriptStyleTag:"<("+r("script","style","textarea")+")"+F+">[^]*?<\\/\\1>",scriptStyleTagOpener:"<",url:"("+r("https?","mailto","javascript","ftp","data")+":\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])",bullet:"\\*",hr:p,heading:"[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*(#{1,6})[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",align:g,column:b,bulleted:u,numbered:m,strikeOpener:t("~~"),italicOpener:t("//"),boldOpener:t("''"),supOpener:t("^^"),strongFront:t("**"),strongBack:t("**"),emFront:t("*"),emBack:t("*"),verbatimOpener:"`+",collapsedFront:"{",collapsedBack:"}",hookAppendedFront:"\\["+o("=+"),hookPrependedFront:P+"\\["+o("=+"),hookFront:"\\["+o("=+"),hookBack:"\\]"+o(I),hookAppendedBack:"\\]"+I,unclosedHook:"\\[=+",unclosedHookPrepended:P+"\\[=+",unclosedCollapsed:"\\{=+",passageLink:y.main+y.closer,passageLinkPeek:"[[",legacyLink:y.opener+y.legacyText+y.legacySeparator+y.legacyText+y.closer,legacyLinkPeek:"[[",simpleLink:y.opener+y.legacyText+y.closer,simpleLinkPeek:"[[",macroFront:O.opener+n(O.name),macroFrontPeek:"(",macroName:O.name,groupingFront:"\\("+o(O.name),groupingFrontPeek:"(",groupingBack:"\\)",twine1Macro:"<<[^>\\s]+\\s*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"|[^'\"\\\\>]|>(?!>))*>>",twine1MacroPeek:"<<",validPropertyName:f,property:w,propertyPeek:"'s",belongingProperty:x,possessiveOperator:T,belongingOperator:"of\\b",belongingOperatorPeek:"of",itsOperator:A,itsOperatorPeek:"its",belongingItOperator:_,belongingItOperatorPeek:"of",variable:v,variablePeek:"$",tempVariable:k,tempVariablePeek:"_",hookName:"\\?("+l+"+)\\b",hookNamePeek:"?",cssTime:"(\\d+\\.?\\d*|\\d*\\.?\\d+)(m?s)\\b",colour:r(r("Red","Orange","Yellow","Lime","Green","Cyan","Aqua","Blue","Navy","Purple","Fuchsia","Magenta","White","Gray","Grey","Black","Transparent"),"#[\\dA-Fa-f]{3}(?:[\\dA-Fa-f]{3})?"),datatype:r("alnum","alphanumeric","any(?:case)?","array","bool(?:ean)?","changer","colou?r","const","command","dm","data"+r("map","type","set"),"ds","digit","gradient","empty","even","int"+o("o")+"(?:eger)?","lambda","lowercase","macro","linebreak","num(?:ber)?","odd","str(?:ing)?","uppercase","whitespace")+c,number:H,boolean:r("true","false")+c,identifier:C,itsProperty:S,itsPropertyPeek:"its",belongingItProperty:N,escapedStringChar:"\\\\[^\\n]",singleStringOpener:"'",doubleStringOpener:'"',singleStringCloser:"'",doubleStringCloser:'"',is:"is"+o(s+"not"+c,s+"an?"+c,s+"in"+c,s+"<",s+">")+c,isNot:"is"+s+"not"+o(s+r("an?","in")+c)+c,isA:"is"+s+"an?"+c,isNotA:"is"+s+"not"+s+"an?"+c,matches:"matches\\b",doesNotMatch:"does"+s+"not"+s+"match"+c,and:"and\\b",or:"or\\b",not:"not\\b",inequality:"((?:is(?:"+s+"not)?"+i+")*)("+r("<(?!=)","<=",">(?!=)",">=")+")",isIn:"is"+s+"in"+c,contains:"contains\\b",doesNotContain:"does"+s+"not"+s+"contain"+c,isNotIn:"is"+s+"not"+s+"in"+c,addition:t("+")+o("="),subtraction:t("-")+o("=","type"),multiplication:t("*")+o("="),division:r("/","%")+o("="),comma:",",spread:"\\.\\.\\."+o("\\."),to:r("to\\b","="),into:"into\\b",making:"making\\b",where:"where\\b",when:"when\\b",via:"via\\b",each:"each\\b",augmentedAssign:r("\\+","\\-","\\*","\\/","%")+"=",bind:"2?bind\\b",typeSignature:t("-type")+c,incorrectOperator:L},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e:"function"==typeof define&&define.amd?define("patterns",[],function(){return e}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Patterns=e):this.Patterns=e}.call(eval("this")||("undefined"!=typeof global?global:window)),function(){var e=void 0;Object.assign=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};var t=Object.keys,a=Object.assign;function r(r){return Object.freeze({lex:function(r){function o(e){return e=e||"innerText",function(t){var a=t.reduceRight(function(e,t,a){return e||(a?t:"")},""),r={};return r[e]=a,r}}function n(e,t){var a={};return a[e]=t,function(){return{isFront:!0,matches:a,cannotCross:["verbatimOpener"]}}}var i=Object.bind(0,null);function s(e,t){return Object.keys(t).forEach(function(a){var r=t[a].fn;t[a].fn=function(t){var o=r(t);return o.text||(o.text=t[0]),o.type||(o.type=a),o.innerMode||(o.innerMode=e),o}}),t}var c=[],l=[],h=[],d=s(c,{hr:{fn:i},bulleted:{fn:function(e){return{depth:e[1].length}}},numbered:{fn:function(e){return{depth:e[1].length/2}}},heading:{fn:function(e){return{depth:e[1].length}}},align:{fn:function(e){var t=void 0,a=e[1],r=a.indexOf("><");return~r?25===(t=Math.round(r/(a.length-2)*50))&&(t="center"):"<"===a[0]&&">"===a.slice(-1)?t="justify":a.indexOf(">")>-1?t="right":a.indexOf("<")>-1&&(t="left"),{align:t}}},column:{fn:function(e){var t=void 0,a=e[1],r=a.indexOf("|");return r&&r<a.length-1?t="center":"|"===a[0]&&"|"===a.slice(-1)?t="none":r===a.length-1?t="right":r||(t="left"),{column:t,width:/\|+/.exec(a)[0].length,marginLeft:/^=*/.exec(a)[0].length,marginRight:/=*$/.exec(a)[0].length}}}});t(d).forEach(function(e){d[e].canFollow=[null,"br","hr","bulleted","numbered","heading","align","column","escapedLine"],d[e].cannotFollow=["text"]});var u=s(c,{twine1Macro:{fn:function(){return{type:"error",message:"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros."}}},emBack:{fn:function(){return{matches:{emFront:"em"},cannotCross:["verbatimOpener"]}}},strongBack:{fn:function(){return{matches:{strongFront:"strong"},cannotCross:["verbatimOpener"]}}},strongFront:{fn:function(){return{isFront:!0}}},emFront:{fn:function(){return{isFront:!0}}},boldOpener:{fn:n("boldOpener","bold")},italicOpener:{fn:n("italicOpener","italic")},strikeOpener:{fn:n("strikeOpener","strike")},supOpener:{fn:n("supOpener","sup")},commentFront:{fn:function(){return{isFront:!0}}},commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},scriptStyleTag:{fn:i},tag:{fn:i},url:{fn:i},hookPrependedFront:{fn:function(e){return{name:e[1],hidden:")"===e[2],isFront:!0,tagPosition:"prepended"}}},hookFront:{fn:function(){return{isFront:!0}}},hookBack:{fn:function(){return{matches:{hookPrependedFront:"hook",hookFront:"hook"},cannotCross:["verbatimOpener"]}}},hookAppendedBack:{fn:function(e){return{name:e[2],hidden:"("===e[1],tagPosition:"appended",matches:{hookFront:"hook"},cannotCross:["verbatimOpener"]}}},unclosedHook:{fn:i},unclosedHookPrepended:{fn:function(e){return{type:"unclosedHook",name:e[1],hidden:")"===e[2]}}},verbatimOpener:{fn:function(e){var t=e[0].length,a={};return a["verbatim"+t]="verbatim",{type:"verbatim"+t,isFront:!0,matches:a}}},unclosedCollapsed:{fn:i},collapsedFront:{fn:function(){return{isFront:!0}}},collapsedBack:{fn:function(){return{matches:{collapsedFront:"collapsed"},cannotCross:["verbatimOpener"]}}},escapedLine:{fn:i},legacyLink:{fn:function(e){return{type:"twineLink",innerText:e[1],passage:e[2],innerMode:c}}},br:{fn:i}}),m=a(s(l,{macroFront:{fn:function(e){return{isFront:!0,name:e[1]}}},groupingBack:{fn:function(){return{matches:{groupingFront:"grouping",macroFront:"macro"},cannotCross:["singleStringOpener","doubleStringOpener"]}}},passageLink:{fn:function(e){var t=e[1]||"",a=e[2]||"",r=e[3]||"";return{type:"twineLink",innerText:a?r:t,passage:t?r:a,innerMode:c}}},simpleLink:{fn:function(e){return{type:"twineLink",innerText:e[1]||"",passage:e[1]||"",innerMode:c}}},variable:{cannotFollow:["macroFront"],fn:o("name")},tempVariable:{cannotFollow:["macroFront"],fn:o("name")}}),{hookFront:u.hookFront,hookBack:u.hookBack}),p=s(l,a({macroName:{canFollow:["macroFront"],fn:o("name")},groupingFront:{fn:function(){return{isFront:!0}}},property:{fn:o("name"),canFollow:["variable","hookName","property","tempVariable","colour","itsProperty","belongingItProperty","macro","grouping","string","datatype","hook","boolean","number"]},possessiveOperator:{fn:i},itsProperty:{cannotFollow:["text"],fn:o("name")},itsOperator:{cannotFollow:["text"],fn:i},belongingItProperty:{cannotFollow:["text"],fn:o("name")},belongingItOperator:{cannotFollow:["text"],fn:i},belongingProperty:{cannotFollow:["text"],fn:o("name")},belongingOperator:{cannotFollow:["text"],fn:i},escapedStringChar:{fn:function(){return{type:"text"}}},singleStringOpener:{fn:function(){return{isFront:!0,matches:{singleStringOpener:"string"},innerMode:h}}},doubleStringOpener:{fn:function(){return{isFront:!0,matches:{doubleStringOpener:"string"},innerMode:h}}},hookName:{fn:o("name")},cssTime:{fn:function(e){return{value:+e[1]*("s"===e[2].toLowerCase()?1e3:1)}}},datatype:{cannotFollow:["text"],fn:function(e){return{name:e[0].toLowerCase()}}},colour:{cannotFollow:["text"],fn:function(e){var t=e[0].toLowerCase(),a={red:"e61919",orange:"e68019",yellow:"e5e619",lime:"80e619",green:"19e619",cyan:"19e5e6",aqua:"19e5e6",blue:"197fe6",navy:"1919e6",purple:"7f19e6",fuchsia:"e619e5",magenta:"e619e5",white:"fff",black:"000",gray:"888",grey:"888"};return{colour:Object.hasOwnProperty.call(a,t)?"#"+a[t]:t}}},number:{fn:function(e){return{value:parseFloat(e[0])}}},inequality:{fn:function(e){return{operator:e[2],negate:e[1].indexOf("not")>-1}}},augmentedAssign:{fn:function(e){return{operator:e[0][0]}}},identifier:{fn:o("name"),cannotFollow:["text"]},whitespace:{fn:i,cannotFollow:"text"},incorrectOperator:{fn:function(e){var t={"=>":">=","=<":"<=",gte:">=",lte:"<=",gt:">",lt:"<",eq:"is",isnot:"is not",neq:"is not",isa:"is a",are:"is",x:"*","or a":"or"}[e[0].toLowerCase().replace(/\s+/g," ")];return{type:"error",message:"Please say "+(t?"'"+t+"'":"something else")+" instead of '"+e[0]+"'.",explanation:"In the interests of readability, I want certain operators to be in a specific form."}},cannotFollow:"text"}},["boolean","is","to","into","where","when","via","making","each","and","or","not","isNot","contains","doesNotContain","isIn","isA","isNotA","isNotIn","matches","doesNotMatch","bind"].reduce(function(e,t){return e[t]={fn:i,cannotFollow:["text"]},e},{}),["comma","spread","typeSignature","addition","subtraction","multiplication","division"].reduce(function(e,t){return e[t]={fn:i},e},{}))),g=s(h,{singleStringCloser:p.singleStringOpener,doubleStringCloser:p.doubleStringOpener,escapedStringChar:p.escapedStringChar});c.push.apply(c,_toConsumableArray(t(d)).concat(_toConsumableArray(t(m)),_toConsumableArray(t(u)))),l.push.apply(l,_toConsumableArray(t(m)).concat(_toConsumableArray(t(p)))),h.push.apply(h,_toConsumableArray(t(g)));var b=a({},d,u,m,p,g);t(b).forEach(function(t){var a=e[t];b[t].pattern="string"!=typeof a?a:RegExp("^(?:"+a+")","i"),e[t+"Peek"]&&(b[t].peek=e[t+"Peek"])}),a(r.rules,b);var y=r.modes;return y.start=y.markup=c,y.macro=l,y.string=h,r}(r).lex,Patterns:e})}"object"===("undefined"==typeof module?"undefined":_typeof(module))?(e=require("./patterns"),module.exports=r(require("./lexer"))):"function"==typeof define&&define.amd?define("markup",["lexer","patterns"],function(t,a){return e=a,r(t)}):this&&this.loaded&&this.modules?(e=this.modules.Patterns,this.modules.Markup=r(this.modules.Lexer)):(e=this.Patterns,this.TwineMarkup=r(this.TwineLexer))}.call(eval("this")||("undefined"!=typeof global?global:window)),function(){var e={Macro:{set:{name:"set",sig:" ...VariableToValue",returnType:"Instant",aka:[],abstract:"Stores data values in variables, optionally allowing you to permanently restrict the variable to a single datatype.  ",anchor:"macro_set",category:"basics",categoryOrder:"1"},put:{name:"put",sig:" ...VariableToValue",returnType:"Instant",aka:[],abstract:"A left-to-right version of (set:) that requires the word `into` rather than `to`.  ",anchor:"macro_put",category:"basics",categoryOrder:"2"},unpack:{name:"unpack",sig:" ...VariableToValue",returnType:"Instant",aka:[],abstract:'A specialised variation of (put:) that lets you extract multiple values from an array, datamap or string, at once, and put them into multiple variables, by placing a matching data structure on the right of `into` containing variables at the positions of those values. For instance, `(unpack: (a: 1, 2, 3) into (a: $x, 2, $y))` sets $x to 1 and $y to 3, and `(unpack: (dm: "B", 3, "A", 1) into (dm: "A", $x, "B", $y))` sets $x to 1 and $y to 3.   ',anchor:"macro_unpack",category:"data structure"},move:{name:"move",sig:" ...VariableToValue",returnType:"Instant",aka:[],abstract:"A variant of (put:) that, if transferring data from a data structure, deletes the source value after copying it - in effect moving the value from the source to the destination.  ",anchor:"macro_move",category:"basics",categoryOrder:"3"},display:{name:"display",sig:" String",returnType:"Command",aka:[],abstract:"This command writes out the contents of the passage with the given string name. If a passage of that name does not exist, this produces an error.  ",anchor:"macro_display",category:"basics",categoryOrder:"5"},print:{name:"print",sig:" Any",returnType:"Command",aka:[],abstract:"This command prints out any data provided to it, as text.  ",anchor:"macro_print",category:"basics",categoryOrder:"4"},verbatimprint:{name:"verbatim-print",sig:" Any",returnType:"Command",aka:["v6m-print"],abstract:"A convenient combination of (verbatim:) and (print:), this prints out any single argument given to it, as text, but without rendering the resulting text as markup.  ",anchor:"macro_verbatim-print",category:"basics",categoryOrder:"16"},v6mprint:{name:"verbatim-print",sig:" Any",returnType:"Command",aka:["v6m-print"],abstract:"A convenient combination of (verbatim:) and (print:), this prints out any single argument given to it, as text, but without rendering the resulting text as markup.  ",anchor:"macro_verbatim-print",category:"basics",categoryOrder:"16"},verbatimsource:{name:"verbatim-source",sig:" Any",returnType:"Command",aka:["v6m-source"],abstract:"A convenient combination of (verbatim-print:) and (source:), this prints out the Harlowe source code of any value given to it.  ",anchor:"macro_verbatim-source",category:"debugging"},v6msource:{name:"verbatim-source",sig:" Any",returnType:"Command",aka:["v6m-source"],abstract:"A convenient combination of (verbatim-print:) and (source:), this prints out the Harlowe source code of any value given to it.  ",anchor:"macro_verbatim-source",category:"debugging"},goto:{name:"go-to",sig:" String",returnType:"Command",aka:[],abstract:"This command stops passage code and sends the player to a new passage. If the passage named by the string does not exist, this produces an error.  ",anchor:"macro_go-to",category:"navigation"},undo:{name:"undo",sig:"",returnType:"Command",aka:[],abstract:'This command stops passage code and "undoes" the current turn, sending the player to the previous visited passage and forgetting any variable changes that occurred in this passage.  ',anchor:"macro_undo",category:"navigation"},iconundo:{name:"icon-undo",sig:" [String], [String]",returnType:"Command",aka:[],abstract:"Creates an icon, similar to those in the sidebar, that, if visible and clicked, undoes the current turn, returning to the previous passage, as if by (undo:). It is not visible on the first turn of the game.  ",anchor:"macro_icon-undo",category:"sidebar",categoryOrder:"2"},iconredo:{name:"icon-redo",sig:" [String], [String]",returnType:"Command",aka:[],abstract:'Creates an icon, similar to those in the sidebar, that, if visible and clicked, "re-does" a turn that was undone. It is only visible if a turn has been undone.  ',anchor:"macro_icon-redo",category:"sidebar",categoryOrder:"3"},iconfullscreen:{name:"icon-fullscreen",sig:" [String], [String]",returnType:"Command",aka:[],abstract:"Creates an icon, similar to those in the sidebar, that, if visible and clicked, toggles fullscreen mode on or off.  ",anchor:"macro_icon-fullscreen",category:"sidebar",categoryOrder:"4"},iconrestart:{name:"icon-restart",sig:" [String]",returnType:"Command",aka:[],abstract:"Creates an icon, similar to those in the sidebar, that, if visible and clicked, reloads the whole page, restarting the story from the beginning.  ",anchor:"macro_icon-restart",category:"sidebar",categoryOrder:"5"},iconcounter:{name:"icon-counter",sig:" Bind, String, [String]",returnType:"Command",aka:[],abstract:"A command that creates a numeric counter element with a text label, designed to fit in the sidebar, displaying the contents of a number variable (rounded to a whole number as if by (trunc:)), and updating it whenever another macro changes it.  ",anchor:"macro_icon-counter",category:"sidebar",categoryOrder:"6"},meter:{name:"meter",sig:" Bind, Number, String, [String], [Colour or Gradient]",returnType:"Command",aka:[],abstract:"A command that creates a horizontal bar-graph meter, showing the current value of a number variable, relative to a maximum value, and updating it whenever that variable changes.  ",anchor:"macro_meter",category:"input and interface"},cyclinglink:{name:"cycling-link",sig:" [Bind], ...String",returnType:"Command",aka:[],abstract:"A command that, when evaluated, creates a cycling link - a link which does not go anywhere, but changes its own text to the next in a looping sequence of strings, and sets the optional bound variable to match the string value of the text.  ",anchor:"macro_cycling-link",category:"input and interface",categoryOrder:"1"},seqlink:{name:"seq-link",sig:" [Bind], ...String",returnType:"Command",aka:["sequence-link"],abstract:"A command that creates a link that does not go anywhere, but changes its own text to the next in a sequence of strings, becoming plain text once the final string is reached, and setting the optional bound variable to match the text at all times.  ",anchor:"macro_seq-link",category:"input and interface",categoryOrder:"2"},sequencelink:{name:"seq-link",sig:" [Bind], ...String",returnType:"Command",aka:["sequence-link"],abstract:"A command that creates a link that does not go anywhere, but changes its own text to the next in a sequence of strings, becoming plain text once the final string is reached, and setting the optional bound variable to match the text at all times.  ",anchor:"macro_seq-link",category:"input and interface",categoryOrder:"2"},dropdown:{name:"dropdown",sig:" Bind, ...String",returnType:"Command",aka:[],abstract:"A command that, when evaluated, creates a dropdown menu with the given strings as options. When one option is selected, the bound variable is set to match the string value of the text.  ",anchor:"macro_dropdown",category:"input and interface"},checkbox:{name:"checkbox",sig:" Bind, String",returnType:"Command",aka:[],abstract:"A command that creates a checkbox input, which sets the given bound variable to `true` or `false`, depending on its state.  ",anchor:"macro_checkbox",category:"input and interface",categoryOrder:"5"},checkboxfullscreen:{name:"checkbox-fullscreen",sig:" String",returnType:"Command",aka:[],abstract:"A command that creates a checkbox input, which toggles the browser's fullscreen mode and windowed mode. The checkbox will automatically update to match the browser's fullscreen status. If fullscreen mode cannot be entered, the checkbox will be disabled.  ",anchor:"macro_checkbox-fullscreen",category:"input and interface",categoryOrder:"6"},inputbox:{name:"input-box",sig:" [Bind], String, [Number], [String]",returnType:"Command",aka:[],abstract:"A command macro that creates a text input box of the given position, width and height, allowing the player to input any amount of text, which can optionally be automatically stored in a variable.  ",anchor:"macro_input-box",category:"input and interface",categoryOrder:"3"},forceinputbox:{name:"force-input-box",sig:" [Bind], String, [Number], String",returnType:"Command",aka:[],abstract:"A command macro that creates an empty text input box of the given position, width and height, which appears to offer the player a means to input text, but instead replaces every keypress inside it with characters from a pre-set string that's relevant to the story.  ",anchor:"macro_force-input-box",category:"input and interface",categoryOrder:"4"},show:{name:"show",sig:" ...HookName",returnType:"Command",aka:[],abstract:"Reveals hidden hooks, running the code within if it's not been shown yet.  ",anchor:"macro_show",category:"showing and hiding"},rerun:{name:"rerun",sig:" ...HookName",returnType:"Command",aka:[],abstract:"Reruns hooks, restoring them to their original contents, and running the macros within them an additional time.  ",anchor:"macro_rerun",category:"revision"},hide:{name:"hide",sig:" ...HookName",returnType:"Command",aka:[],abstract:"Hides a hook that was already visible, without fully erasing it or its contained macro calls.  ",anchor:"macro_hide",category:"showing and hiding"},stop:{name:"stop",sig:"",returnType:"Command",aka:[],abstract:"This macro, which accepts no arguments, creates a (stop:) command, which is not configurable.  ",anchor:"macro_stop",category:"live",categoryOrder:"2"},loadgame:{name:"load-game",sig:" String",returnType:"Command",aka:[],abstract:"This command attempts to load a saved game from the given slot, ending the current game and replacing it with the loaded one. This causes the passage to change.  ",anchor:"macro_load-game",category:"saving"},mockvisits:{name:"mock-visits",sig:" ...String",returnType:"Command",aka:[],abstract:'A macro that can only be used in debug mode, this allows you to mark various passages as "visited", even though the player actually hasn\'t. This allows you to quickly test passages that use the `visits` keyword, or the `(history:)` datamap, without having to play through the whole game from the start.  ',anchor:"macro_mock-visits",category:"debugging"},dialog:{name:"dialog",sig:" [Bind], String, ...String",returnType:"Command",aka:["alert"],abstract:"A command that, when used, displays a pop-up dialog box with the given string displayed, and a number of links labeled with the remaining other strings. When one of the links is clicked to dismiss the dialog, it evaluates to the string text of that clicked link. If an optional bound variable is provided, that variable is updated to match the pressed button.  ",anchor:"macro_dialog",category:"popup",categoryOrder:"1"},alert:{name:"dialog",sig:" [Bind], String, ...String",returnType:"Command",aka:["alert"],abstract:"A command that, when used, displays a pop-up dialog box with the given string displayed, and a number of links labeled with the remaining other strings. When one of the links is clicked to dismiss the dialog, it evaluates to the string text of that clicked link. If an optional bound variable is provided, that variable is updated to match the pressed button.  ",anchor:"macro_dialog",category:"popup",categoryOrder:"1"},openurl:{name:"open-url",sig:" String",returnType:"Command",aka:[],abstract:"When this macro is evaluated, the player's browser attempts to open a new tab with the given URL. This will usually require confirmation from the player, as most browsers block Javascript programs such as Harlowe from opening tabs by default.  ",anchor:"macro_open-url",category:"url"},restart:{name:"restart",sig:"",returnType:"Command",aka:["reload"],abstract:"When this command is used, the player's browser will immediately attempt to reload the page, in effect restarting the entire story.  ",anchor:"macro_restart",category:"navigation"},reload:{name:"restart",sig:"",returnType:"Command",aka:["reload"],abstract:"When this command is used, the player's browser will immediately attempt to reload the page, in effect restarting the entire story.  ",anchor:"macro_restart",category:"navigation"},gotourl:{name:"goto-url",sig:" String",returnType:"Command",aka:[],abstract:"When this command is used, the player's browser will immediately attempt to leave the story's page, and navigate to the given URL in the same tab. If this succeeds, then the story session will \"end\".  ",anchor:"macro_goto-url",category:"url"},ignore:{name:"ignore",sig:" ...[Any]",returnType:"Command",aka:[],abstract:"If you want to test your passage while ignoring a specific command macro in it, temporarily change that command macro's name to (ignore:), and it will ignore all of the data given to it.  ",anchor:"macro_ignore",category:"debugging",categoryOrder:"1"},assertexists:{name:"assert-exists",sig:" HookName or String",returnType:"Command",aka:[],abstract:"A debugging macro that confirms whether a hook with the given name, or passage text matching the given string, is present in the passage. If not, it will produce a helpful error. Use this to test whether enchantment macros like (click:), (enchant:) or (show:) are working properly.  ",anchor:"macro_assert-exists",category:"debugging",categoryOrder:"5"},assert:{name:"assert",sig:" Boolean",returnType:"Instant",aka:[],abstract:"A debugging macro that produces a helpful error whenever the expression given to it produces Boolean false. Use this when testing your story to help ensure that certain facts about the game state are true or not.  ",anchor:"macro_assert",category:"debugging",categoryOrder:"4"},savegame:{name:"save-game",sig:" String, [String]",returnType:"Boolean",aka:[],abstract:"This macro saves the current game's state in browser storage, in the given save slot, and including a special filename. It can then be restored using (load-game:).  ",anchor:"macro_save-game",category:"saving"},prompt:{name:"prompt",sig:" String, String, [String], [String]",returnType:"String",aka:[],abstract:'When this macro is evaluated, a browser pop-up dialog box is shown with the first string displayed, a text entry box containing the second string (as a default value), a confirm link and a cancel link. If the confirm link is clicked, it evaluates to the string in the text entry box. If "Cancel" is clicked, it evaluates to the default value regardless of the entry box\'s contents.  ',anchor:"macro_prompt",category:"popup"},confirm:{name:"confirm",sig:" String, [String], [String]",returnType:"Boolean",aka:[],abstract:"When this macro is evaluated, a pop-up dialog box is shown with the given string displayed, as well as two links (whose text can also be provided) to confirm or cancel whatever action or fact the string tells the player. When it is submitted, it evaluates to the boolean `true` if the confirm link had been clicked, and `false` if the cancel link had.  ",anchor:"macro_confirm",category:"popup"},pageurl:{name:"page-url",sig:"",returnType:"String",aka:[],abstract:"This macro produces the full URL of the story's HTML page, as it is in the player's browser.  ",anchor:"macro_page-url",category:"url"},macro:{name:"macro",sig:" [...TypedVar], CodeHook",returnType:"CustomMacro",aka:[],abstract:"Use this macro to construct your own custom macros, which you can (set:) into variables and call as easily as a built-in macro.  ",anchor:"macro_macro",category:"custom macros",categoryOrder:"1"},outputdata:{name:"output-data",sig:" Any",returnType:"Instant",aka:["out-data"],abstract:"Use this macro inside a (macro:)'s CodeHook to output the value that the macro produces.  ",anchor:"macro_output-data",category:"custom macros",categoryOrder:"3"},outdata:{name:"output-data",sig:" Any",returnType:"Instant",aka:["out-data"],abstract:"Use this macro inside a (macro:)'s CodeHook to output the value that the macro produces.  ",anchor:"macro_output-data",category:"custom macros",categoryOrder:"3"},output:{name:"output",sig:"",returnType:"Changer",aka:["out"],abstract:"Use this macro inside a (macro:)'s CodeHook to output a command that, when run, renders the attached hook.  ",anchor:"macro_output",category:"custom macros",categoryOrder:"2"},out:{name:"output",sig:"",returnType:"Changer",aka:["out"],abstract:"Use this macro inside a (macro:)'s CodeHook to output a command that, when run, renders the attached hook.  ",anchor:"macro_output",category:"custom macros",categoryOrder:"2"},error:{name:"error",sig:" String",returnType:"Instant",aka:[],abstract:"Designed for use in custom macros, this causes the custom macro to immediately produce an error, with the given message string, and ceases running any further code in the CodeHook.  ",anchor:"macro_error",category:"custom macros",categoryOrder:"4"},a:{name:"a",sig:" [...Any]",returnType:"Array",aka:["array"],abstract:"Creates an array, which is an ordered collection of values.  ",anchor:"macro_a",category:"data structure",categoryOrder:"1"},array:{name:"a",sig:" [...Any]",returnType:"Array",aka:["array"],abstract:"Creates an array, which is an ordered collection of values.  ",anchor:"macro_a",category:"data structure",categoryOrder:"1"},range:{name:"range",sig:" Number, Number",returnType:"Array",aka:[],abstract:"Produces an array containing an inclusive range of whole numbers from a to b, in ascending order.  ",anchor:"macro_range",category:"data structure"},subarray:{name:"subarray",sig:" Array, Number, Number",returnType:"Array",aka:[],abstract:"When given an array, this returns a new array containing only the elements whose positions are between the two numbers, inclusively.  ",anchor:"macro_subarray",category:"data structure"},reversed:{name:"reversed",sig:" [...Any]",returnType:"Array",aka:[],abstract:"Similar to (a:), except that it creates an array containing the elements in reverse order.  ",anchor:"macro_reversed",category:"data structure"},shuffled:{name:"shuffled",sig:" Any, ...Any",returnType:"Array",aka:[],abstract:"Similar to (a:), this producws an array of the given values, except that it randomly rearranges the elements instead of placing them in the given order.  ",anchor:"macro_shuffled",category:"data structure"},sorted:{name:"sorted",sig:" Number or String, ...Number or String",returnType:"Array",aka:[],abstract:"Similar to (a:), except that it requires only numbers or strings, and orders them in English alphanumeric sort order, rather than the order in which they were provided.  ",anchor:"macro_sorted",category:"data structure"},rotated:{name:"rotated",sig:" Number, ...Any",returnType:"Array",aka:[],abstract:"Similar to the (a:) macro, but it also takes a number at the start, and moves each item forward by that number, wrapping back to the start if they pass the end of the array.  ",anchor:"macro_rotated",category:"data structure"},rotatedto:{name:"rotated-to",sig:" Lambda, [...Any]",returnType:"Array",aka:[],abstract:'Similar to the (a:) macro, but it also takes a "where" lambda at the start, and cycles the order of the subsequent values so that the first value to match the lambda is placed at the start.  ',anchor:"macro_rotated-to",category:"data structure"},repeated:{name:"repeated",sig:" Number, ...Any",returnType:"Array",aka:[],abstract:"When given a number and a sequence of values, this macro produces an array containing those values repeated, in order, by the given number of times.  ",anchor:"macro_repeated",category:"data structure"},interlaced:{name:"interlaced",sig:" Array, ...Array",returnType:"Array",aka:[],abstract:"Takes multiple arrays, and pairs up each value in those arrays: it creates an array containing each array's first value followed by each array's second value, and so forth. If some values have no matching pair (i.e. one array is longer than the other) then those values are ignored.  ",anchor:"macro_interlaced",category:"data structure"},permutations:{name:"permutations",sig:" ...Any",returnType:"Array",aka:[],abstract:"When given a sequence of values, this produces an array containing each permutation of the order of those values, as arrays.  ",anchor:"macro_permutations",category:"data structure"},altered:{name:"altered",sig:" Lambda, [...Any]",returnType:"Array",aka:[],abstract:'This takes a "via" lambda and a sequence of values, and creates a new array with the same values in the same order, but altered via the operation in the lambda\'s "via" clause.  ',anchor:"macro_altered",category:"data structure"},find:{name:"find",sig:" Lambda, [...Any]",returnType:"Array",aka:[],abstract:"This searches through the given values, and produces an array of those which match the given search test (which is expressed using a temp variable, the `where` keyword, and a boolean condition). If none match, an empty array is produced.  ",anchor:"macro_find",category:"data structure"},allpass:{name:"all-pass",sig:" Lambda, [...Any]",returnType:"Boolean",aka:["pass"],abstract:'This takes a "where" lambda and a series of values, and evaluates to true if the lambda, when run using each value, never evaluated to false.  ',anchor:"macro_all-pass",category:"data structure"},pass:{name:"all-pass",sig:" Lambda, [...Any]",returnType:"Boolean",aka:["pass"],abstract:'This takes a "where" lambda and a series of values, and evaluates to true if the lambda, when run using each value, never evaluated to false.  ',anchor:"macro_all-pass",category:"data structure"},somepass:{name:"some-pass",sig:" Lambda, ...Any",returnType:"Boolean",aka:[],abstract:"This is similar to (all-pass:), but produces true if one or more value, when given to the lambda, evaluated to true. It can be thought of as shorthand for putting `not` in front of (none-pass:). If zero values are given to (all-pass:), then it will return false by default. For more information, consult the description of (all-pass:).  ",anchor:"macro_some-pass",category:"data structure"},nonepass:{name:"none-pass",sig:" Lambda, ...Any",returnType:"Boolean",aka:[],abstract:"This can be thought of as the opposite of (all-pass:): it produces true if every value, when given to the lambda, never evaluated to true. If zero values are given to (none-pass:), then it will return true by default, just like (all-pass:). For more information, consult the description of (all-pass:).  ",anchor:"macro_none-pass",category:"data structure"},folded:{name:"folded",sig:" Lambda, ...Any",returnType:"Any",aka:[],abstract:'This takes a "making" lambda and a sequence of values, and creates a new value (the "total") by feeding every value in the sequence to the lambda, akin to folding a long strip of paper into a single square. The first value after the lambda is put into the total (which is the variable inside the lambda\'s "making" clause) before running the lambda on the remaining values.  ',anchor:"macro_folded",category:"data structure"},datanames:{name:"datanames",sig:" Datamap",returnType:"Array",aka:[],abstract:"This takes a datamap, and returns a sorted array of its data names, sorted alphabetically.  ",anchor:"macro_datanames",category:"data structure"},datavalues:{name:"datavalues",sig:" Datamap",returnType:"Array",aka:[],abstract:"This takes a datamap, and returns an array of its values, sorted alphabetically by their name.  ",anchor:"macro_datavalues",category:"data structure"},dataentries:{name:"dataentries",sig:" Datamap",returnType:"Array",aka:[],abstract:'This takes a datamap, and returns an array of its name/value pairs. Each pair is a datamap that only has "name" and "value" data. The pairs are ordered by their name.  ',anchor:"macro_dataentries",category:"data structure"},history:{name:"history",sig:" [Lambda]",returnType:"Array",aka:[],abstract:"This returns an array containing the string names of all of the passages the player has visited up to now, in the order that the player visited them. An optional lambda can filter the passages, by checking the (passage:) datamap of each. The (mock-visits:) macro can, during debugging, artifically add values to this array to simulate having visited various passages.  ",anchor:"macro_history",category:"game state"},passage:{name:"passage",sig:" [String]",returnType:"Datamap",aka:[],abstract:"When given a passage string name, this provides a datamap containing information about that passage. If no name was provided, then it provides information about the current passage.  ",anchor:"macro_passage",category:"game state"},passages:{name:"passages",sig:" [Lambda]",returnType:"Array",aka:[],abstract:"This returns an array containing datamaps of information for the passages in the story, sorted by passage name, and using the optional search test to only include certain types of passages.  ",anchor:"macro_passages",category:"game state"},openstorylets:{name:"open-storylets",sig:" [Lambda]",returnType:"Array",aka:[],abstract:'Checks all of the (storylet:) macros in every passage, and provides an array of datamaps for every passage whose (storylet:) lambda produced true, sorted by their "urgency" metadata value, then by passage name. If a lambda was provided, the storylets are filtered using it as a search test.  ',anchor:"macro_open-storylets",category:"storylet",categoryOrder:"2"},savedgames:{name:"saved-games",sig:"",returnType:"Datamap",aka:[],abstract:"This returns a datamap containing the names of currently occupied save game slots.  ",anchor:"macro_saved-games",category:"saving"},dm:{name:"dm",sig:" [...Any]",returnType:"Datamap",aka:["datamap"],abstract:"Creates a datamap, which is a data structure that pairs string names with data values. You should provide a string name, followed by the value paired with it, and then another string name, another value, and so on, for as many as you'd like.  ",anchor:"macro_dm",category:"data structure",categoryOrder:"2"},datamap:{name:"dm",sig:" [...Any]",returnType:"Datamap",aka:["datamap"],abstract:"Creates a datamap, which is a data structure that pairs string names with data values. You should provide a string name, followed by the value paired with it, and then another string name, another value, and so on, for as many as you'd like.  ",anchor:"macro_dm",category:"data structure",categoryOrder:"2"},ds:{name:"ds",sig:" [...Any]",returnType:"Dataset",aka:["dataset"],abstract:"Creates a dataset, which is an unordered collection of unique values.  ",anchor:"macro_ds",category:"data structure",categoryOrder:"3"},dataset:{name:"ds",sig:" [...Any]",returnType:"Dataset",aka:["dataset"],abstract:"Creates a dataset, which is an unordered collection of unique values.  ",anchor:"macro_ds",category:"data structure",categoryOrder:"3"},count:{name:"count",sig:" Array or String, ...Any",returnType:"Number",aka:[],abstract:"Accepts a string or array, followed by a value, and produces the number of times any of the values are inside the string or array.  ",anchor:"macro_count",category:"data structure"},change:{name:"change",sig:" HookName or String, Changer or Lambda",returnType:"Command",aka:[],abstract:'Applies a changer (or a "via" lambda producing a changer) to every occurrence of a hook or string in a passage, once.  ',anchor:"macro_change",category:"basics",categoryOrder:"17"},enchant:{name:"enchant",sig:" HookName or String, Changer or Lambda",returnType:"Command",aka:[],abstract:'Applies a changer (or a "via" lambda producing a changer) to every occurrence of a hook or string in a passage, and continues applying that changer to any further occurrences that are made to appear in the same passage later.  ',anchor:"macro_enchant",category:"basics",categoryOrder:"18"},enchantin:{name:"enchant-in",sig:" HookName or String, Changer or Lambda",returnType:"Changer",aka:[],abstract:"A variation of (enchant:) and (change:), this applies a changer to every occurrence of a hook or string within just the attached hook, rather than the whole passage. As with (enchant:), the changer will be applied to every additional occurrence inserted into the attached hook.  ",anchor:"macro_enchant-in",category:"basics",categoryOrder:"19"},linkstyle:{name:"link-style",sig:" Changer or Lambda",returnType:"Changer",aka:[],abstract:"When attached to a hook, this causes all of the links inside the hook to be styled using the specified changer. This is equivalent to using (enchant-in:) with `?link`.  ",anchor:"macro_link-style",category:"styling"},linestyle:{name:"line-style",sig:" Changer or Lambda",returnType:"Changer",aka:[],abstract:"When attached to a hook, this causes all of the lines of prose inside the hook (identical to those that would be selected by `?page's lines`) to be styled using the specified changer.  ",anchor:"macro_line-style",category:"styling"},charstyle:{name:"char-style",sig:" Changer or Lambda",returnType:"Changer",aka:[],abstract:"When attached to a hook, this causes all of the individual non-whitespace characters inside the hook (identical to those that would be selected by `?page's chars`) to be styled using the specified changer.  ",anchor:"macro_char-style",category:"styling"},replace:{name:"replace",sig:" ...HookName or String",returnType:"Changer",aka:[],abstract:"Creates a command which you can attach to a hook, and replace target destinations with the hook's contents. The targets are either text strings within the current passage, or hook references.  ",anchor:"macro_replace",category:"revision"},replacewith:{name:"replace-with",sig:" String",returnType:"Changer",aka:[],abstract:"A counterpart to (append-with:) and (prepend-with:), this replaces the entirety of the attached hook with the given string of prose.  ",anchor:"macro_replace-with",category:"revision"},append:{name:"append",sig:" ...HookName or String",returnType:"Changer",aka:[],abstract:"A variation of (replace:) which adds the attached hook's contents to the end of each target, rather than replacing it entirely.  ",anchor:"macro_append",category:"revision"},appendwith:{name:"append-with",sig:" String",returnType:"Changer",aka:[],abstract:"Creates a changer that, when attached to a hook, adds the given string of code to the end of the hook.  ",anchor:"macro_append-with",category:"revision"},prepend:{name:"prepend",sig:" ...HookName or String",returnType:"Changer",aka:[],abstract:"A variation of (replace:) which adds the attached hook's contents to the beginning of each target, rather than replacing it entirely.  ",anchor:"macro_prepend",category:"revision"},prependwith:{name:"prepend-with",sig:" String",returnType:"Changer",aka:[],abstract:"Creates a changer that, when attached to a hook, adds the given string of code to the start of the hook.  ",anchor:"macro_prepend-with",category:"revision"},click:{name:"click",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"Produces a changer which, when attached to a hook, hides it and enchants the specified target, such that it visually resembles a link, and that clicking it causes the attached hook to be revealed.  ",anchor:"macro_click",category:"links",categoryOrder:"9"},mouseover:{name:"mouseover",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"A variation of (click:) that, instead of showing the hook when the target is clicked, shows it when the mouse pointer merely hovers over it. The target is also styled differently (with a dotted underline), to denote this hovering functionality.  ",anchor:"macro_mouseover",category:"links",categoryOrder:"14"},mouseout:{name:"mouseout",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"A variation of (click:) that, instead of showing the hook when the target is clicked, shows it when the mouse pointer moves over it, and then leaves. The target is also styled differently (a translucent cyan frame), to denote this hovering functionality.  ",anchor:"macro_mouseout",category:"links",categoryOrder:"19"},clickreplace:{name:"click-replace",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"A special shorthand combination of the (click:) and (replace:) macros, this allows you to make a hook replace its own text with that of the attached hook whenever it's clicked. `(click: ?1)[(replace:?1)[...]]` can be rewritten as `(click-replace: ?1)[...]`.  ",anchor:"macro_click-replace",category:"links",categoryOrder:"10"},clickappend:{name:"click-append",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"A special shorthand combination of the (click:) and (append:) macros, this allows you to append text to a hook or string when it's clicked. `(click: ?1)[(append:?1)[...]]` can be rewritten as `(click-append: ?1)[...]`.  ",anchor:"macro_click-append",category:"links",categoryOrder:"11"},clickprepend:{name:"click-prepend",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"A special shorthand combination of the (click:) and (prepend:) macros, this allows you to prepend text to a hook or string when it's clicked. `(click: ?1)[(prepend:?1)[...]]` can be rewritten as `(click-prepend: ?1)[...]`.  ",anchor:"macro_click-prepend",category:"links",categoryOrder:"12"},mouseoverreplace:{name:"mouseover-replace",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"This is similar to (click-replace:), but uses the (mouseover:) macro's behaviour instead of (click:)'s. For more information, consult the description of (click-replace:).  ",anchor:"macro_mouseover-replace",category:"links",categoryOrder:"15"},mouseoverappend:{name:"mouseover-append",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"This is similar to (click-append:), but uses the (mouseover:) macro's behaviour instead of (click:)'s. For more information, consult the description of (click-append:).  ",anchor:"macro_mouseover-append",category:"links",categoryOrder:"16"},mouseoverprepend:{name:"mouseover-prepend",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"This is similar to (click-prepend:), but uses the (mouseover:) macro's behaviour instead of (click:)'s. For more information, consult the description of (click-prepend:).  ",anchor:"macro_mouseover-prepend",category:"links",categoryOrder:"17"},mouseoutreplace:{name:"mouseout-replace",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"This is similar to (click-replace:), but uses the (mouseout:) macro's behaviour instead of (click:)'s. For more information, consult the description of (click-replace:).  ",anchor:"macro_mouseout-replace",category:"links",categoryOrder:"20"},mouseoutappend:{name:"mouseout-append",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"This is similar to (click-append:), but uses the (mouseout:) macro's behaviour instead of (click:)'s. For more information, consult the description of (click-append:).  ",anchor:"macro_mouseout-append",category:"links",categoryOrder:"21"},mouseoutprepend:{name:"mouseout-prepend",sig:" HookName or String, [Changer or Lambda]",returnType:"Changer",aka:[],abstract:"This is similar to (click-prepend:), but uses the (mouseout:) macro's behaviour instead of (click:)'s. For more information, consult the description of (click-prepend:).  ",anchor:"macro_mouseout-prepend",category:"links",categoryOrder:"22"},clickgoto:{name:"click-goto",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"A special shorthand combination of the (click:) and (go-to:) macros, this allows you to make a hook or bit of text into a passage link. `(click-goto: ?1, 'Passage Name')` is equivalent to `(click: ?1)[(goto:'Passage Name')]`  ",anchor:"macro_click-goto",category:"links",categoryOrder:"11"},mouseovergoto:{name:"mouseover-goto",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"This is similar to (click-goto:), but uses the (mouseover:) macro's behaviour instead of (click:)'s. For more information, consult the description of (click-goto:).  ",anchor:"macro_mouseover-goto",category:"links",categoryOrder:"16"},mouseoutgoto:{name:"mouseout-goto",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"This is similar to (click-goto:), but uses the (mouseout:) macro's behaviour instead of (click:)'s. For more information, consult the description of (click-goto:).  ",anchor:"macro_mouseout-goto",category:"links",categoryOrder:"21"},clickundo:{name:"click-undo",sig:" HookName or String",returnType:"Command",aka:[],abstract:"A special shorthand combination of the (click:) and (undo:) macros, this allows you to make a hook or bit of text into a passage link. `(click-undo: ?1)` is equivalent to `(click: ?1)[(undo: )]`  ",anchor:"macro_click-undo",category:"links",categoryOrder:"11"},mouseoverundo:{name:"mouseover-undo",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"This is similar to (click-undo:), but uses the (mouseover:) macro's behaviour instead of (click:)'s. For more information, consult the description of (click-undo:).  ",anchor:"macro_mouseover-undo",category:"links",categoryOrder:"16"},mouseoutundo:{name:"mouseout-undo",sig:" HookName or String, String",returnType:"Command",aka:[],abstract:"This is similar to (click-undo:), but uses the (mouseout:) macro's behaviour instead of (click:)'s. For more information, consult the description of (click-undo:).  ",anchor:"macro_mouseout-undo",category:"links",categoryOrder:"21"},link:{name:"link",sig:" String, [Changer]",returnType:"Changer",aka:["link-replace"],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, vanishes and reveals the hook. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link",category:"links",categoryOrder:"1"},linkreplace:{name:"link",sig:" String, [Changer]",returnType:"Changer",aka:["link-replace"],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, vanishes and reveals the hook. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link",category:"links",categoryOrder:"1"},linkreveal:{name:"link-reveal",sig:" String, [Changer]",returnType:"Changer",aka:[],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook and becomes plain, unstyled text. An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link-reveal",category:"links",categoryOrder:"2"},linkrepeat:{name:"link-repeat",sig:" String, [Changer]",returnType:"Changer",aka:[],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook. Further clicks will cause the hook to repeat itself - a copy of the hook's code will be run, and the result appended to it, in a manner similar to (for:). An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link-repeat",category:"links",categoryOrder:"3"},linkrerun:{name:"link-rerun",sig:" String, [Changer]",returnType:"Changer",aka:[],abstract:"When attached to a hook, this replaces the hook with a link that has the given text. The link, when clicked, reveals the hook. Further clicks will cause the hook to rerun itself, as if by the effect of (rerun:). An optional changer can be given to alter the style of the link (instead of altering the style of the attached hook).  ",anchor:"macro_link-rerun",category:"links",categoryOrder:"4"},linkgoto:{name:"link-goto",sig:" String, [String]",returnType:"Command",aka:[],abstract:"Takes a string of link text, and an optional destination passage name, and makes a command to create a link that takes the player to another passage. The link functions identically to a standard link.  ",anchor:"macro_link-goto",category:"links",categoryOrder:"5"},linkstorylet:{name:"link-storylet",sig:" [String], Number or Lambda, [String]",returnType:"Command",aka:[],abstract:"If there are storylets (passages containing a (storylet:) call) in this story, this will create a link to the first open storylet that matches the passed-in 'where' lambda, or, if a number **n** was passed in, the **n**th (or, if negative, **n**thlast) open storylet. An optional final string can provide text to display when no such storylet is open currently.  ",anchor:"macro_link-storylet",category:"links",categoryOrder:"8"},linkundo:{name:"link-undo",sig:" String",returnType:"Command",aka:[],abstract:"Takes a string of link text, and produces a link that, when clicked, undoes the current turn and sends the player back to the previously visited passage. The link appears identical to a typical passage link.  ",anchor:"macro_link-undo",category:"links",categoryOrder:"7"},linkshow:{name:"link-show",sig:" String, ...HookName",returnType:"Command",aka:[],abstract:"Creates a link that, when clicked, shows the given hidden hooks, running the code within.  ",anchor:"macro_link-show",category:"links",categoryOrder:"8"},linkfullscreen:{name:"link-fullscreen",sig:" String, String, [String]",returnType:"Command",aka:[],abstract:"Creates a link that, when clicked, toggles the browser's fullscreen mode and windowed mode. The first string is used as its link text if the browser is currently in windowed mode, and the second string if it's currently in fullscreen mode. The link will automatically update (re-rendering the link text) to match the browser's current fullscreen state. The optional third string is used when fullscreen mode isn't allowed by the browser - if it's absent or an empty string, the link won't be displayed at all in that situation.  ",anchor:"macro_link-fullscreen",category:"links",categoryOrder:"8"},linkrevealgoto:{name:"link-reveal-goto",sig:" String, [String], [Changer]",returnType:"Changer",aka:[],abstract:"This is a convenient combination of the (link-reveal:) and (go-to:) macros, designed to let you run commands like (set:) just before going to another passage. The first string is the link text, and the second is the passage name. An optional changer, with which to style the link, can also be provided.  ",anchor:"macro_link-reveal-goto",category:"links",categoryOrder:"6"},storylet:{name:"storylet",sig:" Lambda",returnType:"Metadata",aka:[],abstract:"When placed in a passage, it marks that passage as the beginning of a storylet, using the lambda as the condition upon which it's available to the player, so that other macros, like (open-storylets:), can see and select the passage.  ",anchor:"macro_storylet",category:"storylet",categoryOrder:"1"},urgency:{name:"urgency",sig:" Number",returnType:"Metadata",aka:[],abstract:'When placed in a passage that also has a (storylet:) call, it marks that passage as being more or less "urgent", meaning that (open-storylets:) will sort it earlier or later than other passages.  ',anchor:"macro_urgency",category:"storylet",categoryOrder:"4"},exclusivity:{name:"exclusivity",sig:" Number",returnType:"Metadata",aka:[],abstract:'When placed in a passage that also has a (storylet:) call, it marks that passage as being more or less "exclusive", meaning that if it\'s open, it will prevent storylets with lesser exclusivity from appearing in (open-storylets:).  ',anchor:"macro_exclusivity",category:"storylet",categoryOrder:"3"},metadata:{name:"metadata",sig:" [...Any]",returnType:"Metadata",aka:[],abstract:"When placed in a passage, this adds the given names and values to the (passage:) datamap for this passage.  ",anchor:"macro_metadata",category:"game state"},p:{name:"p",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern"],abstract:"Creates a string pattern, a special kind of datatype that can match complex string structures. The pattern matches the entire sequence of strings or datatypes given, in order.  ",anchor:"macro_p",category:"patterns",categoryOrder:"1"},pattern:{name:"p",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern"],abstract:"Creates a string pattern, a special kind of datatype that can match complex string structures. The pattern matches the entire sequence of strings or datatypes given, in order.  ",anchor:"macro_p",category:"patterns",categoryOrder:"1"},peither:{name:"p-either",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-either"],abstract:"Creates a string pattern that matches either of the single strings or datatypes given.  ",anchor:"macro_p-either",category:"patterns",categoryOrder:"2"},patterneither:{name:"p-either",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-either"],abstract:"Creates a string pattern that matches either of the single strings or datatypes given.  ",anchor:"macro_p-either",category:"patterns",categoryOrder:"2"},popt:{name:"p-opt",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-opt","p-optional","pattern-optional"],abstract:"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  ",anchor:"macro_p-opt",category:"patterns",categoryOrder:"3"},patternopt:{name:"p-opt",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-opt","p-optional","pattern-optional"],abstract:"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  ",anchor:"macro_p-opt",category:"patterns",categoryOrder:"3"},poptional:{name:"p-opt",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-opt","p-optional","pattern-optional"],abstract:"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  ",anchor:"macro_p-opt",category:"patterns",categoryOrder:"3"},patternoptional:{name:"p-opt",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-opt","p-optional","pattern-optional"],abstract:"Creates a string pattern that either matches the sequence of strings or datatypes given, or matches the empty string.  ",anchor:"macro_p-opt",category:"patterns",categoryOrder:"3"},pnot:{name:"p-not",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-not"],abstract:"Given any number of string characters or non-spread datatypes, this creates a string pattern that matches any one character that doesn't match any of those values.  ",anchor:"macro_p-not",category:"patterns"},patternnot:{name:"p-not",sig:" ...String or Datatype",returnType:"Datatype",aka:["pattern-not"],abstract:"Given any number of string characters or non-spread datatypes, this creates a string pattern that matches any one character that doesn't match any of those values.  ",anchor:"macro_p-not",category:"patterns"},pmany:{name:"p-many",sig:" [Number], [Number], ...String or Datatype",returnType:"Datatype",aka:["pattern-many"],abstract:"Creates a string pattern that matches the given sequence of strings and datatypes, repeated a given minimum and maximum number of times - or, if these aren't provided, repeated any number of times.  ",anchor:"macro_p-many",category:"patterns",categoryOrder:"4"},patternmany:{name:"p-many",sig:" [Number], [Number], ...String or Datatype",returnType:"Datatype",aka:["pattern-many"],abstract:"Creates a string pattern that matches the given sequence of strings and datatypes, repeated a given minimum and maximum number of times - or, if these aren't provided, repeated any number of times.  ",anchor:"macro_p-many",category:"patterns",categoryOrder:"4"},pins:{name:"p-ins",sig:" ...String or Datatype",returnType:"Datatype",aka:["p-insensitive","pattern-ins","pattern-insensitive"],abstract:"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  ",anchor:"macro_p-ins",category:"patterns",categoryOrder:"5"},pinsensitive:{name:"p-ins",sig:" ...String or Datatype",returnType:"Datatype",aka:["p-insensitive","pattern-ins","pattern-insensitive"],abstract:"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  ",anchor:"macro_p-ins",category:"patterns",categoryOrder:"5"},patternins:{name:"p-ins",sig:" ...String or Datatype",returnType:"Datatype",aka:["p-insensitive","pattern-ins","pattern-insensitive"],abstract:"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  ",anchor:"macro_p-ins",category:"patterns",categoryOrder:"5"},patterninsensitive:{name:"p-ins",sig:" ...String or Datatype",returnType:"Datatype",aka:["p-insensitive","pattern-ins","pattern-insensitive"],abstract:"Creates a string pattern that matches the sequence of strings or datatypes given, case-insensitively.  ",anchor:"macro_p-ins",category:"patterns",categoryOrder:"5"},split:{name:"split",sig:" String or Datatype, String",returnType:"Array",aka:["splitted"],abstract:"This splits up the second value given to it into an array of substrings, after finding and removing each occurrence of the first string or pattern (which is used as a separator value).  ",anchor:"macro_split",category:"string"},splitted:{name:"split",sig:" String or Datatype, String",returnType:"Array",aka:["splitted"],abstract:"This splits up the second value given to it into an array of substrings, after finding and removing each occurrence of the first string or pattern (which is used as a separator value).  ",anchor:"macro_split",category:"string"},trimmed:{name:"trimmed",sig:" [String or Datatype], String",returnType:"String",aka:[],abstract:"This macro takes one string (the last value), and produces a copy with every character matching the given pattern (the first value) removed from the start and end of it. If no pattern is given, it defaults to removing whitespace, as if `whitespace` was the first argument.  ",anchor:"macro_trimmed",category:"string"},if:{name:"if",sig:" Boolean",returnType:"Changer",aka:[],abstract:'This macro accepts only booleans, and produces a changer that can be attached to hooks to hide them "if" the value was false.  ',anchor:"macro_if",category:"basics",categoryOrder:"6"},unless:{name:"unless",sig:" Boolean",returnType:"Changer",aka:[],abstract:'This macro is the negated form of (if:): it accepts only booleans, and returns a changer that can be attached hooks to hide them "if" the value was true.  For more information, see the documentation of (if:).  ',anchor:"macro_unless",category:"basics",categoryOrder:"7"},elseif:{name:"else-if",sig:" Boolean",returnType:"Changer",aka:[],abstract:"This macro's result changes depending on whether the previous hook in the passage was shown or hidden. If the previous hook was shown, then this changer hides the attached hook. Otherwise, it acts like (if:), showing the attached hook if it's true, and hiding it if it's false. If there was no preceding hook before this, then an error message will be printed.  ",anchor:"macro_else-if",category:"basics",categoryOrder:"8"},else:{name:"else",sig:"",returnType:"Changer",aka:[],abstract:"This is a convenient limited variant of the (else-if:) macro. It will simply show the attached hook if the preceding hook was hidden, and hide it otherwise. If there was no preceding hook before this, then an error message will be printed.  ",anchor:"macro_else",category:"basics",categoryOrder:"9"},hidden:{name:"hidden",sig:"",returnType:"Changer",aka:[],abstract:"Produces a changer that can be attached to hooks to hide them.  ",anchor:"macro_hidden",category:"showing and hiding"},verbatim:{name:"verbatim",sig:"",returnType:"Changer",aka:["v6m"],abstract:"When attached to a hook or command, the markup inside that would normally be rendered into HTML is instead presented as plain text, as if the verbatim markup was used on it.  ",anchor:"macro_verbatim",category:"basics",categoryOrder:"15"},v6m:{name:"verbatim",sig:"",returnType:"Changer",aka:["v6m"],abstract:"When attached to a hook or command, the markup inside that would normally be rendered into HTML is instead presented as plain text, as if the verbatim markup was used on it.  ",anchor:"macro_verbatim",category:"basics",categoryOrder:"15"},live:{name:"live",sig:" [Number]",returnType:"Changer",aka:[],abstract:'When you attach this changer to a hook, the hook becomes "live", which means that it\'s repeatedly re-run every certain number of milliseconds, replacing the source inside of the hook with a newly computed version.  ',anchor:"macro_live",category:"live",categoryOrder:"1"},event:{name:"event",sig:" Lambda",returnType:"Changer",aka:[],abstract:"Hooks that have this changer attached will only be run when the given condition becomes true.  ",anchor:"macro_event",category:"live",categoryOrder:"3"},more:{name:"more",sig:"",returnType:"Changer",aka:[],abstract:'Hooks that have this changer attached will only be run once no other exits - links, (mouseover:) or (mouseout:) elements - are remaining in the passage, and will reveal "more" prose.  ',anchor:"macro_more",category:"live",categoryOrder:"5"},after:{name:"after",sig:" Number, [Number]",returnType:"Changer",aka:[],abstract:"Hooks that have this changer attached will only be run once the given amount of time has passed since the passage was rendered. An optional second number specifies that the player can speed up the delay by holding down a keyboard key or mouse button, or by touching the touch device.  ",anchor:"macro_after",category:"live",categoryOrder:"4"},hook:{name:"hook",sig:" String",returnType:"Changer",aka:[],abstract:"A changer that allows the author to give a hook a computed tag name.  ",anchor:"macro_hook",category:"styling"},for:{name:"for",sig:" Lambda, [...Any]",returnType:"Changer",aka:["loop"],abstract:"When attached to a hook, this repeats the attached hook, setting a temporary variable to a different value on each repeat.  ",anchor:"macro_for",category:"basics",categoryOrder:"10"},loop:{name:"for",sig:" Lambda, [...Any]",returnType:"Changer",aka:["loop"],abstract:"When attached to a hook, this repeats the attached hook, setting a temporary variable to a different value on each repeat.  ",anchor:"macro_for",category:"basics",categoryOrder:"10"},transition:{name:"transition",sig:" String",returnType:"Changer",aka:["t8n"],abstract:'A changer that applies a built-in CSS transition to a hook as it appears. Give this macro one of these strings (capitalisation and hyphens ignored): `"instant"`, `"dissolve"`, `"fade"`, `"rumble"`, `"shudder"`, `"pulse"`, `"zoom"`, `"flicker"`, `"slide-left"`, `"slide-right"`, `"slide-up"`, `"slide-down"`, `"fade-left"`, `"fade-right"`, `"fade-up"` and `"fade-down"`.  ',anchor:"macro_transition",category:"transitions",categoryOrder:"1"},t8n:{name:"transition",sig:" String",returnType:"Changer",aka:["t8n"],abstract:'A changer that applies a built-in CSS transition to a hook as it appears. Give this macro one of these strings (capitalisation and hyphens ignored): `"instant"`, `"dissolve"`, `"fade"`, `"rumble"`, `"shudder"`, `"pulse"`, `"zoom"`, `"flicker"`, `"slide-left"`, `"slide-right"`, `"slide-up"`, `"slide-down"`, `"fade-left"`, `"fade-right"`, `"fade-up"` and `"fade-down"`.  ',anchor:"macro_transition",category:"transitions",categoryOrder:"1"},transitiontime:{name:"transition-time",sig:" Number",returnType:"Changer",aka:["t8n-time"],abstract:"A changer that, when added to a (transition:) changer, adjusts the time of the transition.  ",anchor:"macro_transition-time",category:"transitions",categoryOrder:"2"},t8ntime:{name:"transition-time",sig:" Number",returnType:"Changer",aka:["t8n-time"],abstract:"A changer that, when added to a (transition:) changer, adjusts the time of the transition.  ",anchor:"macro_transition-time",category:"transitions",categoryOrder:"2"},transitiondelay:{name:"transition-delay",sig:" Number",returnType:"Changer",aka:["t8n-delay"],abstract:"A changer that, when added to a (transition:) changer, delays the start of the transition by a given time.  ",anchor:"macro_transition-delay",category:"transitions",categoryOrder:"2"},t8ndelay:{name:"transition-delay",sig:" Number",returnType:"Changer",aka:["t8n-delay"],abstract:"A changer that, when added to a (transition:) changer, delays the start of the transition by a given time.  ",anchor:"macro_transition-delay",category:"transitions",categoryOrder:"2"},transitionskip:{name:"transition-skip",sig:" Number",returnType:"Changer",aka:["t8n-skip"],abstract:"A changer that, when added to a (transition:) changer, allows the player to skip or accelerate the transition by holding down a keyboard key or mouse button, or by touching the touch device.  ",anchor:"macro_transition-skip",category:"transitions",categoryOrder:"6"},t8nskip:{name:"transition-skip",sig:" Number",returnType:"Changer",aka:["t8n-skip"],abstract:"A changer that, when added to a (transition:) changer, allows the player to skip or accelerate the transition by holding down a keyboard key or mouse button, or by touching the touch device.  ",anchor:"macro_transition-skip",category:"transitions",categoryOrder:"6"},transitiondepart:{name:"transition-depart",sig:" String",returnType:"Changer",aka:["t8n-depart"],abstract:"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-out animation the link uses.  ",anchor:"macro_transition-depart",category:"transitions",categoryOrder:"4"},t8ndepart:{name:"transition-depart",sig:" String",returnType:"Changer",aka:["t8n-depart"],abstract:"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-out animation the link uses.  ",anchor:"macro_transition-depart",category:"transitions",categoryOrder:"4"},transitionarrive:{name:"transition-arrive",sig:" String",returnType:"Changer",aka:["t8n-arrive"],abstract:"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-in animation the link uses.  ",anchor:"macro_transition-arrive",category:"transitions",categoryOrder:"5"},t8narrive:{name:"transition-arrive",sig:" String",returnType:"Changer",aka:["t8n-arrive"],abstract:"A changer that alters passage links, (link-goto:)s, and most every other kind of link, changing which passage fade-in animation the link uses.  ",anchor:"macro_transition-arrive",category:"transitions",categoryOrder:"5"},button:{name:"button",sig:"",returnType:"Changer",aka:[],abstract:"When applied to a link, this changer styles it so that it resembles a button, and makes it take up the entire passage width. It is not recommended that this be used on non-link hooks.  ",anchor:"macro_button",category:"styling"},border:{name:"border",sig:" String, [String], [String], [String]",returnType:"Changer",aka:["b4r"],abstract:"A changer macro that applies a CSS border to the hook.  ",anchor:"macro_border",category:"borders",categoryOrder:"1"},b4r:{name:"border",sig:" String, [String], [String], [String]",returnType:"Changer",aka:["b4r"],abstract:"A changer macro that applies a CSS border to the hook.  ",anchor:"macro_border",category:"borders",categoryOrder:"1"},bordersize:{name:"border-size",sig:" Number, [Number], [Number], [Number]",returnType:"Changer",aka:["b4r-size"],abstract:"When applied to a hook being changed by the (border:) changer, this multiplies the size of the border by a given amount.  ",anchor:"macro_border-size",category:"borders",categoryOrder:"3"},b4rsize:{name:"border-size",sig:" Number, [Number], [Number], [Number]",returnType:"Changer",aka:["b4r-size"],abstract:"When applied to a hook being changed by the (border:) changer, this multiplies the size of the border by a given amount.  ",anchor:"macro_border-size",category:"borders",categoryOrder:"3"},cornerradius:{name:"corner-radius",sig:" Number, [Number], [Number], [Number]",returnType:"Changer",aka:[],abstract:"When applied to a hook, this rounds the corners by the given number of pixels, causing the hook to become increasingly round or button-like.  ",anchor:"macro_corner-radius",category:"borders",categoryOrder:"4"},bordercolour:{name:"border-colour",sig:" String or Colour, [String or Colour], [String or Colour], [String or Colour]",returnType:"Changer",aka:["b4r-colour","border-color","b4r-color"],abstract:"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  ",anchor:"macro_border-colour",category:"borders",categoryOrder:"2"},b4rcolour:{name:"border-colour",sig:" String or Colour, [String or Colour], [String or Colour], [String or Colour]",returnType:"Changer",aka:["b4r-colour","border-color","b4r-color"],abstract:"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  ",anchor:"macro_border-colour",category:"borders",categoryOrder:"2"},bordercolor:{name:"border-colour",sig:" String or Colour, [String or Colour], [String or Colour], [String or Colour]",returnType:"Changer",aka:["b4r-colour","border-color","b4r-color"],abstract:"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  ",anchor:"macro_border-colour",category:"borders",categoryOrder:"2"},b4rcolor:{name:"border-colour",sig:" String or Colour, [String or Colour], [String or Colour], [String or Colour]",returnType:"Changer",aka:["b4r-colour","border-color","b4r-color"],abstract:"When applied to a hook being changed by the (border:) changer, this changes the border's colour.  ",anchor:"macro_border-colour",category:"borders",categoryOrder:"2"},opacity:{name:"opacity",sig:" Number",returnType:"Changer",aka:[],abstract:"This styling changer changes how opaque the attached hook is, using a value from 0 to 1. Reducing the value makes it more transparent. An opacity of 0 makes the hook invisible.  ",anchor:"macro_opacity",category:"styling"},font:{name:"font",sig:" String",returnType:"Changer",aka:[],abstract:'This styling changer changes the font used to display the text of the attached hook. Provide the font\'s family name (such as "Helvetica Neue" or "Courier") as a string.  ',anchor:"macro_font",category:"styling"},align:{name:"align",sig:" String",returnType:"Changer",aka:[],abstract:"This styling changer changes the alignment of text in the attached hook, as if the `===>`~ arrow syntax was used. In fact, these same arrows (`==>`~, `=><=`~, `<==>`~, `====><=`~ etc.) should be supplied as a string to specify the degree of alignment.  ",anchor:"macro_align",category:"styling"},textcolour:{name:"text-colour",sig:" String or Colour",returnType:"Changer",aka:["colour","text-color","color"],abstract:"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  ",anchor:"macro_text-colour",category:"styling"},colour:{name:"text-colour",sig:" String or Colour",returnType:"Changer",aka:["colour","text-color","color"],abstract:"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  ",anchor:"macro_text-colour",category:"styling"},textcolor:{name:"text-colour",sig:" String or Colour",returnType:"Changer",aka:["colour","text-color","color"],abstract:"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  ",anchor:"macro_text-colour",category:"styling"},color:{name:"text-colour",sig:" String or Colour",returnType:"Changer",aka:["colour","text-color","color"],abstract:"This styling changer changes the colour used by the text in the attached hook. You can supply either a string with a CSS-style colour (a colour name or RGB number supported by CSS), or a built-in colour object.  ",anchor:"macro_text-colour",category:"styling"},textsize:{name:"text-size",sig:" Number",returnType:"Changer",aka:["size"],abstract:"This styling changer changes the text size of the attached hook by the given fraction. Give it a number greater than 1 to enlarge the text, and a number smaller to decrease the text. Providing 1 to this macro will revert the text size back to the default.  ",anchor:"macro_text-size",category:"styling"},size:{name:"text-size",sig:" Number",returnType:"Changer",aka:["size"],abstract:"This styling changer changes the text size of the attached hook by the given fraction. Give it a number greater than 1 to enlarge the text, and a number smaller to decrease the text. Providing 1 to this macro will revert the text size back to the default.  ",anchor:"macro_text-size",category:"styling"},textindent:{name:"text-indent",sig:" Number",returnType:"Changer",aka:[],abstract:"This styling changer causes the attached hook to be indented by the given number of pixels.  ",anchor:"macro_text-indent",category:"styling"},textrotatez:{name:"text-rotate-z",sig:" Number",returnType:"Changer",aka:["text-rotate"],abstract:"This styling changer visually rotates the attached hook clockwise by a given number of degrees. The rotational axis is in the centre of the hook.  ",anchor:"macro_text-rotate-z",category:"styling"},textrotate:{name:"text-rotate-z",sig:" Number",returnType:"Changer",aka:["text-rotate"],abstract:"This styling changer visually rotates the attached hook clockwise by a given number of degrees. The rotational axis is in the centre of the hook.  ",anchor:"macro_text-rotate-z",category:"styling"},textrotatey:{name:"text-rotate-y",sig:" Number",returnType:"Changer",aka:[],abstract:"This styling changer visually rotates the attached hook clockwise, around the Y axis (vertical), by a given number of degrees, making it appear to lean into the page. The rotational axis is in the centre of the hook.  ",anchor:"macro_text-rotate-y",category:"styling"},textrotatex:{name:"text-rotate-x",sig:" Number",returnType:"Changer",aka:[],abstract:"This styling changer visually rotates the attached hook clockwise, around the X axis (horizontal), by a given number of degrees, making it appear to lean into the page. The rotational axis is in the centre of the hook.  ",anchor:"macro_text-rotate-x",category:"styling"},background:{name:"background",sig:" Colour or String or Gradient",returnType:"Changer",aka:["bg"],abstract:'This styling changer alters the background colour or background image of the attached hook. Supplying a gradient (produced by (gradient:)) will set the background to that gradient. Supplying a colour (produced by (rgb:) or (hsl:), a built-in colour value like `red`, or a bare colour value like #FA9138) will set the background to a flat colour. CSS strings that resemble HTML hex colours (like "#FA9138") will also provide flat colour. Other strings will be interpreted as an image URL, and the background will be set to it.  ',anchor:"macro_background",category:"styling"},bg:{name:"background",sig:" Colour or String or Gradient",returnType:"Changer",aka:["bg"],abstract:'This styling changer alters the background colour or background image of the attached hook. Supplying a gradient (produced by (gradient:)) will set the background to that gradient. Supplying a colour (produced by (rgb:) or (hsl:), a built-in colour value like `red`, or a bare colour value like #FA9138) will set the background to a flat colour. CSS strings that resemble HTML hex colours (like "#FA9138") will also provide flat colour. Other strings will be interpreted as an image URL, and the background will be set to it.  ',anchor:"macro_background",category:"styling"},textstyle:{name:"text-style",sig:" ...String",returnType:"Changer",aka:[],abstract:'This applies one or more selected built-in text styles to the hook\'s text. Give this macro one of these strings (capitalisation and hyphens ignored): `"none"`, `"bold"`, `"italic"`, `"underline"`, `"double-underline"`, `"wavy-underline"`, `"strike"`, `"double-strike"`, `"wavy-strike"`, `"superscript"`, `"subscript"`, `"blink"`, `"shudder"`, `"mark"`, `"condense"`, `"expand"`, `"outline"`, `"shadow"`, `"emboss"`, `"smear"`, `"blur"`, `"blurrier"`, `"mirror"`, `"upside-down"`, `"fade-in-out"`, `"rumble"`, `"sway"`, `"buoy"` or `"fidget"`.  ',anchor:"macro_text-style",category:"styling"},collapse:{name:"collapse",sig:"",returnType:"Changer",aka:[],abstract:"When attached to a hook, this collapses the whitespace within the hook, in the same manner as the collapsing whitespace markup.  ",anchor:"macro_collapse",category:"styling"},hoverstyle:{name:"hover-style",sig:" Changer",returnType:"Changer",aka:[],abstract:"Given a style-altering changer, it makes a changer which only applies when the hook or command is hovered over with the mouse pointer, and is removed when hovering off.  ",anchor:"macro_hover-style",category:"styling"},css:{name:"css",sig:" String",returnType:"Changer",aka:[],abstract:'This takes a string of inline CSS, and applies it to the hook, as if it were a HTML "style" property.  ',anchor:"macro_css",category:"styling"},testtrue:{name:"test-true",sig:" ...[Any]",returnType:"Changer",aka:[],abstract:"If you want to test your passage, while ignoring a specific changer macro in it, temporarily change that changer macro's name to (test-true:), and it will ignore all of the data given to it, while enabling the hook.  ",anchor:"macro_test-true",category:"debugging",categoryOrder:"2"},testfalse:{name:"test-false",sig:" ...[Any]",returnType:"Changer",aka:[],abstract:"If you want to test your passage in order to see what would happen if an (if:), (unless:) or (else-if:) macro would hide the hook it's attached to, you can temporarily change the name of the macro to (test-false:), which causes it to ignore the data given to it and act as if it was given `false`.  ",anchor:"macro_test-false",category:"debugging",categoryOrder:"3"},animate:{name:"animate",sig:" HookName, String, [Number]",returnType:"Command",aka:[],abstract:"A command that causes a hook to briefly animate, as if a (transition:) was applied to it. The length of time that the animation plays can be optionally altered by providing a number.  ",anchor:"macro_animate",category:"transitions"},box:{name:"box",sig:" String, [Number]",returnType:"Changer",aka:[],abstract:'When attached to a hook, it becomes a "box", with a given width proportional to the containing element\'s width, an optional number of lines tall, and a scroll bar if its contained text is longer than its height can contain.  ',anchor:"macro_box",category:"styling"},floatbox:{name:"float-box",sig:" String, String",returnType:"Changer",aka:[],abstract:'When attached to a hook, it becomes a "floating box", placed at a given portion of the window, sized proportionally to the window\'s dimensions, and with a scroll bar if its contained text is longer than its height can contain.  ',anchor:"macro_float-box",category:"styling"},str:{name:"str",sig:" ...[Number or String or Boolean or Array]",returnType:"String",aka:["string","text"],abstract:"(str:) accepts any amount of expressions and tries to convert them all to a single String.  ",anchor:"macro_str",category:"string",categoryOrder:"1"},string:{name:"str",sig:" ...[Number or String or Boolean or Array]",returnType:"String",aka:["string","text"],abstract:"(str:) accepts any amount of expressions and tries to convert them all to a single String.  ",anchor:"macro_str",category:"string",categoryOrder:"1"},text:{name:"str",sig:" ...[Number or String or Boolean or Array]",returnType:"String",aka:["string","text"],abstract:"(str:) accepts any amount of expressions and tries to convert them all to a single String.  ",anchor:"macro_str",category:"string",categoryOrder:"1"},source:{name:"source",sig:" Any",returnType:"String",aka:[],abstract:"When given almost any data value, this will produce a string of Harlowe source code that can, when run, create that value exactly.  ",anchor:"macro_source",category:"string"},substring:{name:"substring",sig:" String, Number, Number",returnType:"String",aka:[],abstract:"This macro produces a substring of the given string, cut from two inclusive number positions.  ",anchor:"macro_substring",category:"string"},lowercase:{name:"lowercase",sig:" String",returnType:"String",aka:[],abstract:"This macro produces a lowercase version of the given string.  ",anchor:"macro_lowercase",category:"string"},uppercase:{name:"uppercase",sig:" String",returnType:"String",aka:[],abstract:"This macro produces an uppercase version of the given string.  ",anchor:"macro_uppercase",category:"string"},lowerfirst:{name:"lowerfirst",sig:" String",returnType:"String",aka:[],abstract:"This macro produces a version of the given string, where the first alphanumeric character is lowercase, and other characters are left as-is.  ",anchor:"macro_lowerfirst",category:"string"},upperfirst:{name:"upperfirst",sig:" String",returnType:"String",aka:[],abstract:"This macro produces a version of the given string, where the first alphanumeric character is uppercase, and other characters are left as-is.  ",anchor:"macro_upperfirst",category:"string"},words:{name:"words",sig:" String",returnType:"Array",aka:[],abstract:'This macro takes a string and creates an array of each word ("word" meaning a sequence of non-whitespace characters) in the string.  ',anchor:"macro_words",category:"string"},strrepeated:{name:"str-repeated",sig:" Number, String",returnType:"String",aka:["string-repeated"],abstract:"A special shorthand combination of the (str:) and (repeated:) macros, this accepts a single string and duplicates it the given number of times.  ",anchor:"macro_str-repeated",category:"string"},stringrepeated:{name:"str-repeated",sig:" Number, String",returnType:"String",aka:["string-repeated"],abstract:"A special shorthand combination of the (str:) and (repeated:) macros, this accepts a single string and duplicates it the given number of times.  ",anchor:"macro_str-repeated",category:"string"},strreversed:{name:"str-reversed",sig:" String",returnType:"String",aka:["string-reversed"],abstract:"A special shorthand combination of the (str:) and (reversed:) macros, this accepts a single string and reverses it.  ",anchor:"macro_str-reversed",category:"string"},stringreversed:{name:"str-reversed",sig:" String",returnType:"String",aka:["string-reversed"],abstract:"A special shorthand combination of the (str:) and (reversed:) macros, this accepts a single string and reverses it.  ",anchor:"macro_str-reversed",category:"string"},joined:{name:"joined",sig:" ...String",returnType:"String",aka:[],abstract:"Using the first string as a separator value, this macro takes all of the other strings given to it, and joins them into a single string.  ",anchor:"macro_joined",category:"string"},plural:{name:"plural",sig:" Number, String, [String]",returnType:"String",aka:[],abstract:'This macro takes a whole number and a string, then converts the number to a string, joins them up with a space character, and pluralises the string if the number wasn\'t 1 or -1. By default, this pluralisation is done by adding "s", as in some English plurals. An optional extra string can specify a different plural word to use instead.  ',anchor:"macro_plural",category:"string"},strnth:{name:"str-nth",sig:" Number",returnType:"String",aka:["string-nth"],abstract:'This macro takes a whole number, and converts it to a string comprising an English ordinal abbreviation (of the form "nth", such as "1st", "22nd", etc.).  ',anchor:"macro_str-nth",category:"string"},stringnth:{name:"str-nth",sig:" Number",returnType:"String",aka:["string-nth"],abstract:'This macro takes a whole number, and converts it to a string comprising an English ordinal abbreviation (of the form "nth", such as "1st", "22nd", etc.).  ',anchor:"macro_str-nth",category:"string"},num:{name:"num",sig:" String",returnType:"Number",aka:["number"],abstract:"This macro converts strings to numbers by reading the digits in the entire string. It can handle decimal fractions and negative numbers. If any letters or other unusual characters appear in the number, it will result in an error.  ",anchor:"macro_num",category:"number"},number:{name:"num",sig:" String",returnType:"Number",aka:["number"],abstract:"This macro converts strings to numbers by reading the digits in the entire string. It can handle decimal fractions and negative numbers. If any letters or other unusual characters appear in the number, it will result in an error.  ",anchor:"macro_num",category:"number"},datatype:{name:"datatype",sig:" Any",returnType:"Datatype",aka:[],abstract:"This macro takes any storeable value, and produces a datatype that matches it.  ",anchor:"macro_datatype",category:"custom macros",categoryOrder:"5"},datapattern:{name:"datapattern",sig:" Any",returnType:"Any",aka:[],abstract:"This takes any storeable value, and produces a datatype that matches it, in a manner similar to (datatype:). However, when given an array or datamap, it creates an array or datamap with its values replaced with their datatypes, which can be used as a more accurate pattern with `matches` or (set:) elsewhere.  ",anchor:"macro_datapattern",category:"custom macros",categoryOrder:"6"},rgb:{name:"rgb",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["rgba"],abstract:"This macro creates a colour using the three red (r), green (g) and blue (b) values provided, whose values are numbers between 0 and 255, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_rgb",category:"colour",categoryOrder:"2"},rgba:{name:"rgb",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["rgba"],abstract:"This macro creates a colour using the three red (r), green (g) and blue (b) values provided, whose values are numbers between 0 and 255, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_rgb",category:"colour",categoryOrder:"2"},hsl:{name:"hsl",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["hsla"],abstract:"This macro creates a colour using the given hue (h) angle in degrees, as well as the given saturation (s) and lightness (l) percentages, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_hsl",category:"colour",categoryOrder:"1"},hsla:{name:"hsl",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["hsla"],abstract:"This macro creates a colour using the given hue (h) angle in degrees, as well as the given saturation (s) and lightness (l) percentages, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_hsl",category:"colour",categoryOrder:"1"},lch:{name:"lch",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["lcha"],abstract:"This macro creates a colour using three values in the CIELAB colour model - a lightness (l) percentage, a chroma (c) value, and a hue (h) angle in degrees, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_lch",category:"colour",categoryOrder:"3"},lcha:{name:"lch",sig:" Number, Number, Number, [Number]",returnType:"Colour",aka:["lcha"],abstract:"This macro creates a colour using three values in the CIELAB colour model - a lightness (l) percentage, a chroma (c) value, and a hue (h) angle in degrees, and, optionally, the transparency (alpha, or a) percentage, which is a fractional value between 0 (fully transparent) and 1 (fully visible).  Anything drawn with a partially transparent colour will itself be partially transparent. You can then layer such elements to produce a few interesting visual effects.  ",anchor:"macro_lch",category:"colour",categoryOrder:"3"},complement:{name:"complement",sig:" Colour",returnType:"Colour",aka:[],abstract:"When given a colour, this provides a complement to that colour.  ",anchor:"macro_complement",category:"colour",categoryOrder:"4"},palette:{name:"palette",sig:" String, Colour",returnType:"Array",aka:[],abstract:"When given a string specifying a palette type, and a colour, this macro produces an array containing the given colour followed by three additional colours that together form a palette, for use with (text-colour:), (background:), and other macros.  ",anchor:"macro_palette",category:"colour",categoryOrder:"5"},gradient:{name:"gradient",sig:" Number, ...Number, Colour",returnType:"Gradient",aka:[],abstract:'When given a degree angle, followed by any number of number-colour pairs called "colour stops", this macro produces a gradient that fades between those colours in the direction of the angle.  ',anchor:"macro_gradient",category:"colour",categoryOrder:"6"},stripes:{name:"stripes",sig:" Number, Number, Colour, Colour",returnType:"Gradient",aka:[],abstract:"When given a degree angle, a pixel distance, and two or more colours, this macro produces a gradient that draws a striped background, with each stripe as wide as the distance, and alternating through the given colours.  ",anchor:"macro_stripes",category:"colour",categoryOrder:"7"},hooksnamed:{name:"hooks-named",sig:" String",returnType:"HookName",aka:[],abstract:"When given a string, this creates a HookName from it. This can be used to dynamically create HookNames.  ",anchor:"macro_hooks-named",category:"basics"},cond:{name:"cond",sig:" Boolean, Any, ...Any",returnType:"Any",aka:[],abstract:'When given a sequence of booleans (the "conditions") paired with values, this provides the first value that was paired with a `true` condition. This can give you one value or another based on a quick check.  ',anchor:"macro_cond",category:"basics",categoryOrder:"12"},weekday:{name:"weekday",sig:"",returnType:"String",aka:[],abstract:'This date/time macro produces one of the strings "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday" or "Saturday", based on the weekday on the current player\'s system clock.  ',anchor:"macro_weekday",category:"date and time"},monthday:{name:"monthday",sig:"",returnType:"Number",aka:[],abstract:"This date/time macro produces a number corresponding to the day of the month on the current player's system clock. This should be between 1 (on the 1st of the month) and 31, inclusive.  ",anchor:"macro_monthday",category:"date and time"},currenttime:{name:"current-time",sig:"",returnType:"String",aka:[],abstract:'This date/time macro produces a string of the current 12-hour time on the current player\'s system clock, in the format "12:00 AM".  ',anchor:"macro_current-time",category:"date and time"},currentdate:{name:"current-date",sig:"",returnType:"String",aka:[],abstract:'This date/time macro produces a string of the current date the current player\'s system clock, in the format "Thu Jan 01 1970".  ',anchor:"macro_current-date",category:"date and time"},min:{name:"min",sig:" ...Number",returnType:"Number",aka:[],abstract:"This maths macro accepts numbers, and evaluates to the lowest valued number.  ",anchor:"macro_min",category:"maths"},max:{name:"max",sig:" ...Number",returnType:"Number",aka:[],abstract:"This maths macro accepts numbers, and evaluates to the highest valued number.  ",anchor:"macro_max",category:"maths"},abs:{name:"abs",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro finds the absolute value of a number (without the sign).  ",anchor:"macro_abs",category:"maths"},sign:{name:"sign",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces -1 when given a negative number, 0 when given 0, and 1 when given a positive number.  ",anchor:"macro_sign",category:"maths"},sin:{name:"sin",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro computes the sine of the given number of radians.  ",anchor:"macro_sin",category:"maths"},cos:{name:"cos",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro computes the cosine of the given number of radians.  ",anchor:"macro_cos",category:"maths"},tan:{name:"tan",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro computes the tangent of the given number of radians.  ",anchor:"macro_tan",category:"maths"},floor:{name:"floor",sig:" Number",returnType:"Number",aka:[],abstract:"This macro rounds the given number downward to a whole number. If a whole number is provided, it returns the number as-is.  ",anchor:"macro_floor",category:"number"},round:{name:"round",sig:" Number",returnType:"Number",aka:[],abstract:"This macro rounds the given number to the nearest whole number - downward if its decimals are smaller than 0.5, and upward otherwise. If a whole number is provided, it returns the number as-is.  ",anchor:"macro_round",category:"number"},trunc:{name:"trunc",sig:" Number",returnType:"Number",aka:[],abstract:'This macro rounds the given number towards zero. This "truncates" the fractional portion of the number, removing it and leaving just the whole portion.  ',anchor:"macro_trunc",category:"number"},ceil:{name:"ceil",sig:" Number",returnType:"Number",aka:[],abstract:"This macro rounds the given number upward to a whole number. If a whole number is provided, it returns the number as-is.  ",anchor:"macro_ceil",category:"number"},pow:{name:"pow",sig:" Number, Number",returnType:"Number",aka:[],abstract:"This maths macro raises the first number to the power of the second number, and provides the result.  ",anchor:"macro_pow",category:"maths"},exp:{name:"exp",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro raises Euler's number to the power of the given number, and provides the result.  ",anchor:"macro_exp",category:"maths"},sqrt:{name:"sqrt",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces the square root of the given number.  ",anchor:"macro_sqrt",category:"maths"},log:{name:"log",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces the natural logarithm (the base-e logarithm) of the given number.  ",anchor:"macro_log",category:"maths"},log10:{name:"log10",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces the base-10 logarithm of the given number.  ",anchor:"macro_log10",category:"maths"},log2:{name:"log2",sig:" Number",returnType:"Number",aka:[],abstract:"This maths macro produces the base-2 logarithm of the given number.  ",anchor:"macro_log2",category:"maths"},random:{name:"random",sig:" Number, [Number]",returnType:"Number",aka:[],abstract:"This macro produces a whole number randomly selected between the two whole numbers, inclusive (or, if the second number is absent, then between 0 and the first number, inclusive).  ",anchor:"macro_random",category:"number"},either:{name:"either",sig:" ...Any",returnType:"Any",aka:[],abstract:"Give this macro several values, separated by commas, and it will pick and return one of them randomly.  ",anchor:"macro_either",category:"basics",categoryOrder:"11"},nth:{name:"nth",sig:" Number, ...Any",returnType:"Any",aka:[],abstract:"Given a positive whole number and a sequence of values, this selects the nth value in the sequence, where n is the number. If n is larger than the number of items in the sequence, the selection loops around to the start.  ",anchor:"macro_nth",category:"basics",categoryOrder:"13"}}};this&&this.loaded?(this.modules||(this.modules={}),this.modules.ShortDefs=e):this.ShortDefs=e}.call(eval("this")),function(){var e=void 0,t=function(e){return(e+"").toLowerCase().replace(/-|_/g,"")},a="This markup gives the enclosed text ",r=function(e){return'The <b>"'+e+'" operator</b> produces the boolean value `true` if '},o=" Otherwise, it produces `false`.",n="If they contain strings, numbers, commands or changers, you can place them directly in your prose to display the value, run the command, or apply the changer.",i=function(e){return'The keyword <b>"'+e+'"</b> makes the code on the right into a <b>"'+e+'" lambda clause</b>. '},s={hr:"This is a <b>horizontal rule</b>. It extends across the entire passage width (or the column width, if it's in a column).",bulleted:"The `*` at the start of this line makes this a <b>bulleted list item</b>.",numbered:"The `0.` at the start of this line makes this a <b>numbered list item</b>.",heading:function(e){var t=e.depth;return"This is a <b>level "+t+" "+(1===t?"(largest) ":"")+"heading</b> mark."},align:function(e){var t=e.align;return"This is an <b>aligner</b> mark. The text after this is "+("justify"===t?"justified (spaced out to touch both edges)":"aligned to the "+t)+". Write `<==` for left alignment, `==>` for right alignment, `=><=` for centering, and `<==>` for justified alignment."},column:function(e){var t=e.text,a=e.width,r=e.marginRight,o=e.marginLeft;return t.trim().startsWith("|")&&t.trim().endsWith("|")?"This mark ends all of the preceding columns. The text after this is not in a column.":"The text after this mark is in a <b>column</b> with width multiplier "+a+"x, a left margin of "+o+"em, and a right margin of "+r+"em. Write more consecutive `|` marks to increase the width, and place `=` to the left and right to increase the margin on that side."},em:a+"<b>emphasis style</b>.",strong:a+"<b>strong emphasis style</b>.",bold:a+"<b>bold style</b>.",italic:a+"<b>italic style</b>.",strike:a+"<b>strikethrough style</b>.",sup:a+"<b>superscript style</b>.",comment:"This is a <b>HTML comment</b>. Everything inside it will be ignored by Harlowe.",scriptStyleTag:function(){return s.tag},tag:"This is a <b>HTML tag</b>. Harlowe supports raw HTML in passage code.",hook:function(e){var t=e.type,a=e.name,r=e.tagPosition;return("hook"===t?"These square brackets are a <b>hook</b>, enclosing this section of passage code.":"")+" Changer values can be attached to the left of hooks."+(a?"<br>This hook has a <b>nametag</b> on the "+("prepended"===r?"left":"right")+". This allows the hook to be referred to in macro calls using the hook name <code>?"+a+"</code>.":"")},unclosedHook:function(e){return"This marks all of the remaining code in the passage as being inside a <b>hook</b>."+s.hook(e)},verbatim:"This is <b>verbatim markup</b>. Place text between matching pairs and amounts of <code>`</code> marks, and Harlowe will ignore the markup within, instead displaying it as-is.",unclosedCollapsed:function(e){return s.collapsed(e)},collapsed:function(e){var t=e.type;return"This is <b>"+("unclosedCollapsed"===t?"unclosed ":"")+"collapsed whitespace</b> markup. All sequences of consecutive whitespace within "+("unclosedCollapsed"===t?"the remainder of the passage ":"the <code>{</code> and <code>}</code> marks")+" will be replaced with a single space. You can use this to space out your code and keep your passage readable.<br>To include a line break within this markup that will be preserved, use a HTML <code>&lt;br&gt;</code> tag."},escapedLine:"This is an <b>escaped line break</b> mark. This removes the line break before or after it from the displayed passage.",twineLink:function(e){return'This is a <b>link to the passage "'+e.passage+'"</b>. Links, like hooks and commands, can have changer values attached to the left.'},br:"",url:"",variable:"This is a <b>story-wide variable</b>. After this has been set to a data value, it can be used anywhere else in the story. Use these to store data values related to your story's game state, or changers that are commonly used. "+n,tempVariable:"This is a <b>temp variable</b>. It can be used in the same passage and hook in which it's first set to a data value. Use these to store values temporarily, or that won't be needed elsewhere. "+n,macroName:function(e,t){var a=_slicedToArray(t,2)[1];return s.macro(a)},grouping:"Use these <b>grouping brackets</b> to ensure operations are performed in a certain order. Code in brackets will be computed before the code adjacent to it.",property:function(e){var t=e.type,a=e.name;return(a?"This retrieves the data stored at <b>the `"+a+"` "+(a.match(/^\d+(?:th|nd|st|rd)(?:last)?(?:to\d+(?:nth|nd|st|rd)(?:last)?)?$/g)?"position"+(a.includes("to")?"s":""):"name")+"</b> of the container value on the "+(t.startsWith("belonging")?"right":"left")+".<br><br>":"")+"Some types of data values (arrays, datamaps, datasets, strings, colours, gradients, custom macros, and typedvars) are also storage containers for other values. You can access a specific value stored in them using that value's <b>data name</b> (or a string or number value in brackets) by writing <i>value</i> `'s` <i>name</i>, or <i>name</i> `of` <i>value</i>."},possessiveOperator:function(e){return s.property(e)},itsProperty:function(e){return s.property(e)},itsOperator:function(e){return s.identifier(e)},belongingItProperty:function(e){return s.property(e)},belongingItOperator:function(e){return s.property(e)},belongingProperty:function(e){return s.property(e)},belongingOperator:function(e){return s.property(e)},escapedStringChar:"",string:'This is <b>string data</b>. Strings are sequences of text data enclosed in matching " or \' marks. Use a `\\` inside a string to "escape" the next character. Escaped " or \' marks don\'t count as the end of the string.',hookName:function(e){return'This <b>hook name</b> refers to all hooks named "`'+e.name+'`" in this passage.'},cssTime:function(e){return"This is <b>number data</b> in CSS time format. Harlowe automatically converts this to a number of milliseconds, so this is identical to "+e.value+"."},datatype:"This is the name of a <b>datatype</b>. Use these names to check what kind of data a data value is, using the `matches` or `is a` operators.<br>You can also use them in a `(set:)` or `(put:)` to restrict that variable's data for error-checking purposes. (See the documentation for details.)",colour:function(e){return"This is a "+(e.text.startsWith("#")?"<b>HTML colour value</b>. Harlowe can use this as colour data.":"built-in Harlowe <b>colour value</b>. The built-in colours are `red`, `orange`, `yellow`, `lime`, `green`, `cyan` (alias `aqua`), `blue`, `navy`, `purple`, `fuchsia` (alias `magenta`), `white`, `gray` (alias `grey`), `black`, and `transparent`.")},number:"This is <b>number data</b>. Harlowe supports whole numbers (like `2`), negative numbers (like `-2`), and numbers with a decimal fraction component (like `2.2`).",inequality:function(e){var t=e.operator,a=(">"===(t=e.negate?{">":"<=","<":">=",">=":"<","<=":">"}[t]:t)[0]?"greater ":"less ")+"than"+(t.endsWith("=")?" or equal to":"");return r(a)+" the number value on the left is "+a+" the number value on the right."+o},augmentedAssign:"This is an <b>augmented assignment operator</b>, similar to the ones in Javascript.",identifier:function(e){var a=e.text;return(a=t(a)).startsWith("it")?"The keyword <b>it</b> is a shorthand for the leftmost part of an operation. You can write `(if: $candles < 2 and it > 5)` instead of `(if: $candles < 2 and $candles > 5)` or `(set: $candles to it + 3)` instead of `(set: $candles to $candles + 3)`. When accessing a data value from it, you can write it as <b>its</b>, such as in `its length > 0`.":"time"===a?"The keyword <b>time</b> equals the number of milliseconds passed since the passage was displayed.":a.startsWith("exit")?'The keyword <b>exits</b> or <b>exit</b> equals the number of currently available "exits" in a passage - the number of link, mouseover, and mouseout elements that are still active on the page, which could lead to new content and progress.':a.startsWith("visit")?"The keyword <b>visits</b> or <b>visit</b> equals the number of times the current passage has been visited this game, including the current visit. In `(storylet:)` macros, when Harlowe decides whether this passage is available to `(open-storylets:)`, this will often be 0, but when actually visiting the passage, it will be at least 1.":"pos"===a?'The keyword <b>pos</b> should ONLY be used within a "where" or "via" lambda clause. It refers to the position of the current data value that this lambda is processing.':""},whitespace:"<b>Whitespace</b> within macro calls is simply used to separate values. You can use as much or as little as you like to make your code more readable.",error:function(e,t){var a=_slicedToArray(t,1)[0],r=a.message,o=a.explanation;return r+(o?"<br>"+o:"")},boolean:"The keywords <b>true</b> or <b>false</b> are the two <b>boolean values</b>. They are produced by comparison operators (`<`, `>`, `is`, etc.) and other macros.",is:'The <b>"is" operator</b> produces the boolean value `true` if the values on each sides of it are exactly the same.'+o,to:'Use the <b>"to" operator</b> only inside a `(set:)` macro call. Place it to the left of the data, and right of the variable to set the data to.',into:'Use the <b>"into" operator</b> only inside a `(put:)`, `(move:)` or `(unpack:)` macro call. Place it to the right of the data, and left of the destination to put the data.',where:i("where")+"This lambda will search for input values <i>where</i> the right side, once computed, produces `true`.",when:i("when")+"This lambda will cause the macro to only do something <i>when</i> the right side, once computed, produces `true`.",via:i("via")+"This lambda will convert input values into new values <i>via</i> computing the expression to the right.",making:i("making")+"This is used only by the `(folded:)` macro. The lambda <i>makes</i> the temp variable on the right, which becomes the final value of the `(folded:)` call.",each:i("each")+"This causes the macro to, for <i>each</i> input value, place that value in the temp variable on the right, before running the other lambda clauses adjacent to this one (if any).",and:r("and")+"the values on each side of it are both `true`."+o,or:r("or")+"the values on each side of it are both `false`."+o,not:'The <b>"not" operator</b> inverts the boolean value to its right, turning `true` to `false` and vice-versa.',isNot:r("is not")+"the values on each sides of it are NOT exactly the same."+o,contains:r("contains")+"the array, string, datamap or dataset on the left contains the data on the right."+o,doesNotContain:r("does not contain")+"the array, string, datamap or dataset on the left does NOT contain the data on the right."+o,isIn:r("is in")+"the data on the left is in the array, string, datamap or dataset on the right."+o,isA:r("is a")+"the data on the left matches the datatype on the right."+o,isNotA:r("is not a")+"the data on the left does NOT match the datatype on the right."+o,isNotIn:r("is not in")+"the data on the left is NOT in the array, string, datamap or dataset on the right."+o,matches:r("matches")+"one side describes the other - that is, if one side is a datatype that describes the other, or both sides are arrays, datamaps, or datasets, with data in positions that matches those in the other, or if both sides are equal."+o,doesNotMatch:r("does not match")+"one side does NOT describe the other."+o,bind:'The <b>bind</b> or <b>2bind</b> keyword specifies that the variable to the right should be "bound" to an interactable element. This is used only by certain command macros, like `(dialog:)` or `(cycling-link:)`.',comma:"Use <b>commas</b> to separate the values that you give to macro calls.",spread:"This is a <b>spreader</b>. These spread out the values in the array, string or dataset to the right of it, as if each value was individually placed in the call and separated with commas.<br><br>Alternatively, if a datatype is to the right of it, that datatype becomes a <b>spread datatype</b> that matches zero or more of itself.",typeSignature:"The <b>-type</b> suffix is used to restrict the variable on the right to only holding data that matches the data pattern on the left. Variables restricted in this way are called <b>typed variables</b>.",addition:"Use the <b>addition operator</b> to add two numbers together, as well as join two strings or two arrays, and combine two datamaps, two datasets, two changers, or two colours.This operator can also combine two hook names, creating a hook name that applies to both names of hooks.",subtraction:"Use the <b>subtraction operator</b> to subtract two numbers, as well as create a copy of the array or dataset on the left that doesn't contain values of the array or dataset on the right.",multiplication:"Use the <b>multiplication operator</b> to multiply two numbers.",division:function(e){return("/"===e.text?"Use the <b>division operator</b> to divide":"Use the <b>modulo operator</b> to get the remainder (modulo) from dividing")+" two numbers. Dividing a number by 0 produces an error."},macro:function(a){var r=a.name;if(void 0===r)return"This macro call is incomplete or erroneously written. Macro calls should consist of `(`, the name (which is case-insensitive and dash-insensitive), `:`, zero or more expressions separated by commas, then `)`, in that order.";if("_"===r[0]||"$"===r[0])return"This is a <b>call to a custom macro stored in the "+r+" variable</b>. Custom macros are created with the `(macro:)` macro, and must be stored in variables in order to be used.";var o=e.Macro[t(r)];if(!o)return"This is a call to a nonexistent or misspelled macro. This will cause an error.";var n,i,s=o.returnType.toLowerCase();return"This is a <b>call to the `("+o.name+":)` macro</b>. "+("instant"===s||"command"===s?'It produces a <span class="cm-harlowe-3-macroName-command">command</span>, so it should appear in passage code without being connected to a hook.':"changer"===s?'It produces a <span class="cm-harlowe-3-macroName-changer">changer</span>, which can be placed to the left of a hook or a command (passage links are commands), or combined with other changers.':"any"===s||"string"===s?"":'Since it produces a <span class="cm-harlowe-3-macroName-'+s+'">'+s+"</span>, it should be nested inside another macro call that can use "+s+" (or any) data.")+"<code class='harlowe-3-tooltipMacroSignature'>"+(n=o.anchor,i="("+o.name+": "+o.sig+") -> "+o.returnType,'<a href="https://twine2.neocities.org/#'+n+'" target="_blank" rel="noopener noreferrer">'+i+"</a>")+"</code>"+(o.aka.length?"<div><i>Also known as: "+o.aka.map(function(e){return"<code>("+e+":)</code>"}).join(", ")+"</i>":"")+"</div><div>"+o.abstract+"</div>"},text:function(e,t){var a=e.changerAttachment,r=e.text;if(a)return"+"===r.trim()?'If the code to the left and right of this <b>+ sign</b> produces two <span class="cm-harlowe-3-macroName-changer">changer</span> values, then they will be added together (even though this text is outside of a macro call), removing the + sign and the surrounding whitespace.<br><br>Note that there needs to be a hook or a command after the rightmost changer, so that the combined changer can attach to it.':'If the code on the left produces a <span class="cm-harlowe-3-macroName-changer">changer</span>, and the code on the right is a hook or a <span class="cm-harlowe-3-macroName-command">command</span> (passage links are commands), then the changer will <b>attach</b> to the right, applying its changes and removing this whitespace.<br><br>You can place any amount of whitespace, including newlines, between a changer and the hook or command it\'s attached to.';if(r.trim()&&t.reduce(function(e,t){return void 0===e?"macro"===t.type||"hook"!==t.type&&e:e},void 0))return"This doesn't seem to be valid code.<br>Note that inside macro calls, only other macro calls, data, operators and whitespace are permitted."}},c=document.createElement("div");c.className="harlowe-3-tooltip";var l=0;function h(){l<1?c.style.display="":(l-=1,requestAnimationFrame(h))}this&&this.loaded&&(this.modules||(this.modules={}),e=this.modules.ShortDefs,this.modules.Tooltips=function(e,t,a){if(c.setAttribute("style","display:none"),t.somethingSelected())l=0;else{var r=document.querySelector(".CodeMirror");1&c.compareDocumentPosition(document)&&r.append(c);var o=t.getCursor(),n=a.pathAt(t.indexFromPos(o));if(n.length){var i=_slicedToArray(n,1)[0],d=s[i.type];if("function"==typeof d&&(d=d(i,n)),d){d=d.replace(/`([^`]+)`/g,function(e,t){return"<code>"+t+"</code>"}),c.innerHTML=d+"<div class=harlowe-3-tooltipTail>",c.removeAttribute("style");var u=c.getBoundingClientRect().width,m=r.getBoundingClientRect().width,p=e.charCoords(o,"local"),g=Math.min(m-u,Math.max(30+(0|p.left)-u/2,30));c.setAttribute("style","left:"+g+"px; top:"+(30+(0|p.top)-r.querySelector(".CodeMirror-scroll").scrollTop)+"px;"),c.lastChild.setAttribute("style","left:"+(p.right-g+(p.right-p.left)/2+6)+"px; top:-24px"),c.style.display="none";var b=l>0;l=50,b||h()}}else l=0}})}.call(eval("this")),function(){var e=JSON.stringify,t=JSON.parse,a=Math.round,r=void 0,o=void 0,n=void 0,i=void 0,s=void 0,c="querySelector",l=c+"All",h="addEventListener",d="removeEventListener",u=document.createElement("p");function m(e){return u.innerHTML=e,u.firstChild}var p,g=function e(t,a){return t?a?t>a?e(t-a,a):e(t,a-t):t:a},b=function(e){return a(1e4*e)/1e4},y=function(e){return'<i class="fa fa-'+e+'"></i>'},f=m('<div class="harloweToolbar">');function v(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(o&&0!==(e+t).length){var n=void 0!==a?a:o.doc.getSelection()||"Your Text Here";o.doc.replaceSelection(e+(r||String)(n)+t,"around")}}(p=m("<datalist id='harlowe-3-passages'>")).append.apply(p,_toConsumableArray(Array.from(document[l](".passage")).map(function(e){if(e.__vue__){var t=m("<option>");return t.setAttribute("value",e.__vue__.passage.name),t}return""}))),f.append(p);var k="background:hsl(0,0%,50%,0.5);opacity:0.5;pointer-events:none";function w(e){"string"!=typeof e&&(e="default");var t=getComputedStyle(f).height;Object.entries(r).forEach(function(t){var a=_slicedToArray(t,2),o=a[0],n=a[1];if("function"==typeof n){if(o!==e)return;n=r[o]=n()}n[l]("[type=radio]").forEach(function(e){return e.checked=e.parentNode.parentNode[c]("label:first-of-type")===e.parentNode}),n[l]("[type=checkbox]").forEach(function(e){return e.checked=!1}),n[l]("[type=text]").forEach(function(e){return e.value=""}),n[l]("select").forEach(function(e){e.value=e.firstChild.getAttribute("value");var t=e.nextElementSibling;t&&t.className.includes("harlowe-3-dropdownRows")&&Array.from(t.children).forEach(function(t){t[(t.getAttribute("data-value")===e.value?"remove":"set")+"Attribute"]("hidden","")})}),n.onreset()}),f[l](".harlowe-3-toolbarPanel").forEach(function(e){return e.remove()}),r[e].style.maxHeight=t,f.append(r[e]),f[l]("[data-use-selection]").forEach(function(e){return e.value=o.doc.getSelection()}),setTimeout(function(){return r[e].style.maxHeight="70vh"},100)}var x={default:function(e){return e?"appear step-end":"appear"},dissolve:function(){return"appear"},shudder:function(){return"shudder-in"},rumble:function(){return"rumble-in"},zoom:function(){return"zoom-in"},"slide-left":function(e){return e?"slide-right":"slide-left"},"slide-right":function(e){return e?"slide-left":"slide-right"},"slide-up":function(e){return e?"slide-down":"slide-up"},"slide-down":function(e){return e?"slide-up":"slide-down"},flicker:function(){return"flicker"},pulse:function(){return"pulse"},instant:function(e){return"appear step-"+(e?"end":"start")},"fade-right":function(e){return e?"fade-left":"fade-right"},"fade-left":function(e){return e?"fade-right":"fade-left"},"fade-up":function(e){return e?"fade-down":"fade-up"},"fade-down":function(e){return e?"fade-up":"fade-down"},blur:function(){return"blur"}},T={"#e61919":"red","#e68019":"orange","#e5e619":"yellow","#80e619":"lime","#19e619":"green","#19e5e6":"cyan","#197fe6":"blue","#1919e6":"navy","#7f19e6":"purple","#e619e5":"magenta","#ffffff":"white","#000000":"black","#888888":"grey"},C=[["#f8f9fa","#fff5f5","#fff0f6","#f8f0fc","#f3f0ff","#edf2ff","#e7f5ff","#e3fafc","#e6fcf5","#ebfbee","#f4fce3","#fff9db","#fff4e6"],["#f1f3f5","#ffe3e3","#ffdeeb","#f3d9fa","#e5dbff","#dbe4ff","#d0ebff","#c5f6fa","#c3fae8","#d3f9d8","#e9fac8","#fff3bf","#ffe8cc"],["#e9ecef","#ffc9c9","#fcc2d7","#eebefa","#d0bfff","#bac8ff","#a5d8ff","#99e9f2","#96f2d7","#b2f2bb","#d8f5a2","#ffec99","#ffd8a8"],["#dee2e6","#ffa8a8","#faa2c1","#e599f7","#b197fc","#91a7ff","#74c0fc","#66d9e8","#63e6be","#8ce99a","#c0eb75","#ffe066","#ffc078"],["#ced4da","#ff8787","#f783ac","#da77f2","#9775fa","#748ffc","#4dabf7","#3bc9db","#38d9a9","#69db7c","#a9e34b","#ffd43b","#ffa94d"],["#adb5bd","#ff6b6b","#f06595","#cc5de8","#845ef7","#5c7cfa","#339af0","#22b8cf","#20c997","#51cf66","#94d82d","#fcc419","#ff922b"],["#868e96","#fa5252","#e64980","#be4bdb","#7950f2","#4c6ef5","#228be6","#15aabf","#12b886","#40c057","#82c91e","#fab005","#fd7e14"],["#495057","#f03e3e","#d6336c","#ae3ec9","#7048e8","#4263eb","#1c7ed6","#1098ad","#0ca678","#37b24d","#74b816","#f59f00","#f76707"],["#343a40","#e03131","#c2255c","#9c36b5","#6741d9","#3b5bdb","#1971c2","#0c8599","#099268","#2f9e44","#66a80f","#f08c00","#e8590c"],["#212529","#c92a2a","#a61e4d","#862e9c","#5f3dc4","#364fc7","#1864ab","#0b7285","#087f5b","#2b8a3e","#5c940d","#e67700","#d9480f"]],S=["default","","instant","dissolve","blur","rumble","shudder","pulse","zoom","flicker","slide-left","slide-right","slide-up","slide-down","fade-left","fade-right","fade-up","fade-down"];function A(e,t){return 0==+t?"transparent":+t<1?(e=e.slice(1),"rgba("+parseInt(e.slice(0,2),16)+","+parseInt(e.slice(2,4),16)+","+parseInt(e.slice(4,6),16)+","+t+")"):e}function N(e,t){return e=e.toLowerCase(),0==+t?"transparent":+t<1?(e=function(e){e=e.slice(1);var t=parseInt(e.slice(0,2),16)/255,a=parseInt(e.slice(2,4),16)/255,r=parseInt(e.slice(4,6),16)/255,o=Math.max(t,a,r),n=Math.min(t,a,r),i=(o+n)/2,s=o-n;if(o===n)return{h:0,s:0,l:i};var c=void 0;switch(o){case t:c=(a-r)/s+(a<r?6:0);break;case a:c=(r-t)/s+2;break;case r:c=(t-a)/s+4}return{h:c=Math.round(60*c),s:i>.5?s/(2-o-n):s/(o+n),l:i}}(e),"(hsl:"+b(e.h)+","+b(e.s)+","+b(e.l)+","+b(t)+")"):e in T?T[e]:e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e}var _,O,L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t){return e.expression=t},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return{type:"inline-dropdown-rows",text:"Value: ",name:"variable-datatype",width:"16%",options:[["text string",{type:"inline-string-textarea",width:"55%",text:"",placeholder:"Text",modelCallback:e,modelRegistry:t}],["number",{type:"inline-number-textarea",width:"20%",text:"",modelCallback:e,modelRegistry:t}],["Boolean value",{type:"inline-dropdown",text:"",options:["false","true"],model:function(t,a){e(t,""+!!a[c]("select").value)},modelRegistry:t}],["colour",{type:"inline-colour",text:"",value:"#ffffff",model:function(t,a){var r=a[c]("[type=color]").value,o=a[c]("[type=range]").value;e(t,N(r,o))},modelRegistry:t}],["array",{type:"datavalue-rows",text:"<div class='harlowe-3-datavalueRowHint'>An <b>array</b> is a sequence of ordered datavalues that can be used without having to create separate variables for each. Use it to store similar values whose order and position matter, or to store an ever-changing quantity of similar values.</div>",model:function(t,a){e(t,"(a:"+a+")")},renumber:function(e,t){var a=((t+=1)+"").slice(-1);e.textContent=t+("1"===a?"st":"2"===a?"nd":"3"===a?"rd":"th")+": "},modelRegistry:t}],["datamap",{type:"datavalue-map",text:"<div class='harlowe-3-datavalueRowHint'>A <b>datamap</b> is a value that holds any number of other values, each of which is \"mapped\" to a unique name. Use it to store data values that represent parts of a larger game entity, or rows of a table.</div>",model:function(t,a){a.every(function(e,t){return t%2!=0||'""'!==e&&"''"!==e})||(t.invalidSubrow=!0),e(t,"(dm:"+a+")")},renumber:function(e){e.textContent=":"},modelRegistry:t}],[],["randomly chosen value",{type:"datavalue-rows",text:"<div class='harlowe-3-datavalueRowHint'>One of the following values is randomly chosen <b>each time the macro is run</b>.</div>",model:function(t,a){a.length||(t.invalidSubrow=!0),e(t,"(either:"+a+")")},renumber:function(e){e.textContent="\u2022",e.style.marginRight="0.5em"},modelRegistry:t}],["random number",m("<div class='harlowe-3-datavalueRowHint'>A number between these two values is randomly chosen <b>each time the macro is run</b>.</div>"),{type:"inline-number-textarea",width:"20%",text:"From",model:function(){},modelRegistry:t},{type:"inline-number-textarea",width:"20%",text:"to",model:function(t,a){e(t,"(random:"+(+a.previousElementSibling[c]("input").value||0)+","+(+a[c]("input").value||0)+")")},modelRegistry:t}]].concat(a?[]:[[],["itself + value",{type:"datavalue-inner",text:"<div class='harlowe-3-datavalueRowHint'>The following value is added to the existing value in the variable. NOTE: if the values aren't the same type of data, an error will result.</div>",model:function(t,a){1!==a.length&&(t.invalidSubrow=!0),e(t,"it + "+a)},renumber:function(e){(e||{}).textContent="it + "},modelRegistry:t}],["variable + value",{type:"inline-dropdown",text:" Other variable: ",options:["$","_"],model:function(e,t){e.innerVariable=t[c]("select").value?"_":"$"}},{type:"inline-textarea",width:"25%",text:"",placeholder:"Variable name",model:function(e,t){var a=t[c]("input").value;a&&RegExp("^"+i.validPropertyName+"$").exec(a)&&!RegExp(/^\d/).exec(a)&&(e.innerVariable+=a)}},{type:"datavalue-inner",text:"<div class='harlowe-3-datavalueRowHint'>The above variable's value and the value below are added together. NOTE: if the values aren't the same type of data, an error will result.</div>",model:function(t,a){1!==a.length&&(t.invalidSubrow=!0),e(t,t.innerVariable+" + "+a)},renumber:function(e){(e||{}).textContent=""},modelRegistry:t}]]).concat([[],["coded expression",{type:"expression-textarea",width:"90%",text:"<div>Write a Harlowe code expression that should be computed to produce the desired value.</div>",placeholder:"Code",modelCallback:e,modelRegistry:t}]])}},E=function(){for(var t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];return function(){var t=[],r=[];function o(){return Object.entries(this.changers).map(function(e){var t=_slicedToArray(e,2);return"("+t[0]+":"+t[1].join(",")+")"}).join("+")}function i(e){return this.changers[e]||(this.changers[e]=[])}var u=function(e){return t.reduce(function(e,t){return t(e)||e},{changers:{},wrapStart:"[",wrapEnd:"]",wrapStringify:!1,innerText:void 0,valid:!1,output:o,changerNamed:i,initiator:e})};function p(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target,t=u(e);r.forEach(function(e){return e(t)})}var g=m('<div class="harlowe-3-toolbarPanel" style="transition:max-height 0.8s;overflow-y:auto">'),b=function(e){var t=function(e,t,a){return m('<span class=harlowe-3-swatchRow data-index="'+t+'" '+(a?"":'style="display:none"')+">"+e.map(function(e){return'<span class=harlowe-3-swatch style="background-color:'+e+'"></span>'}).join("")+"</span>")},a=m('<div class=harlowe-3-singleColourPicker><input style="width:48px;margin-right:8px" type=color value="'+e+'"></div>'),r=m('<select><option value="" selected>Harlowe built-ins</option></select>');return a.append(t(Object.keys(T),"",!0)),C.forEach(function(e,o){a.append(t(e,o)),r.append(m("<option value="+o+">OpenColor "+o+"</option>"))}),r[h]("change",function(){a[l]("[data-index]").forEach(function(e){return e.style.display="none"}),a[c]('[data-index="'+r.value+'"]').style.display="inline-block"}),a.append(r,m("<br>"),new Text("Opacity: "),m('<input type=range style="width:64px;top:8px;position:relative" value=1 min=0 max=1 step=0.05>')),a[h]("click",function(e){var t=e.target;if(t.classList.contains("harlowe-3-swatch")){var r=a[c]("input");r.value=t.getAttribute("style").slice(-7),r.dispatchEvent(new Event("change"))}}),a},f=a.reduce(function a(o,i){var g=void 0,f=void 0,x="",T="label"===o.tagName.toLowerCase();if(Object.getPrototypeOf(i)!==Object.prototype?g=i:f=(x=i.type).startsWith("inline"),x.endsWith("text")&&(g=m("<"+(f?"span":"div")+">"+i.text+"</"+(f?"span":"div")+">")),"notice"===x&&(g=m('<small style="display:block">'+i.text+"</small>")),"buttons"===x&&o.append.apply(o,_toConsumableArray(i.buttons.map(function(e){if("tagName"in e)return e;var t=m('<button title="'+e.title+'" class="harlowe-3-toolbarButton'+(e.active?" active":"")+'">'+e.html+"</button>");return e.onClick&&t.addEventListener("click",e.onClick),t}))),x.endsWith("preview")){var C=i.tagName||"span";if(g=m('<div class="harlowe-3-stylePreview" style="'+(x.startsWith("t8n")?"cursor:pointer;height: 2.6rem;":"")+'" '+(x.startsWith("t8n")?'alt="Click to preview the transition"':"")+"><"+C+">"+(i.text||"")+"</"+C+">"+(x.startsWith("t8n")?"<"+C+">"+i.text2+"</"+C+">":"")+"</div>"),x.startsWith("t8n")){g[h]("mouseup",p),g[h]("touchend",p);var S=g[c](":first-child");S[h]("animationend",function(){return S.style.visibility="hidden"})}}if("checkbox"!==x&&"checkboxrow"!==x||(g=m('<label style="display:block;"><input type="checkbox"></input>'+i.text+"</label>"),x.endsWith("w")&&(i.subrow.reduce(a,g),i.subrow.forEach(function(e){var t=e.model;e.model=function(e,a){return!g[c](":scope > input:checked")||T&&!o[c](":scope > input:checked")?e:t(e,a)}})),g[h]("change",p)),"checkboxes"===x&&(g=m('<div class="harlowe-3-toolbarCheckboxRow"><div'+(i.bold?' style="font-weight:bold"':"")+">"+i.name+"</div></div>"),i.options.forEach(function(e){var t=m("<label"+(i.capitalise?' style="text-transform:capitalize;"':"")+'><input type="checkbox"></input>'+e+"</label>");t[h]("change",p),g.append(t)})),"radios"===x&&(g=m('<div class="harlowe-3-toolbarCheckboxRow"><div'+(i.bold?' style="font-weight:bold"':"")+">"+i.name+"</div></div>"),i.options.forEach(function(e,t){var a=m("<label"+(i.capitalise?' style="text-transform:capitalize;"':"")+'><input type="radio" name="'+i.name+'" value="'+e+'" '+(t?"":"checked")+"></input>"+e+"</label>");a[h]("change",p),g.append(a)})),x.endsWith("textarea")){var _="text";x.endsWith("expression-textarea")&&(i.update=function(e,t){!e.expression&&t[c]("input").value?t.setAttribute("invalid","This doesn't seem to be valid code."):t.removeAttribute("invalid")},i.model=function(e,t){var a=(t[c]("input").value||"").trim();if(a){if(n(a,0,"macro").children.every(function e(t){return"text"!==t.type&&"error"!==t.type&&("string"===t.type||"hook"===t.type||t.children.every(e))}))return void i.modelCallback(e,a);e.valid=!0}}),x.endsWith("string-textarea")&&(i.model||(i.model=function(e,t){i.modelCallback(e,JSON.stringify(t[c]("input").value||""))})),x.endsWith("number-textarea")&&(_="number",i.model||(i.model=function(e,t){i.modelCallback(e,+t[c]("input").value||0)})),(g=m("<"+(f?"span":"div")+' class="harlowe-3-labeledInput">'+i.text+"<input "+(i.useSelection?"data-use-selection":"")+(x.includes("passage")?'list="harlowe-3-passages"':"")+' style="width:'+i.width+";margin"+(f?":0 0.5rem":"-left:1rem")+';" type='+_+' placeholder="'+(i.placeholder||"")+'"></input></'+(f?"span":"div")+">"))[c]("input")[h]("input",p)}if((x.endsWith("number")||x.endsWith("range"))&&(g=m("<"+(f?"span":"div")+' class="harlowe-3-labeledInput">'+i.text+'<input style="" type='+(x.endsWith("range")?"range":"number")+" min="+i.min+" max="+i.max+" value="+i.value+(i.step?" step="+i.step:"")+"></input></"+(f?"span":"div")+">"))[c]("input")[h]("change",p),x.endsWith("colour")){g=m("<"+(f?"span":"div")+' class="harlowe-3-labeledInput">'+i.text+"</"+(f?"span":"div")+">");var O=b(i.value);g.append(O),g[l]("input").forEach(function(e){return e[h]("change",p)})}if(x.endsWith("gradient")){var E=(g=m("<div style='position:relative'><span class=harlowe-3-gradientBar></span><button>"+y("plus")+" Colour</button></div>"))[c](".harlowe-3-gradientBar"),F=function(e,t,a){var r=m("<div "+(a?"selected":"")+' data-colour="'+t+'" data-pos="'+e+'" class=harlowe-3-colourStop style="left:calc('+100*e+'% - 8px); top:-8px"><div class=harlowe-3-colourStopButtons style="left:'+-464*e+'px"></div></div>'),o=b(t);o[l]("input").forEach(function(e){return e[h]("change",function(){var e=o[c]("[type=range]").value,t=o[c]("[type=color]").value;r.setAttribute("data-colour",A(t,e)),e<1&&r.setAttribute("data-harlowe-colour",N(t,e)),p()})});var n=m("<button style='float:right'>"+y("times")+" Delete</button>");n[h]("click",function(){r.remove(),p()}),o.append(n),r.firstChild.prepend(o),E.append(r),p()};setTimeout(function(){F(0,"#ffffff"),F(.5,"#000000",!0),F(1,"#ffffff")}),g[c]("button")[h]("click",function(){return F(.5,"#888888")});var P=function(e){var t=e.target;if(t.classList.contains("harlowe-3-colourStop")){var a=document.documentElement,r=E.getBoundingClientRect(),o=r.left,n=r.right-o,i=function(e){var a=e.pageX,r=e.touches;if(void 0!==(a=a||r&&r[0].pageX)){var i=Math.min(1,Math.max(0,(a-window.scrollX-o)/n));t.style.left="calc("+100*i+"% - 8px)",t.firstChild.style.left=-464*i+"px",t.setAttribute("data-pos",i),p()}},s=function e(){a[d]("mousemove",i),a[d]("mouseup",e),a[d]("touchmove",i),a[d]("touchend",e)};a[h]("mousemove",i),a[h]("mouseup",s),a[h]("touchmove",i),a[h]("touchend",s),Array.from(E[l]("[selected]")).forEach(function(e){return e.removeAttribute("selected")}),t.setAttribute("selected",!0)}};g[h]("mousedown",P),g[h]("touchstart",P),r.push(function(){E.style.background="linear-gradient(to right, "+Array.from(E[l](".harlowe-3-colourStop")).sort(function(e,t){return e.getAttribute("data-pos")-t.getAttribute("data-pos")}).map(function(e){return e.getAttribute("data-colour")+" "+100*e.getAttribute("data-pos")+"%"})+")"})}if(x.endsWith("dropdown")){var I=m("<"+(f?"span":"div")+' style="'+(f?"":"width:50%;")+'position:relative;">'+i.text+'<select style="'+(f?"margin:0.5rem;":"margin-left:1rem;")+'font-size:1rem;margin-top:4px"></select></'+(f?"span":"div")+">");i.options.forEach(function(e,t){I.lastChild.append(m('<option value="'+(t?e:"")+'"'+(e?t?"":" selected":" disabled")+">"+(e||"\u2500\u2500\u2500\u2500\u2500\u2500\u2500")+"</select>"))}),I[c]("select")[h]("change",p),g=I}if("radiorows"===x&&(g=m("<div>"),i.options.forEach(function(e,t){var r=m('<label class=\'harlowe-3-radioRow\'><input type="radio" name="'+i.name+'" value="'+(t||"none")+'" '+(t?"":"checked")+"></input></label>");g.append(e.reduce(a,r)),e.forEach(function(e){var t=e.model;t&&(e.model=function(e,a){return!r[c](":scope > input:checked")||T&&!o[c](":scope > input:checked")?e:t(e,a)})}),r[c]("input")[h]("change",p)})),"macro-list"===x){g=m('<div><div style="text-align:center">Category: </div></div>');var H=m("<select>");g.firstChild.append(H);var R=m('<div style="margin-top:8px;border-top:1px solid hsla(0,0%,50%,0.5);max-height:40vh;overflow-y:scroll">');g.append(R),H[h]("change",function(){var e=R[c]('[name="'+H.value+'"]');e&&e.scrollIntoView()}),Object.values(s.Macro).sort(function(e,t){var a=e.name,r=e.category,o=e.categoryOrder,n=t.name,i=t.category,s=t.categoryOrder;return r!==i?(r||"").localeCompare(i||""):o!==s?isNaN(+o)?1:isNaN(+s)?-1:Math.sign(o-s):a.localeCompare(n)}).forEach(function(e,t,a){if(0!==t&&e.category===a[t-1].category||(R.append(m('<h3 style="text-transform:capitalize" name="'+e.category+'">'+e.category+"</h3>")),H.append(m('<option value="'+e.category+'">'+e.category+"</option>"))),!(t>0&&e.name===a[t-1].name)){var r=m('<label class=\'harlowe-3-radioRow\'><input type="radio" name="macro-list" value="'+e.name+'"></input><code><a href="https://twine2.neocities.org/#'+e.anchor+'" target="_blank" rel="noopener noreferrer">('+e.name+": "+e.sig+") \u2192 "+e.returnType+"</a></code>"+(e.aka.length?"<div><i>Also known as: "+e.aka.map(function(e){return"<code>("+e+":)</code>"}).join(", ")+"</i>":"")+"</div><div>"+e.abstract.replace(/`([^`]+)`/g,function(e,t){return"<code>"+t+"</code>"})+"</div></label>");R.append(r),r[c]("input")[h]("change",p)}})}if(x.endsWith("dropdown-rows")){var M=(g=m("<"+(f?"span":"div")+'><span class="harlowe-3-dropdownRowLabel">'+i.text+'</span><select style="font-size:1rem;margin-top:4px;'+(i.width?"width:"+i.width+";text-overflow:ellipsis":"")+'"></select><span class="harlowe-3-dropdownRows"></span></'+(f?"span":"div")+">"))[c]("select");i.options.forEach(function(e,t){var r=_toArray(e),n=r[0],i=r.slice(1);if(n){M.append(m('<option value="'+n+'" '+(t?"":"selected")+">"+n+"<option>"));var s=m('<span data-value="'+n+'" '+(t?"hidden":"")+">");g[c](".harlowe-3-dropdownRows").append(i.reduce(a,s)),i.forEach(function(e){var t=e.model;t&&(e.model=function(e,a){return M.value!==n||T&&!o[c](":scope > input:checked")?e:t(e,a)})})}else M.append(m("<option disabled>\u2500\u2500\u2500\u2500\u2500\u2500\u2500</option>"))}),M[h]("change",function(){var e=M.value;g[l](":scope > .harlowe-3-dropdownRows > span").forEach(function(t){t[(t.getAttribute("data-value")===e?"remove":"set")+"Attribute"]("hidden","")}),p()})}if("textarea-rows"===x){g=m('<div class="harlowe-3-textareaRows '+(i.nonZeroRows?"harlowe-3-nonZeroRows":"")+'">');!function e(){if(!(g.childNodes.length>100)){var t=m('<div class="harlowe-3-dataRow"><input type=text style="width:85%;" placeholder="'+i.placeholder+'"></input><button class="harlowe-3-rowMinus">'+y("minus")+'</button><button class="harlowe-3-rowPlus">'+y("plus")+"</button></div>");t[c]("input")[h]("input",p),t[c](".harlowe-3-rowPlus")[h]("click",function(){e(),p()}),t[c](".harlowe-3-rowMinus")[h]("click",function(){t.remove(),p()}),g.append(t)}}()}if("datavalue-inner"===x){g=m("<div class=\"harlowe-3-dataRow\" style='margin:0.2em 0px'>"+i.text+"</div>");var W=[],B=[];a(g,L(function(e,t){return B.push(t)},W,!0));var q=i.model;i.model=function(e){B=[],W.reduce(function(e,t){return t(e)||e},e),q&&q(e,B)},i.renumber(g[c](":scope > * > .harlowe-3-dropdownRowLabel"))}if("datavalue-rows"===x||"datavalue-map"===x){var j=(g=m('<div class="harlowe-3-datavalueRows">'+(i.text||"")+'<div class="harlowe-3-dataEmptyRow"><i>No data</i></div><button class="harlowe-3-rowPlus">'+y("plus")+" Value</button></div>"))[c](".harlowe-3-rowPlus"),z=new Set,D=[],V=function(){Array.from(g[l](":scope > .harlowe-3-dataRow > * > .harlowe-3-dropdownRowLabel")).forEach(i.renumber)},Y=i.model;i.model=function(e){D=[],[].concat(_toConsumableArray(z)).reduce(function(e,t){return t(e)||e},e),Y&&Y(e,D)},j[h]("click",function(){!function t(){if(!(g.childNodes.length>50)){var r=m('<div class="harlowe-3-dataRow">'),o=[];g.insertBefore((x.endsWith("map")?[{type:"inline-textarea",text:"",placeholder:"Data name",width:"15%",model:function(t,a){D.push(e(a[c]("input").value))},modelRegistry:o}]:[]).concat(L(function(e,t){return D.push(t)},o,!0)).reduce(a,r),j),o.forEach(function(e){return z.add(e)}),r.append(m('<button class="harlowe-3-rowMinus">'+y("minus")+"</button>")),r[c](":scope > .harlowe-3-rowMinus")[h]("click",function(){r.remove(),o.forEach(function(e){return z.delete(e)}),0===g.childNodes.length&&t(),p(),V()})}}(),p(),V()})}if("confirm"===x){var $=m('<p class="buttons" style="padding-bottom:8px;"></p>'),U=m('<span>Resulting code: <span class="harlowe-3-resultCode"><code></code> <code></code></span></span>'),G=m("<button>"+y("times")+" Cancel</button>"),X=m('<button class="create">'+y("check")+" Add</button>");X.setAttribute("style",k),r.push(function(e){var t=e.valid?"removeAttribute":"setAttribute";X[t]("style",k),U[t]("hidden",""),e.valid&&("function"==typeof e.wrapStart&&(e.wrapStart=e.wrapStart(e)),"function"==typeof e.wrapEnd&&(e.wrapEnd=e.wrapEnd(e)),U[c]("code:first-of-type").textContent=e.output()+e.wrapStart,U[c]("code:last-of-type").textContent=e.wrapEnd)}),G[h]("click",w),X[h]("click",function(){var e=u();"function"==typeof e.wrapStart&&(e.wrapStart=e.wrapStart(e)),"function"==typeof e.wrapEnd&&(e.wrapEnd=e.wrapEnd(e)),v(e.output()+e.wrapStart,e.wrapEnd,e.innerText,e.wrapStringify),w()}),$.append(U,G,X),g=$}if(T){var Z=i.update;i.update=function(e,t){var a=o[c](":scope > input:checked");Array.from(o[l]("div,br ~ *")).forEach(function(e){return e[(a?"remove":"set")+"Attribute"]("hidden","")}),Array.from(o[l]("input,select")).slice(1).forEach(function(e){return e[(a?"remove":"set")+"Attribute"]("disabled","")}),Z&&Z(e,t)}}return i.model&&(i.modelRegistry||t).push(function(e){return i.model(e,g)}),i.update&&r.push(function(e){return i.update(e,g)}),g&&o.append(g),o.onreset=p,o},g);return a=null,f}},F={type:"checkbox",text:"Affect the entire remainder of the passage or hook",model:function(e,t){t[c](":checked")&&(e.wrapStart="[=\n",e.wrapEnd="")}},P="A <b>hook</b> is a section of passage prose enclosed in <code>[</code> or <code>]</code>, or preceded with <code>[=</code>.",I={type:"confirm"};if(r={textstyle:function(){var a={bold:"font-weight:bold",italic:"font-style:italic",underline:"text-decoration: underline","double-underline":"text-decoration: underline;text-decoration-style:double","wavy-underline":"text-decoration: underline;text-decoration-style:wavy",strike:"text-decoration: line-through","double-strike":"text-decoration: line-through;text-decoration-style:double","wavy-strike":"text-decoration: line-through;text-decoration-style:wavy",superscript:"vertical-align:super;font-size:.83em",subscript:"vertical-align:sub;font-size:.83em",mark:"background-color: hsla(60, 100%, 50%, 0.6)",outline:"color:black; text-shadow: -1px -1px 0 white, 1px -1px 0 white, -1px  1px 0 white, 1px  1px 0 white",shadow:"text-shadow: 0.08em 0.08em 0.08em white",emboss:"text-shadow: 0.04em 0.04em 0em white",condense:"letter-spacing:-0.08em",expand:"letter-spacing:0.1em",blur:"text-shadow: 0em 0em 0.08em white; color:transparent",blurrier:"text-shadow: 0em 0em 0.2em white; color:transparent",smear:"text-shadow: 0em 0em 0.02em white, -0.2em 0em 0.5em white, 0.2em 0em 0.5em white; color:transparent",mirror:"display:inline-block;transform:scaleX(-1)","upside-down":"display:inline-block;transform:scaleY(-1)",blink:"animation:fade-in-out 1s steps(1,end) infinite alternate","fade-in-out":"animation:fade-in-out 2s ease-in-out infinite alternate",rumble:"display:inline-block;animation:harlowe-3-rumble linear 0.1s 0s infinite",shudder:"display:inline-block;animation:harlowe-3-shudder linear 0.1s 0s infinite",sway:"display:inline-block;animation:harlowe-3-sway 5s linear 0s infinite",buoy:"display:inline-block;animation:harlowe-3-buoy 5s linear 0s infinite",fidget:"display:inline-block;animation:harlowe-3-fidget 60s linear 0s infinite"};function r(t,a){var r,o=Array.from(a[l]("[type=radio]:checked")).map(function(e){return e.value}).filter(function(e){return"none"!==e}).concat(Array.from(a[l]("[type=checkbox]:checked")).map(function(e){return e.parentNode.textContent}));(r=t.changerNamed("text-style")).push.apply(r,_toConsumableArray(o.map(e))),t.valid=t.valid||o.length>0}return E({type:"preview",text:"Example text preview",update:function(e,r){r.firstChild.setAttribute("style","position:relative;"+e.changers["text-style"].map(function(e){return a[t(e)]}).join(";"))}},{type:"small",text:"This preview doesn't account for other modifications to this passage's text colour, font, or background, and is meant only for you to examine each of these styles."},{type:"checkboxes",name:"Font variants",capitalise:!0,bold:!0,options:["bold","italic","mark"],model:r},{type:"radios",name:"Underlines and strikes",capitalise:!0,bold:!0,options:["none","underline","double-underline","wavy-underline","strike","double-strike","wavy-strike"],model:r},{type:"radios",name:"Superscript and subscript",capitalise:!0,bold:!0,options:["none","superscript","subscript"],model:r},{type:"radios",name:"Outlines",capitalise:!0,bold:!0,options:["none","outline","shadow","emboss","blur","blurrier","smear"],model:r},{type:"radios",name:"Letter spacing",capitalise:!0,bold:!0,options:["none","condense","expand"],model:r},{type:"radios",name:"Flips",capitalise:!0,bold:!0,options:["none","mirror","upside-down"],model:r},{type:"radios",name:"Animations",capitalise:!0,bold:!0,options:["none","blink","fade-in-out","rumble","shudder","sway","buoy","fidget"],model:r},F,I)}(),borders:function(){function a(t,a){return[m("<div><b>"+t+"</b></div>"),{type:"inline-dropdown",text:"Style:",options:["none","","dotted","dashed","solid","double","groove","ridge","inset","outset"],model:function(t,r){var o=r[c]("select").value;t.changerNamed("b4r").push(e(o||"none")),(t.borderEnabled=t.borderEnabled||[])[a]=!!o}},{type:"inline-number",text:"Size:",value:1,min:.1,max:20,step:.1,model:function(e,t){e.changerNamed("b4r-size").push(t[c]("input").value)}},{type:"inline-colour",text:"Colour:",value:"#ffffff",update:function(e,t){t.setAttribute("style",e.borderEnabled[a]?"":"display:none")},model:function(e,t){var a=t[c]("[type=color]").value,r=t[c]("[type=range]").value;e.changerNamed("b4r-colour").push(N(a,r)),e.borderColours=(e.borderColours||[]).concat(A(a,r))}}]}return E.apply(void 0,[{type:"preview",text:"Example border preview",update:function(e,a){var r=e.suppressedChangers||e.changers;a.firstChild.setAttribute("style","border-style:"+(r.b4r?r.b4r.map(t).join(" ")+";":"")+(r["b4r-size"]?"border-width:"+r["b4r-size"].reduce(function(e,t){return e+" "+2*t+"px"},"")+";":"")+(r["b4r-colour"]?"border-color:"+e.borderColours.join(" ")+";":""))}}].concat(_toConsumableArray(a("Top",0)),_toConsumableArray(a("Right",1)),_toConsumableArray(a("Bottom",2)),_toConsumableArray(a("Left",3)),[{type:"radios",name:"Affect:",options:["The attached hook","The remainder of the passage or hook.","The entire passage."],model:function(e,t){var a=t[c]("input:checked"),r=Array.from(t[l]("label")).indexOf(a.parentNode);r>=2&&Object.keys(e.changers).length?(e.suppressedChangers=e.changers,e.changers={}):1===r&&(e.wrapStart="[=\n",e.wrapEnd="")}},{type:"confirm",model:function(e){e.valid=!0;var a=e.suppressedChangers||e.changers;[["b4r",function(e){return"none"===t(e)}],["b4r-size",function(e){return 1==+e}],["b4r-colour",function(e){return"transparent"===e}]].forEach(function(t){var r,o=_slicedToArray(t,2),n=o[0],i=o[1];a[n]=(4===(r=a[n]).length&&r[3]===r[1]&&r.pop(),3===r.length&&r[2]===r[0]&&r.pop(),2===r.length&&r[1]===r[0]&&r.pop(),r),a[n].every(i)&&(delete a[n],"b4r"===n&&(e.valid=!1))}),e.valid&&e.suppressedChangers&&(e.wrapStart="(enchant:?passage,"+Object.entries(a).map(function(e){var t=_slicedToArray(e,2);return"("+t[0]+":"+t[1].join(",")+")"}).join("+")+")",e.wrapEnd="")}}]))}(),textcolor:E({type:"preview",text:"Example text preview",update:function(e,t){var a=e.suppressedChangers||e.changers;t.firstChild.setAttribute("style",(a["text-colour"]?"color:"+e.textColour+";":"")+(e.stops?"background:linear-gradient("+e.angle+"deg, "+e.stops.map(function(e){return e.getAttribute("data-colour")+" "+100*e.getAttribute("data-pos")+"%"})+")":a.background?"background:"+e.backgroundColour:""))}},{type:"small",text:"This preview doesn't account for other modifications to this passage's text colour or background, and is meant only for you to examine the selected colours."},m("<div><b>Text colour</b></div>"),{type:"radiorows",name:"txtcolor",options:[[{type:"inline-text",text:"Default text colour"}],[new Text("Flat colour"),{type:"colour",text:"",value:"#ffffff",model:function(e,t){var a=t[c]("[type=color]").value,r=t[c]("[type=range]").value;e.changerNamed("text-colour").push(N(a,r)),e.textColour=A(a,r)}}]]},m("<div><b>Background</b></div>"),{type:"radiorows",name:"bgcolor",options:[[{type:"inline-text",text:"Default background",model:function(e){e.valid=!0}}],[new Text("Flat colour"),{type:"colour",text:"",value:"#000000",model:function(e,t){var a=t[c]("[type=color]").value,r=t[c]("[type=range]").value;e.changerNamed("background").push(N(a,r)),e.backgroundColour=A(a,r),e.valid=!0}}],[new Text("Linear gradient"),{type:"gradient",model:function(e,t){var a=Array.from(t[l](".harlowe-3-colourStop")).sort(function(e,t){return e.getAttribute("data-pos")-t.getAttribute("data-pos")});a.length>1&&(e.valid=!0,e.changerNamed("background").push("(gradient: $deg, "+a.map(function(e){return b(e.getAttribute("data-pos"))+","+(e.getAttribute("data-harlowe-colour")||e.getAttribute("data-colour"))})+")"),e.stops=a,e.angle=0)}},m("<br>"),{type:"inline-range",text:"Angle (deg):",value:0,min:0,max:359,step:1,model:function(e,t){if(e.valid){var a=e.changerNamed("background");e.angle=+t[c]("input").value,a[0]=a[0].replace("$deg",e.angle)}}}]]},{type:"radios",name:"Affect:",options:["The attached hook","The remainder of the passage or hook.","The entire passage.","The entire page."],model:function(e,t){var a=t[c]("input:checked"),r=Array.from(t[l]("label")).indexOf(a.parentNode),o=Object.entries(e.changers);r>=2&&o.length?(e.wrapStart="(enchant:?pa"+(2===r?"ssa":"")+"ge,"+o.map(function(e){var t=_slicedToArray(e,2);return"("+t[0]+":"+t[1].join(",")+")"}).join("+")+")",e.wrapEnd="",e.suppressedChangers=e.changers,e.changers={}):1===r&&(e.wrapStart="[=\n",e.wrapEnd="")}},I),passagelink:(O=function(){return[m("<br>"),{type:"inline-dropdown",text:"Departing passage transition: ",options:S,model:function(t,a){var r=a[c]("select").value;""!==r&&t.changerNamed("t8n-depart").push(e(r))}},{type:"inline-dropdown",text:"Arriving passage transition: ",options:S,model:function(t,a){var r=a[c]("select").value;""!==r&&t.changerNamed("t8n-arrive").push(e(r))}},{type:"inline-number",text:"Transition time (sec): ",value:.8,min:0,max:999,step:.1,model:function(e,t){var a=t[c]("input").value;.8!=+a&&e.changerNamed("t8n-time").push(a+"s")}},{type:"t8n-preview",text:"Departing Text",text2:"Arriving Text",update:function(e,a){if(!e.initiator||["select","div","span"].some(function(t){return t===e.initiator.tagName.toLowerCase()})){var r="harlowe-3-"+x[e.changers["t8n-depart"]?t(e.changers["t8n-depart"][0]):"default"](!0),o="harlowe-3-"+x[e.changers["t8n-arrive"]?t(e.changers["t8n-arrive"][0]):"default"](!1),n=e.changers["t8n-time"]?e.changers["t8n-time"][0]:"0.8s",i=a.firstChild,s=a.lastChild;i.setAttribute("style","animation:"+r+" reverse "+n+" 1;"),s.setAttribute("style","animation:"+o+" "+n+" 1;"),i.remove(),s.remove(),setTimeout(function(){return a.append(i,s)})}}}]},E({type:"radiorows",name:"whichclick",options:[[{type:"inline-textarea",text:"Create a hyperlink, with this text:",placeholder:"Link text (can't be empty)",useSelection:!0,width:"50%",model:function(e,t){var a=t[c]("input").value;a.length>0&&(e.linkText=a,e.valid=!0)}}],[{type:"inline-text",text:"Allow the entire page to be clicked.",model:function(e){e.changerNamed("click").push("?page"),e.clickPage=!0,e.valid=!0}},{type:"text",text:"This will place a faint blue border around the edges of the page, and change the mouse cursor to the hand pointer, until it is clicked."}]]},{type:"text",text:"<b>When it is clicked, perform this action:</b>"},{type:"radiorows",name:"passagelink",update:function(e,t){t.lastChild.firstChild[(e.clickPage?"set":"remove")+"Attribute"]("disabled",""),e.clickPage&&t.lastChild.firstChild.checked&&t.firstChild.firstChild.click()},options:[[{type:"inline-passage-textarea",text:"Go to this passage:",width:"70%",placeholder:"Passage name",model:function(t,a){var r=a[c]("input").value;r.length||(t.valid=!1),"click"in t.changers?(delete t.changers.click,t.wrapStart="(click-goto:?page,"+e(r)+")",t.wrapEnd=""):["]]","->","<-"].some(function(e){return r.includes(e)||t.linkText&&t.linkText.includes(e)})?(t.wrapStart="(link-goto:"+e(t.linkText)+",",t.wrapEnd=e(r)+")"):(t.wrapStart="[["+t.linkText,t.wrapEnd="->"+r+"]]"),t.innerText=""}}].concat(_toConsumableArray(O())),[{type:"inline-text",text:"Undo the current turn, returning to the previous passage.",model:function(t){"click"in t.changers?(t.wrapStart="(click-undo:"+t.changers.click+")",t.wrapEnd="",delete t.changers.click):(t.changerNamed("link-undo").push(e(t.linkText)),t.wrapStart="",t.wrapEnd="")}}].concat(_toConsumableArray(O())),[{type:"inline-dropdown",text:"Reveal ",options:["an attached hook.","the remainder of the passage."],model:function(e,t){t[c]("select").value&&(e.wrapStart="[=\n",e.wrapEnd="")}},m("<br>"),{type:"text",text:"("+P+")"},{type:"inline-dropdown",text:"Revealed text transition: ",options:S,model:function(t,a){var r=a[c]("select").value;""!==r&&t.changerNamed("t8n").push(e(r))}},{type:"inline-number",text:"Transition time (sec): ",value:.8,min:0,max:999,step:.1,model:function(e,t){var a=t[c]("input").value;.8!=+a&&e.changerNamed("t8n-time").push(a+"s")}},{type:"t8n-preview",text2:"Revealed Text",update:function(e,a){if(!e.initiator||["select","div","span"].some(function(t){return t===e.initiator.tagName.toLowerCase()})){var r="harlowe-3-"+x[e.changers.t8n?t(e.changers.t8n[0]):"default"](!1),o=e.changers["t8n-time"]?e.changers["t8n-time"][0]:"0.8s",n=a.lastChild;n.setAttribute("style","animation:"+r+" "+o+" 1;"),n.remove(),setTimeout(function(){return a.append(n)})}}},{type:"radiorows",name:"linkReveal",update:function(e,t){t[l]("input").forEach(function(t){return t[(e.clickPage?"set":"remove")+"Attribute"]("disabled","")})},options:[[{type:"inline-text",text:"Then remove the link's own text.",model:function(t){t.clickPage||t.changerNamed("link").push(e(t.linkText))}}],[{type:"inline-text",text:"Then unlink the link's own text.",model:function(t){t.clickPage||t.changerNamed("link-reveal").push(e(t.linkText))}}],[{type:"inline-text",text:"Re-run the hook each time the link is clicked.",model:function(t){t.clickPage||t.changerNamed("link-rerun").push(e(t.linkText))}}],[{type:"inline-text",text:"Repeat the hook each time the link is clicked.",model:function(t){t.clickPage||t.changerNamed("link-repeat").push(e(t.linkText))}}]]}],[{type:"inline-text",text:"Cycle the link's text to the next alternative in a list."},m("<br>"),{type:"textarea-rows",nonZeroRows:!0,placeholder:"Link text (can't be empty)",model:function(e,t){var a=[e.linkText].concat(Array.from(t[l]("input")).map(function(e){return e.value}));!e.clickPage&&a.every(Boolean)?(e.wrapStart="(cycling-link:"+a.map(function(e){return JSON.stringify(e)})+")",e.wrapEnd="",e.innerText=""):t.parentNode.firstChild.checked&&(e.valid=!1)}},{type:"radios",name:"Upon reaching the end:",options:["Loop to the start.","Remove the link.","Unlink the link."],model:function(e,t){if(e.valid){var a=t[c]("[type=radio]:checked").value;"U"===a[0]?e.wrapStart=e.wrapStart.replace(/^\(cycling/,"(seq"):"R"===a[0]&&(e.wrapStart=e.wrapStart.replace(/\)$/,',"")'))}}}]]},I)),if:E({type:"text",text:"<b>Only show a section of the passage if this condition is met:</b>"},{type:"radiorows",name:"if",options:[[{type:"inline-dropdown",text:"The player visited this passage",options:["exactly","at most","at least","anything but","a multiple of"],model:function(e,t){e.changerNamed("if").push("visits"+{"":" is ","at most":" <= ","at least":" >= ","anything but":" is not ","a multiple of":" % "}[t[c]("select").value])}},{type:"inline-number",text:"",value:0,min:0,max:999,model:function(e,t){var a=e.changerNamed("if");a[0]+=t[c]("input").value,a[0].includes(" % ")&&(a[0]+=" is 0",a[0]=a[0].replace(" % 2 is 0"," is an even")),e.valid=!0}},new Text(" times.")],[{type:"inline-dropdown",text:"The player has now visited this passage an",options:["even","odd"],model:function(e,t){e.changerNamed("if").push({"":"visits is an even",odd:"visits is an odd"}[t[c]("select").value]),e.valid=!0}},new Text(" number of times.")],[{type:"inline-number",text:"",value:2,min:1,max:999,model:function(e,t){e.changerNamed("after").push(t[c]("input").value+"s"),e.valid=!0}},new Text(" seconds have passed since this passage was entered.")],[{type:"inline-textarea",width:"30%",text:"The passage ",placeholder:"Passage name",model:function(t,a){var r=a[c]("input").value;r&&(t.changerNamed("if").push("(history: where it is "+e(r)+")'s length"),t.valid=!0)}},{type:"inline-dropdown",text:"was visited ",options:["exactly","at most","at least","anything but","a multiple of"],model:function(e,t){e.changerNamed("if")[0]+={"":" is ","at most":" <= ","at least":" >= ","anything but":" is not ","a multiple of":" % "}[t[c]("select").value]}},{type:"inline-number",text:"",value:1,min:1,max:999,model:function(e,t){var a=e.changerNamed("if");a[0]+=t[c]("input").value,a[0].includes(" % ")&&(a[0]+=" is 0",a[0]=a[0].replace(" % 2 is 0"," is even"))}},new Text(" times.")],[{type:"inline-textarea",width:"20%",text:"Passages with the tag ",placeholder:"Tag name",model:function(t,a){var r=a[c]("input").value;r&&(t.changerNamed("if").push("(history: where (passage:it)'s tags contains "+e(r)+")'s length"),t.valid=!0)}},{type:"inline-dropdown",text:"were visited ",options:["exactly","at most","at least","anything but","a multiple of"],model:function(e,t){var a=t[c]("select").value;e.changerNamed("if")[0]+={"":" is ","at most":" <= ","at least":" >= ","anything but":" is not ","a multiple of":" % "}[a]}},{type:"inline-number",text:"",value:1,min:1,max:999,model:function(e,t){var a=e.changerNamed("if");a[0]+=t[c]("input").value,a[0].includes(" % ")&&(a[0]+=" is 0",a[0]=a[0].replace(" % 2 is 0"," is even"))}},new Text(" times.")],[{type:"inline-text",text:"There are no more interactable elements in the passage.",model:function(e){e.changerNamed("more"),e.valid=!0}},{type:"text",text:"Interactable elements are link, mouseover, or mouseout areas. If you're using links that reveal additional lines of prose and then remove or unlink themselves, this will reveal the attached text when all of those are gone."}],[{type:"inline-dropdown",text:"The variable ",options:["$","_"],model:function(e,t){e.variable=t[c]("select").value?"_":"$"}},{type:"inline-textarea",width:"25%",text:"",placeholder:"Variable name",model:function(e,t){var a=t[c]("input").value;a&&RegExp("^"+i.validPropertyName+"$").exec(a)&&!RegExp(/^\d/).exec(a)&&(e.variable+=a)}},{type:"inline-dropdown",text:"",options:["is","is not","is greater than","is less than","contains","is in"],model:function(e,t){var a=t[c]("select").value;e.operator={"is greater than":">","is less than":"<","":"is"}[a]||a}},new Text("a certain data value."),m("<br>"),L(),{type:"text",text:"",model:function(e){void 0!==e.expression&&""!==e.expression&&e.operator&&e.variable&&!e.invalidSubrow&&(e.changerNamed("if").push(e.variable+" "+e.operator+" "+e.expression),e.valid=!0)}}]]},{type:"checkbox",text:"Also, only if the previous (if:), (else-if:) or (unless:) hook's condition wasn't fulfilled.",model:function(e,t){var a;t[c](":checked")&&("if"in e.changers?((a=e.changerNamed("else-if")).push.apply(a,_toConsumableArray(e.changerNamed("if"))),delete e.changers.if):e.changerNamed("else"))}},F,I),hook:E({type:"text",text:P+" The main purpose of hooks is that they can be visually or textually altered by special data values called <b>changers</b>. Changers are usually placed in front of hooks to change them.",model:function(e){e.wrapStart="[",e.wrapEnd="]",e.valid=!0}},{type:"textarea",width:"25%",text:"Hook name (letters, numbers and underscores only):",placeholder:"Hook name",model:function(e,t){var a=t[c]("input").value;a&&(RegExp("^"+i.validPropertyName+"$").exec(a)?(e.wrapStart="|"+a+">[",e.hookName=a):e.valid=!1)}},{type:"text",text:"",update:function(e,t){var a=(e.hookName||"").toLowerCase();a?["link","page","passage","sidebar"].includes(a)?t.innerHTML="The hook name <b><code>?"+a+"</code></b> is <b>reserved</b> by Harlowe. It refers to <b>"+("link"===a?"all of the links in the passage":"page"===a?"the entire HTML page":"passage"===a?"the element that contains the current passage's text":"sidebar"===a?"the passage's sidebar, containing the undo/redo icons":"unknown")+"</b>.":t.innerHTML="You can refer to this hook (and every other one with this name) using the code <b><code>?"+a+"</code></b>.":t.innerHTML="Hook names are optional, but giving a hook a nametag allows it to be remotely altered using macros like <code>(click:)</code>, <code>(replace:)</code>, or <code>(enchant:)</code>. You can use these macros elsewhere in the passage, keeping your prose uncluttered."}},I),align:E({type:"preview",text:"You can apply left, center and right alignment to your passage text, as well as adjust the margins and width.",update:function(e,t){t.setAttribute("style","width:100%;height:6em;overflow-y:hidden;");var a="width:"+100*e.width+"%;margin-left:"+100*e.left+"%;margin-right:"+100*e.right+"%;";"center"!==e.align&&(a+="text-align:"+e.align+";"),t.firstChild.setAttribute("style","display:block;"+a)}},{type:"inline-range",text:"Placement: ",value:0,min:0,max:10,step:1,model:function(e,t){e.placement=t[c]("input").value/10}},{type:"inline-range",text:"Width: ",value:5,min:1,max:10,step:1,model:function(e,t){e.width=t[c]("input").value/10;var a=1-e.width;e.left=a*e.placement,e.right=a*(1-e.placement)}},{type:"radios",name:"Alignment",capitalise:!0,options:["left","center","justify","right"],model:function(e,t){e.align=t[c]("input:checked").value}},{type:"checkbox",text:"Affect the entire remainder of the passage",model:function(t,r){var o=!!r[c](":checked");if(t.width===("center"===t.align?.5:1)&&(!t.left||!t.right)==("center"!==t.align&&"justify"!==t.align)){var n=a(10*t.left),i=a(10*t.right),s=g(n,i),l="left"===t.align?"<==":"right"===t.align?"==>":"=".repeat(n/s)+(n?">":"")+(i?"<":"")+"=".repeat(i/s);o?(t.wrapStart=l+"\n",t.wrapEnd=""):t.changerNamed("align").push(e(l))}else{var h=a(100*t.left),d=a(100*t.width),u=a(100*t.right),m=g(d,g(h,u));t.changerNamed("align").push(e("left"===t.align?"<==":"right"===t.align?"==>":"justify"===t.align?"<==>":"=><=")),t.changerNamed("box").push(e("=".repeat(h/m)+"X".repeat(d/m)+"=".repeat(u/m))),o&&(t.wrapStart="[=\n",t.wrapEnd="")}t.valid=!0}},I),rotate:E({type:"preview",text:"Rotated text preview",update:function(e,t){t.setAttribute("style","height:6em;");var a=t[c]("span"),r=e.changers,o=r["text-rotate-x"],n=r["text-rotate-y"],i=r["text-rotate-z"],s="margin-top:2em;transform:";(o||n)&&(s+="perspective(50vw) "),o&&(s+="rotateX("+o+"deg) "),n&&(s+="rotateY("+n+"deg) "),i&&(s+="rotateZ("+i+"deg)"),a.setAttribute("style",s)}},{type:"range",text:"Rotation (X axis):",value:0,min:0,max:359,step:1,model:function(e,t){var a=t[c]("input").value;+a&&(e.changerNamed("text-rotate-x").push(a),e.valid=!0)}},{type:"range",text:"Rotation (Y axis):",value:0,min:0,max:359,step:1,model:function(e,t){var a=t[c]("input").value;+a&&(e.changerNamed("text-rotate-y").push(a),e.valid=!0)}},{type:"range",text:"Rotation (Z axis):",value:0,min:0,max:359,step:1,model:function(e,t){var a=t[c]("input").value;+a&&(e.changerNamed("text-rotate-z").push(a),e.valid=!0)}},F,I),columns:E.apply(void 0,[{type:"preview",text:"Use columns to lay out two or more spans of prose alongside each other. Each column has its own margins and can occupy a different amount of horizontal space.",update:function(e,t){t.setAttribute("style","width:90%;display:flex;justify-content:space-between;height:5em;overflow-y:hidden;");for(var a=e.columns||[],r=Array.from(t[l]("span")),o=0;o<Math.max(a.length,r.length);o+=1)o>=a.length?r[o].remove():o>=r.length&&t.append(m("<span>"+r[0].textContent+"</span>"));var n=a.reduce(function(e,t){return e+t.width},0);Array.from(t[l]("span")).forEach(function(e,t){return e.setAttribute("style","position:relative; font-size:50%; width:"+a[t].width/n*100+"%;margin-left:"+a[t].left+"em;margin-right:"+a[t].right+"em")})}},{type:"inline-dropdown",text:"Columns:",options:["1","2","3","4","5","6"],model:function(e,t){e.columns=[].concat(_toConsumableArray(Array(+t[c]("select").value||1))).map(function(){return{left:1,width:1,right:1}}),e.wrapStart="",e.innerText="",e.wrapEnd=e.columns.length>1?"\n|==|":"",e.valid=!0},update:function(e,t){Array.from(t.parentNode[l](".harlowe-3-labeledInput")).forEach(function(e){return e.removeAttribute("style")}),Array.from(t.parentNode[l]("p:nth-of-type("+e.columns.length+") ~ .harlowe-3-labeledInput")).forEach(function(e){return e.setAttribute("style","display:none")})}},m("<br>")].concat(_toConsumableArray([0,1,2,3,4,5].reduce(function(e,t){return e.concat({type:"inline-number",text:"Column "+(t+1)+" left margin:",value:1,min:0,max:9,step:1,model:function(e,a){e.columns[t]&&(e.columns[t].left=+a[c]("input").value)}},{type:"inline-number",text:"Width:",value:1,min:1,max:9,step:1,model:function(e,a){e.columns[t]&&(e.columns[t].width=+a[c]("input").value)}},{type:"inline-number",text:"Right margin:",value:1,min:0,max:9,step:1,model:function(e,a){var r=e.columns[t];r&&(r.right=+a[c]("input").value,e.wrapStart+="\n"+"=".repeat(r.left)+"|".repeat(r.width)+"=".repeat(r.right)+"\nColumn "+(t+1))}},m("<p>"))},[])),[I])),collapse:E({type:"inline-dropdown",text:"Collapse the whitespace within ",options:["a section of the passage.","the remainder of the passage."],model:function(e,t){t[c]("select").value?(e.wrapStart="{=\n",e.wrapEnd=""):(e.wrapStart="{",e.wrapEnd="}"),e.valid=!0}},{type:"text",text:"The <b>collapsing markup</b> hides line breaks and reduces sequences of consecutive spaces to just a single space."},{type:"text",text:"If you wish to include whitespace that's exempt from this, you may include <b>HTML &lt;br&gt; tags</b>, or use the verbatim (Vb) markup."},I),basicValue:E({type:"text",text:"Use <b>variables</b> to store <b>data values</b>, either across your story or within a passage.<br>That data can then be used in the passage, or in other macro calls, by using the variable's name in place of that value."},{type:"textarea",width:"25%",text:"Variable name (letters, numbers and underscores only):",placeholder:"Variable name",model:function(e,t){var a=t[c]("input").value;a&&RegExp("^"+i.validPropertyName+"$").exec(a)&&!RegExp(/^\d/).exec(a)&&(e.variableName=a)}},L(),{type:"checkbox",text:"Temp variable (the variable only exists in this passage and hook).",model:function(e,t){e.sigil=t[c]("input").checked?"_":"$",e.variableName&&e.expression&&!e.invalidSubrow?(e.wrapStart="(set: "+e.sigil+e.variableName+" to "+e.expression+")",e.wrapEnd=e.innerText="",e.valid=!0):e.valid=!1}},{type:"text",text:"",update:function(e,t){var a=e.valid?""+e.sigil+e.variableName:"";t.innerHTML=e.valid?"<p>You can refer to this variable using the code <b><code>"+a+"</code></b>.</p><p>Some types of data values (arrays, datamaps, datasets, strings, colours, gradients, custom macros, and typedvars) are storage containers for other values.<br>You can access a specific value stored in them using that value's <b>data name</b> (or a string or number value in brackets) by writing <b><code>"+a+"'s</code></b> <i>name</i>, or <i>name</i> <b><code>of "+a+"</code></b>.</p><p>(If you want to display that stored value in the passage, you'll need to give it to a macro, such as <code>(print: "+a+"'s </code> <i>name</i><code>)</code>.)</p>":""}},I),input:E({type:"radiorows",name:"inputelement",options:[[new Text("Create a text input box."),m("<br>"),{type:"preview",tagName:"textarea",text:"You can type sample text into this preview box.",update:function(e,t){t.setAttribute("style","width:100%;height:6em;"),t.firstChild.setAttribute("style","display:block;resize:none;font-family:Georgia,serif;border-style:solid;border-color:#fff;color:#fff;width:"+100*e.width+"%;margin-left:"+100*e.left+"%;margin-right:"+100*e.right+"%;"),t.firstChild.setAttribute("rows",e.rows||3)},model:function(t){t.wrapStart=function(t){var r=a(100*t.left),o=a(100*t.width),n=a(100*t.right),i=g(o,g(r,n));return"("+("forcedText"in t?"force-":"")+"input-box:"+(t.variable?"2bind "+t.variable+",":"")+e("=".repeat(r/i)+"X".repeat(o/i)+"=".repeat(n/i))+(3!==t.rows?","+t.rows:"")+("forcedText"in t?","+e(t.forcedText):t.initialText?","+e(t.initialText):"")+")"},t.wrapEnd=t.innerText="",t.valid=!0}},{type:"inline-range",text:"Placement: ",value:5,min:0,max:10,step:1,model:function(e,t){e.placement=t[c]("input").value/10}},{type:"inline-range",text:"Width: ",value:5,min:1,max:10,step:1,model:function(e,t){e.width=t[c]("input").value/10;var a=1-e.width;e.left=a*e.placement,e.right=a*(1-e.placement)}},{type:"inline-number",text:"Rows:",value:3,min:1,max:9,step:1,model:function(e,t){e.rows=+t[c]("input").value}},{type:"radiorows",name:"inputboxtype",options:[[{type:"inline-textarea",width:"50%",text:"The box initially contains this text:",placeholder:"Initial text",model:function(e,t){e.initialText=t[c]("input").value||""}}],[{type:"inline-textarea",width:"50%",text:"Force the player to type this text:",placeholder:"Text to display",model:function(e,t){e.forcedText=t[c]("input").value||""}},m("<div>Instead of being a normal input box, this will instead slowly write the above text into the box as the player presses keys.</div>")]]}],[new Text("Create a dropdown menu."),m("<br>"),{type:"inline-text",text:"Dropdown options (leave blank to make a separator):"},{type:"textarea-rows",nonZeroRows:!0,placeholder:"Option text (leave blank to make a separator)",model:function(t,a){var r=Array.from(a[l]("input")).map(function(e){return e.value});r.some(Boolean)&&(t.wrapStart=function(t){return"(dropdown: "+(t.variable?"2bind "+t.variable+",":"")+r.map(function(t){return e(t)})+")"},t.wrapEnd=t.innerText="",t.valid=!0)}}],[new Text("Create a checkbox."),m("<br>"),{type:"inline-textarea",width:"50%",text:"Checkbox label:",placeholder:"Label text",model:function(t,a){var r=a[c]("input").value||"";r&&(t.wrapStart=function(t){return"(checkbox: "+(t.variable?"2bind "+t.variable+",":"")+e(r)+")"},t.wrapEnd=t.innerText="",t.valid=!0),t.needsVariable=!0}}],[new Text("Show a dialog box."),m("<br>"),m("<div>This dialog box will appear as soon as the macro is displayed. This is best used inside a hook that's only shown if a condition is met.</div>"),{type:"textarea",width:"80%",text:"Text:",placeholder:"Your text here",model:function(t,a){var r=a[c]("input").value||"";t.wrapStart=function(t){return"(dialog: "+(t.variable?"bind "+t.variable+",":"")+e(r)+", "+t.links.map(function(t){return e(t)})+")"},t.wrapEnd=t.innerText=""}},{type:"inline-text",text:"Link options:"},{type:"textarea-rows",nonZeroRows:!0,placeholder:"Link text (can't be blank)",model:function(e,t){var a=Array.from(t[l]("input")).map(function(e){return e.value});a.every(Boolean)&&(e.links=a,e.valid=!0)}}]]},{type:"checkboxrow",text:"",update:function(e,t){var a=t[c]("input");e.needsVariable?(a.setAttribute("disabled",!0),a.checked=!0):a.removeAttribute("disabled",!0)},model:function(e,t){e.needsVariable&&!t[c]("input:checked")&&(e.valid=!1)},subrow:[{type:"inline-dropdown",text:"Bind this input element to the variable",options:["$","_"],model:function(e,t){e.variable=t[c]("select").value?"_":"$"}},{type:"inline-textarea",width:"25%",text:"",placeholder:"Variable name",model:function(e,t){var a=t[c]("input").value;a&&RegExp("^"+i.validPropertyName+"$").exec(a)&&!RegExp(/^\d/).exec(a)?e.variable+=a:e.valid=!1}}]},I),macro:E({type:"text",text:"<b>Macros</b> are code used for programming and styling your story. The vast majority of Harlowe's features are available through macros.<br>All of the built-in Harlowe macros are listed here. For more details, click their signatures to open the documentation."},{type:"macro-list",model:function(e,t){var a=t[c]("input:checked");a&&(e.wrapStart="("+a.value+":",e.wrapEnd=")",e.innerText="Your Code Here",e.valid=!0)}},I),default:E({type:"buttons",buttons:[{title:"Bold",html:y("bold"),onClick:function(){return v("''","''")}},{title:"Italic",html:y("italic"),onClick:function(){return v("//","//")}},{title:"Strikethrough",html:y("strikethrough"),onClick:function(){return v("~~","~~")}},{title:"Superscript",html:y("superscript"),onClick:function(){return v("^^","^^")}},{title:"Text and background colour",html:"<div class='harlowe-3-bgColourButton'>",onClick:function(){return w("textcolor")}},{title:"Borders",html:'<span style="display:inline-block; height:16px; width:16px; border-style: dotted solid solid dotted; border-size:3px;"></span>',onClick:function(){return w("borders")}},{title:"Rotated text",html:'<div style="transform:rotate(-30deg);font-family:serif;font-weight:bold">R</div>',onClick:function(){return w("rotate")}},{title:"Special text style",html:"Styles\u2026",onClick:function(){return w("textstyle")}},m('<span class="harlowe-3-toolbarBullet">'),{title:"Heading",html:y("header"),onClick:function(){return v("\n#","")}},{title:"Bulleted list item",html:y("list-ul"),onClick:function(){return v("\n* ","")}},{title:"Numbered list item",html:y("list-ol"),onClick:function(){return v("\n0. ","")}},{title:"Horizontal rule",html:"<b>\u2014</b>",onClick:function(){return v("\n---\n","")}},{title:"Alignment",html:y("align-right"),onClick:function(){return w("align")}},{title:"Columns",html:y("columns"),onClick:function(){return w("columns")}},m('<span class="harlowe-3-toolbarBullet">'),{title:"Collapse whitespace (at runtime)",html:"<b>{}</b>",onClick:function(){return w("collapse")}},{title:"Verbatim (ignore all markup)",html:"Vb",onClick:function(){var e=(o.doc.getSelection().match(/`+/g)||[]).reduce(function(e,t){return Math.max(t.length,e)},0);v("`".repeat(e+1),"`".repeat(e+1))}},m('<span class="harlowe-3-toolbarBullet">'),{title:"Link element",html:"Link\u2026",onClick:function(){return w("passagelink")}},{title:"Only show a portion of text if a condition is met",html:"If\u2026",onClick:function(){return w("if")}},{title:"Input element",html:"Input\u2026",onClick:function(){return w("input")}},{title:"Hook (named section of the passage)",html:"Hook\u2026",onClick:function(){return w("hook")}},{title:"Set a variable with a data value",html:"Var\u2026",onClick:function(){return w("basicValue")}},{title:"Peruse a list of all built-in macros",html:"Macro\u2026",onClick:function(){return w("macro")}},m('<span class="harlowe-3-toolbarBullet">'),{title:"Proofreading view (dim all code except strings)",html:y("eye"),onClick:function(e){var t=e.target;f.classList.toggle("harlowe-3-hideCode"),"i"===t.tagName.toLowerCase()&&(t=t.parentNode),t.classList.toggle("active")}},{title:"Coding tooltips (show a tooltip when the cursor rests on code structures)",html:y("comment"),active:!0,onClick:function(e){var t=e.target;f.classList.toggle("harlowe-3-hideTooltip"),"i"===t.tagName.toLowerCase()&&(t=t.parentNode),t.classList.toggle("active")}},m('<span class="harlowe-3-toolbarBullet">'),{title:"Open the Harlowe documentation",html:y("question"),onClick:function(){return window.open("https://twine2.neocities.org/","Harlowe Documentation","noopener,noreferrer")}},(_=m('<button style="position:absolute;right:1em;margin-top:-2em">'+y("chevron-up")+"</button>"),_.addEventListener("click",function(){f.classList.toggle("harlowe-3-minimised");var e=_.firstChild.classList;e.toggle("fa-chevron-down"),e.toggle("fa-chevron-up")}),_)]})},w(),this&&this.loaded){var H=this.modules;n=H.Markup.lex,i=H.Patterns,s=H.ShortDefs,this.modules.Toolbar=function(e){var t=document[c](".editor .passageTags");t&&t.after(f),o=e}}}.call(eval("this")),function(){var e=function(e){return(e+"").toLowerCase().replace(/-|_/g,"")},t=void 0,a=void 0,r=void 0,o=void 0;if("object"===("undefined"==typeof module?"undefined":_typeof(module))){var n=require("../lexer");t=n.lex}else if("function"==typeof define&&define.amd)define("markup",[],function(e){t=e.lex});else if(this&&this.loaded&&this.modules){var i=this.modules;t=i.Markup.lex,a=i.Toolbar,r=i.Tooltips,o=i.ShortDefs}else this.TwineMarkup&&(t=this.TwineMarkup.lex,o=this.ShortDefs);var s=Object.entries(o.Macro).reduce(function(e,t){var a=_slicedToArray(t,2),r=a[0],o=a[1];return[r].concat(_toConsumableArray(o.aka)).forEach(function(t){return e[t]=o}),e},{}),c=Object.entries(s).filter(function(e){var t=_slicedToArray(e,2),a=(t[0],t[1]);return["Changer","Any"].includes(a.returnType)}).map(function(e){return e[0]});window.CodeMirror&&CodeMirror.defineMode("harlowe-3",function(){var o=void 0,n=void 0,i={variable:[],tempVariable:[],hook:[],hookName:[],clear:function(){this.variable=[],this.tempVariable=[],this.hook=[],this.hookName=[]}};function l(e){"variable"!==e.type&&"tempVariable"!==e.type&&"hook"!==e.type&&"hookName"!==e.type||i[e.type].push(e),"string"===e.type&&(e.childAt=void 0,e.children=[]),e.children.forEach(l)}function h(e){var a=t(e);return i.clear(),a.children.forEach(l),a}var d=[];function u(e,a,r){Array.from(r.querySelectorAll(".cm-harlowe-3-colour")).forEach(function(e){var a=t(e.textContent,0,"macro").tokenAt(0).colour;e.setAttribute("style","background:linear-gradient(to bottom,transparent,transparent 80%,"+a+" 80.1%,"+a+")")})}var m=function(){var e=o.doc;n=h(e.getValue()),e.on("beforeChange",function(t,a){!function(e,t){if(e.update){var a=e.from.line,r=t.split("\n").slice(0,e.from.line+1);r[a]=r[a].slice(0,e.from.ch)+e.text[0],r=r.concat(e.text.slice(1)),e.update({line:0,ch:0},e.to,r),r.join("\n")}}(a,e.getValue())}),e.on("change",function(){var t=e.getValue();n=h(t)}),e.on("cursorActivity",function(){!function(e,t){d.length&&(d.forEach(function(e){return e.clear()}),d=[]);var a=t.tokenAt(e.indexFromPos(e.getCursor()));if(a){if(d.push(e.markText(e.posFromIndex(a.start),e.posFromIndex(a.end),{className:"cm-harlowe-3-cursor"})),"variable"===a.type||"tempVariable"===a.type||"hookName"===a.type||"hook"===a.type){var r="hook"===a.type?"hookName":a.type;i[r].forEach(function(t){t!==a&&t.name===a.name&&d.push(e.markText(e.posFromIndex(t.start),e.posFromIndex(t.end),{className:"cm-harlowe-3-variableOccurrence"}))})}"hookName"!==a.type&&"hook"!==a.type||i.hook.forEach(function(t){if(t!==a&&t.name&&t.name===a.name){var r="appended"===t.tagPosition?t.end-t.name.length-1:t.start+1;d.push(e.markText(e.posFromIndex(r),e.posFromIndex(r+t.name.length),{className:"cm-harlowe-3-hookOccurrence"}))}})}}(e,n),r&&r(o,e,n)}),o.on("renderLine",u),o.on("scroll",function(){var e=document.querySelector(".harlowe-3-tooltip");e&&e.remove()}),m=null};return{startState:function(){return o||((o=CodeMirror.modes["harlowe-3"].cm).setOption("placeholder",["Enter the body text of your passage here.","''Bold'', //italics//, ^^superscript^^, ~~strikethrough~~, and <p>HTML tags</p> are available.","To display special symbols without them being transformed, put them between `backticks`.","To link to another passage, write the link text and the passage name like this: [[link text->passage name]]\nor this: [[passage name<-link text]]\nor this: [[link text]].","Macros like (set:) and (display:) are the programming of your passage. If you've (set:) a $variable, you can just enter its name to print it out.","To make a 'hook', put [single square brackets] around text - or leave it empty [] - then put a macro like (if:), a $variable, or a |nametag> outside the front, |like>[so].","Hooks can be used for many things: showing text (if:) something happened, applying a (text-style:), making a place to (append:) text later on, and much more!","Consult the Harlowe documentation for more information."].join("\n\n")),o.setOption("lineNumbers",!0),o.setOption("lineNumberFormatter",function(){return"\u2022"})),a&&a(o),{pos:0,attachment:!1}},blankLine:function(e){e.pos++},token:function(t,a){m&&m();var r=n.pathAt(a.pos),o=r[0];if(!o)return a.pos++,t.next(),null;for(;o===o.tokenAt(a.pos)&&!t.eol();)a.pos++,t.next();t.eol()&&a.pos++;for(var i={},l="",h=0;h<r.length;h+=1){var d=r[h],u=d.type,p=d.text;"verbatim"===u&&(l=""),0!==h||!a.attachment||"escapedLine"===u||"br"===u||"root"===u||"text"===u&&p.match(/^\s*\+?\s*$/)||(a.attachment=!1);var g="harlowe-3-"+u;switch(i[g]=(i[g]||0)+1,i[g]>1&&(g+="-"+i[g]),u){case"text":if(p.trim())r.slice(h+1).reduce(function(e,t){return void 0===e?"macro"===t.type||"hook"!==t.type&&e:e},void 0)&&(g+=" harlowe-3-error");break;case"macroName":var b=r[h].text[0];if("_"===b||"$"===b){g+=" harlowe-3-customMacro harlowe-3-"+("_"===b?"tempV":"v")+"ariable";break}var y=e(r[h].text.slice(0,-1));s.hasOwnProperty(y)?g+="-"+s[y].returnType.toLowerCase():g+=" harlowe-3-error";break;case"macro":var f=e(r[h].children[0].text.slice(0,-1));if(!c.includes(f))break;case"variable":case"tempVariable":0===h&&a.pos===r[h].end&&(a.attachment=!0)}l+=g+" "}return!0===a.attachment&&(l+=" harlowe-3-changerAttachment",o.changerAttachment=!0),l}}});var l=document.querySelector("style#cm-harlowe-3");l||((l=document.createElement("style")).setAttribute("id","cm-harlowe-3"),document.head.appendChild(l)),l.innerHTML=".cm-harlowe-3-root{box-sizing:border-box;}.cm-harlowe-3-cursor:not([class^='cm-harlowe-3-text cm-harlowe-3-root']){border-bottom: 2px solid darkgray;}.CodeMirror{padding: 0 !important}.CodeMirror-linenumber{color: hsla(0,0%,80%,1.0);}.CodeMirror-gutters{left: 0px !important;}.cm-harlowe-3-hook{background-color: hsla(40,100%,50%,0.05);}.theme-dark .cm-harlowe-3-hook{background-color: hsla(40,100%,50%,0.05);}.cm-harlowe-3-hook-2{background-color: hsla(40,100%,50%,0.1);}.theme-dark .cm-harlowe-3-hook-2{background-color: hsla(40,100%,50%,0.1);}.cm-harlowe-3-hook-3{background-color: hsla(40,100%,50%,0.15);}.theme-dark .cm-harlowe-3-hook-3{background-color: hsla(40,100%,50%,0.15);}.cm-harlowe-3-hook-4{background-color: hsla(40,100%,50%,0.2);}.theme-dark .cm-harlowe-3-hook-4{background-color: hsla(40,100%,50%,0.2);}.cm-harlowe-3-hook-5{background-color: hsla(40,100%,50%,0.25);}.theme-dark .cm-harlowe-3-hook-5{background-color: hsla(40,100%,50%,0.25);}.cm-harlowe-3-hook-6{background-color: hsla(40,100%,50%,0.3);}.theme-dark .cm-harlowe-3-hook-6{background-color: hsla(40,100%,50%,0.3);}.cm-harlowe-3-hook-7{background-color: hsla(40,100%,50%,0.35);}.theme-dark .cm-harlowe-3-hook-7{background-color: hsla(40,100%,50%,0.35);}.cm-harlowe-3-hook-8{background-color: hsla(40,100%,50%,0.4);}.theme-dark .cm-harlowe-3-hook-8{background-color: hsla(40,100%,50%,0.4);}[class^='cm-harlowe-3-hook '], [class^='cm-harlowe-3-hook-']{font-weight:bold;}.cm-harlowe-3-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}.theme-dark .cm-harlowe-3-unclosedHook{background-color: hsla(40,100%,50%,0.05);font-weight:bold;}.cm-harlowe-3-error:not([class*='cm-harlowe-3-string']){background-color: hsla(17,100%,50%,0.5) !important;}.theme-dark .cm-harlowe-3-error:not([class*='cm-harlowe-3-string']){background-color: hsla(17,100%,50%,0.5) !important;}[class^='cm-harlowe-3-macroName']{font-style:italic;}.cm-harlowe-3-macroName-boolean{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-3-macroName-boolean{color:hsla(0,0%,70%,1.0)}.cm-harlowe-3-macroName-array{color:hsla(0,100%,30%,1.0)}.theme-dark .cm-harlowe-3-macroName-array{color:hsla(0,100%,70%,1.0)}.cm-harlowe-3-macroName-dataset{color:hsla(30,100%,40%,1.0)}.theme-dark .cm-harlowe-3-macroName-dataset{color:hsla(30,100%,60%,1.0)}.cm-harlowe-3-macroName-datatype{color:hsla(220,100%,30%,1.0)}.theme-dark .cm-harlowe-3-macroName-datatype{color:hsla(220,100%,70%,1.0)}.cm-harlowe-3-macroName-number{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-3-macroName-number{color:hsla(30,100%,70%,1.0)}.cm-harlowe-3-macroName-datamap{color:hsla(60,100%,30%,1.0)}.theme-dark .cm-harlowe-3-macroName-datamap{color:hsla(60,100%,70%,1.0)}.cm-harlowe-3-macroName-changer{color:hsla(90,100%,30%,1.0)}.theme-dark .cm-harlowe-3-macroName-changer{color:hsla(90,100%,70%,1.0)}.cm-harlowe-3-macroName-string{color:hsla(180,100%,30%,1.0)}.theme-dark .cm-harlowe-3-macroName-string{color:hsla(180,100%,70%,1.0)}.cm-harlowe-3-macroName-colour, .cm-harlowe-3-macroName-gradient{color:hsla(280,100%,30%,1.0)}.theme-dark .cm-harlowe-3-macroName-colour, .theme-dark .cm-harlowe-3-macroName-gradient{color:hsla(280,100%,70%,1.0)}.cm-harlowe-3-macroName-command, .cm-harlowe-3-macroName-instant, .cm-harlowe-3-macroName-metadata{color:hsla(240,100%,20%,1.0)}.theme-dark .cm-harlowe-3-macroName-command, .theme-dark .cm-harlowe-3-macroName-instant, .theme-dark .cm-harlowe-3-macroName-metadata{color:hsla(240,100%,80%,1.0)}.cm-harlowe-3-macroName-custommacro, .cm-harlowe-3-macroName-any{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-3-macroName-custommacro, .theme-dark .cm-harlowe-3-macroName-any{color:hsla(320,100%,70%,1.0)}[class^='cm-harlowe-3-macro ']{font-weight:bold;color:hsla(320,80%,30%,1.0)}.theme-dark [class^='cm-harlowe-3-macro ']{font-weight:bold;color:hsla(320,100%,70%,1.0)}.cm-harlowe-3-comma, .cm-harlowe-3-spread{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-3-comma, .theme-dark .cm-harlowe-3-spread{color:hsla(320,100%,70%,1.0)}.cm-harlowe-3-addition{color:hsla(320,80%,30%,1.0)}.theme-dark .cm-harlowe-3-addition{color:hsla(320,100%,70%,1.0)}.cm-harlowe-3-subtraction, .cm-harlowe-3-multiplication, .cm-harlowe-3-division{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-3-subtraction, .theme-dark .cm-harlowe-3-multiplication, .theme-dark .cm-harlowe-3-division{color:hsla(30,100%,70%,1.0)}.cm-harlowe-3-is, .cm-harlowe-3-and, .cm-harlowe-3-or, .cm-harlowe-3-not, .cm-harlowe-3-isNot, .cm-harlowe-3-contains, .cm-harlowe-3-doesNotContain, .cm-harlowe-3-isIn, .cm-harlowe-3-isA, .cm-harlowe-3-isNotA, .cm-harlowe-3-isNotIn, .cm-harlowe-3-matches, .cm-harlowe-3-doesNotMatch{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-3-is, .theme-dark .cm-harlowe-3-and, .theme-dark .cm-harlowe-3-or, .theme-dark .cm-harlowe-3-not, .theme-dark .cm-harlowe-3-isNot, .theme-dark .cm-harlowe-3-contains, .theme-dark .cm-harlowe-3-doesNotContain, .theme-dark .cm-harlowe-3-isIn, .theme-dark .cm-harlowe-3-isA, .theme-dark .cm-harlowe-3-isNotA, .theme-dark .cm-harlowe-3-isNotIn, .theme-dark .cm-harlowe-3-matches, .theme-dark .cm-harlowe-3-doesNotMatch{color:hsla(0,0%,70%,1.0)}.cm-harlowe-3-bold, .cm-harlowe-3-strong{font-weight:bold;}.cm-harlowe-3-italic, .cm-harlowe-3-em{font-style:italic;}.cm-harlowe-3-sup{vertical-align: super;font-size:0.8em;}.cm-harlowe-3-strike{text-decoration: line-through;}.cm-harlowe-3-changerAttachment.cm-harlowe-3-text{text-decoration: line-through dashed hsla(90,100%,30%,0.5);color:hsla(90,100%,30%,1.0)}.theme-dark .cm-harlowe-3-changerAttachment.cm-harlowe-3-text{text-decoration: line-through dashed hsla(90,100%,70%,0.5);color:hsla(90,100%,70%,1.0)}.cm-harlowe-3-verbatim{background-color: hsla(0,0%,50%,0.1);}.theme-dark .cm-harlowe-3-verbatim{background-color: hsla(0,0%,50%,0.1);}[class^='cm-harlowe-3-bold'], [class^='cm-harlowe-3-strong'], [class^='cm-harlowe-3-italic'], [class^='cm-harlowe-3-em'], [class^='cm-harlowe-3-sup'], [class^='cm-harlowe-3-verbatim'], [class^='cm-harlowe-3-strike']{font-weight:100; color: hsla(0,0,0,0.5)}[class^='cm-harlowe-3-collapsed']{font-weight:bold; color: hsla(201,100%,30%,1.0);}.theme-dark [class^='cm-harlowe-3-collapsed']{font-weight:bold; color: hsla(201,100%,70%,1.0);}.cm-harlowe-3-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,30%,1.0);}.theme-dark .cm-harlowe-3-unclosedCollapsed{background-color: hsla(220,100%,50%,0.025);font-weight:bold; color: hsla(201,100%,70%,1.0);}.cm-harlowe-3-collapsed{background-color: hsla(220,100%,50%,0.025);}.theme-dark .cm-harlowe-3-collapsed{background-color: hsla(220,100%,50%,0.025);}.cm-harlowe-3-collapsed.cm-harlowe-3-hook{background-color: hsla(220,100%,50%,0.05);}.theme-dark .cm-harlowe-3-collapsed.cm-harlowe-3-hook{background-color: hsla(220,100%,50%,0.05);}.cm-harlowe-3-collapsed.cm-harlowe-3-hook-2{background-color: hsla(220,100%,50%,0.1);}.theme-dark .cm-harlowe-3-collapsed.cm-harlowe-3-hook-2{background-color: hsla(220,100%,50%,0.1);}.cm-harlowe-3-collapsed.cm-harlowe-3-hook-3{background-color: hsla(220,100%,50%,0.15);}.theme-dark .cm-harlowe-3-collapsed.cm-harlowe-3-hook-3{background-color: hsla(220,100%,50%,0.15);}.cm-harlowe-3-collapsed.cm-harlowe-3-hook-4{background-color: hsla(220,100%,50%,0.2);}.theme-dark .cm-harlowe-3-collapsed.cm-harlowe-3-hook-4{background-color: hsla(220,100%,50%,0.2);}.cm-harlowe-3-collapsed.cm-harlowe-3-hook-5{background-color: hsla(220,100%,50%,0.25);}.theme-dark .cm-harlowe-3-collapsed.cm-harlowe-3-hook-5{background-color: hsla(220,100%,50%,0.25);}.cm-harlowe-3-collapsed.cm-harlowe-3-hook-6{background-color: hsla(220,100%,50%,0.3);}.theme-dark .cm-harlowe-3-collapsed.cm-harlowe-3-hook-6{background-color: hsla(220,100%,50%,0.3);}.cm-harlowe-3-collapsed.cm-harlowe-3-hook-7{background-color: hsla(220,100%,50%,0.35);}.theme-dark .cm-harlowe-3-collapsed.cm-harlowe-3-hook-7{background-color: hsla(220,100%,50%,0.35);}.cm-harlowe-3-collapsed.cm-harlowe-3-hook-8{background-color: hsla(220,100%,50%,0.4);}.theme-dark .cm-harlowe-3-collapsed.cm-harlowe-3-hook-8{background-color: hsla(220,100%,50%,0.4);}.cm-harlowe-3-twineLink:not(.cm-harlowe-3-text){color:hsla(240,100%,20%,1.0)}.theme-dark .cm-harlowe-3-twineLink:not(.cm-harlowe-3-text){color:hsla(240,100%,80%,1.0)}.cm-harlowe-3-tag, .cm-harlowe-3-scriptStyleTag, .cm-harlowe-3-comment{color: hsla(240,34%,25%,1.0);}.theme-dark .cm-harlowe-3-tag, .theme-dark .cm-harlowe-3-scriptStyleTag, .theme-dark .cm-harlowe-3-comment{color: hsla(240,51%,75%,1.0);}.cm-harlowe-3-boolean{color:hsla(0,0%,30%,1.0)}.theme-dark .cm-harlowe-3-boolean{color:hsla(0,0%,70%,1.0)}.cm-harlowe-3-string{color:hsla(180,100%,30%,1.0)}.theme-dark .cm-harlowe-3-string{color:hsla(180,100%,70%,1.0)}.cm-harlowe-3-number{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-3-number{color:hsla(30,100%,70%,1.0)}.cm-harlowe-3-variable{color:hsla(200,100%,30%,1.0)}.theme-dark .cm-harlowe-3-variable{color:hsla(200,100%,70%,1.0)}.cm-harlowe-3-tempVariable{color:hsla(200,70%,20%,1.0)}.theme-dark .cm-harlowe-3-tempVariable{color:hsla(200,100%,80%,1.0)}.cm-harlowe-3-hookName{color:hsla(160,100%,30%,1.0)}.theme-dark .cm-harlowe-3-hookName{color:hsla(160,100%,70%,1.0)}.cm-harlowe-3-datatype{color:hsla(220,100%,30%,1.0)}.theme-dark .cm-harlowe-3-datatype{color:hsla(220,100%,70%,1.0)}.cm-harlowe-3-colour{color:hsla(280,100%,30%,1.0)}.theme-dark .cm-harlowe-3-colour{color:hsla(280,100%,70%,1.0)}.cm-harlowe-3-cssTime{color:hsla(30,100%,30%,1.0)}.theme-dark .cm-harlowe-3-cssTime{color:hsla(30,100%,70%,1.0)}.cm-harlowe-3-variableOccurrence, .cm-harlowe-3-hookOccurrence{background: hsla(159,50%,75%,1.0) !important;}.theme-dark .cm-harlowe-3-variableOccurrence, .theme-dark .cm-harlowe-3-hookOccurrence{background: hsla(159,75%,25%,1.0) !important;}[class^='cm-harlowe-3-where'], [class^='cm-harlowe-3-via'], [class^='cm-harlowe-3-with'], [class^='cm-harlowe-3-making'], [class^='cm-harlowe-3-each'], [class^='cm-harlowe-3-when']{color: #007f00; font-style:italic;}.cm-harlowe-3-heading{font-weight:bold;}.cm-harlowe-3-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,75%,1.0) 45%, transparent 55%, transparent);}.theme-dark .cm-harlowe-3-hr{background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,25%,1.0) 45%, transparent 55%, transparent);}.cm-harlowe-3-align{color: hsla(14,99%,37%,1.0); background-color: hsla(14,99%,87%,0.1);}.theme-dark .cm-harlowe-3-align{color: hsla(14,100%,63%,1.0); background-color: hsla(14,100%,13%,0.1);}.cm-harlowe-3-column{color: hsla(204,99%,37%,1.0); background-color: hsla(204,99%,87%,0.1);}.theme-dark .cm-harlowe-3-column{color: hsla(204,100%,63%,1.0); background-color: hsla(204,100%,13%,0.1);}.cm-harlowe-3-escapedLine{font-weight:bold; color: hsla(51,100%,30%,1.0);}.theme-dark .cm-harlowe-3-escapedLine{font-weight:bold; color: hsla(51,100%,70%,1.0);}.cm-harlowe-3-identifier, .cm-harlowe-3-property, .cm-harlowe-3-belongingProperty, .cm-harlowe-3-itsProperty, .cm-harlowe-3-belongingItProperty, .cm-harlowe-3-belongingItOperator{color:hsla(200,80%,40%,1.0)}.theme-dark .cm-harlowe-3-identifier, .theme-dark .cm-harlowe-3-property, .theme-dark .cm-harlowe-3-belongingProperty, .theme-dark .cm-harlowe-3-itsProperty, .theme-dark .cm-harlowe-3-belongingItProperty, .theme-dark .cm-harlowe-3-belongingItOperator{color:hsla(200,100%,60%,1.0)}@keyframes harlowe-3-appear{0%{opacity:0}to{opacity:1}}@keyframes harlowe-3-fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes harlowe-3-rumble{25%{top:-0.1em}75%{top:0.1em}0%,to{top:0px}}@keyframes harlowe-3-shudder{25%{left:0.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes harlowe-3-buoy{25%{top:0.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes harlowe-3-sway{25%{left:0.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes harlowe-3-pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes harlowe-3-zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes harlowe-3-shudder-in{0%, to{transform:translateX(0em)}5%, 25%, 45%{transform:translateX(-1em)}15%, 35%, 55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes harlowe-3-rumble-in{0%, to{transform:translateY(0em)}5%, 25%, 45%{transform:translateY(-1em)}15%, 35%, 55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes harlowe-3-fidget{0%, 8.1%, 82.1%, 31.1%, 38.1%, 44.1%, 40.1%, 47.1%, 74.1%, 16.1%, 27.1%, 72.1%, 24.1%, 95.1%, 6.1%, 36.1%, 20.1%, 4.1%, 91.1%, 14.1%, 87.1%, to{left:0px;top:0px}8%, 82%, 31%, 38%, 44%{left:-1px}40%, 47%, 74%, 16%, 27%{left:1px}72%, 24%, 95%, 6%, 36%{top:-1px}20%, 4%, 91%, 14%, 87%{top:1px}}@keyframes harlowe-3-slide-right{0%{transform:translateX(-100vw)}}@keyframes harlowe-3-slide-left{0%{transform:translateX(100vw)}}@keyframes harlowe-3-slide-up{0%{transform:translateY(100vh)}}@keyframes harlowe-3-slide-down{0%{transform:translateY(-100vh)}}@keyframes harlowe-3-fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes harlowe-3-fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes harlowe-3-fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes harlowe-3-fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes harlowe-3-flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:0.2}64%{opacity:0.4}78%{opacity:0.6}87%{opacity:0.8}92%, to{opacity:1}}@keyframes harlowe-3-blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}\r\n.harlowe-3-toolbarPanel{transition:max-height 0.8s;overflow-y:auto;margin-bottom:4px}.harlowe-3-minimised .harlowe-3-toolbarPanel>:not(:last-child){display:none}.harlowe-3-toolbarPanel code:not(:empty){font-size:1rem;border:1px dotted gray}.harlowe-3-toolbarPanel [type=\"radio\"][disabled] ~ *{opacity:0.5}.harlowe-3-stylePreview{text-align:center;user-select:none;overflow:hidden;background:black;color:white;font-family:'Georgia',serif;padding:8px;font-size:1.5rem;margin:8px auto;width:50%;position:relative}.harlowe-3-stylePreview>span{display:inline-block}.harlowe-3-stylePreview>span:first-child{position:absolute}.harlowe-3-stylePreview>span:last-child{position:relative}.harlowe-3-toolbarPanel>button{border-radius:0.8rem;margin:0px 2px;padding:0px 4px;height:36px;font-size:1.2rem;min-width:28px}.harlowe-3-toolbarPanel>button:not(:active):not(.active):not(:last-child){border:1px solid rgba(128,128,128,0.5);border-top:none;border-left:none}.harlowe-3-toolbarCheckboxRow{border-bottom:1px solid rgba(128,128,128,0.5);position:relative;padding-bottom:8px;margin-bottom:8px}.harlowe-3-toolbarCheckboxRow>label{min-width:20%;display:inline-block}.harlowe-3-toolbarRadios{border-bottom:1px solid rgba(128,128,128,0.5);position:relative;padding-bottom:8px;margin-bottom:8px}.harlowe-3-swatch{width:24px;height:24px;display:inline-block;cursor:pointer;border-bottom:1px solid rgba(128,128,128,0.5);border-right:1px solid rgba(128,128,128,0.5)}.harlowe-3-labeledInput{position:relative;padding-bottom:8px}.harlowe-3-labeledInput>input[type=text]{display:inline-block;font-size:1rem}.harlowe-3-labeledInput>input[type=range]{vertical-align:middle}.harlowe-3-labeledInput>input[type=number]{box-shadow:0 1px 0 rgba(128,128,128,0.5);background:transparent;color:inherit;border:none;font-family:'Source Code Pro',monospace;width:4rem;margin:0 0.5rem;display:inline-block;font-size:1rem}.harlowe-3-radioRow{margin:8px 0px;display:block}.harlowe-3-radioRow .harlowe-3-radioRow{margin-left:2rem}.harlowe-3-toolbarPanel>*>.harlowe-3-radioRow{border-bottom:1px solid rgba(128,128,128,0.5);padding-bottom:8px}.harlowe-3-resultCode{max-width:50%;overflow-x:auto;white-space:pre;display:inline-block;vertical-align:middle;padding:1px 0px}.harlowe-3-resultCode *{white-space:nowrap}.harlowe-3-toolbarBullet{padding:0px 2px;color:rgba(128,128,128,0.5)}.harlowe-3-toolbarBullet::before{content:\"\u2022\"}.harlowe-3-bgColourButton{display:inline-block;border-radius:8px;width:16px;height:16px;margin-bottom:-2px;background:linear-gradient(to right, rgba(255,0,0,0.5), rgba(255,128,0,0.5), rgba(255,255,0,0.5), rgba(0,255,0,0.5), rgba(0,255,255,0.5), rgba(0,0,255,0.5), rgba(255,0,255,0.5), rgba(255,0,170,0.5))}.harlowe-3-gradientBar{display:inline-block;position:relative;width:75%;height:32px;margin:12px 8px 96px 40px;border:1px solid rgba(128,128,128,0.5);border-radius:5px}.harlowe-3-gradientBar+button{position:absolute;top:8px;right:8px}.harlowe-3-colourStop{position:absolute;height:48px;width:16px;background:rgba(128,128,128,0.5);border-radius:5px;cursor:grab}.harlowe-3-colourStop:active{cursor:grabbing}.harlowe-3-colourStopButtons{display:none;position:relative;top:64px;width:540px;background:rgba(128,128,128,0.5);padding:8px;cursor:auto}.harlowe-3-colourStop[selected]{border-bottom-right-radius:0px;border-bottom-left-radius:0px;height:64px}.harlowe-3-colourStop[selected]>.harlowe-3-colourStopButtons{display:block}.harlowe-3-singleColourPicker{display:inline-block}.harlowe-3-singleColourPicker select{position:relative;top:-4px;font-size:1rem;margin-left:8px}.harlowe-3-directionPicker{width:48px;height:48px;border-radius:24px;border:1px solid rgba(128,128,128,0.5);display:inline-block}.harlowe-3-hideCode ~ * .cm-harlowe-3-root:not(.cm-harlowe-3-text):not(.cm-harlowe-3-string),.harlowe-3-hideCode ~ * .cm-harlowe-3-changerAttachment{opacity:0.25}.harlowe-3-tooltip{font-family:\"Source Sans Pro\", sans-serif;max-width:20vw;position:absolute;border:1px solid rgba(128,128,128,0.5);padding:8px;display:block;z-index:2}.theme-light .harlowe-3-tooltip{background:white}.theme-dark .harlowe-3-tooltip{background:black}.harlowe-3-hideTooltip ~ * .harlowe-3-tooltip{display:none}.harlowe-3-tooltipMacroSignature{display:block;padding-top:0.5em;margin-top:0.5em;border-top:1px solid rgba(128,128,128,0.5)}.harlowe-3-tooltipTail{position:absolute;height:0;width:0;border:12px solid transparent;border-bottom-color:rgba(128,128,128,0.5)}.harlowe-3-tooltipTail::after{content:'';position:absolute;height:0;width:0;left:-12px;top:-10px;border:12px solid transparent}.theme-light .harlowe-3-tooltipTail::after{border-bottom-color:white}.theme-dark .harlowe-3-tooltipTail::after{border-bottom-color:black}.harlowe-3-dataEmptyRow:not(:last-child){display:none}.harlowe-3-dataRow .harlowe-3-dropdownRowLabel{font-family:'Source Code Pro',monospace}.harlowe-3-textareaRows{margin-bottom:0.5em}.harlowe-3-nonZeroRows>:first-child>.harlowe-3-rowMinus{display:none}.harlowe-3-datavalueRows{margin-left:6px;padding-left:6px;border-left:1px solid rgba(128,128,128,0.5)}.harlowe-3-toolbarPanel [invalid]::after{display:block;position:absolute;content:attr(invalid);background-color:rgba(255,72,0,0.5);right:0px;bottom:8px}.harlowe-3-datavalueRows .harlowe-3-datavalueRows .harlowe-3-datavalueRowHint{display:none}\r\n"}.call(eval("this"));
}});